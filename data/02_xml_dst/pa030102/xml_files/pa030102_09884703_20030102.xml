<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030000201A1-20030102-M00001.NB SYSTEM "US20030000201A1-20030102-M00001.NB" NDATA NB>
<!ENTITY US20030000201A1-20030102-M00001.TIF SYSTEM "US20030000201A1-20030102-M00001.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-M00002.NB SYSTEM "US20030000201A1-20030102-M00002.NB" NDATA NB>
<!ENTITY US20030000201A1-20030102-M00002.TIF SYSTEM "US20030000201A1-20030102-M00002.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00000.TIF SYSTEM "US20030000201A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00001.TIF SYSTEM "US20030000201A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00002.TIF SYSTEM "US20030000201A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00003.TIF SYSTEM "US20030000201A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00004.TIF SYSTEM "US20030000201A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00005.TIF SYSTEM "US20030000201A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00006.TIF SYSTEM "US20030000201A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00007.TIF SYSTEM "US20030000201A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00008.TIF SYSTEM "US20030000201A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00009.TIF SYSTEM "US20030000201A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00010.TIF SYSTEM "US20030000201A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00011.TIF SYSTEM "US20030000201A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00012.TIF SYSTEM "US20030000201A1-20030102-D00012.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00013.TIF SYSTEM "US20030000201A1-20030102-D00013.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00014.TIF SYSTEM "US20030000201A1-20030102-D00014.TIF" NDATA TIF>
<!ENTITY US20030000201A1-20030102-D00015.TIF SYSTEM "US20030000201A1-20030102-D00015.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030000201</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>09884703</doc-number>
</application-number>
<application-number-series-code>09</application-number-series-code>
<filing-date>20010619</filing-date>
</domestic-filing-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>F01N003/00</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>060</class>
<subclass>274000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>060</class>
<subclass>276000</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Method and system for controlling an emission control device based on depletion of device storage capacity</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Garth</given-name>
<middle-name>Michael</middle-name>
<family-name>Meyer</family-name>
</name>
<residence>
<residence-us>
<city>Dearborn</city>
<state>MI</state>
<country-code>US</country-code>
</residence-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Joseph</given-name>
<middle-name>Richard</middle-name>
<family-name>Asik</family-name>
</name>
<residence>
<residence-us>
<city>Bloomfield Hills</city>
<state>MI</state>
<country-code>US</country-code>
</residence-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<correspondence-address>
<name-1>Julia Voutyras</name-1>
<name-2>Ford Global Technologies, Inc.</name-2>
<address>
<address-1>East Parklane Towers</address-1>
<address-2>One Parklane Blvd. Suite 600</address-2>
<city>Dearborn</city>
<state>MI</state>
<postalcode>48126</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A method of optimizing vehicle emissions during lean engine operation is disclosed wherein an emission control device receiving engine exhaust gases is filled with one or more constituent gases of the exhaust gas to a predetermined fraction of the device storage capacity, and is then completely emptied during a subsequent purge. As the device storage capacity is substantially reduced, as indicated by an actual fill time becoming equal to or less than a predetermined minimum fill time, a device regeneration cycle is performed to attempt to restore device capacity. A programmed computer controls the fill and purge times based on the amplitude of the voltage of a switching-type oxygen sensor and the time response of the sensor. The frequency of the purge, which ideally is directly related to the device capacity depletion rate, is controlled so that the device is not filled beyond its storage capacity limit. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Technical Field </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The invention relates to a method of controlling the nominal fill and purge times used in connection with an emission control device to facilitate &ldquo;lean-burn&rdquo; operation of an internal combustion engine. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Background Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Generally, the operation of a vehicle&apos;s internal combustion engine produces engine exhaust that includes a variety of constituent gases, including carbon monoxide (CO), hydrocarbons (HC), and nitrogen oxides (NO<highlight><subscript>x</subscript></highlight>). The rates at which the engine generates these constituent gases are dependent upon a variety of factors, such as engine operating speed and load, engine temperature, spark timing, and EGR. Moreover, such engines often generate increased levels of one or more constituent gases, such as NO<highlight><subscript>x</subscript></highlight>, when the engine is operated in a lean-burn cycle, i.e., when engine operation includes engine operating conditions characterized by a ratio of intake air to injected fuel that is greater than the stoichiometric air-fuel ratio, for example, to achieve greater vehicle fuel economy. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> In order to control these vehicle tailpipe emissions, the prior art teaches vehicle exhaust treatment systems that employ one or more three-way catalysts, also referred to as emission control devices, in an exhaust passage to store and release select constituent gases, such as NO<highlight><subscript>x</subscript></highlight>, depending upon engine operating conditions. For example, U.S. Pat. No. 5,437,153 teaches an emission control device which stores exhaust gas NO<highlight><subscript>x </subscript></highlight>when the exhaust gas is lean, and releases previously-stored NO<highlight><subscript>x </subscript></highlight>when the exhaust gas is either stoichiometric or &ldquo;rich&rdquo; of stoichiometric, i.e., when the ratio of intake air to injected fuel is at or below the stoichiometric air-fuel ratio. Such systems often employ open-loop control of device storage and release times (also respectively known as device &ldquo;fill&rdquo; and &ldquo;purge&rdquo; times) so as to maximize the benefits of increased fuel efficiency obtained through lean engine operation without concomitantly increasing tailpipe emissions as the device becomes &ldquo;filled.&rdquo; The timing of each purge event must be controlled so that the device does not otherwise exceed its NO<highlight><subscript>x </subscript></highlight>storage capacity, because NO<highlight><subscript>x </subscript></highlight>would then pass through the device and effect an increase in tailpipe NO<highlight><subscript>x </subscript></highlight>emissions. The frequency of the purge is preferably controlled to avoid the purging of only partially filled devices, due to the fuel penalty associated with the purge event&apos;s enriched air-fuel mixture. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> The prior art has recognized that the storage capacity of a given emission control device is itself a function of many variables, including device temperature, device history, sulfation level, and the presence of any thermal damage to the device. Moreover, as the device approaches its maximum capacity, the prior art teaches that the incremental rate at which the device continues to store the selected constituent gas may begin to fall. Accordingly, U.S. Pat. No. 5,437,153 teaches use of a nominal NO<highlight><subscript>x</subscript></highlight>-storage capacity for its disclosed device which is significantly less than the actual NO<highlight><subscript>x</subscript></highlight>-storage capacity of the device, to thereby provide the device with a perfect instantaneous NO<highlight><subscript>x</subscript></highlight>-storing efficiency, that is, so that the device is able to store all engine-generated NO<highlight><subscript>x </subscript></highlight>as long as the cumulative stored NO<highlight><subscript>x </subscript></highlight>remains below this nominal capacity. A purge event is scheduled to rejuvenate the device whenever accumulated estimates of engine-generated NO<highlight><subscript>x </subscript></highlight>reach the device&apos;s nominal capacity. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> The amount of the selected constituent gas that is actually stored in a given emission control device during vehicle operation depends on the concentration of the selected constituent gas in the engine feedgas, the exhaust flow rate, the ambient humidity, the device temperature, and other variables. Thus, both the device capacity and the actual quantity of the selected constituent gas stored in the device are complex functions of many variables. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> When the engine is operated using a fuel containing sulfur, sulfur is stored in the device and causes a decrease in both the device&apos;s absolute capacity to store the selected constituent gas, and the device&apos;s instantaneous efficiency to store the selected constituent gas. When such device sulfation exceeds a critical level, the absorbed. SOX must be &ldquo;burned off&rdquo; or released during a regeneration or desulfation event, during which device temperatures are raised above perhaps about 650&deg; C. in the presence of excess HC and CO. By way of example only, U.S. Pat. No. 5,746,049 teaches a device desulfation method which includes raising the device temperature to at least 650&deg; C. by introducing a source of secondary air into the exhaust upstream of the NO<highlight><subscript>x </subscript></highlight>device when operating the engine with an enriched air-fuel mixture and relying on the resulting exothermic reaction to raise the device temperature to the desired level to purge the device of SOX. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> It is an object of the invention to provide a method and system for controlling an emission control device based on the depletion of the device&apos;s capacity to store a selected engine-generated constituent gas. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> Under the invention, a method of filling and purging an emission control device, located in an exhaust passage of an engine upstream from an oxygen sensor, is provided so that the device is substantially filled to capacity with a constituent gas of the engine-generated exhaust gas during a fill time and is substantially emptied of previously-stored constituent gas during a subsequent purge time. The method includes calculating the depletion of device capacity of the device based on a calibrated device filling rate in engine speed load regions multiplied by the time spent in the region; continuously summing the calculated depletion; and scheduling a purge event when the summed calculated depletion exceeds a predetermined value for capacity depletion, wherein the predetermined value for capacity depletion is less than 100%. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> In accordance with a feature of the invention, the calibrated device filling rate is preferably modified as a function of air-fuel ratio, EGR and spark advance and, further, as a function of device temperature. In an exemplary embodiment, the device filling rate is advantageously mapped over an engine speed and load operating range using a representative calibration for device temperature, air-fuel ratio, EGR and spark advance, with the depletion of device capacity being a time-weighted sum based on the amount of time spent in a given speed-load region utilizing the mapped filling rates in each region modified to account for the difference between existing and calibrated operating conditions. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> In accordance with another feature of the invention, the method preferably further includes purging the device for a purge time t<highlight><subscript>P</subscript></highlight>(k), and monitoring the output signal of an oxygen sensor to determine the purge time t<highlight><subscript>P</subscript></highlight>(k&plus;1) for the next purge cycle based on the output voltage of the sensor. In this manner, the purge time is iteratively optimized for the current storage capacity of the device. Most preferably, the fill time is likewise optimized by adjusting the fill time using predetermined increments that are respectively greater than and less than an initial fill time until the change in the purge time with respect to the corresponding fill time equals a predetermined target value. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> According to yet another feature of the invention, the method further preferably includes scheduling a device regeneration event, such as a desulfation event, is the thus-adjusted purge time is less than a predetermined purge time for a non-deteriorated device minus an offset. Most preferably, the method includes scheduling at least one additional regeneration event if the device purge time does not increase as a result of a previous regeneration cycle; and, upon the scheduling of a predetermined number of additional regeneration cycles, triggering a warning indication. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> From the foregoing, it will be appreciated that the invention beneficially utilizes information related to the quantity of a constituent gas of the engine-generated exhaust gas that is stored in an emission control device, along with the maximum capacity of the device to store such constituent gas, to adjust device purge parameters, storage capacity depletion rate (the rate at which device storage capacity is decreased during the filling process), purge time, and strength of purge in real time during engine operation in a vehicle. Still further, a decision to regenerate the device, for example, by purging the device of accumulated sulfur, is made based on the observed reduction in device storage capacity and the related increase in the storage capacity depletion rate. Thus, the device is operated continuously at its optimum condition of constituent-gas conversion efficiency, thereby minimizing tailpipe emissions while maximizing vehicle fuel economy. Intelligent regeneration of the device ensures that the constituent-gas conversion efficiency of the device is always maintained above a given minimum. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> The above object and other objects, features, and advantages of the present invention are readily apparent from the following detailed description of the best mode for carrying out the invention when taken in connection with the accompanying drawings.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a diagram of an engine control system that embodies the principles of the invention; </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a graph showing the voltage response of an oxygen sensor versus air-fuel ratio; </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows various graphs comparing (a) engine air-fuel ratio, (b) tailpipe oxygen sensor response, (c) EGO data capture, and (d) tailpipe CO, versus time for a short purge time (1), a medium purge time (2) and a long purge time (3); </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a more detailed view of oxygen sensor response versus time for a short purge time (1), a medium purge time (2) and a long purge time (3); </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a plot of normalized oxygen sensor saturation time t<highlight><subscript>sat </subscript></highlight>as a function of purge time t<highlight><subscript>P</subscript></highlight>; </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a plot of normalized saturation time t<highlight><subscript>sat </subscript></highlight>versus oxygen sensor peak voltage V<highlight><subscript>P </subscript></highlight>for the case where the oxygen sensor peak voltage V<highlight><subscript>P </subscript></highlight>is less than a reference voltage V<highlight><subscript>ref</subscript></highlight>; </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> shows the relationship between device purge time t<highlight><subscript>P </subscript></highlight>and device fill time t<highlight><subscript>F </subscript></highlight>and depicts the optimum purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>for a given fill time t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>, with two sub-optimal purge points 1 and 2 also illustrated; </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference><highlight><italic>a </italic></highlight>shows the relationship between purge time and fill time when the purge time has been optimized for all fill times. The optimum purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>and fill time t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>represent the preferred system operating point T. Two sub-optimal points A and B that lie on the response curve are also shown; </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> shows the relationship between device purge time t<highlight><subscript>P </subscript></highlight>and fill time t<highlight><subscript>F </subscript></highlight>for four different device operating conditions of progressively increasing deterioration in NO<highlight><subscript>x </subscript></highlight>device capacity and further shows the extrapolated purge times for the oxygen storage portion t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC </subscript></highlight></subscript></highlight>of the total purge time t<highlight><subscript>P</subscript></highlight>; </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> shows the relationship between NO<highlight><subscript>x </subscript></highlight>device capacity and purge time for four different device conditions with progressively more deterioration caused by sulfation, thermal damage, or both; </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a flowchart for optimization of device purge time t<highlight><subscript>P</subscript></highlight>; </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a flowchart for system optimization; </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a flowchart for determining whether desulfation of the device is required; </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a plot of the relationship between the relative oxidant stored in the device and the relative time that the device is subjected to an input stream of NO<highlight><subscript>x</subscript></highlight>; </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a plot of relative purge fuel versus relative fill time; </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a map of the basic device filling rate R<highlight><subscript>ij </subscript></highlight>(NO<highlight><subscript>x </subscript></highlight>capacity depletion) for various speed and load points at given mapped values of temperature, air-fuel ratio, EGR and spark advance; </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 16</cross-reference><highlight><italic>a</italic></highlight>-<highlight><bold>16</bold></highlight><highlight><italic>d </italic></highlight>show a listing of the mapping conditions for air-fuel ratio, EGR, spark advance, and device temperature, respectively, for which the device filling rates R<highlight><subscript>ij </subscript></highlight>were determined in <cross-reference target="DRAWINGS">FIG. 15</cross-reference>; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> shows how device capacity depletion rate modifier varies with temperature; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 18</cross-reference> shows how the air-fuel ratio, EGR, and spark advance modifiers change as the values of air-fuel ratio, EGR and spark advance vary from the mapped values in <cross-reference target="DRAWINGS">FIG. 16</cross-reference>; and </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is a flowchart for determining when to schedule a device purge.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENT(S) </heading>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> Referring now to the drawings, and initially to <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> powertrain control module (PCM) generally designated <highlight><bold>10</bold></highlight> is an electronic engine controller including ROM, RAM and CPU, as indicated. The PCM controls a set of injectors <highlight><bold>12</bold></highlight>, <highlight><bold>14</bold></highlight>, <highlight><bold>16</bold></highlight> and <highlight><bold>18</bold></highlight> which inject fuel into a four-cylinder internal combustion engine <highlight><bold>20</bold></highlight>. The fuel injectors are of conventional design and are positioned to inject fuel into their associated cylinder in precise quantities as determined by the controller <highlight><bold>10</bold></highlight>. The controller <highlight><bold>10</bold></highlight> transmits a fuel injector signal to the injectors to maintain an air-fuel ratio (also &ldquo;AFR&rdquo;) determined by the controller <highlight><bold>10</bold></highlight>. An air meter or air mass flow sensor <highlight><bold>22</bold></highlight> is positioned at the air intake of the manifold <highlight><bold>24</bold></highlight> of the engine and provides a signal regarding air mass flow resulting from positioning of the throttle <highlight><bold>26</bold></highlight>. The air flow signal is utilized by controller <highlight><bold>10</bold></highlight> to calculate an air mass value which is indicative of a mass of air flowing per unit time into the induction system. A heated exhaust gas oxygen (HEGO) sensor <highlight><bold>28</bold></highlight> detects the oxygen content of the exhaust gas generated by the engine, and transmits a signal to the controller <highlight><bold>10</bold></highlight>. The HEGO sensor <highlight><bold>28</bold></highlight> is used for control of the engine air-fuel ratio, especially during stoichiometric engine operation. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> As seen in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, the engine-generated exhaust gas flows through an exhaust treatment system that includes, in series, an upstream emission control device <highlight><bold>30</bold></highlight>, an intermediate section of exhaust pipe <highlight><bold>32</bold></highlight>, a downstream emission control device <highlight><bold>34</bold></highlight>, and the vehicle&apos;s tailpipe <highlight><bold>36</bold></highlight>. While each device <highlight><bold>30</bold></highlight>,<highlight><bold>34</bold></highlight> is itself a three-way catalyst, the first device <highlight><bold>30</bold></highlight> is preferably optimized to reduce tailpipe emissions during engine operation about stoichiometry, while the second device <highlight><bold>34</bold></highlight> is optimized for storage of one or more selected constituent gases of the engine exhaust gas when the engine operates &ldquo;lean,&rdquo; and to release previously-stored constituent gas when the engine operates &ldquo;rich.&rdquo; The exhaust treatment system further includes a second HEGO sensor <highlight><bold>38</bold></highlight> located downstream of the second device <highlight><bold>34</bold></highlight>. The second HEGO sensor <highlight><bold>38</bold></highlight> provides a signal to the controller <highlight><bold>10</bold></highlight> for diagnosis and control according to the present invention. The second HEGO sensor <highlight><bold>38</bold></highlight> is used to monitor the HC efficiency of the first device <highlight><bold>30</bold></highlight> by comparing the signal amplitude of the second HEGO sensor <highlight><bold>38</bold></highlight> with that of the first HEGO sensor <highlight><bold>28</bold></highlight> during conventional stoichiometric, closed-loop limit cycle operation. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> In accordance with another feature of the invention, the exhaust treatment system includes a temperature sensor <highlight><bold>42</bold></highlight> located at a mid-point within the second device <highlight><bold>34</bold></highlight> that generates an output signal representative of the instantaneous temperature T of the second device <highlight><bold>34</bold></highlight>. Still other sensors (not shown) provide additional information to the controller <highlight><bold>10</bold></highlight> about engine performance, such as camshaft position, crankshaft position, angular velocity, throttle position and air temperature. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> A typical voltage versus air-fuel ratio response for a switching-type oxygen sensor such as the second HEGO sensor <highlight><bold>38</bold></highlight> is shown in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. The voltage output of the second HEGO sensor <highlight><bold>38</bold></highlight> switches between low and high levels as the exhaust mixture changes from a lean to a rich mixture relative to the stoichiometric air-fuel ratio of approximately 14.65. Since the air-fuel ratio is lean during the fill time, NO<highlight><subscript>x </subscript></highlight>generated in the engine passes through the first device <highlight><bold>30</bold></highlight> and the intermediate exhaust pipe <highlight><bold>32</bold></highlight> into the second device <highlight><bold>34</bold></highlight> where it is stored. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> A typical operation of the purge cycle for the second device <highlight><bold>34</bold></highlight> is shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. The top waveform (<cross-reference target="DRAWINGS">FIG. 3</cross-reference><highlight><italic>a</italic></highlight>) shows the relationship of the lean fill time t<highlight><subscript>F </subscript></highlight>and the rich purge time t<highlight><subscript>P </subscript></highlight>for three different purge times, <highlight><bold>1</bold></highlight>, <highlight><bold>2</bold></highlight>, and <highlight><bold>3</bold></highlight>. The response of the second HEGO sensor <highlight><bold>38</bold></highlight> for the three purge times is shown in the second waveform (<cross-reference target="DRAWINGS">FIG. 3</cross-reference><highlight><italic>b</italic></highlight>). The amount of CO and HC passing through the second device <highlight><bold>34</bold></highlight> and affecting the downstream sensor <highlight><bold>38</bold></highlight> is used as an indicator of the effectiveness of the second device&apos;s purge event. The peak voltage level of the tailpipe oxygen sensor is an indicator of the quantities of NO<highlight><subscript>x </subscript></highlight>and O<highlight><subscript>2 </subscript></highlight>that are still stored in the second device <highlight><bold>34</bold></highlight>. For a small purge time 1, a very weak response of the oxygen sensor results since the second device <highlight><bold>34</bold></highlight> has not been fully purged of NO<highlight><subscript>x</subscript></highlight>, resulting in a small spike of tailpipe CO and closely related second HEGO sensor response. For this case, the peak sensor voltage V<highlight><subscript>P </subscript></highlight>does not reach the reference voltage V<highlight><subscript>ref</subscript></highlight>. For a moderate or optimum purge time 2, the second HEGO sensor&apos;s response V<highlight><subscript>P </subscript></highlight>equals the reference voltage V<highlight><subscript>ref</subscript></highlight>, indicating that the second device <highlight><bold>34</bold></highlight> has been marginally purged, since an acceptably very small amount of tailpipe Co is generated. For a long purge <highlight><bold>3</bold></highlight>, the second HEGO sensor&apos;s peak voltage exceeds V<highlight><subscript>ref</subscript></highlight>, indicating that the second device <highlight><bold>34</bold></highlight> has been either fully purged or over-purged, thereby generating increased and undesirably high tailpipe CO (and HC) emissions, as illustrated by the waveform in <cross-reference target="DRAWINGS">FIG. 3</cross-reference><highlight><italic>d. </italic></highlight></paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> The data capture window for the second HEGO sensor voltage is shown in the waveform in <cross-reference target="DRAWINGS">FIG. 3</cross-reference><highlight><italic>c</italic></highlight>. During this window the PCM acquires data on the second HEGO sensor <highlight><bold>38</bold></highlight> response. <cross-reference target="DRAWINGS">FIG. 4</cross-reference> shows an enlarged view of the response of the sensor <highlight><bold>38</bold></highlight> to the three levels of purge time shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. The time interval &Dgr;t<highlight><subscript>21 </subscript></highlight>is equal to the time interval that the sensor voltage exceeds V<highlight><subscript>ref</subscript></highlight>. For a peak sensor voltage V<highlight><subscript>P </subscript></highlight>which is less than the reference voltage V<highlight><subscript>ref</subscript></highlight>, the PCM <highlight><bold>10</bold></highlight> provides a smooth continuation to the metric of <cross-reference target="DRAWINGS">FIG. 5</cross-reference> by linearly extrapolating the sensor saturation time t<highlight><subscript>sat </subscript></highlight>from t<highlight><subscript>sat</subscript></highlight>&equals;t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>ref </subscript></highlight></subscript></highlight>to t<highlight><subscript>sat</subscript></highlight>&equals;0. The PCM <highlight><bold>10</bold></highlight> uses the ftlinerelationship shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>, making the sensor saturation time t<highlight><subscript>sat </subscript></highlight>proportional to the peak sensor voltage V<highlight><subscript>P</subscript></highlight>, as depicted therein. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> shows the relationship between the normalized oxygen sensor saturation time t<highlight><subscript>sat </subscript></highlight>and the purge time t<highlight><subscript>P</subscript></highlight>. The sensor saturation time t<highlight><subscript>sat </subscript></highlight>is the normalized amount of time that the second HEGO sensor signal is above V<highlight><subscript>ref </subscript></highlight>and is equal to &Dgr;t<highlight><subscript>21</subscript></highlight>/&Dgr;t<highlight><subscript>21</subscript></highlight><highlight><subscript><highlight><subscript>norm</subscript></highlight></subscript></highlight>, where &Dgr;t<highlight><subscript>21</subscript></highlight><highlight><subscript><highlight><subscript>norm </subscript></highlight></subscript></highlight>is the normalizing factor. The sensor saturation time t<highlight><subscript>sat </subscript></highlight>is normalized by the desired value t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>desired</subscript></highlight></subscript></highlight>. For a given fill time t<highlight><subscript>F </subscript></highlight>and state of the second device <highlight><bold>34</bold></highlight>, there is an optimum purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>sat</subscript></highlight></subscript></highlight><highlight><subscript>&mdash;</subscript></highlight><highlight><subscript><highlight><subscript>desired </subscript></highlight></subscript></highlight>that results in an optimum normalized saturation time t<highlight><subscript>sat</subscript></highlight>&equals;1 for which the tailpipe HC and CO are not excessive, and which still maintains an acceptable device NO<highlight><subscript>x</subscript></highlight>-storage efficiency. For a sensor saturation time t<highlight><subscript>sat</subscript></highlight>&gt;1, the purge time is too long and should be decreased. For a sensor saturation time t<highlight><subscript>sat</subscript></highlight>&lt;1, the purge time is too short and should be increased. Thus, closed-loop control of the purge of the second device <highlight><bold>34</bold></highlight> can be achieved based on the output of the second HEGO sensor <highlight><bold>38</bold></highlight>. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> shows the nominal relationship between the purge time t<highlight><subscript>P </subscript></highlight>and the fill time t<highlight><subscript>F </subscript></highlight>for a given operating condition of the engine and for a given condition of the second device <highlight><bold>34</bold></highlight>. The two sub-optimal purge times t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>subopt1 </subscript></highlight></subscript></highlight>and t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>subopt2 </subscript></highlight></subscript></highlight>correspond to either under-purging or over-purging of the second device <highlight><bold>34</bold></highlight> for a fixed fill time t<highlight><subscript>P</subscript></highlight><highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>. The purge time t<highlight><subscript>P </subscript></highlight>that optimally purges the second device <highlight><bold>34</bold></highlight> of stored NO<highlight><subscript>x </subscript></highlight>is designated as t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>. This point corresponds to a target or desired purge time, t<highlight><subscript>sat</subscript></highlight>&equals;t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>desired</subscript></highlight></subscript></highlight>. This purge time minimizes CO tailpipe emissions during the fixed fill time t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>. This procedure also results in a determination of the stored-oxygen purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC</subscript></highlight></subscript></highlight>, which is related to the amount of oxygen directly stored in the second device <highlight><bold>34</bold></highlight>. Oxygen can be directly stored in the form of cerium oxide, for example. The stored-oxygen purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript>OSC </subscript></highlight>can be determined by either extrapolating two or more optimum purge times to the t<highlight><subscript>F</subscript></highlight>&equals;0 point or by conducting the t<highlight><subscript>P </subscript></highlight>optimization near the point t<highlight><subscript>F</subscript></highlight>&equals;0. Operating point T2 is achieved by deliberately making t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T2</subscript></highlight></subscript></highlight>&lt;t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>and finding t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T2 </subscript></highlight></subscript></highlight>through the optimization. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference><highlight><italic>a </italic></highlight>illustrates the optimization of the fill time t<highlight><subscript>F</subscript></highlight>. For a given fill time t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>, the optimum purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>is determined, as in <cross-reference target="DRAWINGS">FIG. 7</cross-reference>. Then the fill time is dithered by stepping to a value t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>B </subscript></highlight></subscript></highlight>that is slightly less than the initial value t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>and stepping to a value t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>A </subscript></highlight></subscript></highlight>that is slightly greater than the initial value t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>. The purge time optimization is applied at all three points, T, A, and B, in order to determine the variation of t<highlight><subscript>P </subscript></highlight>with t<highlight><subscript>F</subscript></highlight>. The change in t<highlight><subscript>P </subscript></highlight>from A to T and also from B to T is evaluated. In <cross-reference target="DRAWINGS">FIG. 7</cross-reference><highlight><italic>a</italic></highlight>, the change from B to T is larger than the change from A to T. The absolute value of these differences is controlled to be within a certain tolerance DELTA_MIN, as discussed more fully with respect to <cross-reference target="DRAWINGS">FIG. 11</cross-reference>. The absolute value of the differences is proportional to the slope of the t<highlight><subscript>P </subscript></highlight>versus t<highlight><subscript>F </subscript></highlight>curve. This optimization process defines the operating point, T, as the &ldquo;shoulder&rdquo; of the t<highlight><subscript>P </subscript></highlight>versus t<highlight><subscript>F </subscript></highlight>curve. T<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>sat </subscript></highlight></subscript></highlight>represents the saturation value of the sat purge time for infinitely long fill times. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> The results of the purge time t<highlight><subscript>P </subscript></highlight>and fill time t<highlight><subscript>F </subscript></highlight>optimization routine are shown in <cross-reference target="DRAWINGS">FIG. 8</cross-reference> for four different device states comprising different levels of stored NO<highlight><subscript>x </subscript></highlight>and oxygen. Both the purge time t<highlight><subscript>P </subscript></highlight>and the fill time t<highlight><subscript>F </subscript></highlight>have been optimized using the procedures described in <cross-reference target="DRAWINGS">FIGS. 7 and 7</cross-reference><highlight><italic>a</italic></highlight>. The point determined by <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is designated as the optimum operating point T1, for which the purge time is t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T1 </subscript></highlight></subscript></highlight>and the fill time is t<highlight><subscript>F</subscript></highlight><highlight><subscript><highlight><subscript>T1</subscript></highlight></subscript></highlight>. The &ldquo;1&rdquo; designates that the second device <highlight><bold>34</bold></highlight> is non-deteriorated, or state A. As the second device <highlight><bold>34</bold></highlight> deteriorates, due to sulfur poisoning, thermal damage, or other factors, device states B, C, and D will be reached. The purge and fill optimization routines are run continuously when quasi-steady-state engine conditions exist. Optimal operating points T2, T3, and T4 will be reached, corresponding to device states B, C, and D. Both the NO<highlight><subscript>x </subscript></highlight>saturation level, reflected in t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T1</subscript></highlight></subscript></highlight>, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T2</subscript></highlight></subscript></highlight>, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T3</subscript></highlight></subscript></highlight>, and t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T4</subscript></highlight></subscript></highlight>, the oxygen storage related purge times, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSCT1</subscript></highlight></subscript></highlight>, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSCT2</subscript></highlight></subscript></highlight>, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSCT3</subscript></highlight></subscript></highlight>, and t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSCT4</subscript></highlight></subscript></highlight>, </paragraph>
<paragraph id="P-0046" lvl="7"><number>&lsqb;0046&rsqb;</number> will vary with the state of the second device <highlight><bold>34</bold></highlight> and will typically decrease in value as the second device <highlight><bold>34</bold></highlight> deteriorates. The purge fuel for the NO<highlight><subscript>x </subscript></highlight>portion of the purge is equal to t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NOx</subscript></highlight></subscript></highlight>&equals;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T</subscript></highlight></subscript></highlight>&minus;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC</subscript></highlight></subscript></highlight>. </paragraph>
<paragraph id="P-0047" lvl="7"><number>&lsqb;0047&rsqb;</number> It will be appreciated that the purge fuel is equivalent to purge time for a given operating state. The controller <highlight><bold>10</bold></highlight> regulates the actual purge fuel by modifying the time the engine <highlight><bold>20</bold></highlight> is allowed to operate at a predetermined rich air-fuel ratio. To simply the discussion herein, the purge time is assumed to be equivalent to purge fuel at the assumed operating condition under discussion. Thus, direct determination of the purge time required for the NO<highlight><subscript>x </subscript></highlight>stored and the oxygen stored can be determined and used for diagnostics and control. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> illustrates the relationship between the NO<highlight><subscript>x </subscript></highlight>purge time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NOx </subscript></highlight></subscript></highlight></paragraph>
<paragraph id="P-0049" lvl="7"><number>&lsqb;0049&rsqb;</number> and the NO<highlight><subscript>x</subscript></highlight>-storage capacity of the second device <highlight><bold>34</bold></highlight>. States A, B, and C are judged to have acceptable NO<highlight><subscript>x </subscript></highlight>efficiency, device capacity and fuel consumption, while state D is unacceptable. Therefore, as state D is approached, a device desulfation event is scheduled to regenerate the NO<highlight><subscript>x</subscript></highlight>-storage capacity of the second device <highlight><bold>34</bold></highlight> and reduce the fuel consumption accompanying a high NO<highlight><subscript>x </subscript></highlight>purging frequency. The change of t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC </subscript></highlight></subscript></highlight>can provide additional information on device aging through the change in oxygen storage. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> illustrates the flowchart for the optimization of the purge time t<highlight><subscript>P</subscript></highlight>. The objective of this routine is to optimize the air-fuel ratio rich purge spike for a given value for the fill time t<highlight><subscript>F</subscript></highlight>. This routine is contained within the software for system optimization, hereinafter described with reference to <cross-reference target="DRAWINGS">FIG. 11</cross-reference>. At decision block <highlight><bold>46</bold></highlight>, the state of a purge flag is checked and if set, a lean NO<highlight><subscript>X </subscript></highlight>purge is performed as indicated at block <highlight><bold>48</bold></highlight>. The purge flag is set when a fill of the second device <highlight><bold>34</bold></highlight> has completed. For example, the flag would be set in block <highlight><bold>136</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 19</cross-reference> when that purge scheduling method is used. At block <highlight><bold>50</bold></highlight>, the oxygen sensor (EGO) voltage is sampled during a predefined capture window to determined the peak voltage V<highlight><subscript>P </subscript></highlight>and the transition times t<highlight><subscript>1 </subscript></highlight>and t<highlight><subscript>2 </subscript></highlight>if they occur. The window captures the EGO sensor waveform change, as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference><highlight><italic>c</italic></highlight>. If V<highlight><subscript>P</subscript></highlight>&gt;V<highlight><subscript>ref</subscript></highlight>, as determined by decision block <highlight><bold>52</bold></highlight>, then the sensor saturation time t<highlight><subscript>sat </subscript></highlight>is proportional to &Dgr;t<highlight><subscript>21</subscript></highlight>, the time spent above V<highlight><subscript>ref </subscript></highlight>by the EGO sensor voltage as indicated in blocks <highlight><bold>54</bold></highlight> and <highlight><bold>56</bold></highlight>. Where V<highlight><subscript>P</subscript></highlight>&lt;V<highlight><subscript>ref</subscript></highlight>, t<highlight><subscript>sat </subscript></highlight>is determined from a linearly extrapolated function as indicated in block <highlight><bold>58</bold></highlight>. For this function, shown in <cross-reference target="DRAWINGS">FIG. 6, t</cross-reference><highlight><subscript>sat </subscript></highlight>is determined by making t<highlight><subscript>sat </subscript></highlight>proportional to the peak amplitude V<highlight><subscript>P</subscript></highlight>. This provides a smooth transition from the case of V<highlight><subscript>P</subscript></highlight>&gt;V<highlight><subscript>ref </subscript></highlight>to the case of V<highlight><subscript>P</subscript></highlight>&lt;V<highlight><subscript>ref </subscript></highlight>providing a continuous, positive and negative, error function t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error</subscript></highlight></subscript></highlight>(k) suitable for feedback control as indicated in block <highlight><bold>60</bold></highlight>, wherein the error function t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error</subscript></highlight></subscript></highlight>(k) is equal to a desired value t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>desired </subscript></highlight></subscript></highlight>for the sensor saturation time minus the actual sensor saturation time t<highlight><subscript>sat</subscript></highlight>. The error function t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error</subscript></highlight></subscript></highlight>(k) is then normalized at block <highlight><bold>62</bold></highlight> by dividing it by error oftlinethe desired sensor saturation time t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>desired</subscript></highlight></subscript></highlight>. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> The resulting normalized error t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error &mdash;</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>norm</subscript></highlight></subscript></highlight>(k) </paragraph>
<paragraph id="P-0052" lvl="7"><number>&lsqb;0052&rsqb;</number> is used as the input to a feedback controller, such as a PID (proportional-differential-integral) controller. The output of the PID controller is a multiplicative correction to the device purge time, or PURGE_MUL as indicated in block <highlight><bold>64</bold></highlight>. There is a direct, monotonic relationship between t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error&mdash;</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>norm</subscript></highlight></subscript></highlight>(k) </paragraph>
<paragraph id="P-0053" lvl="7"><number>&lsqb;0053&rsqb;</number> and PURGE_MUL. If t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>Error&mdash;</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>norm</subscript></highlight></subscript></highlight>(k)&gt;0, </paragraph>
<paragraph id="P-0054" lvl="7"><number>&lsqb;0054&rsqb;</number> the second device <highlight><bold>34</bold></highlight> is being under-purged and PURGE_MUL must be increased from its base value to provide more CO for the NO<highlight><subscript>x </subscript></highlight>purge. If t<highlight><subscript>sat</subscript></highlight><highlight><subscript><highlight><subscript>error&mdash;</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>norm</subscript></highlight></subscript></highlight>(k)&lt;0, </paragraph>
<paragraph id="P-0055" lvl="7"><number>&lsqb;0055&rsqb;</number> the second device <highlight><bold>34</bold></highlight> is being over-purged and PURGE_MUL must be decreased from its base value to provide less CO for the NO<highlight><subscript>x </subscript></highlight>purge. This results in a new value of purge time t<highlight><subscript>P</subscript></highlight>(k&plus;1)&equals;t<highlight><subscript>P</subscript></highlight>(k)&times;PURGE_MUL as indicated in block <highlight><bold>66</bold></highlight>. The optimization of the purge time is continued until the absolute value of the difference between the old and new purge time values is less than an allowable tolerance, as indicated in blocks <highlight><bold>68</bold></highlight> and <highlight><bold>70</bold></highlight>. If &verbar;t<highlight><subscript>P</subscript></highlight>(k&plus;1)&minus;t<highlight><subscript>P</subscript></highlight>(k)&verbar;&gE;&egr;, then the PID feedback control loop has not located the optimum purge time t<highlight><subscript>P </subscript></highlight>within the allowable tolerance &egr;. Accordingly, as indicated in block <highlight><bold>70</bold></highlight>, the new purge time calculated at block <highlight><bold>66</bold></highlight> is used in the subsequent purge cycles until block <highlight><bold>68</bold></highlight> is satisfied. The fill time t<highlight><subscript>F </subscript></highlight>is adjusted as required using Eq.(2) (below) during the t<highlight><subscript>P </subscript></highlight>optimization until the optimum purge time t<highlight><subscript>P </subscript></highlight>is achieved. When &verbar;t<highlight><subscript>P</subscript></highlight>(k&plus;1)&minus;t<highlight><subscript>P</subscript></highlight>(k)&verbar;&lt;&egr;, then the purge time optimization has converged, the current value of the purge time is stored as indicated at <highlight><bold>72</bold></highlight>, and the optimization procedure can move to the routine shown in <cross-reference target="DRAWINGS">FIG. 11</cross-reference> for the t<highlight><subscript>F </subscript></highlight>optimization. Instead of changing only the purge time t<highlight><subscript>P</subscript></highlight>, the relative richness of the air-fuel ratio employed during the purge event (see <cross-reference target="DRAWINGS">FIG. 3</cross-reference>) can also be changed in a similar manner. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a flowchart for system optimization including both purge time and fill time optimization. The fill time optimization is carried out only when the engine is operating at quasi-steady state as indicated in block <highlight><bold>74</bold></highlight>. In this context, a quasi-steady state is characterized in that the rates of change of certain engine operating variables, such as engine speed, load, airflow, spark timing, EGR, are maintained below predetermined levels. At block <highlight><bold>76</bold></highlight>, the fill time step increment FILL_STEP is selected equal to STEP_SIZE, which results in increasing fill time if FILL_STEP&gt;0. STEP_SIZE is adjusted for the capacity utilization rate R<highlight><subscript>ij </subscript></highlight>as illustrated in <cross-reference target="DRAWINGS">FIG. 14</cross-reference> below. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> At block <highlight><bold>78</bold></highlight>, the purge time optimization described above in connection with <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, is performed. This will optimize the purge time t<highlight><subscript>P </subscript></highlight>for a given fill time. The PURGE_MUL at the end of the purge optimization performed in block <highlight><bold>78</bold></highlight>, is stored as CTRL_START, and the fill time multiplier FILL_MUL is incremented by FILL_STEP, as indicated in block <highlight><bold>80</bold></highlight>. The fill step is multiplied by FILL_MUL in block <highlight><bold>82</bold></highlight> to promote the stepping of t<highlight><subscript>F</subscript></highlight>. In block <highlight><bold>84</bold></highlight>, the purge optimization of <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is performed for the new fill time t<highlight><subscript>F</subscript></highlight>(k&plus;1). The PURGE_MUL at the end of the purge optimization performed in <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is stored as CTRL_END in block <highlight><bold>86</bold></highlight>. The magnitude of the change in the purge multiplier CTRL_DIFF&equals;ABS(CTRL_END&minus;CTRL_START) is also stored in block <highlight><bold>86</bold></highlight> and compared to a reference value DELTA_MIN at block <highlight><bold>88</bold></highlight>. DELTA_MIN corresponds to the tolerance discussed in <cross-reference target="DRAWINGS">FIG. 7</cross-reference><highlight><italic>a</italic></highlight>, and CTRL_END and CTRL_START correspond to the two values of t<highlight><subscript>P </subscript></highlight>found at A and T or at B and T of <cross-reference target="DRAWINGS">FIG. 7</cross-reference><highlight><italic>a</italic></highlight>. If the change in purge multiplier is greater than DELTA_MIN, the sign of FILL_STEP is changed to enable a search for an optimum fill time in the opposite direction as indicated at block <highlight><bold>90</bold></highlight>. If the change in purge multiplier is less than DELTA_MIN, searching for the optimum fill time t<highlight><subscript>F </subscript></highlight>continues in the same direction as indicated in block <highlight><bold>92</bold></highlight>. In block <highlight><bold>94</bold></highlight>, FILL_MUL is incremented by the selected FILL_STEP. In block <highlight><bold>96</bold></highlight> the fill time t<highlight><subscript>F</subscript></highlight>(k&plus;1) is modified by multiplying by FILL_MUL. The result will be the selection of the optimum point t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>T </subscript></highlight></subscript></highlight>as the operating point and continuously dithering at this point. If the engine does not experience quasi-steady state conditions during this procedure, the fill time optimization is aborted, as shown in block <highlight><bold>74</bold></highlight>, and the fill time from Eq. (2) (below) is used. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> illustrates the flowchart for desulfation of the second device <highlight><bold>34</bold></highlight> according to the present invention. At block <highlight><bold>100</bold></highlight>, the reference value t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NOx</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref </subscript></highlight></subscript></highlight></paragraph>
<paragraph id="P-0059" lvl="7"><number>&lsqb;0059&rsqb;</number> representative purge time for a non-deteriorated device <highlight><bold>34</bold></highlight> at the given operating conditions is retrieved from a lookup table. t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref </subscript></highlight></subscript></highlight></paragraph>
<paragraph id="P-0060" lvl="7"><number>&lsqb;0060&rsqb;</number> may be a function of airflow, air-fuel ratio, and other parameters. At block <highlight><bold>102</bold></highlight>, the current purge time t<highlight><subscript>P</subscript></highlight>(k) is recalled and is compared to t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref </subscript></highlight></subscript></highlight></paragraph>
<paragraph id="P-0061" lvl="7"><number>&lsqb;0061&rsqb;</number> minus a predetermined tolerance TOL, and if t<highlight><subscript>P</subscript></highlight>(k)&lt;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref</subscript></highlight></subscript></highlight>&minus;TOL, </paragraph>
<paragraph id="P-0062" lvl="7"><number>&lsqb;0062&rsqb;</number> then a desulfation event for the second device <highlight><bold>34</bold></highlight> is scheduled. Desulfation involves heating the second device <highlight><bold>34</bold></highlight> to approximately 650&deg; C. for approximately ten minutes with the air-fuel ratio set to slightly rich of stoichiometry, for example, to 0.98&lgr;. A desulfation counter D is reset at block <highlight><bold>104</bold></highlight> and is incremented each time the desulfation process is performed as indicated at block <highlight><bold>106</bold></highlight>. After the desulfation process is completed, the optimum purge and fill time are determined in block <highlight><bold>108</bold></highlight> as previously described in connected with <cross-reference target="DRAWINGS">FIG. 11</cross-reference>. The new purge time t<highlight><subscript>P</subscript></highlight>(k&plus;1) is compared to the reference time t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref </subscript></highlight></subscript></highlight></paragraph>
<paragraph id="P-0063" lvl="7"><number>&lsqb;0063&rsqb;</number> minus the tolerance TOL at block <highlight><bold>110</bold></highlight> and, if t<highlight><subscript>P</subscript></highlight>(k&plus;1)&lt;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref</subscript></highlight></subscript></highlight>&minus;TOL, </paragraph>
<paragraph id="P-0064" lvl="7"><number>&lsqb;0064&rsqb;</number> at least 2 additional desulfation events are performed, as determined by the decision block <highlight><bold>112</bold></highlight>. If the second device <highlight><bold>34</bold></highlight> still fails the test then a malfunction indicator lamp (MIL) is illuminated and the device <highlight><bold>34</bold></highlight> should be replaced with a new one as indicated in block <highlight><bold>114</bold></highlight>. If the condition is met and t<highlight><subscript>P</subscript></highlight>(k)&gt;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NO</subscript></highlight></subscript></highlight><highlight><subscript><highlight><subscript>ref</subscript></highlight></subscript></highlight>&minus;TOL, </paragraph>
<paragraph id="P-0065" lvl="7"><number>&lsqb;0065&rsqb;</number> the second device <highlight><bold>34</bold></highlight> has not deteriorated to an extent which requires immediate servicing, and normal operation is resumed. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> A NO<highlight><subscript>x</subscript></highlight>-purging event is scheduled when a given capacity of the second device <highlight><bold>34</bold></highlight>, less than the device&apos;s actual capacity, has been filled or consumed by the storage of NO<highlight><subscript>x</subscript></highlight>. Oxygen is stored in the second device <highlight><bold>34</bold></highlight> as either oxygen, in the form of cerium oxide, or as NO<highlight><subscript>x </subscript></highlight>and the sum the two is the oxidant storage. <cross-reference target="DRAWINGS">FIG. 13</cross-reference> illustrates the relationship between the oxidant stored in the second device <highlight><bold>34</bold></highlight> and the time that the device <highlight><bold>34</bold></highlight> is subjected to an input stream of NO<highlight><subscript>x</subscript></highlight>. The NO<highlight><subscript>x </subscript></highlight>storage occurs at a slower rate than does the oxygen storage. The optimum operating point, with respect to NO<highlight><subscript>x </subscript></highlight>generation time, corresponds to the &ldquo;shoulder&rdquo; of the curve, or about 60-70% relative NO<highlight><subscript>x </subscript></highlight>generation time for this Figure. A value of 100% on the abscissa corresponds to the saturated NO<highlight><subscript>x</subscript></highlight>-storage capacity of the second device <highlight><bold>34</bold></highlight>. The values for NO<highlight><subscript>x </subscript></highlight>stored and for oxygen stored are also shown. The capacity utilization rate R<highlight><subscript>ij </subscript></highlight>is the initial slope of this curve, the percent oxidant stored divided by the percent NO<highlight><subscript>x</subscript></highlight>-generating time. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is similar to <cross-reference target="DRAWINGS">FIG. 13</cross-reference> except that the relative purge fuel is plotted versus the relative fill time t<highlight><subscript>F</subscript></highlight>. The capacity utilization rate R<highlight><subscript>ij </subscript></highlight>(% purge fuel/% fill time) is identified as the initial slope of this curve. For a given calibration of air-fuel ratio, EGR, SPK at a given speed and load point, the relationship of the relative NO<highlight><subscript>x </subscript></highlight>generated quantity is linearly dependent on the relative fill rate t<highlight><subscript>F</subscript></highlight>. <cross-reference target="DRAWINGS">FIG. 14</cross-reference> illustrates the relationship between the amount of purge fuel, containing HC and CO, applied to the second device <highlight><bold>34</bold></highlight> versus the amount of time that the second device <highlight><bold>34</bold></highlight> is subjected to an input stream of NO<highlight><subscript>x</subscript></highlight>. The purge fuel is partitioned between that needed to purge the stored oxygen and that needed to purge the NO<highlight><subscript>x </subscript></highlight>stored as nitrate. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> The depletion of NO<highlight><subscript>x</subscript></highlight>-storage capacity in the second device <highlight><bold>34</bold></highlight> may be expressed by the following equations.  
<math-cwu id="MATH-US-00001">
<number>1</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mi>RS</mi>
        <mo>=</mo>
        <mrow>
          <munderover>
            <mo>&Sum;</mo>
            <mrow>
              <mi>k</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
            <mrow>
              <mi>k</mi>
              <mo>=</mo>
              <mi>P</mi>
            </mrow>
          </munderover>
          <mo>&it;</mo>
          <mrow>
            <msub>
              <mi>R</mi>
              <mi>ij</mi>
            </msub>
            <mo>&it;</mo>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mi>speed</mi>
                <mo>,</mo>
                <mi>load</mi>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mo>&it;</mo>
            <msub>
              <mi>t</mi>
              <mi>k</mi>
            </msub>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>1</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>RSM</mi>
          <mo>=</mo>
          <mrow>
            <mrow>
              <msub>
                <mi>M</mi>
                <mn>1</mn>
              </msub>
              <mo>&af;</mo>
              <mrow>
                <mo>(</mo>
                <mi>T</mi>
                <mo>)</mo>
              </mrow>
            </mrow>
            <mo>&it;</mo>
            <mrow>
              <munderover>
                <mo>&Sum;</mo>
                <mrow>
                  <mi>k</mi>
                  <mo>=</mo>
                  <mn>1</mn>
                </mrow>
                <mrow>
                  <mi>k</mi>
                  <mo>=</mo>
                  <mi>P</mi>
                </mrow>
              </munderover>
              <mo>&it;</mo>
              <mrow>
                <mrow>
                  <msub>
                    <mi>M</mi>
                    <mn>2</mn>
                  </msub>
                  <mo>&af;</mo>
                  <mrow>
                    <mo>(</mo>
                    <mi>AFR</mi>
                    <mo>)</mo>
                  </mrow>
                </mrow>
                <mo>&it;</mo>
                <mrow>
                  <msub>
                    <mi>M</mi>
                    <mn>3</mn>
                  </msub>
                  <mo>&af;</mo>
                  <mrow>
                    <mo>(</mo>
                    <mi>EGR</mi>
                    <mo>)</mo>
                  </mrow>
                </mrow>
                <mo>&it;</mo>
                <mrow>
                  <msub>
                    <mi>M</mi>
                    <mn>4</mn>
                  </msub>
                  <mo>&af;</mo>
                  <mrow>
                    <mo>(</mo>
                    <msub>
                      <mi>SPK</mi>
                      <mi>ij</mi>
                    </msub>
                    <mo>)</mo>
                  </mrow>
                </mrow>
                <mo>&it;</mo>
                <mrow>
                  <msub>
                    <mi>R</mi>
                    <mi>ij</mi>
                  </msub>
                  <mo>&af;</mo>
                  <mrow>
                    <mo>(</mo>
                    <mrow>
                      <mi>%</mi>
                      <mo>/</mo>
                      <mi>s</mi>
                    </mrow>
                    <mo>)</mo>
                  </mrow>
                </mrow>
                <mo>&it;</mo>
                <msub>
                  <mi>t</mi>
                  <mi>k</mi>
                </msub>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <mstyle>
          <mtext>&NewLine;</mtext>
        </mstyle>
        <mo>&it;</mo>
        <mrow>
          <mrow>
            <mstyle>
              <mtext>where</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mstyle>
              <mtext>&emsp;</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mi>RS</mi>
          </mrow>
          <mo>&leq;</mo>
          <mrow>
            <mn>100</mn>
            <mo>&it;</mo>
            <mi>%</mi>
            <mo>&it;</mo>
            <mstyle>
              <mtext>&emsp;</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mstyle>
              <mtext>and</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mstyle>
              <mtext>&emsp;</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mi>RSM</mi>
          </mrow>
          <mo>&leq;</mo>
          <mrow>
            <mn>100</mn>
            <mo>&it;</mo>
            <mi>%</mi>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <mstyle>
          <mtext>&NewLine;</mtext>
        </mstyle>
        <mo>&it;</mo>
        <mrow>
          <mrow>
            <mstyle>
              <mtext>then</mtext>
            </mstyle>
            <mo>&it;</mo>
            <mstyle>
              <mtext>&emsp;</mtext>
            </mstyle>
            <mo>&it;</mo>
            <msub>
              <mi>t</mi>
              <mi>F</mi>
            </msub>
          </mrow>
          <mo>=</mo>
          <mrow>
            <munderover>
              <mo>&Sum;</mo>
              <mrow>
                <mi>k</mi>
                <mo>=</mo>
                <mn>1</mn>
              </mrow>
              <mrow>
                <mi>k</mi>
                <mo>=</mo>
                <mi>P</mi>
              </mrow>
            </munderover>
            <mo>&it;</mo>
            <msub>
              <mi>t</mi>
              <mi>k</mi>
            </msub>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00001" file="US20030000201A1-20030102-M00001.NB"/>
<image id="EMI-M00001" wi="216.027" he="96.98535" file="US20030000201A1-20030102-M00001.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0069" lvl="7"><number>&lsqb;0069&rsqb;</number> The base or unmodified device capacity utilization, RS(%), is given by Eq.(1), which represents a time weighted summing of the cell filling rate, R<highlight><subscript>ij </subscript></highlight>(%/s), over all operating cells visited by the device filling operation, as a function of speed and load. The relative cell filling rate, R<highlight><subscript>ij </subscript></highlight>(% purge fuel/% fill time), is obtained by dividing the change in purge time by the fill time t<highlight><subscript>F </subscript></highlight>corresponding to 100% filling for that cell. Note that Eq.(1) is provided for reference only, while Eq.(2), with its modifiers, is the actual working equation. The modifiers in Eq.(2) are M<highlight><subscript>1 </subscript></highlight>(T) for device temperature T, M<highlight><subscript>2 </subscript></highlight>for air-fuel ratio, M<highlight><subscript>3 </subscript></highlight>for EGR, and M<highlight><subscript>4 </subscript></highlight>for spark advance. The individual R<highlight><subscript>ij</subscript></highlight>&apos;s are summed to an amount less than 100%, at which point the device capacity has been substantially but not fully utilized. For this capacity, the sum of the times spent in all the cells, t<highlight><subscript>F</subscript></highlight>, is the device fill time. The result of this calculation is the effective device capacity utilization, RSM(%), given by Eq.(2). The basic filling rate for a given region is multiplied by the time t<highlight><subscript>k </subscript></highlight>spent in that region, multiplied by M<highlight><subscript>2</subscript></highlight>, M<highlight><subscript>3</subscript></highlight>, and M<highlight><subscript>4</subscript></highlight>, and continuously summed. The sum is modified by the device temperature modifier M<highlight><subscript>1</subscript></highlight>(T). When the modified sum RSM approaches 100%, the second device <highlight><bold>34</bold></highlight> is nearly filled with NO<highlight><subscript>x</subscript></highlight>, and a purge event is scheduled. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> shows a map of stored data for the basic device filling rate R<highlight><subscript>ij</subscript></highlight>. The total system, consisting of the engine and the exhaust purification system, including the first device <highlight><bold>30</bold></highlight> and the second device <highlight><bold>34</bold></highlight>, is mapped over a speed-load matrix map. A representative calibration for air-fuel ratio (&ldquo;AFR&rdquo;), EGR, and spark advance is used. The device temperature T<highlight><subscript>ij </subscript></highlight>is recorded for each speed load region. <cross-reference target="DRAWINGS">FIGS. 16</cross-reference><highlight><italic>a</italic></highlight>-<highlight><bold>16</bold></highlight><highlight><italic>d </italic></highlight>show a representative listing of the mapping conditions for air-fuel ratio, EGR, spark advance, and device temperature T<highlight><subscript>ij </subscript></highlight>for which the device filling rates R<highlight><subscript>ij </subscript></highlight>were determined in <cross-reference target="DRAWINGS">FIG. 15</cross-reference>. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> When the actual operating conditions in the vehicle differ from the mapping conditions recorded in <cross-reference target="DRAWINGS">FIG. 16</cross-reference>, corrections are applied to the modifiers M<highlight><subscript>1 </subscript></highlight>(T), M<highlight><subscript>2 </subscript></highlight>(AFR), M<highlight><subscript>3 </subscript></highlight>(EGR), and M<highlight><subscript>4 </subscript></highlight>(spark advance). The correction for M<highlight><subscript>1 </subscript></highlight>(T) is shown in <cross-reference target="DRAWINGS">FIG. 17</cross-reference>. Because the second device&apos;s NO<highlight><subscript>x</subscript></highlight>-storage capacity reaches a maximum value at an optimal temperature T<highlight><subscript>0</subscript></highlight>, which, in a constructed embodiment is about 350&deg; C., a correction is applied that reduces the second device&apos;s NO<highlight><subscript>x</subscript></highlight>-storage capacity when the device temperature T rises above or falls below the optimal temperature T<highlight><subscript>0</subscript></highlight>, as shown. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> Corrections to the M<highlight><subscript>2</subscript></highlight>, M<highlight><subscript>3</subscript></highlight>, and M<highlight><subscript>4 </subscript></highlight>modifiers are shown in <cross-reference target="DRAWINGS">FIGS. 18</cross-reference><highlight><italic>a</italic></highlight>-<highlight><bold>18</bold></highlight><highlight><italic>c</italic></highlight>. These are applied when the actual air-fuel ratio, actual EGR, and actual spark advance differ from the values used in the mapping of <cross-reference target="DRAWINGS">FIG. 15</cross-reference>. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> shows the flowchart for the determining the base filling time of the second device <highlight><bold>34</bold></highlight>, i.e., when it is time to purge the device <highlight><bold>34</bold></highlight>. If the purge event has been completed (as determined at block <highlight><bold>120</bold></highlight>) and the engine is operating lean (as determined at block <highlight><bold>122</bold></highlight>), then the second device <highlight><bold>34</bold></highlight> is being filled as indicated by the block <highlight><bold>124</bold></highlight>. Fill time is based on estimating the depletion of NO<highlight><subscript>x </subscript></highlight>storage capacity R<highlight><subscript>ij</subscript></highlight>, suitably modified for air-fuel ratio, EGR, spark advance, and device temperature. At block <highlight><bold>126</bold></highlight> engine speed and load are read and a base filling rate R<highlight><subscript>ij </subscript></highlight>is obtained, at block <highlight><bold>128</bold></highlight>, from a lookup table using speed and load as the entry points (<cross-reference target="DRAWINGS">FIG. 15</cross-reference>). The device temperature, engine air-fuel ratio, EGR spark advance and time tk are obtained in block <highlight><bold>130</bold></highlight> (<cross-reference target="DRAWINGS">FIGS. 16</cross-reference><highlight><italic>a</italic></highlight>-<highlight><bold>16</bold></highlight><highlight><italic>d</italic></highlight>) and are used in block <highlight><bold>132</bold></highlight> to calculate a time weighted sum RSM, based on the amount of time spent in a given speed-load region. When RSM nears 100%, a purge event is scheduled as indicated in blocks <highlight><bold>134</bold></highlight> and <highlight><bold>136</bold></highlight>. Otherwise, the device filling process continues at block <highlight><bold>122</bold></highlight>. The fill time determined in <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is the base fill time. This will change as the second device <highlight><bold>34</bold></highlight> is sulfated or subjected to thermal damage. However, the procedures described earlier (<cross-reference target="DRAWINGS">FIGS. 7</cross-reference><highlight><italic>a</italic></highlight>, <highlight><bold>8</bold></highlight>, and <highlight><bold>11</bold></highlight>), where the optimum fill time is determined by a dithering process, the need for a desulfation is determined, and a determination is made whether the second device <highlight><bold>34</bold></highlight> has suffered thermal damage. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> The scheduled value of the purge time t<highlight><subscript>P </subscript></highlight>must include components for both the oxygen purge t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC </subscript></highlight></subscript></highlight>and the NO<highlight><subscript>x </subscript></highlight>purge t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NOx</subscript></highlight></subscript></highlight>. </paragraph>
<paragraph id="P-0075" lvl="7"><number>&lsqb;0075&rsqb;</number> Thus, t<highlight><subscript>P</subscript></highlight>&equals;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC</subscript></highlight></subscript></highlight>&plus;t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>NOx</subscript></highlight></subscript></highlight>. </paragraph>
<paragraph id="P-0076" lvl="7"><number>&lsqb;0076&rsqb;</number> The controller <highlight><bold>10</bold></highlight> contains a lookup table that provides the t<highlight><subscript>P</subscript></highlight><highlight><subscript>OSC</subscript></highlight>, which is a strong function of temperature. For a second device <highlight><bold>34</bold></highlight> containing ceria, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC </subscript></highlight></subscript></highlight>obeys the Arrhenius equation, t<highlight><subscript>P</subscript></highlight><highlight><subscript><highlight><subscript>OSC</subscript></highlight></subscript></highlight>&equals;C<highlight><subscript>exp</subscript></highlight>(&minus;E/kT), where C is a constant that depends on the type and condition of the device <highlight><bold>34</bold></highlight>, E is an activation energy, and T is absolute temperature. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> While embodiments of the invention have been illustrated and described, it is not intended that these embodiments illustrate and describe all possible forms of the invention. Rather, the words used in the specification are words of description rather than limitation, and it is understood that various changes may be made without departing from the spirit and scope of the invention. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A method of filling and purging an emission control device, located in an exhaust passage of an engine upstream from an oxygen sensor, so that the device is substantially filled to capacity with a constituent gas of the engine-generated exhaust gas during a fill time and is substantially emptied of previously-stored constituent gas during a subsequent purge time, the method comprising: 
<claim-text>calculating the depletion of device capacity of the device based on a calibrated device filling rate in engine speed load regions multiplied by the time spent in the region; </claim-text>
<claim-text>continuously summing the calculated depletion; and </claim-text>
<claim-text>scheduling a purge event when the summed calculated depletion exceeds a predetermined value for capacity depletion, wherein the predetermined value for capacity depletion is less than 100%. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the calibrated device filling rate is modified as a function of air-fuel ratio, EGR and spark advance. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the calculated depletion is modified as a function of device temperature. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, further including: 
<claim-text>mapping the device filling rate over an engine speed and load operating range using a representative calibration for device temperature, air-fuel ratio, EGR and spark advance, </claim-text>
<claim-text>and wherein the depletion of device capacity is a time weighted sum based on the amount of time spent in a given speed-load region utilizing the mapped filling rates in each region modified to account for the difference between existing and calibrated operating conditions. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, further including purging the device for a purge time t<highlight><subscript>P</subscript></highlight>(k) and monitoring the output signal of an oxygen sensor to determine the purge time t<highlight><subscript>P</subscript></highlight>(k&plus;1) for the next purge cycle based on the output voltage of the sensor. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00005">claim 5</dependent-claim-reference>, further including optimizing the fill time by adjusting the fill time by predetermined increments respectively greater than and less than an initial fill time until the change in the purge time with respect to the corresponding fill time equals a predetermined target value. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. A system for filling and purging an emission control device so that the device is substantially filled to capacity with a constituent gas of the engine-generated exhaust gas during a fill time and is substantially emptied of previously-stored constituent gas during a subsequent purge time, the system comprising: 
<claim-text>a sensor operative to generate a signal representative of an oxygen concentration in the exhaust flowing through the device; </claim-text>
<claim-text>a control module programmed to calculate the depletion of device capacity based on a calibrated device filling rate in engine speed load regions multiplied by the time spent in the region and further programmed to continuously sum the calculated capacity depletion and schedule a purge event when a predetermined percentage of capacity less than 100% is depleted. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The system of <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference>, wherein the module is programmed to modify the calibrated device filling rate as a function of air-fuel ratio, EGR and spark advance. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The system of <dependent-claim-reference depends_on="CLM-00008">claim 8</dependent-claim-reference>, wherein the module is further programmed to modify the calculated depletion as a function of device temperature. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The system of <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein the module further includes: 
<claim-text>a map of the device filling rate over an engine speed and load operating range using a representative calibration for device temperature, air-fuel ratio, EGR and spark advance; </claim-text>
<claim-text>and wherein the depletion of device capacity is a time weighted sum based on the amount of time spent in a given speed-load region utilizing the mapped filling rates in each region modified to account for the difference between existing and calibrated operating conditions. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. A method of controlling the fill and purge time of an emission control device located upstream of a switching-type oxygen sensor in an exhaust treatment system for an internal combustion engine, wherein the emission control device stores a quantity of a constituent gas of the engine-generated exhaust gas during a first engine operating condition up to a device capacity, and releases stored constituent gas during a second engine operating, the method comprising: 
<claim-text>calculating device capacity utilization in accordance with the following equation: </claim-text>
<claim-text> 
<math-cwu id="MATH-US-00002">
<number>2</number>
<math>
<mrow>
  <mi>RSM</mi>
  <mo>=</mo>
  <mrow>
    <mrow>
      <msub>
        <mi>M</mi>
        <mn>1</mn>
      </msub>
      <mo>&af;</mo>
      <mrow>
        <mo>(</mo>
        <mi>t</mi>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>&it;</mo>
    <mrow>
      <munderover>
        <mo>&Sum;</mo>
        <mrow>
          <mi>k</mi>
          <mo>=</mo>
          <mn>1</mn>
        </mrow>
        <mrow>
          <mi>k</mi>
          <mo>=</mo>
          <mi>P</mi>
        </mrow>
      </munderover>
      <mo>&it;</mo>
      <mrow>
        <mrow>
          <msub>
            <mi>M</mi>
            <mn>2</mn>
          </msub>
          <mo>&af;</mo>
          <mrow>
            <mo>(</mo>
            <mi>AFR</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <mrow>
          <msub>
            <mi>M</mi>
            <mn>3</mn>
          </msub>
          <mo>&af;</mo>
          <mrow>
            <mo>(</mo>
            <mi>EGR</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <mrow>
          <msub>
            <mi>M</mi>
            <mn>4</mn>
          </msub>
          <mo>&af;</mo>
          <mrow>
            <mo>(</mo>
            <msub>
              <mi>SPK</mi>
              <mi>ij</mi>
            </msub>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <mrow>
          <msub>
            <mi>R</mi>
            <mi>ij</mi>
          </msub>
          <mo>&af;</mo>
          <mrow>
            <mo>(</mo>
            <mrow>
              <mi>%</mi>
              <mo>/</mo>
              <mi>s</mi>
            </mrow>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>&it;</mo>
        <msub>
          <mi>t</mi>
          <mi>k</mi>
        </msub>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
<mathematica-file id="MATHEMATICA-00002" file="US20030000201A1-20030102-M00002.NB"/>
<image id="EMI-M00002" wi="216.027" he="24.97635" file="US20030000201A1-20030102-M00002.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</claim-text>
<claim-text>terminating device filling and scheduling a device purge when the capacity of the device is substantially reached; and </claim-text>
<claim-text>determining an optimum purge time based on the amplitude of the voltage output of the sensor. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein determining the optimum purge time includes: 
<claim-text>detecting, in a closed-loop process, whether the peak voltage of the sensor is above or below a reference voltage during a window following a purge cycle, the reference voltage representing an optimum purge time for the effective utilization of the device capacity on the preceding fill cycle, and </claim-text>
<claim-text>iteratively adjusting, in an open-loop process, a selected stored value for the purge time to force a measured characteristic of the sensor voltage to equal a reference characteristic of the sensor voltage. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein an optimum fill time is determined by dithering a selected stored value for the fill time about an initial value until the resulting change in purge time with respect to fill time equals a target value. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 13</dependent-claim-reference>, wherein a device desulfation event is scheduled if the adjusted selected stored value for the purge time is less than a predetermined purge time for a non-deteriorated device minus an offset. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 14</dependent-claim-reference>, including scheduling at least one subsequent desulfation event if the adjusted selected stored value for the purge time does not increase as a result of a previous desulfation event; and 
<claim-text>upon scheduling a predetermined number of subsequent desulfation events, triggering a warning indication.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030000201A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030000201A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030000201A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030000201A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030000201A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030000201A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030000201A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030000201A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030000201A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030000201A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030000201A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030000201A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030000201A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00013">
<image id="EMI-D00013" file="US20030000201A1-20030102-D00013.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00014">
<image id="EMI-D00014" file="US20030000201A1-20030102-D00014.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00015">
<image id="EMI-D00015" file="US20030000201A1-20030102-D00015.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
