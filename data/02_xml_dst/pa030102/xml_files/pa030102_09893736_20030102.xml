<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030005328A1-20030102-D00000.TIF SYSTEM "US20030005328A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00001.TIF SYSTEM "US20030005328A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00002.TIF SYSTEM "US20030005328A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00003.TIF SYSTEM "US20030005328A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00004.TIF SYSTEM "US20030005328A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00005.TIF SYSTEM "US20030005328A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030005328A1-20030102-D00006.TIF SYSTEM "US20030005328A1-20030102-D00006.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030005328</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>09893736</doc-number>
</application-number>
<application-number-series-code>09</application-number-series-code>
<filing-date>20010629</filing-date>
</domestic-filing-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04L009/00</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>713</class>
<subclass>201000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>713</class>
<subclass>150000</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Dynamic configuration of IPSec tunnels</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Karanvir</given-name>
<family-name>Grewal</family-name>
</name>
<residence>
<residence-non-us>
<city>Mississauga</city>
<country-code>CA</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Cristina</given-name>
<family-name>Georgescu</family-name>
</name>
<residence>
<residence-non-us>
<city>North York</city>
<country-code>CA</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<correspondence-address>
<name-1>Pillsbury Winthrop LLP</name-1>
<name-2></name-2>
<address>
<address-1>1600 Tysons Blvd.</address-1>
<city>McLean</city>
<state>VA</state>
<postalcode>22102</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A method and system for dynamically configuring a tunnel is presented. A client initiates a negotiation with a gateway. The gateway sends information to the client. The client extracts a security configuration from the information. Using the security configuration, a tunnel is established between the client and the gateway so that secure communication may occur. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates generally to virtual private networks (VPNs). Specifically, the present invention relates to methods and systems for configuring VPN tunnels. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. General Background and Related Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> In the age of electronic communications, it is essential that parties communicate with each other in a secure, protected manner. Absent appropriate security measures, external parties may gain access to information exchanged between communicating parties. Such access may compromise both public and private interests. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Security technologies have emerged to address problems inherent in electronic exchanges of information. For example, a virtual private network (VPN) is a secure network connection within a network. Specifically, a VPN &ldquo;tunnel&rdquo; is a secure connection established between endpoints in a network. All data exchanged between a node at a first endpoint and a node at a second endpoint is subject to some kind of security manipulation, such as encryption. As such, an external party may not gain access to the data exchanged. Nodes may be geographically remote, separated by many intervening switches and routers. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> To establish a VPN tunnel, an initiator and a responder may participate in a series of negotiations. The initiator may initiate a negotiation with the responder. During the negotiation, information may be exchanged between the nodes that sets forth security policies applicable to future exchanges of information. Where several phases of negotiation occur, a secure set of defining parameters may be generated. Thus, a tunnel may be established, and the initiator and the responder may communicate in a secure manner. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> Protocols govern the process of establishing tunnels between nodes. Specifically, IPSec, RFC <highlight><bold>2401</bold></highlight>, <highlight><bold>2411</bold></highlight>, is a set of extensions to the IP protocol family that enables the creation of encrypted tunnels. IPSec provides cryptographic security services, including authentication, integrity, access control, and confidentiality support. IPSec is transparent to network applications. The protocols and rules governing IPSec transmissions must conform to documents promulgated by Internet working groups. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> IPSec includes a number of protocols, including Authentication Header (AH), RFC <highlight><bold>2402</bold></highlight>, and ESP (Encapsulated Security Payload), RFC <highlight><bold>2406</bold></highlight>. IPSec-secured links are defined in terms of security associations (SAs), RFC <highlight><bold>2408</bold></highlight>. An SA is a security configuration that includes information required for execution of various network security services. In particular, an SA may include security attributes, such as network parameters and network addresses. Each SA is defined for a single unidirectional flow of data, usually from a single node to another node, and covers traffic distinguishable by some unique selector. The applicable security protocol for SAs may be AH or ESP. The AH follows a basic IP header and contains cryptographic hashes of the data as well as identification information. The ESP header allows for rewriting of the payload in encrypted form. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> (Prior Art) depicts a system in which a tunnel may be established. System <highlight><bold>100</bold></highlight> includes a client <highlight><bold>120</bold></highlight> and a gateway <highlight><bold>180</bold></highlight> which communicate with each other over the Internet <highlight><bold>160</bold></highlight>. Client <highlight><bold>120</bold></highlight> stores the IP address <highlight><bold>130</bold></highlight> of gateway <highlight><bold>180</bold></highlight>. Client <highlight><bold>120</bold></highlight> also stores a security configuration <highlight><bold>140</bold></highlight>. Similarly, gateway <highlight><bold>180</bold></highlight> stores a security configuration <highlight><bold>170</bold></highlight>. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> In order to establish a tunnel <highlight><bold>150</bold></highlight> between client <highlight><bold>120</bold></highlight> and gateway <highlight><bold>180</bold></highlight>, client <highlight><bold>120</bold></highlight> may initiate a preliminary negotiation with gateway <highlight><bold>180</bold></highlight>. In this preliminary negotiation, client <highlight><bold>120</bold></highlight> and gateway <highlight><bold>180</bold></highlight> may agree upon a security algorithm to use in subsequent negotiations. In the IPSec protocol, this preliminary negotiation is termed phase1 negotiation. After phase1 negotiation, client <highlight><bold>120</bold></highlight> may initiate another negotiation with gateway <highlight><bold>180</bold></highlight>. In what is termed phase2, client <highlight><bold>120</bold></highlight> and gateway <highlight><bold>180</bold></highlight> generate secure keys to define subsequent secure transmissions between client <highlight><bold>120</bold></highlight> and gateway <highlight><bold>180</bold></highlight> over tunnel <highlight><bold>150</bold></highlight>. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> Phase2 negotiation only succeeds if gateway <highlight><bold>180</bold></highlight> and client <highlight><bold>120</bold></highlight> are identically configured. That is, to establish tunnel <highlight><bold>150</bold></highlight>, security configuration <highlight><bold>170</bold></highlight> in gateway <highlight><bold>180</bold></highlight> must be identical to security configuration <highlight><bold>140</bold></highlight> in client <highlight><bold>120</bold></highlight>. If even a slight difference exists between the respective security configurations, phase2 negotiation fails. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> Accordingly, a client administrator <highlight><bold>101</bold></highlight> must configure parameters within security configuration <highlight><bold>140</bold></highlight>. Similarly, a gateway administrator <highlight><bold>110</bold></highlight> must configure security parameters within security configuration <highlight><bold>170</bold></highlight>. This configuration process is complex, and client administrator <highlight><bold>101</bold></highlight> must know the respective security configuration of every endpoint with which client <highlight><bold>120</bold></highlight> seeks to establish a tunnel. Moreover, when gateway administrator <highlight><bold>110</bold></highlight> alters even one parameter within security configuration <highlight><bold>170</bold></highlight> of gateway <highlight><bold>180</bold></highlight>, client administrator <highlight><bold>101</bold></highlight> must modify the counterpart parameter within security configuration <highlight><bold>140</bold></highlight> of client <highlight><bold>120</bold></highlight>. <cross-reference target="DRAWINGS">FIG. 2</cross-reference> (Prior Art) depicts exemplary security configurations that may be associated with client <highlight><bold>120</bold></highlight> and gateway <highlight><bold>180</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> Therefore, what is needed is a method and system for dynamically configuring tunnels in a network. </paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> (Prior Art) illustrates a system in which a tunnel may be established. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> (Prior Art) depicts security configurations that may be associated with a client and a gateway in the system of <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> illustrates a system according to an embodiment of the present invention. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a high-level flow diagram of a method according to an embodiment of the present invention. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a high-level flow diagram of a method according to an embodiment of the present invention. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a high-level flow diagram of a method according to an embodiment of the present invention. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> illustrates an exemplary Configuration Mode Exchange transaction.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION </heading>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> The following detailed description refers to the accompanying drawings that illustrate exemplary embodiments of the present inventions. Other embodiments are possible and modifications may be made to the embodiments without departing from the spirit and scope of the invention. Therefore, the following detailed description is not meant to limit the invention. Rather, the scope of the invention is defined by the appended claims. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> It will be apparent to one of ordinary skill in the art that the embodiments as described below may be implemented in many different embodiments of software, firmware, and hardware in the entities illustrated in the figures. The actual software code or specialized control hardware used to implement the present invention is not limiting of the present invention. Thus, the operation and behavior of the embodiments will be described without specific reference to the actual software code or specialized hardware components. The absence of such specific references is feasible because it is clearly understood that artisans of ordinary skill would be able to design software and control hardware to implement the embodiments of the present invention based on the description herein with only a reasonable effort and without undue experimentation. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> Moreover, the processes associated with the presented embodiments may be stored in any storage device, such as, for example, a computer system (non-volatile) memory, an optical disk, magnetic tape, or magnetic disk. Furthermore, the processes may be programmed when the computer system is manufactured or via a computer-readable medium at a later date. Such a medium may include any of the forms listed above with respect to storage devices and may further include, for example, a carrier wave modulated, or otherwise manipulated, to convey instructions that can be read, demodulated/decoded and executed by a computer. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> A method and system for dynamically configuring a tunnel, as presented herein, involves a client and a gateway. The client initiates a negotiation with the gateway. The gateway sends information to the client. The client extracts a security configuration from the information sent by the gateway. Using the security configuration, a tunnel between the client and the gateway is established. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> Accordingly, a minimal configuration may be defined on a client. A gateway administrator may modify network attributes on the gateway, as well as security policies with respect to peers, users, and groups, without manually conveying the modifications to a client. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> illustrates system <highlight><bold>300</bold></highlight> according to an embodiment of the present invention. As shown, system <highlight><bold>300</bold></highlight> comprises a client <highlight><bold>320</bold></highlight> and a gateway <highlight><bold>380</bold></highlight> communicating over the Internet <highlight><bold>360</bold></highlight>. For illustrative purposes, tunnels are shown herein as being formed between clients and gateways. The term &ldquo;client&rdquo; corresponds to a first endpoint of a tunnel, and &ldquo;gateway&rdquo; corresponds to a second endpoint. These terms may encompass any of a number of devices, such as personal computers, client computers, servers, mainframes, gateways, personal digital assistants (PDAs), other handheld devices, and other computing devices. The terms &ldquo;first peer&rdquo; and &ldquo;second peer&rdquo; may be substituted for &ldquo;client&rdquo; and &ldquo;gateway.&rdquo; Additionally, the Internet <highlight><bold>360</bold></highlight> may be replaced by another network, such as an intranet. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> Gateway <highlight><bold>380</bold></highlight> stores or has access to a security configuration <highlight><bold>370</bold></highlight>, which may comprise security and policy attributes. Such attributes may include security and network parameters and network addresses. Gateway <highlight><bold>380</bold></highlight> has associated therewith a gateway administrator <highlight><bold>310</bold></highlight>, who may manually modify various parameters within security configuration <highlight><bold>370</bold></highlight>. However, such modifications may also be made automatically via software. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> Client <highlight><bold>320</bold></highlight> does not have an associated administrator such as client administrator <highlight><bold>101</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 1</cross-reference> above. According to embodiments of the present invention, client <highlight><bold>320</bold></highlight> need not maintain a security configuration corresponding to security configuration <highlight><bold>370</bold></highlight> of gateway <highlight><bold>380</bold></highlight>. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> Client <highlight><bold>320</bold></highlight> stores, has access to, or receives as input from a user, IP address <highlight><bold>330</bold></highlight> of gateway <highlight><bold>380</bold></highlight>. Client <highlight><bold>320</bold></highlight> may maintain IP address <highlight><bold>330</bold></highlight> and a preshared secret or certificate for authentication. The preshared secret may be known to both client <highlight><bold>320</bold></highlight> and gateway <highlight><bold>380</bold></highlight> prior to negotiations which ultimately establish tunnel <highlight><bold>350</bold></highlight> within Internet <highlight><bold>360</bold></highlight>. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a high-level flow diagram of method <highlight><bold>400</bold></highlight> according to an embodiment of the present invention. It is to be appreciated that method <highlight><bold>400</bold></highlight> may be implemented using various protocols. Moreover, additional negotiations (not shown) may be included in method <highlight><bold>400</bold></highlight>. </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> In item <highlight><bold>401</bold></highlight>, a client initiates a preliminary negotiation with a gateway. In item <highlight><bold>410</bold></highlight>, the client initiates a second negotiation with the gateway. In some protocols, one negotiation may be initiated. The gateway sends information to the client in item <highlight><bold>420</bold></highlight>. This information may have been requested by the client in a previous negotiation, such as in the negotiation initiated by the client in item <highlight><bold>410</bold></highlight>. In item <highlight><bold>430</bold></highlight>, the client extracts a security configuration from the information sent by the gateway. In item <highlight><bold>435</bold></highlight>, the client initiates a final negotiation with the gateway. A tunnel providing secure communication between the client and the gateway is established in item <highlight><bold>440</bold></highlight> using the security configuration. </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> In item <highlight><bold>420</bold></highlight> of method <highlight><bold>400</bold></highlight>, the gateway may also send information to the client about one or more protocols, such as the securID, RADIUS, and L2TP protocols. As such, the client may extract the information and use the protocols for additional negotiations. In an exemplary implementation (not shown), a security authentication negotiation may occur before item <highlight><bold>435</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>. </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a high-level flow diagram of method <highlight><bold>500</bold></highlight> according to another embodiment of the present invention. In method <highlight><bold>500</bold></highlight>, the IPSec protocol is employed to establish a secure tunnel between a client and a gateway. In item <highlight><bold>501</bold></highlight>, a phase<highlight><bold>1</bold></highlight> negotiation occurs. The negotiation is described in further detail below. Phase1 negotiation may be effectuated using the Base Mode Exchange extension of the IPSec protocol, Internet Draft draft-ietf-ipsec-ike-base-mode-02.txt, as well as with Main Mode and Aggressive Mode, RFC <highlight><bold>2409</bold></highlight>. As a result of phase1 negotiation, the client and the gateway authenticate each other and agree upon a valid security policy to govern a subsequent negotiation between the client and the gateway. </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> In item <highlight><bold>510</bold></highlight>, an intermediate negotiation termed &ldquo;phase1a&rdquo; herein is initiated between the client and the gateway. In an exemplary implementation, phase1a negotiation utilizes the Configuration Mode Exchange extension, Internet Draft draft-dukes-ike-mode-cfg-00.txt, of the IPSec protocol. As a result of phase1a negotiation, the client receives from the gateway phase2 security parameters needed to negotiate phase2. In exemplary negotiations, the phase1 and phase2 parameters are independent of one another. </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> Because the client and the gateway now have identical security configurations, phase2 negotiation occurs in item <highlight><bold>520</bold></highlight>. In some embodiments, Quick Mode, RFC <highlight><bold>2409</bold></highlight>, an exchange of the IPSec protocol, may be employed. Assuming that phase2 negotiation succeeds, then the client and the gateway have generated secure keys to govern all subsequent transmissions between the client and the gateway. Therefore, in item <highlight><bold>530</bold></highlight>, a tunnel has been established between the client and the gateway to enable secure communications. </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a high-level flow diagram of method <highlight><bold>600</bold></highlight> according to an embodiment of the present invention. The dashed portions of method <highlight><bold>600</bold></highlight> may correspond to respective items within method <highlight><bold>500</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> Dashed portion A may correspond to phase1 negotiation in item <highlight><bold>501</bold></highlight>. In accordance with the Base Mode Exchange extension of the IPSec protocol, a phase1 initiator may offer to a responder multiple security proposals containing multiple transforms, as well as the identity of the initiator, in the first packet of the negotiation. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> In an exemplary implementation, a client may send to a gateway all or some permutations of the security algorithms supported by the client. Further, the proposals may be ordered within the transmitted packet from more to less secure proposals. As such, when the gateway parses these proposals, the more secure proposals may be considered before the less secure proposals. Accordingly, the highest level of security to govern subsequent negotiations may be selected. In addition, because the client offers all of its supported security attributes, phase1 negotiation will succeed&mdash;that is, a valid security policy will be matched&mdash;so long as the gateway supports at least one set of the proposed policies. Therefore, phase1 negotiation may occur successfully without the client storing, having access to, or receiving as input from a user, the security parameters the client must match for phase1 negotiation. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> More specifically, in item <highlight><bold>601</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 6, a</cross-reference> client offers security proposals to a gateway when the client initiates a preliminary negotiation. In item <highlight><bold>610</bold></highlight>, the gateway selects a proposal among the proposals offered by the client that matches a proposal supported by the gateway. The gateway may then send the selected proposal back to the client. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> Dashed portion B of method <highlight><bold>600</bold></highlight> may correspond to phase1a negotiation in item <highlight><bold>510</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. Configuration Mode Exchange of the IPSec protocol is based on a general request/reply protocol. An initiator makes a request of a responder, and the responder replies by sending back requested information to the initiator. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> According to an embodiment of the present invention, the Configuration Mode Exchange extension is enhanced to include an additional set of attributes. In particular, the attributes include security attributes defining one or more phase2 security or policy associations. An initiator client needing configuration information requests that the responder gateway send all defined phase2 policies. Depending upon the configuration defined on the responder gateway, additional IPSec-related attributes and proprietary attributes may be sent by the gateway. The security attributes may also be sent along with traffic protected by each security association (SA). The phase2 security attributes may be designated with a prefix, such as &ldquo;CFG_&rdquo;, so as to distinguish them from other information. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> Once the client extracts the security configuration, including, for example, security and network parameters and identities, the client can use the configuration to initiate negotiations for all phase2 security associations defined on the gateway. Negotiations may succeed because attributes now known by the client match attributes defined on the gateway. In some embodiments, if the client already has phase2 policy definitions at the time the client initiates the negotiation, then the definitions are not used or are overwritten by software. In other embodiments, parameters evaluating to zero are not sent by the gateway in its reply to the client&apos;s request. Additionally, the number of iterations through each set of parameters may depend on the configuration of the client receiving the parameters. <cross-reference target="DRAWINGS">FIG. 7</cross-reference> illustrates an exemplary Configuration Mode Exchange transaction between a client and a gateway. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> Specifically, in item <highlight><bold>620</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 6</cross-reference>, the client requests that the gateway send information, including all or some defined phase2 policies. In item <highlight><bold>630</bold></highlight>, the gateway replies by sending the requested information back to the client. The information may be sent back in the form of sets of attributes, wherein each set contains sufficient information to define an IPSec security association. An attribute may be omitted from a given set, which may indicate that no value exists for that attribute, that is, the attribute is not used. The number of sets of attributes returned by the gateway may be dictated by the configuration of the responder. In item <highlight><bold>640</bold></highlight>, the client extracts security configuration information from the information sent by the gateway. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> Dashed portion C may correspond to phase2 negotiation in item <highlight><bold>520</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. In item <highlight><bold>650</bold></highlight>, using the security configuration received by the client, the client and the gateway may negotiate phase2 security associations to generate secure keys. Differing levels of security may be applied to each SA. As such, multiple SAs may be used to enable a client to access multiple resources or services on a protected network. In item <highlight><bold>660</bold></highlight>, a tunnel is established between the client and the gateway so that secure communications may occur between the client and the gateway. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> The foregoing description of the preferred embodiments is provided to enable any person skilled in the art to make or use the present invention. Various modifications to these embodiments are possible, and the generic principles presented herein may be applied to other embodiments as well. For instance, the IPSec protocol may continue to evolve, and various new or modified exchanges or extensions may be utilized to implement the present invention. Newly developed protocols may also be suitable. In other embodiments, a gateway may respond to a client by sending an IP address and security configuration of a second client or gateway. As such, a tunnel between the client and the second client or gateway may be established. In still other embodiments, a tunnel may be established between a first gateway and a second gateway. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> Moreover, the invention may be implemented in part or in whole as a hard-wired circuit, as a circuit configuration fabricated into an application-specific integrated circuit, or as a firmware program loaded into non-volatile storage or a software program loaded from or into a data storage medium as machine-readable code, such code being instructions executable by an array of logic elements such as a microprocessor or other digital signal processing unit. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> As such, the present invention is not intended to be limited to the embodiments shown above but rather is to be accorded the widest scope consistent with the principles and novel features disclosed in any fashion herein. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A method for dynamically configuring a tunnel comprising: 
<claim-text>initiating, by a first peer, a negotiation with a second peer; </claim-text>
<claim-text>sending, by the second peer, information to the first peer; </claim-text>
<claim-text>extracting, by the first peer, a security configuration from the information sent by the second peer; and </claim-text>
<claim-text>establishing, using the security configuration, a tunnel between the first peer and the second peer. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the negotiation utilizes the configuration mode exchange extension of the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the establishing a tunnel includes conducting a phase2 negotiation in the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, further comprising initiating, by the first peer, a preliminary negotiation with the second peer. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the initiating a preliminary negotiation includes conducting a phase1 negotiation in the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. A method for dynamically configuring a tunnel comprising: 
<claim-text>initiating, by a first peer, a negotiation with a second peer; </claim-text>
<claim-text>extracting, by the first peer, a security configuration from information sent by the second peer; and </claim-text>
<claim-text>establishing, using the security configuration, a tunnel between the first peer and the second peer. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the tunnel is an IPSec tunnel. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the negotiation utilizes the configuration mode exchange extension of the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the initiating comprises requesting, by the first peer, that the second peer send information, the information including policy information to define a subsequent negotiation between the first peer and the second peer. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein the policy information defines one or more security associations. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference>, wherein the information sent by the second peer comprises sets of attributes, the attributes including security parameters and network addresses. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the establishing a tunnel comprises negotiating, by the first peer with the second peer, to generate a secure key. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein the negotiating to generate a secure key includes conducting a phase2 negotiation in the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the establishing a tunnel utilizes the quick mode exchange of the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the IP address of the second peer is accessible to the first peer. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 15</dependent-claim-reference>, wherein a shared secret is stored on the first peer before the negotiation. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, further comprising initiating, by the first peer, a preliminary negotiation with the second peer, the initiating comprising offering, by the first peer to the second peer, at least one security proposal supported by the first peer. </claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the first peer orders offered security proposals in a transmission packet such that a more secure security proposal is offered before a less secure proposal. </claim-text>
</claim>
<claim id="CLM-00019">
<claim-text><highlight><bold>19</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the preliminary negotiation utilizes the base mode exchange extension of the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00020">
<claim-text><highlight><bold>20</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the initiating a preliminary negotiation further comprises sending, by the first peer to the second peer, the identity of the first peer. </claim-text>
</claim>
<claim id="CLM-00021">
<claim-text><highlight><bold>21</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the initiating a preliminary negotiation includes conducting a phase1 negotiation in the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00022">
<claim-text><highlight><bold>22</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the preliminary negotiation utilizes one of main mode and aggressive mode of the IPSec protocol. </claim-text>
</claim>
<claim id="CLM-00023">
<claim-text><highlight><bold>23</bold></highlight>. A method for dynamically configuring a tunnel comprising: 
<claim-text>sending, by a second peer, information to a first peer that initiated a negotiation with the second peer, the information including a security configuration intended to be extracted by the first peer; and </claim-text>
<claim-text>establishing, using the security configuration, a tunnel between the first peer and the second peer. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00024">
<claim-text><highlight><bold>24</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00022">claim 23</dependent-claim-reference>, wherein the information includes policy information defining one or more security associations. </claim-text>
</claim>
<claim id="CLM-00025">
<claim-text><highlight><bold>25</bold></highlight>. A system for dynamically configuring a tunnel comprising: 
<claim-text>a first peer; and </claim-text>
<claim-text>a second peer configured to communicate with the first peer over a network connection, 
<claim-text>wherein the first peer is configured to initiate a negotiation with the second peer, </claim-text>
<claim-text>the second peer is configured to send information to the first peer, </claim-text>
<claim-text>the first peer is configured to extract a security configuration from the information sent by the second peer, and </claim-text>
<claim-text>the first peer and the second peer are configured to establish a tunnel therebetween using the security configuration. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00026">
<claim-text><highlight><bold>26</bold></highlight>. The system of <dependent-claim-reference depends_on="CLM-00022">claim 25</dependent-claim-reference>, wherein the tunnel is an IPSec tunnel. </claim-text>
</claim>
<claim id="CLM-00027">
<claim-text><highlight><bold>27</bold></highlight>. A computer-readable medium encoded with a plurality of processor-executable instruction sequences for: 
<claim-text>initiating, by a first peer, a negotiation with a second peer; </claim-text>
<claim-text>extracting, by the first peer, a security configuration from information sent by the second peer; and </claim-text>
<claim-text>establishing, using the security configuration, a tunnel between the first peer and the second peer. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00028">
<claim-text><highlight><bold>28</bold></highlight>. The computer-readable medium of <dependent-claim-reference depends_on="CLM-00022">claim 27</dependent-claim-reference>, wherein the negotiation comprises a request/reply negotiation, wherein the first peer requests that the second peer send the information, and the second peer replies to the request by sending the information to the first peer. </claim-text>
</claim>
<claim id="CLM-00029">
<claim-text><highlight><bold>29</bold></highlight>. A computer-readable medium encoded with a plurality of processor-executable instruction sequences for: 
<claim-text>sending, by a second peer, information to a first peer that initiated a negotiation with the second peer, the information including a security configuration intended to be extracted by the first peer; and </claim-text>
<claim-text>establishing, using the security configuration, a tunnel between the first peer and the second peer. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00030">
<claim-text><highlight><bold>30</bold></highlight>. The computer-readable medium of <dependent-claim-reference depends_on="CLM-00022">claim 29</dependent-claim-reference>, wherein the information includes sets of attributes, the attributes including security parameters and network addresses.</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>4</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030005328A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030005328A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030005328A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030005328A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030005328A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030005328A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030005328A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
