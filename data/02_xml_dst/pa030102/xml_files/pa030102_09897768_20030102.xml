<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002059A1-20030102-D00000.TIF SYSTEM "US20030002059A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002059A1-20030102-D00001.TIF SYSTEM "US20030002059A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002059A1-20030102-D00002.TIF SYSTEM "US20030002059A1-20030102-D00002.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002059</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>09897768</doc-number>
</application-number>
<application-number-series-code>09</application-number-series-code>
<filing-date>20010702</filing-date>
</domestic-filing-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>B41J001/00</ipc>
</classification-ipc-primary>
<classification-ipc-secondary>
<ipc>G06F015/00</ipc>
</classification-ipc-secondary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>358</class>
<subclass>001900</subclass>
</uspc>
</classification-us-primary>
</classification-us>
<title-of-invention>Automatic color balance</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Krzysztof</given-name>
<middle-name>Antoni</middle-name>
<family-name>Zaklika</family-name>
</name>
<residence>
<residence-us>
<city>Saint Paul</city>
<state>MN</state>
<country-code>US</country-code>
</residence-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Mikhail</given-name>
<middle-name>Evgen?apos;evich</middle-name>
<family-name>Tatarnikov</family-name>
</name>
<residence>
<residence-non-us>
<city>St. Petersburg</city>
<country-code>RU</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Vassily</given-name>
<middle-name>Borisovich</middle-name>
<family-name>Makulov</family-name>
</name>
<residence>
<residence-non-us>
<city>St. Petersburg</city>
<country-code>RU</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>JASC Software, Inc.</organization-name>
<assignee-type>02</assignee-type>
</assignee>
<correspondence-address>
<name-1>MARK A. LITMAN &amp; ASSOCIATES, P.A.</name-1>
<name-2></name-2>
<address>
<address-1>York Business Centre, Suite 205</address-1>
<address-2>3209 West 76th Street</address-2>
<city>Edina</city>
<state>MN</state>
<postalcode>55435</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A method corrects a color image by averaging at least two color channels in regions near the minimum of histograms of the at least two color channels; selecting the smallest of the average color values as a black point; averaging at least two color channels in regions near the maximum of the histograms of the at least two color channels and selecting the largest of the average color values as a white point; and correcting the at least two color channels by adjusting the smallest and the largest color averages to the respectively match the values of the black point and white point to form corrected image data. A preferred method limits the adjustment to a predetermined amount of clipping of the at least two color channels. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF HE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field of the Invention </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates to the field of imaging, the field of computer assisted imaging, the field of digital imaging, and the field of automatically controlled enhancement of specific attributes of digital imaging data such as contrast. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Background of the Invention </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> The proliferation of digital imaging means such as photography, scanning, copying, printing and digital cameras has resulted in a large volume of color imagery. Since none of the devices produce consistently perfect color, especially in the hands of unskilled amateurs, there is a need to correct the color of images. Color correction has been the object of much effort in the imaging art but there remains a need for simple correction methods that can be applied in an automated way. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> One approach to correcting color is based on the idea that improper colors in the scene are the result of illumination that is not perfectly white. If the illuminant of the scene can be determined, then the colors of the scene can be corrected to their appearance under some standard reference illuminant. Many methods make the assumption that specular reflections in the image have a color corresponding to the illuminant so that the brightest pixels in the image can be used to recover the illuminant color. Examples of this approach include the following. U.S. Pat. No. 4,685,071 describes estimating the illuminant by determining the locus of intersection of lines fitted through sets of points of constant hue and varying saturation. U.S. Pat. No. 5,495,428 teaches a similar method in which the improvement involves weighting the lines according to their reliability. U.S. Pat. No. 5,825,916 involves a related fitting of lines to a smoothed chromaticity bitmap. U.S. Pat. No. 6,104,830 discloses a similar procedure in which the location of the lines is estimated by means of a Hough transform. In &ldquo;Signal Processing by the Input Interface to a Digital Color Laser Copier&rdquo; by A. Usami, <highlight><italic>SID </italic></highlight>90 <highlight><italic>Digest, </italic></highlight>p. 498-500 (1990) the brightest non-white pixel is considered representative of the illuminant and is adjusted to a neutral color. However, these methods fail when detector saturation occurs since the brightest pixels then no longer represent the illuminant and, except for the Usami procedure, are computationally expensive. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> An alternative approach to illuminant estimation is to examine the gamut of colors in an image. If certain colors are present in the image particular illuminants can be excluded. For example, since objects are usually colored by virtue of reflecting light, if a scene contains the color red then the illuminant must contain red and cannot, for instance, be blue. The gamut mapping procedure for illuminant recovery is described in &ldquo;A novel algorithm for color constancy&rdquo; by D. Forsyth, <highlight><italic>Int. J. Comput. Vision, </italic></highlight>5, p. 5-36 (1990). A more efficient version in a chromaticity color space has been developed by G. Finlayson and S. Hordley, <highlight><italic>Proc. IEEE Conf. Comput. Vision Patt. Recogn., </italic></highlight>p. 60-65 (1998). European Pat. 0 862,336 teaches the use of the method in a digital camera. These methods are computationally intensive an do not uniquely identify the illuminant with additional assumptions. Moreover, digital images can be subject to arbitrary color manipulation so that color imbalance does not necessarily result from illuminant changes. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> Yet another method of color correction is based on the gray world assumption introduced by Evans in U.S. Pat. No. 2,571,697. The method relies on the idea that in a complex natural scene such as typically occurs amateur photographs the average of all the colors is gray. Thus, by adjusting the mean color of the image to gray, color correction can be achieved. However, this method fails when the scene content does not, in fact, correspond to an average gray. This happens, for instance, when an object of a single color dominates the scene or in digital images, such as business graphics, which have a simple color distribution. There have been attempts to improve the method by applying it to individual luminance ranges in the image. Examples include U.S. Pat. No. 5,233,413, U.S. Pat. No. 5,357,352 and U.S. Pat. No. 5,420,704. Another variation in U.S. Pat. No. 5,926,291 seeks to use only colors of low and high brightness and also low saturation as the basis for correction. The same gray world assumption is used in the retinex family of algorithms as discussed in &ldquo;Investigations into multiscale retinex&rdquo;, K. Barnard and B. Funt, <highlight><italic>Color Imaging in Multimedia &apos;</italic></highlight>98, p. 9-17, Derby, UK, March <highlight><bold>1998. None of these methods are, however, fully satisfactory because of failure of the gray world assumption. </bold></highlight></paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> In order to improve color balancing performance some workers have taken advantage of the statistical distribution of image types submitted to the color correction system and have developed corrections tailored to certain common types of color defects. Examples include U.S. Pat. No. 4,339,517 and U.S. Pat. No. 6,097,836. However, such approaches are useless when the images to be processed do not fall into a few simple categories. Other correction methods attempt to capture the experience of imaging experts by developing rules for image correction based on examination of a very large number of images as exemplified by U.S. Pat. No. 5,694,484. In WO 97/01151 there is disclosed a color correction system that is taught color preferences through the use of neural networks. Such methods frequently fail when they encounter images not in the original training set. Moreover, the effort of developing such a method is very great because of the large number of images on which it is based and the resulting method is hard to understand and modify because of its complexity. In the case of neural networks, there is a danger of over-training, where correction of the training set improves at the expense of generality in the correction performance. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> A range of empirical color correction methods also exist, which are based on statistical analysis of color histograms and sometimes also brightness histograms. Examples include U.S. Pat. No. 4,729,016, U.S. Pat. No. 4,984,071, U.S. Pat. No. 5,117,293, U.S. Pat. No. 5,323,241 and U.S. Pat. No. 6,151,410. Most of these methods place particular emphasis on the highlight and shadow regions of the histogram though some, such as U.S. Pat. No. 6,151,410, specifically exclude some of these regions on the grounds that the data are unreliable. These methods depend on the image data set used to derive the statistical analysis of the histogram and can be unsatisfactory for images of a type not in the original data set. At least some cause over-correction of the image when applied repeatedly and can result in information loss through clipping of the lowest and highest intensities in the image. These methods are, further, inherently incapable of correcting for different scene illuminants. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> There are also color correction methods based on manually specifying a black or white point in the image or a color that should be considered as neutral gray. Such a capability is available as software in the &ldquo;Balance to sample&rdquo; feature of PhotoStyler 2.0 (Aldus Corporation, 411 First Avenue South, Seattle, Wash. 98104), in the &ldquo;Curves&rdquo; feature of Photoshop 5.5 (Adobe Systems Incorporated, 345 Park Avenue, San Jose, Calif. 95110-2704) and in the &ldquo;Automatic&rdquo; mode of the &ldquo;Tint&rdquo; feature in PhotoDraw 2000 (Microsoft Corporation, One Microsoft Way, Redmond, Wash. 98052-6399). Correction using manually specified highlight and shadow regions is disclosed in U.S. Pat. No. 5,062,058 and the falls within the claims of U.S. Pat. No. 5,487,020. These methods, however, require manual intervention and it can be difficult to select the optimal black and white points to achieve the desired correction. There have been attempts to automate this correction process. In 1996 Photoshop 4.0 introduced the &ldquo;Auto Levels&rdquo; feature that stretches the three color channel histograms to full range, by default clipping the top and bottom 0.5% of the channel values. A similar feature is available as &ldquo;Auto Tonal Adjustment&rdquo; in PhotoStyler 2.0. Additionally, U.S. Pat. No. 5,812,286 teaches such a method of correction. These methods have the disadvantage that part of the image information is lost through the clipping process and, further, image contrast is undesirably changed along with the correction of color. An attempt to solve this difficulty is disclosed in U.S. Pat. No. 5,371,615 wherein the RGB color triplets for each image pixel are examined to determine the blackest non-black pixel as min&lsqb;max(R,G,B)&rsqb; and the whitest non-white pixel as max&lsqb;min(R,G,B)&rsqb; ignoring exactly black and exactly white pixels. Subsequently a black point W<highlight><subscript>min </subscript></highlight>is specified as having all three color channels equal to min&lsqb;max(R,G,B)&rsqb; and a white point W<highlight><subscript>max </subscript></highlight>as having all three color channels equal to max&lsqb;min(R,G,B)&rsqb; and then each color channel value X<highlight><subscript>in </subscript></highlight>is corrected to a new value X<highlight><subscript>out </subscript></highlight>according to: </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>X</italic></highlight><highlight><subscript>out</subscript></highlight>&equals;(<highlight><italic>W</italic></highlight><highlight><subscript>max</subscript></highlight><highlight><italic>&minus;W</italic></highlight><highlight><subscript>min</subscript></highlight>)&times;(<highlight><italic>X</italic></highlight><highlight><subscript>in</subscript></highlight><highlight><italic>&minus;X</italic></highlight><highlight><subscript>min</subscript></highlight>)/(<highlight><italic>X</italic></highlight><highlight><subscript>max</subscript></highlight><highlight><italic>&minus;X</italic></highlight><highlight><subscript>min</subscript></highlight>)&plus;<highlight><italic>W</italic></highlight><highlight><subscript>min</subscript></highlight>. </in-line-formula></paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> This procedure, however, has the disadvantage that the color correction can depend on as few as two pixels in the image. This renders the method susceptible to noise and to defective pixels in digital camera detectors. At the same time the method does not retain the contrast of the image, an effect that can be especially marked when the green channel does not participate in the definition of W<highlight><subscript>min </subscript></highlight>and W<highlight><subscript>max</subscript></highlight>. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> It is an aspect of this invention to provide a method of color correction for digital images. A further aspect of the invention is to provide a method of removing strong color casts from images. Another aspect of the invention is to provide a means of automatically correcting color balance in images. Yet another aspect of the invention is to correct color balance in an image by a means that allows compensation for the color of the scene illuminant. Still another aspect of the invention is to provide a method of color correction that leaves image contrast substantially unchanged. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> These and other aspects of the invention are achieved by averaging color channels in regions near the minimum of the histograms of the color channels and selecting the smallest of the average color values as a black point; averaging color channels in regions near the maximum of the histograms of the color channels and selecting the largest of the average color values as a white point; correcting the color channels by adjusting the aforementioned color averages to the match the values of the black point and white point, this adjustment being done optionally in a way that limits clipping of color values; optionally providing an illuminant correction; and optionally providing a method to restore image contrast after color correction.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE FIGURES </heading>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows brightness histograms with identified regions of maximum color values and minimum color values, average points, black points, white points, and color value limits. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> shows brightness histograms with identified regions of maximum color values and minimum color values, average points, black points, white points, and color value limits.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE INVENTION </heading>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> The invention operates on digital images in which information is supplied as a grid of points or pixels. Each pixel is associated with several numbers representing color information. Typically, these are three 8- or 12-bit values representing respectively red (R), green (G) and blue (B). While the invention will be illustrated using such RGB images as examples, it will be understood that more than three or more colors can be used to represent color information, that the color space used to define color need not be restricted to RGB and that the color information is not restricted to any specific form of numeric representation. Although the invention will be described in terms of calculations using all the image pixels, it also understood that the invention may be applied to only a portion of the image pixels, either with respect to the analysis used to derive the means of correction or with respect to the regions of the image that undergo the correction, or both. Whereas the invention will be described in terms of certain illustrative embodiments it will be understood that wide variation of specific realizations of the invention is possible within its scope. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> In the practice of the invention, there are four sub-component processes that may combined, each of the sub-components of the process being novel. The first two sub-component processes relate to an initial color correction step in data format, and the second two steps effect actual implementations of the color adjustments on the data or images. The initial color correction, in general terms involves averaging at least two color channels in regions near the minimum of histograms of the at least two color channels; selecting the of the average color values as a black point or dark reference point; averaging at least two color channels in regions near the maximum of the histograms of the at least two color channels and selecting the largest of the average color values as a white point or light reference point; correcting the at least two color channels by adjusting the smallest and the largest color averages to the respectively match the values of the black point and white point to form corrected image data. It is preferred to impose a clipping limit restriction on the process of matching average color values to the reference points (i.e., the black point and white point) and the first two sub-component processes for initial color correction differ in how this may be accomplished. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> The first inventive step will be referred to as the &ldquo;direct color correction.&rdquo; The process would ordinarily be performed for each color (e.g., R, G and B), but may be performed for only two colors and provide an effect on an image. The process may comprise: </paragraph>
<paragraph id="P-0019" lvl="2"><number>&lsqb;0019&rsqb;</number> 1) For each color, forming a histogram of the darkest pixels in the image data (ignoring pixels with 0, 0, 0 values, that is true black pixels). The measure of darkness is the largest of the color values at a pixel. </paragraph>
<paragraph id="P-0020" lvl="2"><number>&lsqb;0020&rsqb;</number> 2) For each color, forming a histogram of the lightest pixels in the image data (ignoring pixels with 255, 255, 255 values, that is true white pixels). The measure of lightness is the smallest of the color values at a pixel. </paragraph>
<paragraph id="P-0021" lvl="2"><number>&lsqb;0021&rsqb;</number> 3) For the histogram of darkest pixels for each color determining a number (that is, more than one, or at least two) of the darkest pixels and compute a dark average value for this number of pixels. It is preferred that the number be a specific fraction of the area under the histogram. </paragraph>
<paragraph id="P-0022" lvl="2"><number>&lsqb;0022&rsqb;</number> 4) For the histogram of lightest pixels for each color determining a number (that is, more than one, or at least two) of the lightest pixels and compute a light average value for this number of pixels. It is preferred that the number be a specific fraction of the area under the histogram. </paragraph>
<paragraph id="P-0023" lvl="2"><number>&lsqb;0023&rsqb;</number> 5) Selecting the smallest dark average from among those determined for each channel for the darkest pixels as a dark reference point. </paragraph>
<paragraph id="P-0024" lvl="2"><number>&lsqb;0024&rsqb;</number> 6) Selecting the largest light average from among those determined for each channel for the lightest pixels as a light reference point. </paragraph>
<paragraph id="P-0025" lvl="2"><number>&lsqb;0025&rsqb;</number> 7) Specifying a fraction of image pixels as a maximum clipping fraction for each color channel for dark colors and for light colors. This defines a dark clip limit value for each color and a light clip limit value for each color. Any color value less than the dark clip limit value may be set to the minimum possible value for the color (e.g., 0). Any color value greater than the light clip limit value may be set to the maximum possible value for the color (e.g., 255). </paragraph>
<paragraph id="P-0026" lvl="2"><number>&lsqb;0026&rsqb;</number> 8) Conceptually, for each channel displacing the dark average value towards the dark reference (where one of these averages is the dark reference and does not move). The movement continues until either the average aligns with the reference or the dark clip limit value aligns with the minimum channel value, whichever comes first. </paragraph>
<paragraph id="P-0027" lvl="2"><number>&lsqb;0027&rsqb;</number> 9) Conceptually, for each channel displacing the light average value towards the light reference (where one of these averages is the light reference and does not move). The movement continues until either the average aligns with the reference or the light clip limit value aligns with the maximum channel value, whichever comes first. </paragraph>
<paragraph id="P-0028" lvl="2"><number>&lsqb;0028&rsqb;</number> 10) For all the values of each color that are not clipped, constructing a linear look-up table between a point defined by the original and displaced positions of the dark average and a point defined by the original and displaced positions of the light average and applying the look-up table to modify the color values in the image. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> Elements of this process are diagramed in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. The top panel shows the original histograms for red, green and blue channels. The shaded areas at each end of the histogram represent the fraction of pixels used to compute the dark and light averages. The values of these averages are marked with short solid vertical lines. The dark reference is marked DR and the light reference is marked LR. The center panel shows perfect alignment of all three dark averages with the dark reference and of all three light averages with the light reference, as indicated by the dotted lines. Under these conditions low values of the red channel would be excessively clipped (EC) to a degree greater than permitted by the specified maximum clipping fraction. Similarly high values of green channel would be excessively clipped (EC). The bottom panel shows the results of the above specified process, where the dark average or the red channel is moved only as far towards the dark reference as is consistent with the permitted amount of clipping PC. Thus, the low averages of the green and blue channels align with the dark reference but that of the red channel does not. For the red channel the dark clip limit value aligns with the minimum color value. Similarly, the light average of the green channel is moved only as far towards the light reference as is consistent with the permitted amount of clipping PC. Thus while the light averages of the red and blue channels align with the light reference, for the green channel the light clip limit aligns with the maximum color value. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> The second inventive step will be referred to as the &ldquo;color cast correction.&rdquo; The process would ordinarily be performed for each color (e.g., R, G and B), but may be performed for only two colors and provide an effect on an image. The process may comprise: </paragraph>
<paragraph id="P-0031" lvl="2"><number>&lsqb;0031&rsqb;</number> 1) For each color, forming a histogram of the darkest pixels in the image data (ignoring pixels with 0, 0, 0 values, that is true black pixels). The measure of darkness is the largest of the color values at a pixel. </paragraph>
<paragraph id="P-0032" lvl="2"><number>&lsqb;0032&rsqb;</number> 2) For each color, forming a histogram of the lightest pixels in the image data (ignoring pixels with 255, 255, 255 values, that is true white pixels). The measure of lightness is the smallest of the color values at a pixel. </paragraph>
<paragraph id="P-0033" lvl="2"><number>&lsqb;0033&rsqb;</number> 3) For the histogram of darkest pixels for each color determining a number (that is, more than one, or at least two) of the darkest pixels and compute a dark average value for this number of pixels. It is preferred that the number be a specific fraction of the area under the histogram. </paragraph>
<paragraph id="P-0034" lvl="2"><number>&lsqb;0034&rsqb;</number> 4) For the histogram of lightest pixels for each color determining a number (that is, more than one, or at least two) of the lightest pixels and compute a light average value for this number of pixels. It is preferred that the number be a specific fraction of the area under the histogram. </paragraph>
<paragraph id="P-0035" lvl="2"><number>&lsqb;0035&rsqb;</number> 5) Selecting the smallest dark average from among those determined for each channel for the darkest pixels as a dark reference point. </paragraph>
<paragraph id="P-0036" lvl="2"><number>&lsqb;0036&rsqb;</number> 6) Selecting the largest light average from among those determined for each channel for the lightest pixels as a light reference point. </paragraph>
<paragraph id="P-0037" lvl="2"><number>&lsqb;0037&rsqb;</number> 7) Specifying a fraction of image pixels as a maximum clipping fraction for each color channel for dark colors and for light colors. This defines a dark clip limit value for each color and a light clip limit value for each color. Any color value less than the dark clip limit value may be set to the minimum possible value for the color (e.g., 0). Any color value greater than the light clip limit value may be set to the maximum possible value for the color (e.g., 255). </paragraph>
<paragraph id="P-0038" lvl="2"><number>&lsqb;0038&rsqb;</number> 8) Conceptually, for each channel displacing the dark average value towards the dark reference (where one of these averages is the dark reference and does not move). The movement continues until there is perfect alignment. </paragraph>
<paragraph id="P-0039" lvl="2"><number>&lsqb;0039&rsqb;</number> 9) Conceptually, for each channel displacing the light average value towards the light reference (where one of these averages is the light reference and does not move). The movement continues until there is perfect alignment. </paragraph>
<paragraph id="P-0040" lvl="2"><number>&lsqb;0040&rsqb;</number> 10) Conceptually, and if required, displacing the aligned dark averages in unison to higher values until the low values of every color are clipped to an extent no greater than the maximum clipping fraction. </paragraph>
<paragraph id="P-0041" lvl="2"><number>&lsqb;0041&rsqb;</number> 11) Conceptually, and if required, displacing the aligned light averages in unison to lower values until the high values of every color are clipped to an extent no greater than the maximum clipping fraction. </paragraph>
<paragraph id="P-0042" lvl="2"><number>&lsqb;0042&rsqb;</number> 12) For all the values of each color that are not clipped, constructing a linear look-up table between a point defined by the original and displaced positions of the dark average and a point defined by the original and displaced positions of the light average and applying the look-up table to modify the color values in the image. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> Elements of this process are diagramed in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. The top panel shows the original histograms for red, green and blue channels. The shaded areas at each end of the histogram represent the fraction of pixels used to compute the dark and light averages. The values of these averages are marked with short solid vertical lines. The dark reference is marked DR and the light reference is marked LR. The center panel shows perfect alignment of all three dark averages with the dark reference and of all three light averages with the light reference, as indicated by the dotted lines. Under these conditions low values of the red channel would be excessively clipped (EC) to a degree greater than permitted by the specified maximum clipping fraction. Similarly high values of green channel would be excessively clipped (EC). The bottom panel shows the results of the above specified process, where the dark averages maintain alignment but are displaced to higher values to reduce the clipping of the red channel to the permitted amount of clipping (PC). Similarly the light averages maintain alignment but are displaced to lower values until the green channel has no more than the permitted amount of clipping (PC). Thus while all the averages are aligned in the center and bottom panels, the separation between the dark and light averages or, equivalently the separation between dark and light references, is reduced in the bottom panel. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> This process can be alternatively and more mathematically described as the pixels of the image being examined with regard to the RGB values at each pixel in order to define highlight and shadow regions of color. This may be done in a number of ways, for example by building histograms of color distribution in each channel. If these histograms are computed in cumulative (i.e., integral) form it is possible to define a shadow region as those colors lying below some integral threshold and highlights as those colors lying above some integral threshold. Such thresholds correspond to fractions of the total number of pixels in the image. It is also possible to use only a single channel, for instance a brightness channel, to define highlight and shadow regions. In practice a convenient way to define the shadow and highlight regions is the following. A histogram is constructed of the minimum values, min&lsqb;R(i,j), G(i,j), B(i,j)&rsqb;, in each color triplet for every pixel with coordinates (i,j) and pixel color values belonging to a certain integral fraction measured from the high end of the histogram are defined as belonging to the highlight region. Here min&lsqb;R(i,j), G(i,j), B(i,j)&rsqb; means the smallest value of the three color values defining a pixel and the aforementioned fraction is termed a region fraction. Similarly, a histogram is constructed of the maximum values, max&lsqb;R(i,j), G(i,j), B(i,j)&rsqb;, in each color triplet for every pixel and pixel color values belonging to a certain integral fraction measured from the low end of the histogram are defined as belonging to the shadow region. Here max&lsqb;R(i,j), G(i,j), B(i,j)&rsqb; means the largest value of the three color values defining a pixel. Though pure black pixels and pure white pixels can be included in these calculations, it is preferred to omit them since these pixels are often unreliable because of the prior processing history of the image. In the event that the histograms are empty because the image contains only black, or only white, or only black and white pixels, correction is not performed. The region fractions used to define shadows and highlights can be the same or different, though it is convenient to use the same fraction for both ranges. The region fraction can be a number greater than 0% and less than 50%, with a preferred range of 0.04% to 40% and a most preferred range of about 4%. It has been found that a range of about 4% is suitable for balancing the color of the majority of images encountered, without any user intervention, in an automatic way. Very high values near the top of the range can be used for extremely poor images with exceptionally poor color balance. For this reason, though the invention can function without user intervention for normally encountered images, it is useful to also provide the user with control of the fraction defining shadow and highlight regions. The region fraction could be set directly by the user but it has been found that a non-linear control best represents the visual effect of changing this fraction. For example, an implementation where linear steps in the control correspond to logarithmic steps in the region fraction has been found effective. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> A description of the second step would be that, for all pixels whose max&lsqb;R(i,j), G(i,j), B(i,j)&rsqb; values lie in the shadow region, the individual color channels are averaged to produce three average colors R<highlight><subscript>low</subscript></highlight>, G<highlight><subscript>low </subscript></highlight>and B<highlight><subscript>low</subscript></highlight>, constituting histogram control points. The minimum of these three values, X<highlight><subscript>low</subscript></highlight>, is then computed as a reference point. Similarly, for all pixels whose min&lsqb;R(i,j), G(i,j), B(i,j)&rsqb; values lie in the highlight region, the individual color channels are averaged to produce three average colors R<highlight><subscript>high</subscript></highlight>, G<highlight><subscript>high</subscript></highlight>, B<highlight><subscript>high </subscript></highlight>constituting additional histogram control points. The maximum of these three values, X<highlight><subscript>high</subscript></highlight>, is then computed as a second reference point. The intent of the invention is to stretch the color histograms in such a way that the control points R<highlight><subscript>low</subscript></highlight>, G<highlight><subscript>low </subscript></highlight>and B<highlight><subscript>low </subscript></highlight>coincide with the X<highlight><subscript>low </subscript></highlight>reference point and the control points R<highlight><subscript>high</subscript></highlight>, G<highlight><subscript>high</subscript></highlight>, B<highlight><subscript>high </subscript></highlight>coincide with X<highlight><subscript>high </subscript></highlight>reference point, though this intent may be restricted by conditions to be described later. This histogram stretching can be conveniently and efficiently achieved by construction of look-up tables that relate initial channel value to channel values after correction. The use of color averaging confers noise immunity on the algorithm. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> As will be discussed later in the description of specific embodiments of the invention, the alignment of histogram control points with their respective reference points is restricted by control of histogram clipping. By clipping is meant the conversion of a range of shadow or highlight input values into a single shadow or highlight output value. This results in information loss from the image and is consequently undesirable. A clipping fraction can be defined as that range of color values which are responsible for a particular fraction of the of the area under the histogram, which in turn corresponds to a particular fraction of pixels in the image. The clipping fraction is measured from the ends of the color channel histograms in a manner similar to that described for the region fraction. It is a measure of the amount of information that is lost from the image as a result of clipping. The clipping fraction can be different at the high and low ends of the histogram but it is preferred to use the same fraction at both ends. The clipping fraction can be a number from 0% to less than the region fraction, with a preferred range of from about 0.0001% to about 10%, and a most preferred range of from about 0.01% to about 5%. Additionally, it is especially preferred to make the clipping fraction dependent on the region fraction such that the clipping fraction is from about 0.02 to about 0.2 times the region fraction. Most especially preferred is a clipping fraction of about 0.2 times the region fraction. For the preferred region fraction of about 5% the preferred clipping fraction is thus about 0.1%. </paragraph>
</section>
<section>
<heading lvl="1">First Embodiment </heading>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> This embodiment is suitable for processing the majority of normal images that required color balancing, especially when it is desired to perform the correction automatically without user intervention. In the shadow region each of the control points R<highlight><subscript>low</subscript></highlight>, G<highlight><subscript>low</subscript></highlight>, B<highlight><subscript>low </subscript></highlight>that lies above X<highlight><subscript>low </subscript></highlight>is moved towards the reference point X<highlight><subscript>low</subscript></highlight>, subject to the condition that the clipping fraction is not exceeded. Thus, if a particular channel does not exceed the predetermined clipping fraction its control point is aligned with X<highlight><subscript>low</subscript></highlight>. Otherwise, the channel value of the histogram that corresponds to the clipping fraction becomes aligned with X<highlight><subscript>low</subscript></highlight>. The judgement of clipping is done channel by channel, without regard to the amount of clipping in other color channels. Similarly, in the highlight region each of the control points R<highlight><subscript>high</subscript></highlight>, G<highlight><subscript>high</subscript></highlight>, B<highlight><subscript>high </subscript></highlight>that lies below X<highlight><subscript>high </subscript></highlight>is moved towards the reference point X<highlight><subscript>high</subscript></highlight>, subject to the condition that the clipping fraction is not exceeded. Thus, if a particular channel does not exceed the predetermined clipping fraction its control point is aligned with X<highlight><subscript>high</subscript></highlight>. Otherwise, the channel value of the histogram that corresponds to the clipping fraction becomes aligned with X<highlight><subscript>high</subscript></highlight>. Again the judgement of clipping is done channel by channel, without regard to the amount of clipping in other color channels. The old and new positions of the control points are used to establish three linear look-up tables for correcting the color balance. </paragraph>
</section>
<section>
<heading lvl="1">Second Embodiment </heading>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> This embodiment, referred to as the color cast correction, is suitable for processing the majority of normal images that require color balancing and in addition is useful for images that exhibit strong color errors in the form of a distinct color cast. It can also be applied to the automatic correction of images without user intervention. The procedure will be described in two steps for clarity but, as will be appreciated by those skilled in the art, it can also be accomplished in a single step. In step 1, for the shadow region each of the control points R<highlight><subscript>low</subscript></highlight>, G<highlight><subscript>low</subscript></highlight>, B<highlight><subscript>low </subscript></highlight>is moved into exact alignment with the reference point X<highlight><subscript>low</subscript></highlight>. (Note that one color control point is already coincident with X<highlight><subscript>low </subscript></highlight>as it was used to determine X<highlight><subscript>low</subscript></highlight>). Similarly, in the highlight region each of the control points R<highlight><subscript>high</subscript></highlight>, G<highlight><subscript>high</subscript></highlight>, B<highlight><subscript>high </subscript></highlight>is moved into exact alignment with the reference point X<highlight><subscript>high</subscript></highlight>. This may result in one or more of the color channels being clipped by more than the permitted clipping fraction at one end or the other or both. In step 2, the three channel histograms are shrunk simultaneously by the same amount until none of the channels exhibits more clipping than the predetermined clipping fraction. The alignment of the three control points at each end of the histogram is maintained during this process. In other words, the X<highlight><subscript>low </subscript></highlight>reference point is shifted upwards in value until no channel has more than the predetermined clipping fraction at the low end. Similarly, the X<highlight><subscript>high </subscript></highlight>reference point is shifted downward in value until no channel has more than the predetermined clipping at the high end. The old and new positions of the control points are used to establish three linear look-up tables, that is one for each of the colors, for correcting the color balance. </paragraph>
</section>
<section>
<heading lvl="1">Third Embodiment </heading>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> Following the correction according to the first or the second embodiment of the invention the color of the resulting image is well balanced. However, the true color of the scene, especially of neutral gray or white in the scene, may not correspond to the light source used to image the scene. Thus, a scene illuminated with summer skylight of color temperature 9500K would lead to a bluish white. The same scene illuminated with average summer sunlight with some skylight at a color temperature of 6500 K would give rise to a neutral white. Illumination with a flash lamp of color temperature 5000K would produce a yellowish white and an incandescent lamp of 2900K would yield a more orange white. In some cases it is advantageous to restore the appearance of the original scene illuminant even though, strictly speaking, the colors are no longer balanced. There are many ways of achieving this objective as will be obvious to those skilled in the art. One method that has been found effective and convenient is the following. A control point is chosen for performing illuminant correction expressed, for example, as a lightness L<highlight><subscript>k </subscript></highlight>in the CIE L*a*b* color space. While other opponent color spaces with a lightness or brightness axis may be used, color spaces such as CIE L*a*b* or CIE L*u*v* are preferred since their lightness representation is well matched to human vision. Though the exact value of this control point L<highlight><subscript>k </subscript></highlight>is not critical provided it is not at the extremes of the lightness range, it is preferred to have a value near the middle of the lightness range for it is here that colors tend to have the highest saturation and consequently the effect of illuminant color correction is most easily discerned. An especially preferred value of L<highlight><subscript>k </subscript></highlight>is that which corresponds to a mid-grey in the RGB color space, such as that represented by a neutral gray of R&equals;G&equals;B&equals;127, where the range of R, G and B lies between 0 and 255. A table is prepared of the CIE L*a*b* color a<highlight><subscript>k</subscript></highlight>, b<highlight><subscript>k </subscript></highlight>values for a black body radiator of this lightness (L<highlight><subscript>k</subscript></highlight>) but of varying color temperature, k. Advantageously this table includes color temperatures from about 2000K to about 10000K. It is sufficient to have about 5 to 15 values in the table, with more values at the lower temperatures, and to achieve other values by interpolation. Several interpolation methods may be used, but linear interpolation has been found both fast and adequate. The user selects an illuminant temperature and the corresponding a<highlight><subscript>k</subscript></highlight>, b<highlight><subscript>k </subscript></highlight>color components are retrieved. The shift in red, green and blue required to transform the CIE L*a*b* color with the coordinates (L<highlight><subscript>k</subscript></highlight>, 0, 0) to that with the coordinates (L<highlight><subscript>k</subscript></highlight>, a<highlight><subscript>k</subscript></highlight>, b<highlight><subscript>k</subscript></highlight>) is then computed. A gamma function correction is calculated accordingly for each channel using this adjusted control point and the lower and upper limits of the channel values. The correction function is expressed as a look-up table. The correction for illuminant is an optional one. Without this correction the image is correct for a light source of about 6500K color temperature. </paragraph>
</section>
<section>
<heading lvl="1">Fourth Embodiment </heading>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> Following correction according to one or other of the first three embodiments the image will have an appropriate color balance. However, the contrast of the image may have changed during color correction. While any contrast change may have led to a contrast improvement it is often desirable to modify only the color balance without changing contrast. This is especially desirable if the image contrast has already been independently adjusted. Accordingly, it is preferred to optionally correct the image contrast in such a way as to restore the original image contrast. This allows color to be balanced independently of other changes in the properties of the image. Many ways of accomplishing these objectives will occur to those skilled in the art. It has been found that the following procedure is both simple and gives satisfactory results. The lightness or brightness component of a suitable color space is computed for the original uncorrected image. Similarly the same lightness component is calculated for the image that results from color correction. A look-up table is constructed that maps the result image lightness histogram to the original lightness histogram, so restoring the original image contrast. While several color spaces, such as CIE L*a*b*, CIE L*u*v*, HSL, HVC or HSB, have a suitable lightness component for performing the correction, color spaces such as YIQ, YUV or YES are preferred because the transformation to and from these spaces is rapid and the Y brightness component is a good match to human perception. Of these, YIQ is especially preferred. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A method for correcting a color image comprising: 
<claim-text>averaging at least two color channels in regions near the minimum of histograms of the at least two color channels; </claim-text>
<claim-text>selecting the smallest of the average color values as a black point; </claim-text>
<claim-text>averaging at least two color channels in regions near the maximum of the histograms of the at least two color channels and selecting the largest of the average color values as a white point; </claim-text>
<claim-text>correcting the at least two color channels by adjusting the smallest and the largest color averages to the respectively match the values of the black point and white point to form corrected image data. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein correcting is done with an imposed clipping limit on the histogram. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference> wherein the clipping limit is imposed on each of the at least two colors so that no more than a predetermined percentage of pixels are identified as black or white pixels. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein regions of the histogram near the minimum color values of histograms for at least two colors are selected based on the darkest non-black pixels in the histogram of the image. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein regions of the histogram near the maximum color values of histograms for at least two colors are selected based on the lightest non-white pixels in the histogram of the image. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein an original position and a final position of smallest color averages and an original and final position of largest color averages define two points through which a linear interpolation is used to create a look-up table for correcting color data. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> where conceptual movement of smallest color averages in the histogram is equal to the smaller of that required to achieve alignment with a black point and that required to achieve a predetermined level of clipping and conceptual movement of largest color averages is equal to the smaller of that required to achieve alignment with a white point and that required to achieve a predetermined level of clipping. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> wherein smallest color averages are aligned with the black point and largest color averages are aligned with the white point and the white and black points are conceptually moved towards each other, maintaining the alignment until clipping of all colors is reduced to no more than a predetermined amount. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein after adjustment of colors, resulting brightness distribution is replaced by the original image distribution of the image, </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference> wherein after adjustment of color, resulting brightness distribution is replaced by the original image brightness distribution. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference> wherein after adjustment of colors, resulting brightness distribution is replaced by the original image distribution of the image. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00008">claim 8</dependent-claim-reference> wherein after adjustment of colors, resulting brightness distribution is replaced by the original image distribution of the image. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference> wherein brightness is computed in a color space in which the brightness approximately matches human perception. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference> wherein brightness is computed in a color space in which the brightness approximately matches human perception. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference> wherein brightness is computed in a color space in which the brightness approximately matches human perception. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein after color adjustment, a selected illuminant color temperature correction is applied to digital image data of the color image. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference> wherein after color adjustment, a selected illuminant color temperature correction is applied to digital image data of the color image. </claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference> wherein after color adjustment, a selected illuminant color temperature correction is applied to digital image data of the color image. </claim-text>
</claim>
<claim id="CLM-00019">
<claim-text><highlight><bold>19</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00008">claim 8</dependent-claim-reference> wherein after color adjustment, a selected illuminant color temperature correction is applied to digital image data of the color image. </claim-text>
</claim>
<claim id="CLM-00020">
<claim-text><highlight><bold>20</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference> wherein after color adjustment, a selected illuminant color temperature correction is applied to digital image data of the color image. </claim-text>
</claim>
<claim id="CLM-00021">
<claim-text><highlight><bold>21</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein at least three color channels are averaged in regions near the minimum and the maximum color values of histograms of the at least three color channels. </claim-text>
</claim>
<claim id="CLM-00022">
<claim-text><highlight><bold>22</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00022">claim 21</dependent-claim-reference> wherein averages of maximum values and averages of minimum values for all three colors are compared. </claim-text>
</claim>
<claim id="CLM-00023">
<claim-text><highlight><bold>23</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00022">claim 22</dependent-claim-reference> wherein the largest of the average maximum values of color histograms determines the amount of conceptual movement of the average maximum values for all colors towards the white point. </claim-text>
</claim>
<claim id="CLM-00024">
<claim-text><highlight><bold>24</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00022">claim 22</dependent-claim-reference> wherein the smallest of the average minimum values of color histograms determines the amount of conceptual movement of the average minimum values for all colors towards the black point. </claim-text>
</claim>
<claim id="CLM-00025">
<claim-text><highlight><bold>25</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> wherein a separate look-up table of color temperatures in a three dimensional color space is provided, and temperature corrections for images are identified, and temperature corrections are added to the corrected image data. </claim-text>
</claim>
<claim id="CLM-00026">
<claim-text><highlight><bold>26</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00022">claim 22</dependent-claim-reference> wherein a separate look-up table of color temperatures in an at least two-dimensional color space is provided, and temperature corrections for images are identified, and temperature corrections are added to the corrected image data. </claim-text>
</claim>
<claim id="CLM-00027">
<claim-text><highlight><bold>27</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference> wherein brightness is computed according to a linear combination of red, green and blue data. </claim-text>
</claim>
<claim id="CLM-00028">
<claim-text><highlight><bold>28</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference> wherein brightness is computed according to a linear combination of red, green and blue data. </claim-text>
</claim>
<claim id="CLM-00029">
<claim-text><highlight><bold>29</bold></highlight>. The method of <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference> wherein brightness is computed according to a linear combination of red, green and blue data.</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002059A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002059A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002059A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
