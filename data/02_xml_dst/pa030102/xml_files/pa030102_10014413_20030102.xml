<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002438A1-20030102-D00000.TIF SYSTEM "US20030002438A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00001.TIF SYSTEM "US20030002438A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00002.TIF SYSTEM "US20030002438A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00003.TIF SYSTEM "US20030002438A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00004.TIF SYSTEM "US20030002438A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00005.TIF SYSTEM "US20030002438A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00006.TIF SYSTEM "US20030002438A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00007.TIF SYSTEM "US20030002438A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00008.TIF SYSTEM "US20030002438A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00009.TIF SYSTEM "US20030002438A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00010.TIF SYSTEM "US20030002438A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00011.TIF SYSTEM "US20030002438A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00012.TIF SYSTEM "US20030002438A1-20030102-D00012.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00013.TIF SYSTEM "US20030002438A1-20030102-D00013.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00014.TIF SYSTEM "US20030002438A1-20030102-D00014.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00015.TIF SYSTEM "US20030002438A1-20030102-D00015.TIF" NDATA TIF>
<!ENTITY US20030002438A1-20030102-D00016.TIF SYSTEM "US20030002438A1-20030102-D00016.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002438</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10014413</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20011214</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>2001-200437</doc-number>
</priority-application-number>
<filing-date>20010702</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04J001/16</ipc>
</classification-ipc-primary>
<classification-ipc-secondary>
<ipc>H04J003/14</ipc>
</classification-ipc-secondary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>370</class>
<subclass>229000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>370</class>
<subclass>230100</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Packet forwarding apparatus with packet controlling functions</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Takeki</given-name>
<family-name>Yazaki</family-name>
</name>
<residence>
<residence-non-us>
<city>Hachioji</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Yuichi</given-name>
<family-name>Ishikawa</family-name>
</name>
<residence>
<residence-non-us>
<city>Hachioji</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>Hitachi, Ltd.</organization-name>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>Stanley P. Fisher</name-1>
<name-2>Reed Smith Hazel &amp; Thomas LLP</name-2>
<address>
<address-1>Suite 1400</address-1>
<address-2>3110 Fairview Park Drive</address-2>
<city>Falls Church</city>
<state>VA</state>
<postalcode>22042-4503</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A packet forwarding apparatus which quickly selects a plurality of control information entries to be applied according to header information of an input packet and concurrently performs various the header processing functions. The packet forwarding apparatus comprises a flow retrieval unit which compares header information of the input packet with plural sets of flow identification conditions and concurrently outputs various flow identifiers appropriate to the input packet, various header processing units corresponding to the flow identifiers, and a packet forwarding control unit for controlling forwarding of input packets according to control information outputted from at least one of the header processing units. While each of the header processing units has an information table containing plural information entries, reads a single information entry from the information table according to the flow identifier outputted from the flow retrieval unit, and executes a prescribed arithmetic operation. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field of the Invention </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates to a packet forwarding apparatus which interconnects a plurality of networks, and particularly relates to a packet forwarding apparatus which provides various packet controlling functions including filtering and service quality control. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Description of Related Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> A router as a portion of an IP (Internet Protocol) network requires a flow retrieval function which detects, from header information for an input packet, the flow to which the packet belongs. In this specification, we call a series of packets which are identified by a combination of header information included in the packet header as a &ldquo;flow.&rdquo; The router performs packet controlling functions for each flow such as service quality control, statistic information control, filtering, and policy routing. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Recently, in order to cope with rapidly increasing IP traffic, a method for quicker flow retrieval has been explored. One example is the flow identification method proposed in Proceeding SB-4-2, M. Uga et al. tilted as, &ldquo;A flow identification method using content addressable memory&rdquo;, Proceedings of the 2000 IEICE General Meeting. The method is based on a CAM (Content addressable Memory) storing plural flow entries which describe flow identification conditions, and a retrieval result holding table storing plural table entries describing processing operations to be performed on an input packet according to each flow entry. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> In the above-mentioned prior art, all necessary header fields for flow identification are extracted from header information of an input packet as retrieval key information and the CAM is searched to retrieve flow entries which match with the above-mentioned retrieval key information. The CAM quickly retrieves flow entries whose flow identification conditions match with the retrieval key information, regardless of the number of flow entries registered, and outputs, as a retrieval result, the address of the flow entry whose CAM address is the smallest among the retrieved flow entries. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> The input packet is processed according to the description in the table entry read from the retrieval result holding table, based on the above-mentioned flow entry address. Therefore, if a table entry as an instruction for filtering of packets is registered at a specific address in the retrieval result holding table, it is possible to perform filtering of a group of packets which satisfy the flow identification condition as indicated by a specific flow entry with the CAM address corresponding to that table entry. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> If a table entry which specifies, for example, the type of service (TOS) is registered at another address in the retrieval result holding table, service quality can be controlled for packets which belong to a specific flow corresponding to the table entry, which matches the above TOS information. Also, if a table entry which specifies, for example, a next hop address is registered in the retrieval result holding table, policy routing can be done on packets which belong to a specific flow corresponding to that table entry, where policy routing is performed by applying the next hop address specified by the above table entry instead of the next hop address decided automatically by the routing protocol. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> In the above-mentioned prior art, a flow entry address is outputted from the CAM according to input packet header information. Then a table entry is read out from the retrieval result holding table according to that front entry address. The input packet is then processed according to the description in the table entry. This means that according to the above-mentioned prior art, only a specific type of packet processing as specified by the table entry can be performed on an input packet whose flow is identified but not on two or more types of packet processing such as service quality control and policy routing, at a time. </paragraph>
</section>
<section>
<heading lvl="1">BRIEF SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> One object of the present invention is to provide a packet forwarding apparatus which can perform concurrently various packet control functions, such as service quality control, statistic information control, policy routing, and filtering, on each packet whose flow is identified. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> Another object of the present invention is to provide a packet forwarding apparatus which quickly selects plural control information entries to be applied according to input packet header information, and concurrently performs various types of header information processing. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> In order to achieve the above-mentioned objects, according to one aspect of the present invention, the packet forwarding apparatus comprises a flow retrieval unit which compares header information of an input packet with plural sets of flow identification conditions then outputs various flow identifiers corresponding to the above-mentioned input packet concurrently, a plurality of header processing units for matching the flow identifiers, and a means for controlling forwarding of input packets according to the control information outputted from at least one of the header processing units. While each of the header processing units has an information table containing plural information entries, it reads a single information entry from the information table in accordance with the flow identifier outputted from the flow retrieval unit, and it uses that information entry to perform a given arithmetic operation. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> More specifically, according to another aspect of the present invention, the packet forwarding apparatus has plural input line interfaces connected with the respective input lines, and each of the input line interfaces comprises a means for providing the flow retrieval unit with the header information extracted from an input packet; and a packet, forwarding control means for rewriting a portion of the header information of the input packet according to control information outputted from at least one of the header processing units. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> According to another aspect of the present invention, the flow retrieval unit in the packet forwarding apparatus comprises: plural content addressable memories (&ldquo;CAM&rdquo;) consisting of a plurality of flow entries indicating flow identification conditions respectively, and a memory access control unit for generating a flow retrieval key based upon the header information received from an input line interface and concurrently accesses the content addressable memories. While each of the header processing units reads an information entry from the information table in accordance with one of the flow identifiers outputted concurrently from the content addressable memories. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> According to another aspect of the present invention, the content addressable memories are concurrently accessed by the same flow retrieval key outputted form the memory access control unit. If at least one of the content addressable memories has a flow entry to be accessed by a flow retrieval key other than the one for the other CAMs, the memory access control unit outputs the above flow retrieval keys in two groups: one group with common key fields for all the CAMs and the other group specific key fields for a specific CAM, and selectively inputs the above-mentioned common key fields and specific ones to each CAM. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> According to another aspect of the present invention, the flow retrieval unit combined with the header processing units concurrently carries out various header processing operations, such as statistic information control for each flow, service quality control, packet policy routing, and packet filtering. The flow identification conditions for the flow retrieval unit are defined by at least one of a source address and a destination address both of which are included in the packet header, a source application identifier, a destination application identifier, and priority information, such as TOS in packet forwarding. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> According to another aspect of the present invention, a packet forwarding method for performing at least two packet controlling function concurrently, comprising: defining a plurality sets of flow identification conditions to classify input packages into one flow with one set of the plurality sets of flow identification conditions; storing the flow identification conditions in at least two content addressable memories (CAMs); comparing and matching header information of each input packet with a plurality sets of flow identification conditions to identify at least two flows; designating one flow identifier associated with the input packet for each of the identified flows; outputting the flow identifiers concurrently and respectively to at least two header processing units; in each of the header processing units, incorporating an information table including a plurality of information entries, reading a single information entry from the information table according to the respective flow identifier, executing a given arithmetic operation with the single information entry; and forwarding the input packet according to control information which includes the executed result from at least one of the header processing units. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> Other objects of the present invention, its features and functions will be clarified in preferred embodiments which will be later described referring to the attached drawings.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram illustrating a router <highlight><bold>10</bold></highlight> according to one embodiment of the present invention; </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> shows an input packet format for the router <highlight><bold>10</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>; </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows another internal packet format for the router <highlight><bold>10</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>; </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a block diagram illustrating the structure of an input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>and a control unit <highlight><bold>15</bold></highlight>-<highlight><italic>i </italic></highlight>in the router <highlight><bold>10</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>; </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram illustrating the structure of a flow retrieval unit <highlight><bold>30</bold></highlight>; </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> shows the contents of entries for the CAM <highlight><bold>35</bold></highlight> for service quality control; </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> shows the structure of the control unit <highlight><bold>15</bold></highlight> composed of semiconductor LSI chips; </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> shows the structure of the CAM <highlight><bold>35</bold></highlight> for service quality control according to another embodiment of the present invention; </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> shows the structure of the control unit <highlight><bold>15</bold></highlight> composed of semiconductor LSI chips according to another embodiment of the present invention; </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a block diagram illustrating the structure of a service quality control unit <highlight><bold>70</bold></highlight>; </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> shows the structure of a bandwidth check table <highlight><bold>73</bold></highlight>; </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a flowchart showing the operational process of the service quality control unit <highlight><bold>70</bold></highlight>; </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a block diagram showing the structure of a filtering control unit <highlight><bold>40</bold></highlight>; </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> shows the structure of a filtering table <highlight><bold>41</bold></highlight>; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a block diagram illustrating the structure of a policy routing control unit <highlight><bold>50</bold></highlight>; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16</cross-reference> shows the structure of a policy routing table <highlight><bold>51</bold></highlight>; </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> is a block diagram showing the structure of a statistic information control unit <highlight><bold>60</bold></highlight>; </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 18</cross-reference> shows the structure of a statistic table <highlight><bold>61</bold></highlight>; and </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is a block diagram illustrating the router <highlight><bold>10</bold></highlight> according to another embodiment of the present invention.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> A packet forwarding apparatus according to one preferred embodiment of the present invention has a router which concurrently performs the following four types of packet processings depending on the result of an input packet flow retrieval: service quality control, statistic information control, policy routing and filtering. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows the structure of a router <highlight><bold>10</bold></highlight> according to the preferred embodiment of the present invention. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> The router <highlight><bold>10</bold></highlight> includes a plurality of input line interfaces <highlight><bold>11</bold></highlight><highlight><italic>i </italic></highlight>(i&equals;1 to n) connected with respective input lines INi (i&equals;1 to n), a plurality of output line interfaces <highlight><bold>12</bold></highlight><highlight><italic>i </italic></highlight>(i&equals;1 to n) connected with respective output lines OUTi (i&equals;1 to n), an output buffer for high priority <highlight><bold>13</bold></highlight>A-<highlight><italic>i </italic></highlight>(i&equals;1 to n), another output buffer for low priority <highlight><bold>13</bold></highlight>B-<highlight><italic>i </italic></highlight>(i&equals;1 to n) provided for each of the output line interfaces <highlight><bold>12</bold></highlight><highlight><italic>i, </italic></highlight>packet direction circuits <highlight><bold>14</bold></highlight>-<highlight><italic>i </italic></highlight>(i&equals;1 to n) for outputting packets into either of the above two buffers depending on their priority, a packet switching unit <highlight><bold>18</bold></highlight> connected with the input line interfaces <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>and the packet direction circuits <highlight><bold>14</bold></highlight>-<highlight><italic>i, </italic></highlight>a control unit <highlight><bold>15</bold></highlight> for assigning one output line as the destination for the variable-length packet received by each input line interface <highlight><bold>11</bold></highlight><highlight><italic>i, </italic></highlight>a routing function, or a function for service quality control (ex. bandwidth check), and control units <highlight><bold>15</bold></highlight>-<highlight><italic>i </italic></highlight>(i&equals;1 to n) connected with the respective input line interfaces <highlight><bold>11</bold></highlight>-<highlight><italic>i. </italic></highlight></paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> The control unit <highlight><bold>15</bold></highlight> provides a routing function according to the header information of an input packet, and a flow retrieval function, and various packet processing functions. Also, the control unit <highlight><bold>15</bold></highlight> has CAMs prepared for various types of packet processings and various control information tables to be accessed according to entry addresses outputted from these CAMs as flow identifiers. Data is set on these CAMs and control information tables through signal line L<highlight><bold>6</bold></highlight> from a management terminal <highlight><bold>90</bold></highlight>. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> shows one example of a format of a variable-length packet each input line IN-i receives. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> A variable-length input packet <highlight><bold>800</bold></highlight> received by each input line IN-I consists of L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight> including header information in the second layer (data link layer) in the open system interconnection (&ldquo;OSI&rdquo;) reference model, L<highlight><bold>3</bold></highlight> header <highlight><bold>820</bold></highlight> including header information in the third layer (network layer), and L<highlight><bold>3</bold></highlight> data <highlight><bold>810</bold></highlight>. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> The format of L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight> varies depending on the type of input lines. If the input lines IN-i support Ethernet, L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight> includes packet (data) length and other information as well as Source MAC (Media Access Control) address (SMAC) <highlight><bold>831</bold></highlight>, and Destination MAC (Media Access Control) address (DMAC) <highlight><bold>832</bold></highlight>. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> If the protocol for the network layer supports IP (Internet Protocol), L<highlight><bold>3</bold></highlight> header <highlight><bold>820</bold></highlight> includes the information of Type of Service (TOS) <highlight><bold>821</bold></highlight> which indicates the priority in packet forwarding within the network, L<highlight><bold>3</bold></highlight> packet length <highlight><bold>822</bold></highlight>, Source IP address (SIP) <highlight><bold>823</bold></highlight> which indicates the packet is sent from which terminal (the source), Destination IP address (DIP) <highlight><bold>824</bold></highlight> which indicates the terminal to which the packet is sent, etc. To simplify the explanation of the flow identification process, the following information are also treated as a portion of L<highlight><bold>3</bold></highlight> header <highlight><bold>820</bold></highlight>: the header information as used when the protocol for the fourth layer (transport layer) in the OSI reference model is TCP (Transmission Control Protocol) or UDP (User Datagram Protocol), such as Source Port (SPORT) <highlight><bold>825</bold></highlight> indicating the source protocol (upper application) and Destination Port (DPORT) <highlight><bold>826</bold></highlight> indicating the destination protocol. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> Although the explanation given here assumes that the protocol for the network layer is IP, the router <highlight><bold>10</bold></highlight> according to the present invention may use a protocol other than IP, for example, IPX. L<highlight><bold>3</bold></highlight> data <highlight><bold>810</bold></highlight> includes header information and user information in a layer above the layer of L<highlight><bold>3</bold></highlight> header. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows the format of a packet inside the router <highlight><bold>10</bold></highlight>. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> The packet (internal packet) <highlight><bold>801</bold></highlight> to be forwarded inside the router <highlight><bold>10</bold></highlight> has a format in which internal header <highlight><bold>840</bold></highlight> is added to the input packet <highlight><bold>800</bold></highlight>. The internal header <highlight><bold>840</bold></highlight> includes packet length <highlight><bold>841</bold></highlight> indicating the overall length of the packet excluding the internal header <highlight><bold>840</bold></highlight>, an input line number <highlight><bold>842</bold></highlight> as a packet input line identifier, an output line number <highlight><bold>843</bold></highlight> as a packet output line identifier, and a next hop address (NHA) <highlight><bold>844</bold></highlight> indicating the network layer address of the next node in the network over which this packet is forwarded. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> However, the internal packet <highlight><bold>801</bold></highlight> may take another form. L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight> can be excluded from the input packet <highlight><bold>800</bold></highlight>, and then internal header <highlight><bold>840</bold></highlight> is added. In the embodiment described below, the value of packet length <highlight><bold>841</bold></highlight> is treated as the packet length for each input packet for checking the bandwidth of each flow. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> shows the structure of an input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>and a control unit <highlight><bold>15</bold></highlight>-<highlight><italic>i. </italic></highlight></paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> The input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>consists of an L<highlight><bold>2</bold></highlight> terminator <highlight><bold>111</bold></highlight>, an internal header insertion unit <highlight><bold>112</bold></highlight>, a packet header processing unit <highlight><bold>113</bold></highlight>, an input buffer <highlight><bold>114</bold></highlight>, a packet forwarding control unit <highlight><bold>115</bold></highlight>, and a packet read unit <highlight><bold>116</bold></highlight>. The L<highlight><bold>2</bold></highlight> terminator <highlight><bold>111</bold></highlight> reproduces an input packet <highlight><bold>500</bold></highlight> from a signal received from the input line INi. The internal header insertion unit <highlight><bold>112</bold></highlight> adds the internal header <highlight><bold>840</bold></highlight> to the input packet received from the L<highlight><bold>2</bold></highlight> terminator <highlight><bold>111</bold></highlight> and outputs it as the internal packet <highlight><bold>801</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. The packet header processing unit <highlight><bold>113</bold></highlight> outputs the internal packet <highlight><bold>801</bold></highlight> to the input buffer <highlight><bold>114</bold></highlight> and outputs the packet header (including internal header <highlight><bold>840</bold></highlight>, L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight>, and L<highlight><bold>3</bold></highlight> header <highlight><bold>820</bold></highlight>) extracted from the internal packet <highlight><bold>801</bold></highlight> to the signal line L<highlight><bold>1</bold></highlight>-<highlight><italic>i. </italic></highlight>The packet forwarding control unit <highlight><bold>115</bold></highlight> controls rewriting of the header information of the packet stored in the input buffer <highlight><bold>114</bold></highlight> and its forwarding to the packet switching unit <highlight><bold>18</bold></highlight>. The packet read unit <highlight><bold>116</bold></highlight> reads the packet whose header has been changed, from the input buffer <highlight><bold>114</bold></highlight>. </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> The internal header insertion unit <highlight><bold>112</bold></highlight> counts the byte length of the input packet it has received from the L<highlight><bold>2</bold></highlight> terminator <highlight><bold>111</bold></highlight>, and sets the count value as the packet length <highlight><bold>841</bold></highlight> in the internal header. It also writes the predetermined identifier (number) of the input line INi as the input line number <highlight><bold>842</bold></highlight>, and sets meaningless values as the output line number <highlight><bold>843</bold></highlight> and next hop address <highlight><bold>844</bold></highlight>. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> The control unit <highlight><bold>15</bold></highlight>-<highlight><italic>i </italic></highlight>consists of a routing processing unit <highlight><bold>20</bold></highlight>, a flow retrieval unit <highlight><bold>30</bold></highlight>, a filtering control unit <highlight><bold>40</bold></highlight>, a policy routing control unit <highlight><bold>50</bold></highlight>, a statistic information control unit <highlight><bold>60</bold></highlight>, and a service quality control unit <highlight><bold>70</bold></highlight>. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> The routing processing unit <highlight><bold>20</bold></highlight> has a routing table. It extracts the destination IP address <highlight><bold>823</bold></highlight> from the packet header information outputted from the packet header processing unit <highlight><bold>113</bold></highlight> through the signal line L<highlight><bold>1</bold></highlight>, and reads from the routing table the next hop address previously registered to match the above-mentioned destination IP address and the relevant output line identifier (output line number), and outputs them as routing information through the signal line L<highlight><bold>2</bold></highlight>. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> In this example, the routing processing unit <highlight><bold>20</bold></highlight> is a portion of the control unit <highlight><bold>15</bold></highlight>-<highlight><italic>i. </italic></highlight>However, it may be a portion of the input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>instead. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> As described later in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>, the flow retrieval unit <highlight><bold>30</bold></highlight> incorporates CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>35</bold></highlight> which correspond to the filtering control unit <highlight><bold>40</bold></highlight>, the policy routing control unit <highlight><bold>50</bold></highlight>, the statistic information control unit <highlight><bold>60</bold></highlight>, and the service quality control unit <highlight><bold>70</bold></highlight>, respectively. Using the header information in a specific field of the packet header received through the signal line (data bus) L<highlight><bold>1</bold></highlight> as a retrieval key, these CAMs are accessed and the flow identifiers (flow entry addresses) from the CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>35</bold></highlight> are given to the filtering control unit <highlight><bold>40</bold></highlight>, the policy routing control unit <highlight><bold>50</bold></highlight>, the statistic information control unit <highlight><bold>60</bold></highlight>, and the service quality control unit <highlight><bold>70</bold></highlight> through signal lines L<highlight><bold>32</bold></highlight>, L<highlight><bold>33</bold></highlight>, L<highlight><bold>34</bold></highlight> and L<highlight><bold>35</bold></highlight>, respectively. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> As shown later in <cross-reference target="DRAWINGS">FIG. 13</cross-reference>, the filtering control unit <highlight><bold>40</bold></highlight> references a filtering table <highlight><bold>41</bold></highlight> in accordance with the flow identifier for filtering what it has received through the signal line L<highlight><bold>32</bold></highlight>, and issues to the signal line L<highlight><bold>3</bold></highlight> the filtering control information to indicate whether to reject (discard) or accept (pass) the input packet according to the definition of a control information entry in the filtering table <highlight><bold>41</bold></highlight>. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> As shown later in <cross-reference target="DRAWINGS">FIG. 15</cross-reference>, the policy routing control unit <highlight><bold>50</bold></highlight> references a policy routing table <highlight><bold>51</bold></highlight> in accordance with the flow identifier for policy routing it has received through the signal line L<highlight><bold>33</bold></highlight>, and decides whether policy routing is required or not according to the definition of an control information entry in the policy routing table <highlight><bold>51</bold></highlight>. In executing of the policy routing, the policy routing control unit <highlight><bold>50</bold></highlight> issues the following information to the signal line L<highlight><bold>4</bold></highlight>: the flag information to indicate the execution of policy routing, the policy routing information including the next hop address to be preferentially applied, compared with the next hop address generated in the routing processing unit <highlight><bold>20</bold></highlight>, and the relevant output line number. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> As shown later in <cross-reference target="DRAWINGS">FIG. 17</cross-reference>, the statistic information control unit <highlight><bold>60</bold></highlight> reads an entry for the counter from a statistic table <highlight><bold>61</bold></highlight> in accordance with the flow identifier for statistic information it has received through the signal line L<highlight><bold>34</bold></highlight>, and updates the counter reading according to the packet length <highlight><bold>841</bold></highlight> in the packet header information received from the signal line L<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> As shown later in <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, the service quality control unit <highlight><bold>70</bold></highlight> reads bandwidth check control parameters from a bandwidth check table <highlight><bold>73</bold></highlight> in accordance with the flow identifier for service quality it has received through the signal line L<highlight><bold>35</bold></highlight>, carries out a bandwidth check according to these control parameters and the packet length <highlight><bold>841</bold></highlight> in the packet header information received through the signal line L<highlight><bold>1</bold></highlight>, and outputs the TOS information to be given to the input packet as bandwidth control information to the signal line L<highlight><bold>5</bold></highlight>. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> The routing information, the filtering control signal, the policy routing information, and the bandwidth control information sent to signal lines L<highlight><bold>2</bold></highlight> to L<highlight><bold>5</bold></highlight> respectively enter the packet forwarding control unit <highlight><bold>115</bold></highlight> of the input line interface. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> If the filtering control signal received through the signal line L<highlight><bold>3</bold></highlight> indicates &ldquo;to pass the packet&rdquo;, the packet forwarding control unit <highlight><bold>115</bold></highlight> writes, in the header of the first packet stored in the input buffer <highlight><bold>114</bold></highlight>, the output line number and next hop address received as routing information through the signal line L<highlight><bold>1</bold></highlight> as the output line number <highlight><bold>843</bold></highlight> and NHA <highlight><bold>844</bold></highlight> respectively, and writes the TOS information received as bandwidth check information through the signal line L<highlight><bold>5</bold></highlight>, as TOS <highlight><bold>821</bold></highlight>. If the policy routing flag received through the signal line L<highlight><bold>4</bold></highlight> indicates &ldquo;to execute policy routing&rdquo;, it overwrites the output line number <highlight><bold>843</bold></highlight> and NHA <highlight><bold>844</bold></highlight> of the packet with the output line number and next hop address given as policy routing information. After this header rewriting, the packet forwarding control unit <highlight><bold>115</bold></highlight> instructs the packet read unit <highlight><bold>116</bold></highlight> to read the above packet through the signal line L<highlight><bold>115</bold></highlight>. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> If the filtering control signal indicates &ldquo;to reject the packet&rdquo;, the packet forwarding control unit <highlight><bold>115</bold></highlight> omits the instructions of rewriting packet header and making the packet read unit <highlight><bold>116</bold></highlight> read a packet, and discards the first packet stored in the input buffer <highlight><bold>114</bold></highlight>. The packet forwarding control unit <highlight><bold>115</bold></highlight> controls the forwarding of the packets stored in the input buffer <highlight><bold>114</bold></highlight> one after another by positioning the input buffer read address as the first address of the next packet each time a packet from the buffer <highlight><bold>114</bold></highlight> is forwarded or discarded. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> The router <highlight><bold>10</bold></highlight> performs filtering of input packets through a series of steps as mentioned above: retrieving a flow by the flow retrieval unit <highlight><bold>30</bold></highlight>, deciding by the filtering control unit <highlight><bold>40</bold></highlight> as to whether to reject or accept an input packet, and discarding the packet in the input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>if appropriate. The router <highlight><bold>10</bold></highlight> realizes policy routing by taking the following steps: retrieving a flow by the flow retrieval unit <highlight><bold>30</bold></highlight>, deciding by the policy routing control unit <highlight><bold>50</bold></highlight> as to whether a policy routing is required, and overwriting header in the input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i. </italic></highlight></paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, the packet switching unit <highlight><bold>18</bold></highlight> has input ports PIi (i&equals;1 to n) to be connected with input line interfaces <highlight><bold>11</bold></highlight><highlight><italic>i </italic></highlight>(i&equals;1 to n) and output ports POi (i&equals;1 to n) connected to be connected with output buffers <highlight><bold>13</bold></highlight><highlight><italic>i </italic></highlight>(i&equals;1 to n). It switches packets received from each input port PIi to an output port POj as identified by the value j of output line number <highlight><bold>843</bold></highlight>. The packets outputted from the output port POj enter the packet direction circuit <highlight><bold>14</bold></highlight>-<highlight><italic>j </italic></highlight>where some of them are then directed to the buffer for high priority transmission <highlight><bold>13</bold></highlight>A-<highlight><italic>j </italic></highlight>and the others to the buffer for low priority transmission <highlight><bold>13</bold></highlight>B-<highlight><italic>j </italic></highlight>according to the information of TOS <highlight><bold>821</bold></highlight>. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> The output packets stored in the buffers <highlight><bold>13</bold></highlight>A-<highlight><italic>j </italic></highlight>and <highlight><bold>13</bold></highlight>B-<highlight><italic>j </italic></highlight>are read by the output line interface <highlight><bold>12</bold></highlight>-<highlight><italic>j. </italic></highlight>The output line interface <highlight><bold>12</bold></highlight>-<highlight><italic>j </italic></highlight>reads out the packets stored in the buffer <highlight><bold>13</bold></highlight>A-<highlight><italic>j </italic></highlight>for high priority transmission one after another and, only when the buffer <highlight><bold>13</bold></highlight>A-<highlight><italic>j </italic></highlight>becomes empty, the packets stored in the buffer for low priority transmission <highlight><bold>13</bold></highlight>B-<highlight><italic>j </italic></highlight>are read out. The output line interface <highlight><bold>12</bold></highlight>-<highlight><italic>j </italic></highlight>determines the data link layer address DMAC of the next node to receive an output packet from NHA <highlight><bold>844</bold></highlight> in the internal header of that output packet, and writes the data link layer address of the output line OUTj as SMAC <highlight><bold>831</bold></highlight> in L<highlight><bold>2</bold></highlight> header, and writes the address determined above based on NHA <highlight><bold>844</bold></highlight> as DMAC <highlight><bold>832</bold></highlight>. Then, after removal of the internal header <highlight><bold>840</bold></highlight>, the output line interface <highlight><bold>12</bold></highlight>-<highlight><italic>j </italic></highlight>sends out the output packet to the output line OUTj. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> The router <highlight><bold>10</bold></highlight> controls the service quality for packets through the following steps: checking bandwidth by the service quality control unit <highlight><bold>70</bold></highlight>, directing packets by the packet direction circuit <highlight><bold>14</bold></highlight>-<highlight><italic>j </italic></highlight>according to the TOS information, and selectively reading packets by the output line interface <highlight><bold>12</bold></highlight>-<highlight><italic>j. </italic></highlight></paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram showing the structure of the flow retrieval unit <highlight><bold>30</bold></highlight>. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> The flow retrieval unit <highlight><bold>30</bold></highlight> consists of a CAM access control unit <highlight><bold>31</bold></highlight>, a CAM for filtering <highlight><bold>32</bold></highlight>, a CAM for policy routing <highlight><bold>33</bold></highlight>, a CAM for statistic information <highlight><bold>34</bold></highlight>, and a CAM for service quality control <highlight><bold>35</bold></highlight>. These CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>35</bold></highlight> correspond to the filtering control unit <highlight><bold>40</bold></highlight>, the policy routing control unit <highlight><bold>50</bold></highlight>, the statistic information control unit <highlight><bold>60</bold></highlight>, and the service quality control unit <highlight><bold>70</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>, respectively. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> The CAM for service quality control <highlight><bold>35</bold></highlight> includes, for example, n1 flow entries EN-<highlight><bold>1</bold></highlight> through EN-ni as shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference> describing the flow identification conditions for service quality control. In each flow entry, flow identification conditions are defined by a combination of SIP <highlight><bold>351</bold></highlight>, DIP <highlight><bold>352</bold></highlight>, SPORT <highlight><bold>353</bold></highlight>, DPORT <highlight><bold>354</bold></highlight>, TOS <highlight><bold>355</bold></highlight>, and input line number <highlight><bold>356</bold></highlight>. In this example, the other CAMs (CAM for filtering <highlight><bold>32</bold></highlight>, CAM for policy routing <highlight><bold>33</bold></highlight>, and CAM for statistic information <highlight><bold>34</bold></highlight>) use the same combination of information fields as the CAM for service quality control <highlight><bold>35</bold></highlight>, though the number of entries may be different. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> The CAM access control unit <highlight><bold>31</bold></highlight> extracts SIP <highlight><bold>823</bold></highlight>, DIP <highlight><bold>824</bold></highlight>, SPORT <highlight><bold>825</bold></highlight>, DPORT <highlight><bold>826</bold></highlight>, TOS <highlight><bold>821</bold></highlight>, and input line number <highlight><bold>842</bold></highlight> from the packet header it has received through the signal line L<highlight><bold>1</bold></highlight>, generates a flow retrieval key as a combination of these fields, and outputs it to the signal line <highlight><bold>36</bold></highlight>. The flow retrieval key is supplied to CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>35</bold></highlight> in parallel through the signal line <highlight><bold>36</bold></highlight>. The CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>35</bold></highlight> are searched to retrieve flow entries which match the above flow retrieval key in ascending order of CAM addresses, i.e., starting from the first flow entry, then output the respective retrieval results to the signal lines L<highlight><bold>32</bold></highlight> to L<highlight><bold>35</bold></highlight>. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> The search results of the CAMs include a flow identifier (flow entry CAM address) and a validity indication flag to indicate whether the flow identifier is valid or not. If there is no flow entry in one of the CAMs which matches the above-mentioned retrieval key, the validity indication flag is set to be &ldquo;invalid&rdquo; which represents the invalidity of the flow identifier. As the filtering control unit <highlight><bold>40</bold></highlight> through the service quality control unit <highlight><bold>70</bold></highlight> receive the search results of the CAMs through the signal lines L<highlight><bold>32</bold></highlight> to L<highlight><bold>35</bold></highlight>, they check the validity indication flag. If the flag is &ldquo;invalid&rdquo;, the identifier is ignored. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> If the internal packet includes L<highlight><bold>2</bold></highlight> header <highlight><bold>830</bold></highlight>, SMAC and DMAC may be added to the flow retrieval conditions such that each CAM is accessed with the flow retrieval key containing SMAC and DMAC. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> The present invention is characterized in that, as discussed above, the flow retrieval unit <highlight><bold>30</bold></highlight> has various CAMs to match the types of packet processing and these CAMs perform various flow judgments concurrently. According to the present invention, different types of packet forwarding control can be performed on an input packet at high speed because the various control units <highlight><bold>40</bold></highlight> to <highlight><bold>70</bold></highlight> concurrently execute different types of packet processing using the flow identifiers concurrently outputted from these CAMs. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> shows the structure of a control unit <highlight><bold>15</bold></highlight>-<highlight><italic>i </italic></highlight>which is embodied with semiconductor LSI chips. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> In this figure, numbers <highlight><bold>2</bold></highlight> through <highlight><bold>5</bold></highlight> represent semiconductor LSI chips (CAM chips): the CAM for filtering <highlight><bold>32</bold></highlight>, CAM for policy routing <highlight><bold>33</bold></highlight>, CAM for statistic information <highlight><bold>34</bold></highlight>, and CAM for service quality control <highlight><bold>35</bold></highlight>, respectively. Number 1 represents a control circuit board or a LSI chip (control chip) on which the CAM access control unit <highlight><bold>31</bold></highlight> as a component of the flow retrieval unit <highlight><bold>30</bold></highlight>, and the filtering control unit <highlight><bold>40</bold></highlight>, the policy routing control unit <highlight><bold>50</bold></highlight>, the statistic information control unit <highlight><bold>60</bold></highlight>, and the service quality control unit <highlight><bold>70</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 4</cross-reference> are formed. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> The CAM chips <highlight><bold>2</bold></highlight> to <highlight><bold>5</bold></highlight> are connected with the CAM access control unit <highlight><bold>31</bold></highlight> through a data line <highlight><bold>36</bold></highlight> which carries flow retrieval keys. In other words, the LSI pins of the control chip <highlight><bold>1</bold></highlight> for outputting flow retrieval keys are connected in parallel with those LSI pins for of the CAM chips <highlight><bold>2</bold></highlight> to <highlight><bold>5</bold></highlight> for inputting flow retrieval keys via the data line <highlight><bold>36</bold></highlight>. According to the present invention, even when the number of types of packet processing increases, the number of LSI pins required for the CAM access control unit <highlight><bold>31</bold></highlight> does not increase such that as many CAMs as necessary for different types of packet processing can be used. In case of flow entries as shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>, all-bit parallel transfer for flow retrieval keys and a data width of 13 bytes or so for the data line <highlight><bold>36</bold></highlight> are needed. In other words, if the LSI transfers all information simultaneously (within one clock cycle), a data width of the data line <highlight><bold>36</bold></highlight> is 13 bytes wide. If it transfers all information within a two-clock cycle, the data width is 6.5 bytes wide. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> The flow identifiers from the filtering control unit <highlight><bold>40</bold></highlight> to the service quality control unit <highlight><bold>70</bold></highlight> on the CAM chips <highlight><bold>2</bold></highlight> to <highlight><bold>5</bold></highlight> are sent in parallel to the control units in the control chip <highlight><bold>1</bold></highlight> through the signal lines (address lines) L<highlight><bold>32</bold></highlight> to L<highlight><bold>35</bold></highlight>, respectively. The volume of data to be transferred by each of the address lines is log<highlight><subscript>2 </subscript></highlight>(the number of entries in each CAM). So, even if the number of flow entries in a CAM is 64K, the flow identifier data width per packet is 2 bytes or so. In order to receive flow identifiers from the CAM chips, the control chip <highlight><bold>1</bold></highlight> must have as many LSI pins as proportional to the number of types of packet processing. Since the data width of a flow identifier is smaller than that of a flow retrieval key as described above, the number of LSI pins which have to be added to receive flow retrieval keys is relatively small even when more different types of packet processing are handled. </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> If flow entries for the CAM for filtering <highlight><bold>32</bold></highlight>, the CAM for policy routing <highlight><bold>33</bold></highlight>, and the CAM for statistic information <highlight><bold>34</bold></highlight> each contains six types of header fields <highlight><bold>351</bold></highlight> to <highlight><bold>356</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>, and flow entries for the CAM for service quality control <highlight><bold>35</bold></highlight> each contains, for example, five types of header fields <highlight><bold>351</bold></highlight> to <highlight><bold>355</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 8, a</cross-reference> flow retrieval key to be given to the CAM for service quality control <highlight><bold>35</bold></highlight> is different from a flow retrieval key to be given to the CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>34</bold></highlight>. </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> shows one example of a pattern of connections between the control chip <highlight><bold>1</bold></highlight> and the CAMs under the condition that the flow retrieval key to be given to the CAM for service quality control <highlight><bold>35</bold></highlight> is shorter than that to the other CAMs <highlight><bold>32</bold></highlight> to <highlight><bold>34</bold></highlight>. </paragraph>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> The CAM access control unit <highlight><bold>31</bold></highlight> extracts SIP <highlight><bold>823</bold></highlight>, DIP <highlight><bold>824</bold></highlight>, SPORT <highlight><bold>825</bold></highlight>, DPORT <highlight><bold>826</bold></highlight>, TOS <highlight><bold>821</bold></highlight>, and inputs line number <highlight><bold>842</bold></highlight> from the packet header received through the signal line L<highlight><bold>1</bold></highlight>. It outputs the input line number <highlight><bold>842</bold></highlight> to the signal line <highlight><bold>36</bold></highlight>A, and outputs the retrieval key part composed of the other header fields <highlight><bold>823</bold></highlight> to <highlight><bold>826</bold></highlight> and <highlight><bold>821</bold></highlight> to the signal line <highlight><bold>36</bold></highlight>B. While the signal line <highlight><bold>36</bold></highlight>B is connected with all the CAM chips <highlight><bold>2</bold></highlight> to <highlight><bold>5</bold></highlight>, the signal line <highlight><bold>36</bold></highlight>A is connected with the CAM chips except the CAM chip for service quality control <highlight><bold>5</bold></highlight>, (i.e. CAM chips <highlight><bold>2</bold></highlight> to <highlight><bold>4</bold></highlight>). </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> In this way, it is possible to arrange the key fields necessary for all CAMs to be distributed to all the CAMs over the common signal line <highlight><bold>36</bold></highlight>B, while the key fields necessary or unnecessary only for a specific CAM to be distributed over the special signal line <highlight><bold>36</bold></highlight>A. This arrangement effectively uses LSI pins on the control chip <highlight><bold>1</bold></highlight> and accesses to multiple CAMs with different retrieval keys. </paragraph>
<paragraph id="P-0083" lvl="0"><number>&lsqb;0083&rsqb;</number> Next, the structures and operations of various packet processing units (control units <highlight><bold>40</bold></highlight> to <highlight><bold>70</bold></highlight>) mounted in the control unit <highlight><bold>15</bold></highlight> are explained. </paragraph>
<paragraph id="P-0084" lvl="0"><number>&lsqb;0084&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a block diagram showing the structure of a service quality control unit <highlight><bold>70</bold></highlight> as a preferred embodiment of the present invention. </paragraph>
<paragraph id="P-0085" lvl="0"><number>&lsqb;0085&rsqb;</number> The service quality control unit <highlight><bold>70</bold></highlight> checks the bandwidth of each packet flow, decides whether or not the actual packet flow conforms to the previously registered contract bandwidth and determines the TOS information to be given to each packet according to this decision. The contract bandwidth is decided in a contract between and ISP (carrier) and a customer that use the communication service. The ISP (carrier) guarantees to transfer the packets, which are transmitted from or to the customers, with a contract bandwidth. </paragraph>
<paragraph id="P-0086" lvl="0"><number>&lsqb;0086&rsqb;</number> A variable-length packet network version of the Continuous state Leaky Bucket Algorithm, which is known as a technique for measuring the packet flow bandwidth for each connection in a fixed-length packet communication network, typically an asynchronous transfer mode (ATM) network, is used as the algorithm for bandwidth check as in the following example. See 4.4.2 in &ldquo;The ATM Forum Specification version 4.1.&rdquo;</paragraph>
<paragraph id="P-0087" lvl="0"><number>&lsqb;0087&rsqb;</number> In the Continuous-state Leaky Bucket Algorithm, the packet flow bandwidth is modeled based on the water level of a leaky bucket with a given depth which is prepared for each connection. Upon each arrival of a cell for the connection concerned, one cell of water is poured into the leaky bucket and the water collected in the bucket continues to leak at a constant rate which is proportional to the contract bandwidth for each connection, In order to allow burst transmission of cells belonging to the same connection within a range, the maximum water level for the leaky bucket is predetermined. As the cells belonging to the same connection arrive frequently, the volume of water being poured into the leaky bucket becomes larger than the leak water volume, and the water level of the bucket goes up. According to the Continuous state Leaky Bucket Algorithm, it is considered that the flow is &ldquo;conformant&rdquo; to the contract bandwidth unless the bucket overflows, and when the bucket overflows, an excessive cell flow (traffic) as a &ldquo;non-conformance&rdquo; to the bandwidth contract has occurred. In this example, the flow of water being poured into the bucket upon the arrival of a packet can be varied depending on the packet length such that the variable-length packet bandwidth is checked according to the leaky bucket algorithm. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, the service quality control unit <highlight><bold>70</bold></highlight> includes a remaining water volume calculation unit <highlight><bold>71</bold></highlight>, a check result output unit <highlight><bold>72</bold></highlight>, a bandwidth check table <highlight><bold>73</bold></highlight>, and a bandwidth check table control unit <highlight><bold>74</bold></highlight>. The remaining water volume calculation unit <highlight><bold>71</bold></highlight> calculates the remaining water volume of the leaky bucket which matches the flow identifier. The check result output unit <highlight><bold>72</bold></highlight> decides whether the packet water flow rate conforms to the contract bandwidth and outputs the decision. The bandwidth check table control unit <highlight><bold>74</bold></highlight> reads from the bandwidth check table <highlight><bold>73</bold></highlight> one bandwidth check control information entry corresponding to the flow identifier. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> shows the structure of the bandwidth check table <highlight><bold>73</bold></highlight>. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> The bandwidth check table <highlight><bold>73</bold></highlight> consists of m control information entries BE-i (i&equals;1 to m) which correspond to flow identifiers sent through the signal line L<highlight><bold>35</bold></highlight> from the flow retrieval unit <highlight><bold>30</bold></highlight> (m&lE;n1, n1 denotes the number of flow entries in the CAM <highlight><bold>35</bold></highlight>). Each control information entry BE-i includes: checked traffic characteristics information which indicates the characteristics of the packet flows (traffic) to be checked, packet arrival history information which indicates the history of packet arrivals, and service quality control information. </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> Each bandwidth check control information entry BE-i contains, as checked traffic characteristics information, for example, the threshold THR (bytes) <highlight><bold>731</bold></highlight> and the contract bandwidth (policing rate) POLR (bytes/sec) <highlight><bold>732</bold></highlight>. THR <highlight><bold>731</bold></highlight> corresponds to the bucket depth depending on the burst tolerance, and POLR <highlight><bold>732</bold></highlight> corresponds to the water leak rate of the bucket. It also includes, as packet arrival history information, TS (sec) <highlight><bold>733</bold></highlight> and CNT (bytes) <highlight><bold>734</bold></highlight>. TS <highlight><bold>733</bold></highlight> represents the time (time stamp) of arrival of the previous packet in the same packet flow, and CNT <highlight><bold>734</bold></highlight> represents the bucket water level (Count) calculated by the previous bandwidth check in the same packet flow. As service quality control information, BE-i also contains CTOS (Conformant TOS) <highlight><bold>735</bold></highlight> and NTOS (Non-conformant TOS) <highlight><bold>736</bold></highlight>. CTOS <highlight><bold>735</bold></highlight> indicates the TOS information to be allocated to the packet conforming to the contract bandwidth, while NTOS <highlight><bold>736</bold></highlight> indicates the TOS information to be allocated to the packet not conforming to the contract bandwidth. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> In this embodiment, the remaining water volume calculation unit <highlight><bold>71</bold></highlight> includes a timer which shows the current time (sec) <highlight><bold>712</bold></highlight>, a POLR storage register <highlight><bold>713</bold></highlight>, a TS register <highlight><bold>714</bold></highlight>, a CNT storage register <highlight><bold>715</bold></highlight>, and a remaining water volume calculation circuit connected with these components. The check result output unit <highlight><bold>72</bold></highlight> includes a packet length storage register <highlight><bold>722</bold></highlight>, a THR storage register <highlight><bold>723</bold></highlight>, a CTOS storage register <highlight><bold>724</bold></highlight>, an NTOS storage register <highlight><bold>725</bold></highlight>, a default TOS (Type of Service) information storage register <highlight><bold>726</bold></highlight>, and a bandwidth check circuit <highlight><bold>721</bold></highlight>. The default TOS information storage register <highlight><bold>726</bold></highlight> indicates the TOS information to be allocated to a packet for which a flow identifier is not specified, and the bandwidth check circuit <highlight><bold>721</bold></highlight> decides as to conformance to the contract bandwidth from the contents of these registers. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> The registers <highlight><bold>713</bold></highlight> to <highlight><bold>715</bold></highlight> are respectively set at the values of POLR <highlight><bold>732</bold></highlight>, TS <highlight><bold>733</bold></highlight> and CNT <highlight><bold>734</bold></highlight> which are indicated by control information entries read from the bandwidth check table <highlight><bold>73</bold></highlight> according to the flow identifiers received through the signal line L<highlight><bold>35</bold></highlight>. The values of THR <highlight><bold>731</bold></highlight>, CTOS <highlight><bold>735</bold></highlight> and NTOS <highlight><bold>736</bold></highlight> as indicated by the above control information entries are set on the registers <highlight><bold>723</bold></highlight> to <highlight><bold>725</bold></highlight>, respectively. The management terminal <highlight><bold>90</bold></highlight> sets default TOS information on the register <highlight><bold>726</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a flowchart showing the operational process of the service quality control unit <highlight><bold>70</bold></highlight>. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> The service quality control unit <highlight><bold>70</bold></highlight> mainly performs three processes: a startup process <highlight><bold>1100</bold></highlight>, a remaining water volume calculation process <highlight><bold>1110</bold></highlight>, and a decision process <highlight><bold>1120</bold></highlight>. The processes <highlight><bold>1110</bold></highlight> and <highlight><bold>1120</bold></highlight> correspond to operation of the remaining water volume calculation unit <highlight><bold>71</bold></highlight> and that of the check result output unit <highlight><bold>72</bold></highlight>, respectively. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> As the service quality control unit <highlight><bold>70</bold></highlight> receives packet header information through the signal line L<highlight><bold>1</bold></highlight>, it stores the packet length <highlight><bold>841</bold></highlight> extracted from the packet header information into the packet length storage register <highlight><bold>722</bold></highlight> of the check result output unit <highlight><bold>72</bold></highlight> (step <highlight><bold>1101</bold></highlight>). Also, as it receives a validity indication flag and a flow identifier p for service quality through the signal line L<highlight><bold>35</bold></highlight>, the bandwidth check table control unit <highlight><bold>74</bold></highlight> and the bandwidth check circuit <highlight><bold>721</bold></highlight> check the validity indication flag (step <highlight><bold>1102</bold></highlight>). If the validity indication flag indicates that the flow identifier is valid, the bandwidth check table control unit <highlight><bold>74</bold></highlight> reads, from the bandwidth check table <highlight><bold>73</bold></highlight>, the control information entry BE-p (which corresponds to the above-mentioned flow identifier p) and sets the values of POLR <highlight><bold>732</bold></highlight>, TS <highlight><bold>733</bold></highlight>, CNT <highlight><bold>734</bold></highlight>, THR <highlight><bold>731</bold></highlight>, CTOS <highlight><bold>735</bold></highlight> and NTOS <highlight><bold>736</bold></highlight> as indicated by this control information entry BE-p, on the registers <highlight><bold>713</bold></highlight>, <highlight><bold>714</bold></highlight>, <highlight><bold>715</bold></highlight>, <highlight><bold>723</bold></highlight>, <highlight><bold>724</bold></highlight>, and <highlight><bold>725</bold></highlight>, respectively (step <highlight><bold>1103</bold></highlight>). If the validity indication flag indicates that the flow identifier is &ldquo;invalid&rdquo;, the bandwidth check circuit <highlight><bold>721</bold></highlight> outputs the default TOS information set on the register <highlight><bold>726</bold></highlight> to the signal line L<highlight><bold>5</bold></highlight> (step <highlight><bold>1127</bold></highlight>) to complete the bandwidth check process. </paragraph>
<paragraph id="P-0097" lvl="0"><number>&lsqb;0097&rsqb;</number> The remaining water volume calculation circuit <highlight><bold>711</bold></highlight> (as the core of the remaining water volume calculation unit <highlight><bold>71</bold></highlight>) takes the current time from the timer <highlight><bold>712</bold></highlight> and calculates the elapsed time (sec) from the previous decision process in the flow to which the packet to be checked belongs by calculating the difference between the current time and the time of arrival of the previous packet TS shown by the register <highlight><bold>714</bold></highlight> (step <highlight><bold>1111</bold></highlight>). Then, it calculates the bucket leak water volume in the above elapsed time by multiplying the above elapsed time by the value of the bandwidth indicated by the POLR storage register <highlight><bold>713</bold></highlight> (step <highlight><bold>1112</bold></highlight>). It also calculates the bucket&apos;s remaining water volume just before the arrival of the packet of interest by subtracting the above leak water volume from the previous bucket water level CNT <highlight><bold>734</bold></highlight> as indicated by the CNT storage register <highlight><bold>715</bold></highlight> (step <highlight><bold>1113</bold></highlight>). The remaining water volume calculation circuit <highlight><bold>711</bold></highlight> decides whether the above-mentioned bucket&apos;s remaining water volume is positive or negative (step <highlight><bold>1114</bold></highlight>). If it is negative, the circuit resets the value for the bucket&apos;s remaining water volume to the initial value 0 (step <highlight><bold>1115</bold></highlight>), then notifies the bandwidth check circuit <highlight><bold>721</bold></highlight> of the bucket&apos;s remaining water volume. At the same time, the remaining water volume calculation circuit <highlight><bold>711</bold></highlight> notifies the bandwidth check table control unit <highlight><bold>74</bold></highlight> of the current time used at step <highlight><bold>1111</bold></highlight> as a new arrival time TS. </paragraph>
<paragraph id="P-0098" lvl="0"><number>&lsqb;0098&rsqb;</number> Upon receiving the bucket&apos;s remaining water volume from the remaining water volume calculation circuit <highlight><bold>711</bold></highlight>, the bandwidth check circuit <highlight><bold>721</bold></highlight> calculates the bucket water level just after the arrival of the new packet by adding the packet length (bytes) <highlight><bold>841</bold></highlight> (as indicated by the packet length storage register <highlight><bold>722</bold></highlight>) to the above bucket&apos;s remaining water volume (step <highlight><bold>1121</bold></highlight>). The circuit <highlight><bold>721</bold></highlight> compares the above bucket water level with the threshold THR <highlight><bold>731</bold></highlight> as indicated by the register <highlight><bold>723</bold></highlight> (step <highlight><bold>1122</bold></highlight>). If the bucket water level exceeds the threshold THR, the circuit <highlight><bold>721</bold></highlight> decides that the input packet does not conform to the contract bandwidth, and outputs the value of NTOS <highlight><bold>736</bold></highlight> taken from the register <highlight><bold>725</bold></highlight> to the signal line L<highlight><bold>5</bold></highlight>, and the circuit <highlight><bold>721</bold></highlight> also outputs the bucket&apos;s remaining water volume information as the bucket water level before adding the packet length to the signal line L<highlight><bold>721</bold></highlight> (step <highlight><bold>1124</bold></highlight>). If the bucket water level does not exceed the threshold THR, the bandwidth check circuit <highlight><bold>721</bold></highlight> decides that the input packet conforms to the contract bandwidth, and outputs the value of CTOS <highlight><bold>735</bold></highlight> taken from the register <highlight><bold>724</bold></highlight> to the signal line L<highlight><bold>5</bold></highlight> as well as the bucket water level information after adding the packet length to the signal line L<highlight><bold>721</bold></highlight> (step <highlight><bold>1123</bold></highlight>). </paragraph>
<paragraph id="P-0099" lvl="0"><number>&lsqb;0099&rsqb;</number> As the bandwidth check table control unit <highlight><bold>74</bold></highlight> receives the bucket water level or the remaining water volume information through the signal line L<highlight><bold>721</bold></highlight>, it writes the information as CNT <highlight><bold>734</bold></highlight> of control information entry BE-p in the bandwidth check table <highlight><bold>73</bold></highlight> and writes the arrival time TS <highlight><bold>733</bold></highlight> received through the signal line L<highlight><bold>711</bold></highlight> as TS<highlight><bold>733</bold></highlight> of the control information entry BE-p (step <highlight><bold>1125</bold></highlight>). </paragraph>
<paragraph id="P-0100" lvl="0"><number>&lsqb;0100&rsqb;</number> Setting control information entries in the bandwidth check table <highlight><bold>73</bold></highlight> and altering a control parameter in each control information entry are achieved by giving the bandwidth check table control unit <highlight><bold>74</bold></highlight> a control message including a table address and data to be written, from the management terminal <highlight><bold>90</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0101" lvl="0"><number>&lsqb;0101&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a block diagram showing the structure of the filtering control unit <highlight><bold>40</bold></highlight> as a preferred embodiment of the invention. </paragraph>
<paragraph id="P-0102" lvl="0"><number>&lsqb;0102&rsqb;</number> The filtering control unit <highlight><bold>40</bold></highlight> consists of a filtering table <highlight><bold>41</bold></highlight>, a filtering control table control unit <highlight><bold>42</bold></highlight>, and a register <highlight><bold>43</bold></highlight> for storing default filtering information. The management terminal <highlight><bold>90</bold></highlight> sets default filtering control information on the register <highlight><bold>43</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0103" lvl="0"><number>&lsqb;0103&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> shows the structure of the filtering table <highlight><bold>41</bold></highlight>. </paragraph>
<paragraph id="P-0104" lvl="0"><number>&lsqb;0104&rsqb;</number> The filtering table <highlight><bold>41</bold></highlight> consists of j control information entries FE-i (i&equals;1 to j) which correspond to flow identifiers sent through the signal line L<highlight><bold>35</bold></highlight> from the flow retrieval unit <highlight><bold>30</bold></highlight> (j&lE;n2,n2 denotes the number of flow entries in the CAM <highlight><bold>32</bold></highlight>). Each control information entry FE-i includes filtering control information which specifies whether to pass or reject the packet. Like the control information entry FE-i, the default filtering control information set on the register <highlight><bold>43</bold></highlight> specifies whether to pass or reject the packet. </paragraph>
<paragraph id="P-0105" lvl="0"><number>&lsqb;0105&rsqb;</number> As the filtering control unit <highlight><bold>40</bold></highlight> receives a validity indication flag and a flow identifier p for filtering through the signal line L<highlight><bold>32</bold></highlight>, the filtering table control unit <highlight><bold>42</bold></highlight> checks the validity indication flag. If the validity indication flag indicates that the flow identifier is &ldquo;valid&rdquo;, the filtering control unit <highlight><bold>74</bold></highlight> reads, from the filtering table <highlight><bold>41</bold></highlight>, the control information entry FE-p which corresponds to the above-mentioned flow identifier p and outputs it to the signal line L<highlight><bold>3</bold></highlight>. If the validity indication flag indicates that the flow identifier is &ldquo;invalid&rdquo;, the filtering table control unit <highlight><bold>42</bold></highlight> outputs the default filtering information set on the register <highlight><bold>43</bold></highlight> to the signal line L<highlight><bold>3</bold></highlight>. </paragraph>
<paragraph id="P-0106" lvl="0"><number>&lsqb;0106&rsqb;</number> Setting control information entries in the filtering table <highlight><bold>41</bold></highlight> and altering filtering information are achieved by giving the filtering table control unit <highlight><bold>42</bold></highlight> a control message including a table address and data to be written, from the management terminal <highlight><bold>90</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0107" lvl="0"><number>&lsqb;0107&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a block diagram showing the policy routing control unit <highlight><bold>50</bold></highlight> as a preferred embodiment of the invention. </paragraph>
<paragraph id="P-0108" lvl="0"><number>&lsqb;0108&rsqb;</number> The policy routing control unit <highlight><bold>50</bold></highlight> consists of a policy routing table <highlight><bold>51</bold></highlight> and a policy routing table control unit <highlight><bold>52</bold></highlight>. </paragraph>
<paragraph id="P-0109" lvl="0"><number>&lsqb;0109&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16</cross-reference> shows the structure of the policy routing table <highlight><bold>51</bold></highlight>. </paragraph>
<paragraph id="P-0110" lvl="0"><number>&lsqb;0110&rsqb;</number> The policy routing table <highlight><bold>51</bold></highlight> consists of k control information entries PE-i (i&equals;1 to k) which correspond to flow identifiers sent through the signal line L<highlight><bold>33</bold></highlight> from the flow retrieval unit <highlight><bold>30</bold></highlight> (k&lE;n3, n3 denotes the number of flow entries in the CAM <highlight><bold>33</bold></highlight>). Each control information entry PE-i includes the next hop address (NHA) <highlight><bold>511</bold></highlight> and the output line number <highlight><bold>512</bold></highlight>. </paragraph>
<paragraph id="P-0111" lvl="0"><number>&lsqb;0111&rsqb;</number> As the policy routing control unit <highlight><bold>50</bold></highlight> receives a validity indication flag and a flow identifier p for policy routing through the signal line L<highlight><bold>33</bold></highlight>, the policy routing table control unit <highlight><bold>52</bold></highlight> checks the validity indication flag. If the validity indication flag indicates that the flow identifier is &ldquo;valid&rdquo;, the policy routing control unit <highlight><bold>52</bold></highlight> reads, from the policy routing table <highlight><bold>51</bold></highlight>, the control information entry PE-p which corresponds to the above-mentioned flow identifier p and outputs NHA <highlight><bold>511</bold></highlight>, then outputs the line number <highlight><bold>512</bold></highlight> and the control information showing policy routing execution, as policy routing information, to the signal line L<highlight><bold>4</bold></highlight>. If the validity indication flag indicates that the flow identifier is &ldquo;invalid&rdquo;, the policy routing table control unit <highlight><bold>52</bold></highlight> outputs control information showing &ldquo;policy routing non-execution&rdquo; to the signal line L<highlight><bold>4</bold></highlight>. </paragraph>
<paragraph id="P-0112" lvl="0"><number>&lsqb;0112&rsqb;</number> Setting control information entries in the policy routing table <highlight><bold>51</bold></highlight> and altering policy routing information are achieved by giving the policy routing table control unit <highlight><bold>52</bold></highlight> a control message including a table address and data to be written, from the management terminal <highlight><bold>90</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0113" lvl="0"><number>&lsqb;0113&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> is a block diagram showing the structure of the statistic information control unit <highlight><bold>60</bold></highlight> as a preferred embodiment of the invention. </paragraph>
<paragraph id="P-0114" lvl="0"><number>&lsqb;0114&rsqb;</number> The statistic information control unit <highlight><bold>60</bold></highlight> consists of a statistic table <highlight><bold>61</bold></highlight>, a statistic table control unit <highlight><bold>62</bold></highlight>, and a register <highlight><bold>63</bold></highlight> which stores the packet length <highlight><bold>841</bold></highlight> extracted from packet header. </paragraph>
<paragraph id="P-0115" lvl="0"><number>&lsqb;0115&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 18</cross-reference> shows the structure of the statistic table <highlight><bold>61</bold></highlight>. </paragraph>
<paragraph id="P-0116" lvl="0"><number>&lsqb;0116&rsqb;</number> The statistic table <highlight><bold>61</bold></highlight> consists of q control information entries SE-i (i&equals;1 to q) which correspond to flow identifiers sent through the signal line L<highlight><bold>34</bold></highlight> from the flow retrieval unit <highlight><bold>30</bold></highlight> (q&lE;n4, n4 denotes the number of flow entries in the CAM <highlight><bold>34</bold></highlight>). Each statistic entry SE-i includes a byte counter <highlight><bold>611</bold></highlight>, which shows the sum of input packet byte lengths of each packet flow, and a packet counter <highlight><bold>612</bold></highlight>, which shows the accumulated total of input packets of each packet flow. </paragraph>
<paragraph id="P-0117" lvl="0"><number>&lsqb;0117&rsqb;</number> As the statistic information control unit <highlight><bold>60</bold></highlight> receives the packet header through the signal line L<highlight><bold>1</bold></highlight>, it sets the packet length <highlight><bold>841</bold></highlight> extracted from the packet header onto the register <highlight><bold>63</bold></highlight>. Also, as it receives a validity indication flag and a flow identifier p for statistic information through the signal line L<highlight><bold>34</bold></highlight>, the statistic table control unit <highlight><bold>62</bold></highlight> checks the validity indication flag. If the validity indication flag indicates that the flow identifier is &ldquo;valid&rdquo;, the statistic information control unit <highlight><bold>60</bold></highlight> reads, from the statistic table <highlight><bold>61</bold></highlight>, the statistic information entry SE-p which corresponds to the above-mentioned flow identifier p, then adds the packet length <highlight><bold>841</bold></highlight> as indicated by the register <highlight><bold>63</bold></highlight> to the value of the byte counter <highlight><bold>611</bold></highlight>, adds 1 to the value of the packet counter <highlight><bold>612</bold></highlight>, and writes the statistic information entry SE-p back into the statistic table <highlight><bold>61</bold></highlight>. </paragraph>
<paragraph id="P-0118" lvl="0"><number>&lsqb;0118&rsqb;</number> If the validity indication flag indicates that the flow identifier is &ldquo;invalid&rdquo;, the above-mentioned steps for reading statistic information entry SE-p and updating the counter values are omitted. </paragraph>
<paragraph id="P-0119" lvl="0"><number>&lsqb;0119&rsqb;</number> In response to the control message outputted from the management terminal <highlight><bold>90</bold></highlight> to the signal line L<highlight><bold>6</bold></highlight>, the statistic table control unit <highlight><bold>62</bold></highlight> reads the content of the statistic table <highlight><bold>61</bold></highlight> and sends it to the management terminal <highlight><bold>90</bold></highlight> through the signal line L<highlight><bold>6</bold></highlight>. </paragraph>
<paragraph id="P-0120" lvl="0"><number>&lsqb;0120&rsqb;</number> In the above embodiments, if the service quality control unit <highlight><bold>70</bold></highlight> detects a packet which does not conform to the contract bandwidth, the packet forwarding control unit <highlight><bold>115</bold></highlight> in the input line interface is designed to alter the TOS information for the non-conformant packet. However, alternatively, the non-conformant packet may be discarded by the packet forwarding control unit <highlight><bold>115</bold></highlight> like a packet to be decided discarded by the filtering control unit <highlight><bold>40</bold></highlight>. </paragraph>
<paragraph id="P-0121" lvl="0"><number>&lsqb;0121&rsqb;</number> In the above embodiments, each input line interface is connected with a control unit <highlight><bold>15</bold></highlight> (<highlight><bold>15</bold></highlight>-<highlight><bold>1</bold></highlight> to <highlight><bold>15</bold></highlight>-<highlight><italic>n</italic></highlight>) which can concurrently perform various header processing functions with various CAMs. However, the present invention is not limited thereto. For example, as shown in <cross-reference target="DRAWINGS">FIG. 19</cross-reference>, the control unit <highlight><bold>15</bold></highlight> may be shared by a plurality of input line interfaces <highlight><bold>11</bold></highlight>-<highlight><bold>1</bold></highlight> to <highlight><bold>11</bold></highlight>-n. In this case, the packet header information outputted from each input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>to the signal line L<highlight><bold>1</bold></highlight>-<highlight><italic>i </italic></highlight>is sent to the control unit <highlight><bold>15</bold></highlight> sequentially by a multiplexer (MUX) <highlight><bold>16</bold></highlight>. The control unit <highlight><bold>15</bold></highlight> outputs, to signal lines L<highlight><bold>2</bold></highlight> to L<highlight><bold>5</bold></highlight>, routing information, filtering control information, policy routing information, and bandwidth control information, which are then directed to input line interfaces <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>as sources of the packet header information by a packet direction circuit <highlight><bold>17</bold></highlight>. The packet direction circuit <highlight><bold>17</bold></highlight> identifies the input line interface <highlight><bold>11</bold></highlight>-<highlight><italic>i </italic></highlight>as the source of particular packet header information with the input line number given by the MUX <highlight><bold>16</bold></highlight>. </paragraph>
<paragraph id="P-0122" lvl="0"><number>&lsqb;0122&rsqb;</number> As obviously shown in the above description of the embodiments, the packet forwarding apparatus according to the present invention incorporates a plurality of CAMs for flow retrieval and a plurality of control tables to be accessed with the flow identifiers outputted from these CAMs so that various header processing functions can be performed concurrently according to the entry information as defined for each input packet by the tables. </paragraph>
<paragraph id="P-0123" lvl="0"><number>&lsqb;0123&rsqb;</number> The above-described preferred embodiments of the packet forwarding apparatus of the present invention implements a packet forwarding method for performing at least two packet controlling function concurrently. Such a method starts with defining a plurality sets of flow identification conditions to classify input packages into flows each with one set of flow identification conditions. The flow identification conditions are then stored in at least two content addressable memories (CAMs). The header information of each input packet is compared and matched with a plurality sets of flow identification conditions to identify at least two flows. One flow identifier associated with the input packet is designated for each of the identified flows. The flow identifiers are outputted concurrently and respectively to at least two header processing units. In each of the header processing units, an information table including a plurality of information entries is incorporated, a single information entry from is read from the information table according to the respective flow identifier, and a given arithmetic operation is executed with the single information entry. The input packet is then forwarded according to the control information which includes the executed result from at least one of the header processing units. </paragraph>
<paragraph id="P-0124" lvl="0"><number>&lsqb;0124&rsqb;</number> The foregoing invention has been described in terms of preferred embodiments. However, those skilled in the art will recognize that many variations of such embodiments exist. Such variations are intended to be within the scope of the present invention and the appended claims. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A packet forwarding apparatus, connected with a plurality of input lines and output lines, which forwards each input packet received from each of the input lines to an output line as identified by header information of the input packet, the apparatus comprising: 
<claim-text>a flow retrieval unit for comparing and matching the header information of the input packet with a plurality sets of flow identification conditions each set of which is used for classifying input packets into a flow and stored in one content addressable memory (CAM) of the flow retrieval unit, and for outputting at least two flow identifiers appropriate to the input packet concurrently to at least two header processing units respectively corresponding to each of the flow identifiers; </claim-text>
<claim-text>said header processing units each of which incorporates an information table including a plurality of information entries, reads a single information entry from the information table according to the respective flow identifier outputted from the flow retrieval unit, and executes a given arithmetic operation using the single information entry; and </claim-text>
<claim-text>means for forwarding the input packet according to control information which includes the executed result from at least one of the header processing units. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, further comprising a plurality of input line interfaces connected with said input lines, each of the input line interfaces including: 
<claim-text>a means for extracting from each input packet the header information and supplying the extracted header information to the flow retrieval unit; and </claim-text>
<claim-text>a packet rewriting means for rewriting a portion of the header information according to the control information from at least one of the header processing units. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the flow retrieval unit comprises a memory access control unit for generating a flow retrieval key from the header information received from the input line interfaces, and for concurrently accessing the CAMs with the flow retrieval key, wherein 
<claim-text>each of the CAMs consists of a plurality of flow entries indicating the respective flow identification conditions, and </claim-text>
<claim-text>each of the header processing units reads an information entry from the information table according to the respective flow identifiers outputted concurrently from the CAMs. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the CAMs are accessed concurrently with the same flow retrieval key outputted from the memory access control unit. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein at least one of the CAMs has a plurality of flow entries to be accessed with a flow retrieval key other than the one used for the other CAMs; and 
<claim-text>wherein the memory access control unit outputs the flow retrieval key in two forms, one form having common key fields for at least one common content addressable memory and the other form having specific key fields for at least one specific content addressable memory, the common and specific key fields are selectively inputted as a flow retrieval key to at least one of the CAMs. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein each of the input line interfaces has a means for providing the input packet with an respective internal header including at least an input line number, wherein the means for supplying the extracted header information to the flow retrieval unit supplies the header information including said internal header. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the header processing units concurrently execute arithmetic operations for performing at least two of collecting statistic information, service quality control, packet policy routing control, and packet filtering control, for each flow. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The packet switching apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the flow identification conditions are defined based upon at least two of the group included in the packet header: a source address, a destination address, an application identifier at the source, an application identifier at the destination, and priority information of packet forwarding. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. A packet forwarding apparatus, connected with a plurality of input lines and output lines, which forwards each input packet received from each of the input lines to an output line as identified by header information of the input packet, the apparatus comprising: 
<claim-text>a plurality of input line interfaces connected with the input lines; </claim-text>
<claim-text>a plurality of output line interfaces connected with the output lines; </claim-text>
<claim-text>a packet switch connected between the input line interfaces and the output line interfaces; and </claim-text>
<claim-text>a plurality of control units provided for each of the input line interfaces, each of the control units includes: 
<claim-text>a means for receiving packet header information from one of the input line interfaces; </claim-text>
<claim-text>a flow retrieval unit which generates a flow retrieval key from the packet header information, compares the packet header information with a plurality sets of predetermined flow identification conditions each set of which is used for classifying input packets into a flow and stored in one content addressable memory (CAM) of the flow retrieval unit, and outputs concurrently various flow identifiers which correspond to the retrieval key; and </claim-text>
<claim-text>a plurality of header processing units each of which has an information table containing a plurality of information entries and receives one of the flow identifiers outputted from the flow retrieval unit, and each of the header processing units reads a single information entry from said information table according to a specific type of flow identifier outputted from the flow retrieval unit and executes an arithmetic operation with the information entry, </claim-text>
<claim-text>wherein each of the input line interfaces has a means for rewriting a portion of the input packet header information according to control information which includes the executed result outputted from at least one of the header processing units. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein the flow retrieval unit further includes a memory access control unit for generating the flow retrieval key from the header information outputted from the input line interfaces and for concurrently accessing the CAMs with the flow retrieval key. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. A packet forwarding apparatus, connected with a plurality of input lines and output lines, which forwards each input packet received from each of the input lines to an output line as identified by header information of the input packet, the apparatus comprising: 
<claim-text>a plurality of input line interfaces connected with the input lines; </claim-text>
<claim-text>a plurality of output line interfaces connected with the output lines; </claim-text>
<claim-text>a packet switch connected between the input line interfaces and the output line interfaces; and </claim-text>
<claim-text>a plurality of control units provided for each of the input line interfaces, each of the control units includes: 
<claim-text>a means for receiving packet header information from one of the input line interfaces; </claim-text>
<claim-text>a flow retrieval unit which generates a flow retrieval key from the packet header information, compares the packet header information with a plurality sets of predetermined flow identification conditions each set of which is used for classifying input packets into a flow and stored in one content addressable memory (CAM) of the flow retrieval unit, and outputs concurrently various flow identifiers which correspond to the retrieval key; and </claim-text>
<claim-text>a plurality of header processing units each of which has an information table containing a plurality of information entries and receives one of the flow identifiers outputted from the flow retrieval unit, and each of the header processing units reads a single information entry from said information table according to a specific type of flow identifier outputted from the flow retrieval unit and executes an arithmetic operation with the information entry; and </claim-text>
<claim-text>a means for supplying control information which includes the executed result from at least one of the header processing units, to the input line interface as a source of the packet header, </claim-text>
<claim-text>wherein each of the input line interfaces has a means for rewriting a portion of the input packet header information according to the control information received from the control unit. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein the flow retrieval unit further includes a memory access control unit for generating the flow retrieval key from the header information outputted from the input line interfaces and for concurrently accessing the CAMs with the flow retrieval key. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference>, wherein the CAMs are accessed concurrently with the same flow retrieval key outputted from the memory access control unit. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein the plural content addressable memories are concurrently accessed using the same flow retrieval key outputted from the memory access control unit. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference>, wherein at least one of the CAMs has a plurality of flow entries to be accessed with a flow retrieval key other than the one used for the other CAMs; and 
<claim-text>wherein the memory access control unit outputs the flow retrieval key in two forms, one form having common key fields for at least one common content addressable memory and the other form having specific key fields for at least one specific content addressable memory, the common and specific key fields are selectively inputted as a flow retrieval key to at least one of the CAMs. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein at least one of the CAMs has a plurality of flow entries to be accessed with a flow retrieval file key other than the one used for the other CAMs; and 
<claim-text>wherein the memory access control unit outputs the flow retrieval key in two forms, one form having common key fields for at least one common content addressable memory and the other form having specific key fields for at least one specific content addressable memory, the common and specific key fields are selectively inputted as a flow retrieval key to at least one of the CAMs. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. The packet forwarding apertures as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the flow retrieval unit comprise a CAM control chip for outputting the header information to the CAMs via at least one predetermined output pin. </claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. The packet forwarding apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the number of the CAMs is larger the number of the output pin.</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002438A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002438A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002438A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030002438A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030002438A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030002438A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030002438A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030002438A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030002438A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030002438A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030002438A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030002438A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030002438A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00013">
<image id="EMI-D00013" file="US20030002438A1-20030102-D00013.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00014">
<image id="EMI-D00014" file="US20030002438A1-20030102-D00014.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00015">
<image id="EMI-D00015" file="US20030002438A1-20030102-D00015.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00016">
<image id="EMI-D00016" file="US20030002438A1-20030102-D00016.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
