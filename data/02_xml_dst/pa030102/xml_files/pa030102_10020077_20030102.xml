<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002517A1-20030102-D00000.TIF SYSTEM "US20030002517A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00001.TIF SYSTEM "US20030002517A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00002.TIF SYSTEM "US20030002517A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00003.TIF SYSTEM "US20030002517A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00004.TIF SYSTEM "US20030002517A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00005.TIF SYSTEM "US20030002517A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00006.TIF SYSTEM "US20030002517A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00007.TIF SYSTEM "US20030002517A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00008.TIF SYSTEM "US20030002517A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00009.TIF SYSTEM "US20030002517A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00010.TIF SYSTEM "US20030002517A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00011.TIF SYSTEM "US20030002517A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00012.TIF SYSTEM "US20030002517A1-20030102-D00012.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00013.TIF SYSTEM "US20030002517A1-20030102-D00013.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00014.TIF SYSTEM "US20030002517A1-20030102-D00014.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00015.TIF SYSTEM "US20030002517A1-20030102-D00015.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00016.TIF SYSTEM "US20030002517A1-20030102-D00016.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00017.TIF SYSTEM "US20030002517A1-20030102-D00017.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00018.TIF SYSTEM "US20030002517A1-20030102-D00018.TIF" NDATA TIF>
<!ENTITY US20030002517A1-20030102-D00019.TIF SYSTEM "US20030002517A1-20030102-D00019.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002517</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10020077</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20011030</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>2001-196778</doc-number>
</priority-application-number>
<filing-date>20010628</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04J003/14</ipc>
</classification-ipc-primary>
<classification-ipc-secondary>
<ipc>H04J001/16</ipc>
</classification-ipc-secondary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>370</class>
<subclass>428000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>370</class>
<subclass>229000</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Communications apparatus and communications control method</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Ryo</given-name>
<family-name>Takajitsuko</family-name>
</name>
<residence>
<residence-non-us>
<city>Kawasaki</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Kenichi</given-name>
<family-name>Okabe</family-name>
</name>
<residence>
<residence-non-us>
<city>Kawasaki</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Shiro</given-name>
<family-name>Uriu</family-name>
</name>
<residence>
<residence-non-us>
<city>Kawasaki</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Hiroya</given-name>
<family-name>Kawasaki</family-name>
</name>
<residence>
<residence-non-us>
<city>Kawasaki</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<correspondence-address>
<name-1>KATTEN MUCHIN ZAVIS ROSENMAN</name-1>
<name-2></name-2>
<address>
<address-1>575 MADISON AVENUE</address-1>
<city>NEW YORK</city>
<state>NY</state>
<postalcode>10022-2585</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A communications apparatus for switching among different interfaces includes a switch unit. The switch unit includes a main switch for switching data of a fixed length and an interface having a first buffer for an input of the main switch and a second buffer for an output of the main switch. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field of the Invention </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates to a communications apparatus designed to be connected to a network, and more particularly, to a communications apparatus such as a router accommodating a plurality of different circuits and having a switching function. More particularly still, the present invention relates to a method for queuing inside a router, and to back pressure control and related technique that is one type of traffic control. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Description of Related Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Conventionally, a relay apparatus called a router is used to connect a plurality of networks and to route and relay data. The router converts the network protocol and address and establishes a data relay path. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows an example of a conventional network composition. Routers <highlight><bold>10</bold></highlight>-<highlight><bold>13</bold></highlight> connect different networks. For example, the router <highlight><bold>10</bold></highlight> connects the Sonet/SDH ADM (Sonet/Synchronous Digital Hierarchy Add-Drop Multiplexer) <highlight><bold>14</bold></highlight>, ATM (Asynchronous Transfer Mode) dedicated line service network <highlight><bold>15</bold></highlight>, OC-48DWDM (Dense Wavelength Division Multiplexing) network <highlight><bold>16</bold></highlight>, and OC 48cDWDM network <highlight><bold>17</bold></highlight>. In other words, the router <highlight><bold>10</bold></highlight> accommodates circuits of different transmission speeds (in other words, different interfaces). Similarly, the other routers <highlight><bold>11</bold></highlight>-<highlight><bold>13</bold></highlight> also connect different networks to each other and relay data. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> This type of router relays packets of different sizes (lengths). That is, the packets it handles are of variable length. Additionally, when one circuit is congested, the router performs back pressure control to prevent the influx of packets to that circuit and thus prevent packet loss on an ethernet port unit basis (in other words, a circuit unit basis). For example, in case one port is congested, the router performs back pressure control on the circuit connected to that port. For example, in a case in which the router is equipped with a buffer for every port, the router restricts the influx of packets to the congested buffer. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> However, one drawback of the conventional router is that it cannot accommodate different networks efficiently and relay data efficiently. More specifically, the conventional router has the following drawbacks. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> First, internal control becomes extremely complicated when the conventional router attempts to relay different networks in order to relay variable length packets, and it is extremely difficult to perform QoS (Quality of Service) control for all the different transmission speeds involved. In this case, back pressure control is exerted on an ethernet port unit basis, which means that efficient back pressure control is not always exerted over packet processing at different transmission speeds such as ATM (Asynchronous Transfer Mode) and POS (Packet Over Switch). Accordingly, the conventional router cannot perform QoS control effectively and efficiently for different transmission speeds. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> Second, because the conventional router has a buffer for every output port, the buffer cannot be used efficiently. For example, in a case in which one output port is congested and another output port is not, the overall router buffer utilization efficiency is low. In order to solve this problem it is possible to aggregate the output circuits (ports) and provide a single common buffer. However, when the router receives a request for back pressure control of a given output circuit, the router continues to be influenced by the backlog until data is received to the effect that the output circuit is not congested, creating a blocking situation in which data cannot be output. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> Third, for purposes of reliability and conservative operation, the typical router is a multiplex router. In such a multiplexed router, when configured so as to commence control under backlog from either a working system or a passive system, there is a possibility that, depending on the latency and router state, the working system and passive system may fail. Accordingly, when switching from the working system to the passive system, depending on the back pressure controlled state and the buffering state, there is the possibility that a doubling up or a skipping of data may occur. Additionally, when a failure has occurred in the passive system and a backlog occurs, the working system is affected despite the breakdown in the passive system. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> Fourth, ATM circuits have standards for data jitter and delay. In order to uphold those standards, ideally back pressure control would not be undertaken at all. However, in terms of effective utilization of the buffer, performing back pressure control is desirable. However, whenever back pressure control must be performed frequently it is impossible to satisfy data jitter and delay standards. </paragraph>
</section>
<section>
<heading lvl="1">BRIEF SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> Accordingly, the present invention discloses, and has as its object to provide, a communications apparatus and communications control method that address the drawbacks of the prior art, accommodating different networks efficiently and capable of relaying data efficiently. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> The above-described object of the present invention is achieved by a communications apparatus designed to switch among different interfaces and comprising a switch unit, the switch unit comprising: </paragraph>
<paragraph id="P-0014" lvl="2"><number>&lsqb;0014&rsqb;</number> a main switch for switching data of a fixed length; and </paragraph>
<paragraph id="P-0015" lvl="2"><number>&lsqb;0015&rsqb;</number> an interface having a first buffer for an input of the main switch and a second buffer for an output of the main switch. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> According to this aspect of the invention, the main switch can be made bufferless. Accordingly, differences in transmission speed depending on network protocol can be absorbed and jitter due to switching can be reduced. Additionally, QoS control and back pressure control can be performed effectively and efficiently for all transmission speeds. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> Additionally, the above-described object of the present invention is also achieved by a communications apparatus for switching among different interfaces and comprising a switch unit, the switch unit comprising: </paragraph>
<paragraph id="P-0018" lvl="2"><number>&lsqb;0018&rsqb;</number> a main switch for switching data of a fixed length; and </paragraph>
<paragraph id="P-0019" lvl="2"><number>&lsqb;0019&rsqb;</number> an interface having a first buffer for an input of the main switch and a second buffer for an output of the main switch; </paragraph>
<paragraph id="P-0020" lvl="2"><number>&lsqb;0020&rsqb;</number> a plurality of first buffers and a plurality of second buffers being provided on each circuit. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> Additionally, the above-described object of the present invention is also achieved by a communications control method for switching among different interfaces, comprising the steps of: </paragraph>
<paragraph id="P-0022" lvl="2"><number>&lsqb;0022&rsqb;</number> switching data handled by the different interfaces after once buffering data of a fixed length related to the data handled by the different interfaces, and </paragraph>
<paragraph id="P-0023" lvl="2"><number>&lsqb;0023&rsqb;</number> sending the switched data to the circuits after once buffering the switched data.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> These and other objects, features, aspects and advantages of the present invention will become better understood and more apparent from the following description, appended claims and accompanying drawings, in which: </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows an example of a conventional network composition; </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a block diagram of a composition of a router according to a first embodiment of the present invention; </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a block diagram illustrating one possible internal composition of the constituent units shown in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>; </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a diagram showing a layer <highlight><bold>2</bold></highlight> terminal process and a layer <highlight><bold>3</bold></highlight> routing process; </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram showing a basic composition of L<highlight><bold>3</bold></highlight> processor and switch unit; </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a diagram showing one possible composition of a first scheduler; </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> is a diagram showing one possible composition of a second scheduler; </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a diagram showing one possible composition of a common buffer and an output buffer of an interface; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a diagram showing one possible composition of a third scheduler; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a diagram for explaining back pressure control using a back pressure control signal; </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a schematic diagram of a common buffer and an input buffer of an interface; </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a diagram for explaining back pressure control using a back pressure control signal; </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a diagram showing generation of a back pressure control signal; </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a diagram showing generation of another back pressure control signal; </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a diagram a case in which a cell number or flow within a queue corresponding to a class within an output buffer provided in an interface internal to a circuit processing unit of an L<highlight><bold>3</bold></highlight> processor exceeds a predetermined threshold value; </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16</cross-reference> is a diagram illustrating a second problem, in which <cross-reference target="DRAWINGS">FIG. 16A</cross-reference> illustrates a configuration having a plurality of buffers and <cross-reference target="DRAWINGS">FIG. 16B</cross-reference> illustrates an occurrence of blocking; </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 17A and 17B</cross-reference> are diagrams showing a communications apparatus according to a second embodiment of the present invention, in which <cross-reference target="DRAWINGS">FIG. 17A</cross-reference> illustrates a physical back pressure flow and <cross-reference target="DRAWINGS">FIG. 17B</cross-reference> illustrates a logical back pressure flow. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 18</cross-reference> is a diagram showing a communications apparatus according to a third embodiment of the present invention; and </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is a diagram showing a communications apparatus according to a fourth embodiment of the present invention.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE INVENTION </heading>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> A description will now be given of embodiments of the present invention, with reference to the accompanying drawings. It should be noted that identical or corresponding elements in the embodiments are given identical or corresponding reference numbers in all drawings, with detailed descriptions of such elements given once and thereafter omitted. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a block diagram of a composition of a router according to a first embodiment of the present invention. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> As shown in the diagram, a router <highlight><bold>20</bold></highlight> replaces the routers <highlight><bold>10</bold></highlight>-<highlight><bold>13</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. The router <highlight><bold>20</bold></highlight> is multiplexed. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> The router <highlight><bold>20</bold></highlight> comprises circuit terminals <highlight><bold>21</bold></highlight><highlight><italic>w</italic></highlight>, <highlight><bold>21</bold></highlight><highlight><italic>p</italic></highlight>, L<highlight><bold>3</bold></highlight> (layer <highlight><bold>3</bold></highlight>: network layer) processors <highlight><bold>22</bold></highlight><highlight><italic>w </italic></highlight>and <highlight><bold>22</bold></highlight><highlight><italic>p</italic></highlight>, switches <highlight><bold>23</bold></highlight><highlight><italic>w </italic></highlight>and <highlight><bold>23</bold></highlight><highlight><italic>p</italic></highlight>, L<highlight><bold>3</bold></highlight> processors <highlight><bold>24</bold></highlight><highlight><italic>w </italic></highlight>and <highlight><bold>24</bold></highlight><highlight><italic>p</italic></highlight>, and circuit terminals <highlight><bold>25</bold></highlight><highlight><italic>w </italic></highlight>and <highlight><bold>25</bold></highlight><highlight><italic>p</italic></highlight>. The suffix &ldquo;w&rdquo; indicates a multiplexed working system and the suffix &ldquo;p&rdquo; indicates a passive system. The multiplexed L<highlight><bold>3</bold></highlight> processor and circuit terminal that are connected to the switches <highlight><bold>23</bold></highlight><highlight><italic>w</italic></highlight>, <highlight><bold>23</bold></highlight><highlight><italic>p </italic></highlight>need not necessarily be multiplexed. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> The types of circuits handled by the router <highlight><bold>20</bold></highlight> include Ether 10/100 Base-T, Ether 1000 Base-T, POS, OC3C, OC12C, OC48C, ATM OC3C, OC12C, STM T1/E1, STS3, STS12, and so forth. The types of circuits handled are not limited to these specifically enumerated circuits, and it is contemplated that the router <highlight><bold>20</bold></highlight> may handle other equivalent circuits that have been or may be developed. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> A description will now be given of the internal composition of the constituent units shown in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a block diagram illustrating one possible internal composition of the constituent units shown in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> The composition shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference> may apply to either the passive system or the multiplexed working system. Thus, in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, the suffixes &ldquo;w&rdquo; and &ldquo;p&rdquo; attached to the reference numbers that distinguish between the working system and the passive system have been eliminated. Additionally, the composition shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is arranged along the flow of data as shown by the solid arrows therein. Accordingly, the circuit terminal <highlight><bold>21</bold></highlight> and the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> are shown separated into an input side and an output side. </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> The input side circuit terminal <highlight><bold>21</bold></highlight> comprises a physical layer processor <highlight><bold>211</bold></highlight> and an L<highlight><bold>3</bold></highlight> interface <highlight><bold>212</bold></highlight>. The L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> comprises a circuit interface <highlight><bold>221</bold></highlight>, a local switch <highlight><bold>222</bold></highlight> and a switch interface <highlight><bold>223</bold></highlight>. The L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> transfers data between communications apparatus connected to a plurality of networks and performs processes data relay according to a communications protocol. The switch unit <highlight><bold>23</bold></highlight> comprises an input switch interface <highlight><bold>231</bold></highlight>, a main switch <highlight><bold>232</bold></highlight> and an output switch interface <highlight><bold>233</bold></highlight>. The output side L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> comprises a switch interface <highlight><bold>224</bold></highlight>, a local switch <highlight><bold>225</bold></highlight> and a circuit interface <highlight><bold>226</bold></highlight>. The output side circuit terminal <highlight><bold>25</bold></highlight> comprises an L<highlight><bold>3</bold></highlight> interface <highlight><bold>213</bold></highlight> and a physical layer processor <highlight><bold>214</bold></highlight>. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> The circuit terminal <highlight><bold>21</bold></highlight> physical layer processor <highlight><bold>211</bold></highlight> accommodates and aggregates circuits on a network connected via a port. The L<highlight><bold>3</bold></highlight> interface <highlight><bold>212</bold></highlight> performs layer <highlight><bold>2</bold></highlight> processing (layer <highlight><bold>2</bold></highlight> terminal process) on data on the circuit aggregated by the physical layer processor <highlight><bold>211</bold></highlight>. The L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> circuit interface <highlight><bold>221</bold></highlight>, after temporarily accumulating variable-length packets in a buffer, converts the packets so stored into fixed-length packets of a predetermined length (hereinafter referred to as cells). This process is called fragmenting. The local switch <highlight><bold>222</bold></highlight> carries out switching of the cells from the circuit interface <highlight><bold>221</bold></highlight>. The switching interface <highlight><bold>223</bold></highlight>, after temporarily storing the cells output by the local switch <highlight><bold>222</bold></highlight>, outputs the cells to the switch <highlight><bold>23</bold></highlight>. The switch <highlight><bold>23</bold></highlight>, after temporarily storing the cells from the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight>, outputs the cells to the main switch <highlight><bold>232</bold></highlight>. The main switch <highlight><bold>232</bold></highlight> performs routing based on layer <highlight><bold>3</bold></highlight> IP (Internet Protocol). The main switch <highlight><bold>232</bold></highlight> does not have a buffer. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a diagram showing a layer <highlight><bold>2</bold></highlight> terminal process and a layer <highlight><bold>3</bold></highlight> routing process. For example, in an ATM circuit, the ATM layer is terminated at the circuit terminal <highlight><bold>21</bold></highlight>, with the switch <highlight><bold>23</bold></highlight> routing the ATM cell based on the layer <highlight><bold>3</bold></highlight> IP data. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> The switch interface <highlight><bold>233</bold></highlight> temporarily stores cells routed by the main switch <highlight><bold>232</bold></highlight>. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> The output side L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> switch interface <highlight><bold>224</bold></highlight> temporarily stores cells from the switch <highlight><bold>23</bold></highlight>. The local switch <highlight><bold>225</bold></highlight> switches cells from the circuit interface <highlight><bold>224</bold></highlight>. The circuit interface <highlight><bold>226</bold></highlight> temporarily stores cells from the local switch <highlight><bold>225</bold></highlight>. The circuit terminal <highlight><bold>21</bold></highlight> L<highlight><bold>3</bold></highlight> interface <highlight><bold>213</bold></highlight> temporarily stores cells routed from the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight>, adds data relating to layer <highlight><bold>2</bold></highlight>, and further, converts the cells to corresponding variable-length packets. The physical layer processor <highlight><bold>214</bold></highlight> outputs the variable-length packets to the corresponding circuit (port). </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> The symbol &ldquo;x&rdquo; in <cross-reference target="DRAWINGS">FIG. 3</cross-reference> indicates a back pressure signal disposal (terminal) point for the back pressure signal to be described in greater detail below. In a communications apparatus according to a first embodiment of the present invention, the back pressure signal is terminated at the switch interface <highlight><bold>223</bold></highlight> of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> and data discarded. Additionally, in a communications apparatus according to a second embodiment of the present invention, the back pressure signal is terminated at the local switch <highlight><bold>225</bold></highlight> of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight>, and data discarded. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> A description will now be given of a basic composition and a basic operation of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> and switch unit <highlight><bold>23</bold></highlight>. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram showing a basic composition of L<highlight><bold>3</bold></highlight> processor and switch unit. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> As shown in the diagram, the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> comprises circuit processors <highlight><bold>22</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>22</bold></highlight><highlight><subscript>7 </subscript></highlight>and internal processor <highlight><bold>22</bold></highlight><highlight><subscript>8</subscript></highlight>. The circuit processor <highlight><bold>22</bold></highlight><highlight><subscript>0 </subscript></highlight>comprises interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>and network processor <highlight><bold>227</bold></highlight><highlight><subscript>0</subscript></highlight>. The interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>corresponds to one port (circuit) of the router <highlight><bold>20</bold></highlight>, and is equivalent to an internal circuit of the switch interfaces <highlight><bold>223</bold></highlight> and <highlight><bold>224</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. The network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>is connected to the local switch <highlight><bold>222</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, but in order to simplify the drawing has been eliminated from <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. The network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>processes the two input lines IN<highlight><bold>0</bold></highlight>, IN<highlight><bold>1</bold></highlight> and the two output lines OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight>. The interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>is equipped with FIFO type common buffers <highlight><bold>31</bold></highlight>, <highlight><bold>32</bold></highlight>, input buffer <highlight><bold>35</bold></highlight> and output buffer <highlight><bold>36</bold></highlight>. The other circuit processors <highlight><bold>22</bold></highlight><highlight><subscript>2</subscript></highlight>-<highlight><bold>22</bold></highlight><highlight><subscript>7 </subscript></highlight>have the same composition. That is, the circuit processors <highlight><bold>22</bold></highlight><highlight><subscript>2</subscript></highlight><highlight><bold>22</bold></highlight><highlight><subscript>7 </subscript></highlight>have interfaces <highlight><bold>220</bold></highlight><highlight><subscript>1</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>and network processors <highlight><bold>227</bold></highlight><highlight><subscript>3</subscript></highlight>-<highlight><bold>227</bold></highlight><highlight><subscript>7</subscript></highlight>, respectively. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> The internal processor <highlight><bold>22</bold></highlight><highlight><subscript>8 </subscript></highlight>comprises interface <highlight><bold>220</bold></highlight><highlight><subscript>8 </subscript></highlight>and main processor <highlight><bold>227</bold></highlight><highlight><subscript>8</subscript></highlight>. The main processor <highlight><bold>227</bold></highlight><highlight><subscript>8 </subscript></highlight>provides comprehensive control of the router <highlight><bold>20</bold></highlight> and, via the interface <highlight><bold>220</bold></highlight><highlight><subscript>8</subscript></highlight>, exchanges cells with the switch unit <highlight><bold>23</bold></highlight>. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> The switch unit <highlight><bold>23</bold></highlight> comprises the main switch <highlight><bold>232</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference> and the circuit processors <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. The interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>are the equivalent of internal circuits of the switch interface <highlight><bold>231</bold></highlight>, <highlight><bold>233</bold></highlight>. The interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>correspond to the L<highlight><bold>3</bold></highlight> processor interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7</subscript></highlight>, respectively. Additionally, the interface <highlight><bold>220</bold></highlight><highlight><subscript>8 </subscript></highlight>is connected to the interface <highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. The interface <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>, comprises FIFO-type common buffers <highlight><bold>33</bold></highlight> and <highlight><bold>34</bold></highlight>, as well as output buffer <highlight><bold>37</bold></highlight> and input buffer <highlight><bold>38</bold></highlight>. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> The other interfaces <highlight><bold>230</bold></highlight><highlight><subscript>1</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>have the same composition. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> It should be noted that, for ease of explanation, the common buffer <highlight><bold>33</bold></highlight> and the output buffer <highlight><bold>37</bold></highlight> are together called the first buffer. Additionally, the common buffer <highlight><bold>34</bold></highlight> and the input buffer <highlight><bold>38</bold></highlight> are together called the second buffer. Further, the common buffer <highlight><bold>35</bold></highlight> and the input buffer <highlight><bold>31</bold></highlight> are together called the third buffer. Further, the common buffer <highlight><bold>32</bold></highlight> and the output buffer <highlight><bold>36</bold></highlight> are together called the fourth buffer. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> A description will now be given of the basic operation of the circuit shown in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> The network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>receives cells from the local switch <highlight><bold>222</bold></highlight> and outputs to the input buffer <highlight><bold>35</bold></highlight>. Cell input is accomplished with two lines, inputs IN<highlight><bold>0</bold></highlight> and IN<highlight><bold>1</bold></highlight>. The input buffer <highlight><bold>35</bold></highlight> outputs the received cells to the common buffer <highlight><bold>31</bold></highlight>. By so doing, a cell queue is formed at the common buffer <highlight><bold>31</bold></highlight>. The cells in the common buffer <highlight><bold>31</bold></highlight> are then read out according to a scheduling process to be described in greater detail below, and sent to the switch unit <highlight><bold>23</bold></highlight>. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> The common buffer <highlight><bold>33</bold></highlight> of the switch unit <highlight><bold>23</bold></highlight> accommodates the cells sent from the interface <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>. The cells contained in the common buffer <highlight><bold>33</bold></highlight> are the read out according to a scheduling process to be described in greater detail later, and, after being stored temporarily in the output buffer <highlight><bold>37</bold></highlight>, sent to the main switch <highlight><bold>232</bold></highlight>. The main switch <highlight><bold>232</bold></highlight> switches the received cells. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> The cells from the main switch <highlight><bold>232</bold></highlight>, after being temporarily stored in the input buffer <highlight><bold>38</bold></highlight>, are stored in the common buffer <highlight><bold>34</bold></highlight>. The cells stored in the common buffer <highlight><bold>34</bold></highlight> are then read out according to a scheduling process to be described in greater detail below and sent to the interface <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>. The common buffer <highlight><bold>32</bold></highlight> of the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>accommodates the received cells. Then, the cells are read out from the common buffer <highlight><bold>32</bold></highlight> according to a scheduling process to be described in greater detail below and temporarily stored in the output buffer <highlight><bold>36</bold></highlight>. Then, the cells read out from the output buffer <highlight><bold>36</bold></highlight> are output to the network processor <highlight><bold>227</bold></highlight><highlight><subscript>0</subscript></highlight>. The network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>outputs the received cells to the local switch <highlight><bold>222</bold></highlight> via the output lines OUT<highlight><bold>0</bold></highlight> and OUT<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> As will be described in greater detail below, the individual input buffers <highlight><bold>35</bold></highlight>, <highlight><bold>38</bold></highlight> and output buffers <highlight><bold>36</bold></highlight>, <highlight><bold>37</bold></highlight> have a buffer (queue) for every QoS class. The QoS class may for example include fixed bit rate service, variable bit rate service, unrestricted bit rate service, available bit rate service and multicast service. The QoS service unit can be set arbitrarily for each interface. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> A description will now be given of back pressure control. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> shows back pressure signals BP<highlight><bold>1</bold></highlight>, BP<highlight><bold>2</bold></highlight>, BP<highlight><bold>3</bold></highlight>, BP<highlight><bold>4</bold></highlight> and BP<highlight><bold>5</bold></highlight> used in the communications apparatus according to a first embodiment of the present invention. The back pressure signal BP<highlight><bold>1</bold></highlight> is generated when the output buffer <highlight><bold>37</bold></highlight> and the common buffer <highlight><bold>33</bold></highlight> inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight> assumes a predetermined state. Such a predetermined state may be a state of congestion or a state in which congestion is predicted to occur. Congestion may also be defined to include a state in which congestion is predicted to occur. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> The back pressure signal BP<highlight><bold>1</bold></highlight> stops the readout of cells from the common buffer <highlight><bold>31</bold></highlight> provided inside the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight>. The arrow of back pressure signal BP<highlight><bold>1</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> indicates a logical flow. Preferably, the back pressure signal BP<highlight><bold>1</bold></highlight> is composed of cells. These cells are called flow control cells. That is, in-band flow control transmits the back pressure signal BP<highlight><bold>1</bold></highlight>. More specifically, when the common buffer <highlight><bold>33</bold></highlight> or the output buffer <highlight><bold>37</bold></highlight> assume a predetermined state, the scheduling process sends the flow control cells to the common buffer <highlight><bold>32</bold></highlight> of the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>via the common buffer <highlight><bold>34</bold></highlight>. When the flow control cells are read from the common buffer <highlight><bold>32</bold></highlight>, the scheduling process stops the readout of cells from the common buffer <highlight><bold>31</bold></highlight>. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> The back pressure signal BP<highlight><bold>2</bold></highlight> is generated when the output buffer <highlight><bold>36</bold></highlight> or the joint buffer <highlight><bold>32</bold></highlight> inside the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> assumes a predetermined state. The back pressure signal BP<highlight><bold>2</bold></highlight> stops the readout of cells from the common buffer <highlight><bold>33</bold></highlight> provided inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight>. The arrow of back pressure signal BP<highlight><bold>1</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> indicates a logical flow. Preferably, the back pressure signal BP<highlight><bold>1</bold></highlight> is composed of flow control cells. The physical flow of the flow control cells is as follows: When the common buffer <highlight><bold>32</bold></highlight> or the output buffer <highlight><bold>36</bold></highlight> assumes a predetermined state, the scheduling process sends the flow control cells to the common buffer <highlight><bold>33</bold></highlight> of the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>via the common buffer <highlight><bold>31</bold></highlight>. When flow control cells are read out from the common buffer <highlight><bold>33</bold></highlight>, the scheduling process stops the readout of cells from the common buffer <highlight><bold>33</bold></highlight>. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> It should be noted that, as will be described in greater detail below, the back pressure signal BP<highlight><bold>2</bold></highlight> exerts link level flow control, that is, can stop the readout of cells from the common buffer <highlight><bold>33</bold></highlight> for all the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. This control is carried out in conjunction with back pressure signal BP<highlight><bold>5</bold></highlight> to be described in greater detail below. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> The back pressure signal BP<highlight><bold>3</bold></highlight> is generated when the input buffer <highlight><bold>38</bold></highlight> or the common buffer <highlight><bold>24</bold></highlight> inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight> assumes a predetermined state. The back pressure signal BP<highlight><bold>3</bold></highlight> stops the readout of cells from the common buffer <highlight><bold>33</bold></highlight> provided inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight>. The arrow of back pressure signal BP<highlight><bold>3</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> indicates a logical flow. Preferably, the back pressure signal BP<highlight><bold>3</bold></highlight> is composed of flow control cells. More specifically, when the common buffer <highlight><bold>34</bold></highlight> or the input buffer <highlight><bold>38</bold></highlight> assume a predetermined state, the scheduling process sends the flow control cells to the common buffer <highlight><bold>33</bold></highlight> of the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>via the common buffer <highlight><bold>31</bold></highlight>. When the flow control cells are read from the common buffer <highlight><bold>33</bold></highlight>, the scheduling process stops the readout of cells from the common buffer <highlight><bold>33</bold></highlight>. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> The back pressure signal BP<highlight><bold>4</bold></highlight> controls the readout of cells from the common buffer <highlight><bold>32</bold></highlight> in output OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight> units. When the internal buffer provided at the local switch <highlight><bold>225</bold></highlight> (see <cross-reference target="DRAWINGS">FIG. 3</cross-reference>) at the end of the output OUT<highlight><bold>0</bold></highlight> or OUT<highlight><bold>1</bold></highlight> assumes a predetermined state, the network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>transmits the back pressure signal BP<highlight><bold>4</bold></highlight> to the common buffer <highlight><bold>32</bold></highlight> via a dedicated line. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> The back pressure signal BP<highlight><bold>5</bold></highlight> is a signal transmitted serially via a back pressure bus to be described in greater detail below. The back pressure bus connects the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>to each other. The back pressure signal BP<highlight><bold>5</bold></highlight> stops the readout of cells from the common buffer <highlight><bold>33</bold></highlight> inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. Readout using the back pressure signal BP<highlight><bold>5</bold></highlight>, as will be described in greater detail below, can be stopped at the QoS class unit (also called service class) as well as at the buffer unit. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> A description will now be given of the scheduling process of the common buffer <highlight><bold>31</bold></highlight> provided inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>, with reference in the first instance to <cross-reference target="DRAWINGS">FIG. 6</cross-reference>. </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a diagram showing one possible composition of a first scheduler that performs the scheduling process (sometimes hereinafter referred to simply as scheduling). </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> The scheduler shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference> (hereinafter referred to as the first scheduler) comprises address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7 </subscript></highlight>corresponding to the common buffer <highlight><bold>31</bold></highlight> of the interface <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7</subscript></highlight>, an address queue <highlight><bold>45</bold></highlight> that contains the addresses of cells to be multicast, a selector <highlight><bold>44</bold></highlight> that selects an output of the address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7</subscript></highlight>, and a selector <highlight><bold>46</bold></highlight> that selects either the output of the selector <highlight><bold>44</bold></highlight> or the output of the address queue <highlight><bold>45</bold></highlight>. The first scheduler, which is absent from FIGS. <highlight><bold>2</bold></highlight>-<highlight><bold>5</bold></highlight> above simply for ease of explanation and illustration, controls the readout of that which is indicated as {circle over (<highlight><bold>1</bold></highlight>)} in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> Each of the address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7 </subscript></highlight>has queues <highlight><bold>43</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>43</bold></highlight><highlight><subscript>7</subscript></highlight>, respectively, of a number corresponding to the class. In this embodiment, eight classes are contemplated, ranging from class <highlight><bold>0</bold></highlight> to class <highlight><bold>7</bold></highlight>. Address pointer values of cells stored in the corresponding common buffer <highlight><bold>31</bold></highlight> are stored in the queues <highlight><bold>43</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>43</bold></highlight><highlight><subscript>7</subscript></highlight>. For example, cells of class <highlight><bold>0</bold></highlight> are stored in queue <highlight><bold>43</bold></highlight><highlight><subscript>0 </subscript></highlight>address queue <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>. Each of the queues <highlight><bold>43</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>43</bold></highlight><highlight><subscript>7 </subscript></highlight>are composed of FIFO-type memory units. Address pointer values of the common buffer <highlight><bold>31</bold></highlight> in which queues to be multicast are stored are stored in the address queue <highlight><bold>45</bold></highlight>. </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> The selector <highlight><bold>42</bold></highlight> selects (arbitrates) a queue to be read according to scheduling between classes. The selection logic of this scheduling is Weighted Round Robin (hereinafter sometimes referred to as WRR). In contrast to the simple sequential selection of ordinary Round Robin (RR) logic, with the WRR logic it is possible to weight queues in the round. This weighting establishes the maximum number of times readout on a continuous basis from that queue can be performed, so when all the queues are given a weighting of 1 the WRR logic and the RR logic are identical. After initialization, selection from the queue <highlight><bold>43</bold></highlight><highlight><subscript>0 </subscript></highlight>is performed. When the queue is empty or continuously read, the process moves to the next class readout at the next packet period. Different weightings can be given to different classes. For example, the weighting can be the same for interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7</subscript></highlight>. </paragraph>
<paragraph id="P-0083" lvl="0"><number>&lsqb;0083&rsqb;</number> Accordingly, scheduling between classes is carried out for each of the address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7</subscript></highlight>. </paragraph>
<paragraph id="P-0084" lvl="0"><number>&lsqb;0084&rsqb;</number> The selector <highlight><bold>44</bold></highlight> schedules selection of address queues of cells to be read from among the address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7</subscript></highlight>. The selection logic may be Round Robin. </paragraph>
<paragraph id="P-0085" lvl="0"><number>&lsqb;0085&rsqb;</number> The selector <highlight><bold>46</bold></highlight> selects either the selector <highlight><bold>44</bold></highlight> output or the output of the multicast address queue <highlight><bold>45</bold></highlight>. The selection logic only reads from the multicast when there is no output from the selector <highlight><bold>44</bold></highlight>, in other words, only when there are no unicast cells to be read from the common buffers <highlight><bold>31</bold></highlight> of the address queues <highlight><bold>41</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>41</bold></highlight><highlight><subscript>7</subscript></highlight>. In this case, the multicast queue (buffer) inside the common buffer <highlight><bold>31</bold></highlight> becomes the object to be read. When there are not even cells to be read in the multicast queue as well, the selection logic does not read cells during cell time. </paragraph>
<paragraph id="P-0086" lvl="0"><number>&lsqb;0086&rsqb;</number> As described above, the first scheduler determines the address of the cell to be read from the interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7</subscript></highlight>. </paragraph>
<paragraph id="P-0087" lvl="0"><number>&lsqb;0087&rsqb;</number> It should be noted that, in order to transmit the flow control cells that form the back pressure signal BP<highlight><bold>2</bold></highlight>, the first scheduler forcibly inserts a single non-effective cell so as to be able to create a time during which the readout of cells from the buffer does not occur. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> A description will now be given of back pressure control using the back pressure signal BP<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> As described above, an arbitrary packet period read queue is determined using the three scheduling processes. When the back pressure signal BP<highlight><bold>1</bold></highlight> is sent to the above-described scheduler, the first scheduler stops the readout of cells pursuant to the back pressure signal BP<highlight><bold>1</bold></highlight>. As will be explained below, there are two types of back pressure signal BP<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> When the back pressure signal BP<highlight><bold>1</bold></highlight> is link level, that is, when the switch interface <highlight><bold>23</bold></highlight> requests that the switch interface <highlight><bold>22</bold></highlight> stop the readout of all cells, the first scheduler receives the back pressure signal BP<highlight><bold>1</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> and disables the selector <highlight><bold>46</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>. Accordingly, cell readout addresses are not supplied to the common buffer and the readout of cells from the interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>is stopped. </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> By contrast, when the back pressure signal BP<highlight><bold>1</bold></highlight> is port unit (circuit unit), there is, for example, a possibility that the common buffer <highlight><bold>33</bold></highlight> inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight> will be congested. Thus, when requesting a stop to the readout of cells from the common buffer <highlight><bold>31</bold></highlight>, the first scheduler receives the back pressure signal BP<highlight><bold>1</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> and disables the selector <highlight><bold>42</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>. Accordingly, the readout of cells from the common buffer <highlight><bold>31</bold></highlight> of the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>is stopped. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> The scheduling process of the common buffer <highlight><bold>32</bold></highlight> of the interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>is performed by the second scheduler. The second scheduler controls the cell readout of that which is indicated by the reference numeral {circle over (<highlight><bold>2</bold></highlight>)} in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> is a diagram showing one possible composition of a second scheduler. The second scheduler comprises address queues <highlight><bold>47</bold></highlight><highlight><subscript>0</subscript></highlight>, <highlight><bold>47</bold></highlight><highlight><subscript>1 </subscript></highlight>that correspond to outputs OUT<highlight><bold>0</bold></highlight> and OUT<highlight><bold>1</bold></highlight>, respectively, and a selector <highlight><bold>51</bold></highlight> that selects an output of either the address queue <highlight><bold>47</bold></highlight><highlight><subscript>0 </subscript></highlight>or the address queue <highlight><bold>471</bold></highlight> The address queues <highlight><bold>47</bold></highlight><highlight><subscript>0</subscript></highlight>, <highlight><bold>47</bold></highlight><highlight><subscript>1 </subscript></highlight>each have queues <highlight><bold>48</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>48</bold></highlight><highlight><subscript>7 </subscript></highlight>corresponding to the eight classes, a queue <highlight><bold>48</bold></highlight><highlight><subscript>8 </subscript></highlight>corresponding to the multicast, a selector <highlight><bold>49</bold></highlight> that chooses one of the aforementioned queues, and a selector <highlight><bold>50</bold></highlight> that selects one or the other of either the selector <highlight><bold>49</bold></highlight> or the queue <highlight><bold>48</bold></highlight><highlight><subscript>8</subscript></highlight>. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> The second scheduler determines the readout of which queue corresponding to which QoS class. In order to perform the above-described selection process there are two logic methods. The first logic involves arbitration between outputs OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight>, the second logic involves arbitration between QoS classes. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> The first logic determines for each packet period which packet to read, either OUT<highlight><bold>0</bold></highlight> or OUT<highlight><bold>1</bold></highlight>. This selection involves reading OUT<highlight><bold>0</bold></highlight> and OUT<highlight><bold>1</bold></highlight> fixedly in turns at each packet period, and in order to do so a per-2-packet-period multiframe is generated, the first half for OUT<highlight><bold>0</bold></highlight> and the second half for OUT<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> The second logic involves determining which queue to read from among the queues <highlight><bold>48</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>48</bold></highlight><highlight><subscript>7 </subscript></highlight>corresponding to the eight classes and the one multicast queue <highlight><bold>48</bold></highlight><highlight><subscript>8 </subscript></highlight>for each output OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight>. As one example of selection logic, first, precedence is given to logic that guarantees frame continuity, and next, a Weighted Round Robin system for the eight QoS unicasts is employed, and then finally, a selection is made between unicast and multicast according to a fixed priority ranking. In a logic guaranteeing frame continuity, address pointer values are read out from corresponding queues so as to be able to read out the cells continuously from among the selected queues. All queues, when not in a frame read state, move to the next WRR system. This logic selection employing the WRR method is the same selection as described above with respect to the scheduling of the common buffer <highlight><bold>31</bold></highlight>. However, because it is necessary to guarantee frame continuity, the weighting is not as to the number of continuous cell readouts but as to the maximum number of continuous frame readouts. The process carried out according to a fixed priority ranking reads out the address pointer values from the multicast queue <highlight><bold>48</bold></highlight><highlight><subscript>8 </subscript></highlight>when all class queues <highlight><bold>48</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>48</bold></highlight><highlight><subscript>7 </subscript></highlight>are empty. That is, the multicast frame is not read as long as a unicast frame exists. It should be noted that when all the queues <highlight><bold>48</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>48</bold></highlight><highlight><subscript>8 </subscript></highlight>are empty the readout is invalid. </paragraph>
<paragraph id="P-0097" lvl="0"><number>&lsqb;0097&rsqb;</number> A description will now be given of back pressure control using the back pressure signal BP<highlight><bold>4</bold></highlight>. </paragraph>
<paragraph id="P-0098" lvl="0"><number>&lsqb;0098&rsqb;</number> As stated above, the back pressure signal BP<highlight><bold>4</bold></highlight> controls the readout of cells of the common buffer <highlight><bold>31</bold></highlight> in outputs OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight> units. When an internal buffer provided in the local switch <highlight><bold>225</bold></highlight> (see <cross-reference target="DRAWINGS">FIG. 3</cross-reference>) at the end of the outputs OUT<highlight><bold>0</bold></highlight>, OUT<highlight><bold>1</bold></highlight> assumes a predetermined state, the network processor <highlight><bold>227</bold></highlight><highlight><subscript>0 </subscript></highlight>sends the back pressure signal BP<highlight><bold>4</bold></highlight> to the common buffer <highlight><bold>32</bold></highlight> via a dedicated line. When the second scheduler shown in <cross-reference target="DRAWINGS">FIG. 7</cross-reference> receives the back pressure signal BP<highlight><bold>4</bold></highlight>, the second scheduler masks an output of address queues <highlight><bold>47</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>47</bold></highlight><highlight><subscript>1 </subscript></highlight>corresponding to the output designated by the back pressure signal BP<highlight><bold>4</bold></highlight>. By masking, packets to be read are rendered nonexistent. That is, the output of the address queues <highlight><bold>47</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>47</bold></highlight><highlight><subscript>1 </subscript></highlight>is rendered invalid. </paragraph>
<paragraph id="P-0099" lvl="0"><number>&lsqb;0099&rsqb;</number> A description will now be given of the scheduling of the common buffer <highlight><bold>33</bold></highlight> provided inside the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>, with reference in the first instance to <cross-reference target="DRAWINGS">FIG. 8</cross-reference> and <cross-reference target="DRAWINGS">FIG. 9</cross-reference>. </paragraph>
<paragraph id="P-0100" lvl="0"><number>&lsqb;0100&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a diagram showing one possible composition of a common buffer and an output buffer of an interface. </paragraph>
<paragraph id="P-0101" lvl="0"><number>&lsqb;0101&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 8</cross-reference>, the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>is configured so that the common buffer <highlight><bold>33</bold></highlight> comprises a preprocessor <highlight><bold>53</bold></highlight>, a common buffer <highlight><bold>33</bold></highlight>, an address controller <highlight><bold>55</bold></highlight> and a scheduler <highlight><bold>70</bold></highlight> (hereinafter referred to as the third scheduler). The third scheduler <highlight><bold>70</bold></highlight> comprises a queue allocation component <highlight><bold>56</bold></highlight>, address queues <highlight><bold>57</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>57</bold></highlight><highlight><subscript>1</subscript></highlight>, and a selector <highlight><bold>59</bold></highlight>. As can be seen also in <cross-reference target="DRAWINGS">FIG. 9</cross-reference>, the output buffer <highlight><bold>37</bold></highlight> comprises a cell distributor <highlight><bold>66</bold></highlight>, FIFO-type buffers <highlight><bold>61</bold></highlight> and <highlight><bold>62</bold></highlight>, selectors <highlight><bold>63</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>63</bold></highlight><highlight><subscript>1</subscript></highlight>, and FIFO-type buffers <highlight><bold>64</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>64</bold></highlight><highlight><subscript>1</subscript></highlight>. The third scheduler <highlight><bold>70</bold></highlight> controls the readout of cells from that which is indicated by reference symbol {circle over (<highlight><bold>3</bold></highlight>)} in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0102" lvl="0"><number>&lsqb;0102&rsqb;</number> The preprocessor <highlight><bold>53</bold></highlight>, after synchronizing to an internal clock the cells received from the circuit processor <highlight><bold>22</bold></highlight><highlight><subscript>0 </subscript></highlight>of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight>, corrects the cells to a fixed length. The cells are then stored inside the common buffer <highlight><bold>33</bold></highlight> according to a storage address issued by the address controller <highlight><bold>55</bold></highlight>. The storage address may be issued sequentially by an address controller <highlight><bold>55</bold></highlight> write address issue function. Addressee data and addresser data for each cell are output to the queue allocation component <highlight><bold>56</bold></highlight> via the address controller <highlight><bold>55</bold></highlight>. </paragraph>
<paragraph id="P-0103" lvl="0"><number>&lsqb;0103&rsqb;</number> The queue allocation component <highlight><bold>56</bold></highlight> receives the addressee data, the addresser data, the QoS and the above-described storage address endowed to each cell from the address controller <highlight><bold>55</bold></highlight> and writes a write address, that is, an address pointer value, to the internal queue of the address queue <highlight><bold>57</bold></highlight><highlight><subscript>0 </subscript></highlight>or the address queue <highlight><bold>57</bold></highlight><highlight><subscript>1</subscript></highlight>. </paragraph>
<paragraph id="P-0104" lvl="0"><number>&lsqb;0104&rsqb;</number> The address queue <highlight><bold>57</bold></highlight><highlight><subscript>0 </subscript></highlight>corresponds to the input IN<highlight><bold>0</bold></highlight>, and internally, comprises queues <highlight><bold>58</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>58</bold></highlight><highlight><subscript>7 </subscript></highlight>corresponding to interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>, queue <highlight><bold>588</bold></highlight> corresponding to interface <highlight><bold>228</bold></highlight><highlight><subscript>8 </subscript></highlight>of <cross-reference target="DRAWINGS">FIG. 5</cross-reference>, and queue <highlight><bold>589</bold></highlight> corresponding to the multicast. Similarly, the address queue <highlight><bold>571</bold></highlight> corresponds to input IN<highlight><bold>1</bold></highlight>, and internally, comprises queues <highlight><bold>58</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>58</bold></highlight><highlight><subscript>7 </subscript></highlight>corresponding to interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>, queue <highlight><bold>588</bold></highlight> corresponding to interface <highlight><bold>228</bold></highlight><highlight><subscript>5 </subscript></highlight>of <cross-reference target="DRAWINGS">FIG. 5</cross-reference>, and queue <highlight><bold>58</bold></highlight><highlight><subscript>9 </subscript></highlight>corresponding to the multicast. The selector <highlight><bold>59</bold></highlight> selects the output of the address queue <highlight><bold>57</bold></highlight><highlight><subscript>0 </subscript></highlight>or the address queue <highlight><bold>57</bold></highlight><highlight><subscript>1</subscript></highlight>. </paragraph>
<paragraph id="P-0105" lvl="0"><number>&lsqb;0105&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a diagram showing one possible composition of a third scheduler. The scheduler <highlight><bold>70</bold></highlight> performs scheduling both within inputs IN<highlight><bold>0</bold></highlight>, IN<highlight><bold>1</bold></highlight> and between inputs IN<highlight><bold>0</bold></highlight>, IN<highlight><bold>1</bold></highlight>. The third scheduler <highlight><bold>70</bold></highlight> has selectors <highlight><bold>65</bold></highlight>, <highlight><bold>66</bold></highlight> and <highlight><bold>67</bold></highlight> corresponding to input IN<highlight><bold>0</bold></highlight>, Though not shown in the diagrams, nevertheless the scheduler <highlight><bold>70</bold></highlight> has the same selectors for the input IN<highlight><bold>1</bold></highlight> as well. </paragraph>
<paragraph id="P-0106" lvl="0"><number>&lsqb;0106&rsqb;</number> The selector <highlight><bold>65</bold></highlight> performs scheduling between the address queue <highlight><bold>587</bold></highlight> and the address queue <highlight><bold>58</bold></highlight><highlight><subscript>8</subscript></highlight>. That is, this scheduling is performed prior to the scheduling for the address queues <highlight><bold>58</bold></highlight><highlight><subscript>0 </subscript></highlight>through <highlight><bold>58</bold></highlight><highlight><subscript>6</subscript></highlight>. This scheduling may be performed by the Round Robin method. The address pointer value selected by the selector <highlight><bold>65</bold></highlight> is scheduled together with address queues <highlight><bold>58</bold></highlight><highlight><subscript>0 </subscript></highlight>through <highlight><bold>58</bold></highlight><highlight><subscript>6 </subscript></highlight>together with selector <highlight><bold>66</bold></highlight>. This scheduling may be carried out by the Round Robin method. The address pointer value selected by the selector <highlight><bold>65</bold></highlight> is then transmitted to the selector <highlight><bold>67</bold></highlight>. The selector <highlight><bold>67</bold></highlight> then schedules the selector <highlight><bold>65</bold></highlight> output, that is, the unicast cells and the multicast cells designated by the address pointer values stored in the address queue <highlight><bold>58</bold></highlight><highlight><subscript>9</subscript></highlight>. This scheduling makes it possible to read from the multicast queue only when no unicast queue exists. </paragraph>
<paragraph id="P-0107" lvl="0"><number>&lsqb;0107&rsqb;</number> Finally, the output of the selector <highlight><bold>67</bold></highlight> for the address queues <highlight><bold>57</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>57</bold></highlight><highlight><subscript>1 </subscript></highlight>is selected (for example alternately) by a selector not shown in the diagram but internal to the selector <highlight><bold>59</bold></highlight>, and the selected address pointer value is output to the address controller <highlight><bold>55</bold></highlight>. The address controller <highlight><bold>55</bold></highlight> read address issue function then issues a read address to the common buffer <highlight><bold>33</bold></highlight> based on the address value received from the scheduler <highlight><bold>70</bold></highlight>. </paragraph>
<paragraph id="P-0108" lvl="0"><number>&lsqb;0108&rsqb;</number> The cells read out from the common buffer <highlight><bold>33</bold></highlight> are allotted to either the buffer <highlight><bold>61</bold></highlight> corresponding to the input IN<highlight><bold>0</bold></highlight> or to the buffer <highlight><bold>62</bold></highlight> corresponding to the input IN<highlight><bold>1</bold></highlight> by the queue allocation component <highlight><bold>60</bold></highlight> of the output buffer <highlight><bold>37</bold></highlight>. The selector <highlight><bold>63</bold></highlight><highlight><subscript>0 </subscript></highlight>and the selector <highlight><bold>631</bold></highlight>, respectively, select cells read out from the FIFO-type buffers <highlight><bold>61</bold></highlight> and <highlight><bold>62</bold></highlight> and outputs the cells to the main switch <highlight><bold>232</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. </paragraph>
<paragraph id="P-0109" lvl="0"><number>&lsqb;0109&rsqb;</number> A description will now be given of back pressure control using the back pressure signal BP<highlight><bold>5</bold></highlight>, with reference to <cross-reference target="DRAWINGS">FIG. 10</cross-reference>. </paragraph>
<paragraph id="P-0110" lvl="0"><number>&lsqb;0110&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a diagram for explaining back pressure control using a back pressure control signal. <cross-reference target="DRAWINGS">FIG. 10</cross-reference> shows in schematic form the internal composition of the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>described with reference to <cross-reference target="DRAWINGS">FIG. 8</cross-reference> above. Additionally, <cross-reference target="DRAWINGS">FIG. 10</cross-reference> also shows the internal composition of the interface <highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. </paragraph>
<paragraph id="P-0111" lvl="0"><number>&lsqb;0111&rsqb;</number> As described above, the back pressure signal BP<highlight><bold>5</bold></highlight> is a signal that is transmitted serially via the back pressure bus. The back pressure bus is indicated in <cross-reference target="DRAWINGS">FIG. 10</cross-reference> by the reference number <highlight><bold>71</bold></highlight>. The back pressure bus <highlight><bold>71</bold></highlight> connects the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>to each other. </paragraph>
<paragraph id="P-0112" lvl="0"><number>&lsqb;0112&rsqb;</number> The &ldquo;RDY&rdquo; shown in <cross-reference target="DRAWINGS">FIG. 10</cross-reference> means the back pressure signal BP<highlight><bold>2</bold></highlight> transmitted from the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>by the flow control cell. This back pressure signal BP<highlight><bold>2</bold></highlight> includes, in addition to the above-described port unit requests, link level back pressure requests as well. When the back pressure signal BP<highlight><bold>2</bold></highlight> is a predetermined value, the back pressure signal BP<highlight><bold>2</bold></highlight> requests a stop (link level back pressure), and moreover in class units, to all readouts from the buffers corresponding to the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>. For example, in the situation shown in <cross-reference target="DRAWINGS">FIG. 10, a</cross-reference> cell readout stop is requested for class j cells (j being class 0 through class 7) and multicast cells. </paragraph>
<paragraph id="P-0113" lvl="0"><number>&lsqb;0113&rsqb;</number> The third scheduler, having received the above-described type of back pressure signal BP<highlight><bold>2</bold></highlight>, controls the queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>of the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>and the queue <highlight><bold>58</bold></highlight><highlight><subscript>9 </subscript></highlight>corresponding to the multicast, stopping cell readout from these buffers. More specifically, the selection logic of the selectors <highlight><bold>66</bold></highlight> and <highlight><bold>67</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is designed so as not to select the queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>and <highlight><bold>58</bold></highlight><highlight><subscript>9</subscript></highlight>. At the same time, the third scheduler outputs the back pressure signal BP<highlight><bold>5</bold></highlight> to the other interfaces <highlight><bold>230</bold></highlight><highlight><subscript>1</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>via the back pressure bus <highlight><bold>71</bold></highlight>. The back pressure signal BP<highlight><bold>5</bold></highlight> includes data that specifies the queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>and the queue <highlight><bold>58</bold></highlight><highlight><subscript>9</subscript></highlight>. <cross-reference target="DRAWINGS">FIG. 10</cross-reference> shows a state in which the back pressure signal BP<highlight><bold>5</bold></highlight> calls a stop to cell readout from the interface <highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>and the queues <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>and <highlight><bold>58</bold></highlight><highlight><subscript>9</subscript></highlight>. </paragraph>
<paragraph id="P-0114" lvl="0"><number>&lsqb;0114&rsqb;</number> By the above-described back-pressure control, the transmission of cells addressed to the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>from all the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>can be stopped. </paragraph>
<paragraph id="P-0115" lvl="0"><number>&lsqb;0115&rsqb;</number> A description will now be given of back pressure control using the back pressure signal BP<highlight><bold>3</bold></highlight>, with reference to <cross-reference target="DRAWINGS">FIG. 11</cross-reference> and <cross-reference target="DRAWINGS">FIG. 12</cross-reference>. </paragraph>
<paragraph id="P-0116" lvl="0"><number>&lsqb;0116&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a schematic diagram of a common buffer and an input buffer of an interface. </paragraph>
<paragraph id="P-0117" lvl="0"><number>&lsqb;0117&rsqb;</number> As described above, the back pressure signal BP<highlight><bold>3</bold></highlight> is generated when either the input buffer <highlight><bold>38</bold></highlight> or the common buffer <highlight><bold>34</bold></highlight> inside the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight> assumes a predetermined state. </paragraph>
<paragraph id="P-0118" lvl="0"><number>&lsqb;0118&rsqb;</number> The composition shown in <cross-reference target="DRAWINGS">FIG. 11</cross-reference> comprises buffers <highlight><bold>69</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>69</bold></highlight><highlight><subscript>1 </subscript></highlight>corresponding to outputs OUT<highlight><bold>0</bold></highlight> and OUT<highlight><bold>1</bold></highlight> and a selector <highlight><bold>72</bold></highlight>. In the event that the use volume of the buffer <highlight><bold>69</bold></highlight><highlight><subscript>0 </subscript></highlight>or the buffer <highlight><bold>69</bold></highlight><highlight><subscript>1 </subscript></highlight>exceeds a predetermined threshold value, then the back pressure signal BP<highlight><bold>3</bold></highlight> is output to the main switch <highlight><bold>232</bold></highlight>. As described above, the back pressure signal BP<highlight><bold>3</bold></highlight> is composed of flow cells. Cells stay in the buffer <highlight><bold>690</bold></highlight> or the buffer <highlight><bold>691</bold></highlight> only when flow control cells concentrate. Typically, the transmission rate from the buffers <highlight><bold>69</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>69</bold></highlight><highlight><subscript>1 </subscript></highlight>is higher than the reception rate from the main switch <highlight><bold>232</bold></highlight>. Thus, cells do not clog up the buffer <highlight><bold>69</bold></highlight><highlight><subscript>0 </subscript></highlight>and <highlight><bold>69</bold></highlight><highlight><subscript>1</subscript></highlight>, and as long as flow control cell traffic is not concentrated, the back pressure signal BP<highlight><bold>3</bold></highlight> does not become enabled. </paragraph>
<paragraph id="P-0119" lvl="0"><number>&lsqb;0119&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a diagram for explaining back pressure control using a back pressure control signal. As shown in <cross-reference target="DRAWINGS">FIG. 12</cross-reference>, the main switch <highlight><bold>232</bold></highlight>, having received the back pressure signal BP<highlight><bold>3</bold></highlight>, outputs to the buffer <highlight><bold>64</bold></highlight><highlight><subscript>0 </subscript></highlight>whose input (in the example shown in <cross-reference target="DRAWINGS">FIG. 12</cross-reference>, input IN<highlight><bold>0</bold></highlight>) corresponds to a demultiplexer <highlight><bold>371</bold></highlight>. As a result, cell readout from the buffer <highlight><bold>64</bold></highlight><highlight><subscript>0 </subscript></highlight>is stopped. </paragraph>
<paragraph id="P-0120" lvl="0"><number>&lsqb;0120&rsqb;</number> A description will now be given of the generation of the back pressure signal BP<highlight><bold>1</bold></highlight>, with reference to <cross-reference target="DRAWINGS">FIG. 13</cross-reference>. </paragraph>
<paragraph id="P-0121" lvl="0"><number>&lsqb;0121&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a diagram showing generation of a back pressure control signal. In the example shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference>, the back pressure signal being generated is BP<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0122" lvl="0"><number>&lsqb;0122&rsqb;</number> In the example shown in <cross-reference target="DRAWINGS">FIG. 13, a</cross-reference> queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>corresponds to a class j inside the buffer <highlight><bold>61</bold></highlight> that forms the output buffer <highlight><bold>37</bold></highlight> of the input IN<highlight><bold>0</bold></highlight> in the interface <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>. When the queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>is congested or there is a possibility that it will become congested, the back pressure signal BP<highlight><bold>1</bold></highlight> is generated. As described above, the back pressure signal <highlight><bold>1</bold></highlight> is formed from flow control cells. </paragraph>
<paragraph id="P-0123" lvl="0"><number>&lsqb;0123&rsqb;</number> The interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>is equipped with a cell counter <highlight><bold>75</bold></highlight>. The cell counter <highlight><bold>75</bold></highlight> counts the cells of each class stored in the common buffer <highlight><bold>33</bold></highlight>, the cells addressed to the main processor <highlight><bold>227</bold></highlight><highlight><subscript>8 </subscript></highlight>shown in <cross-reference target="DRAWINGS">FIG. 5</cross-reference> and the multicast cells, respectively. The reference numerals <highlight><bold>58</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>58</bold></highlight><highlight><subscript>9 </subscript></highlight>indicating the queues inside the cell counter <highlight><bold>75</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> indicate the respective counters. The count values may be the total number of incoming cells or the number of cells coming in during a predetermined time period (cell flow volume). A threshold value is then established for the total number of incoming cells or the flow volume. A comparator provided inside the cell counter <highlight><bold>75</bold></highlight> compares the count with the predetermined threshold value. If the results of the comparison exceed the threshold or show an overflow, then flow control cells that form the back pressure signal <highlight><bold>1</bold></highlight> are sent to the output OUT<highlight><bold>1</bold></highlight>. These flow control cells include data that identifies the queue <highlight><bold>58</bold></highlight><highlight><subscript>j </subscript></highlight>and data that distinguishes between unicast and multicast. </paragraph>
<paragraph id="P-0124" lvl="0"><number>&lsqb;0124&rsqb;</number> A description will now be given of the generation of the back pressure signal BP<highlight><bold>5</bold></highlight>, with reference to <cross-reference target="DRAWINGS">FIG. 14</cross-reference>. </paragraph>
<paragraph id="P-0125" lvl="0"><number>&lsqb;0125&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a diagram showing generation of another back pressure control signal. In the example shown in <cross-reference target="DRAWINGS">FIG. 14</cross-reference>, the back pressure signal being generated is BP<highlight><bold>5</bold></highlight>. </paragraph>
<paragraph id="P-0126" lvl="0"><number>&lsqb;0126&rsqb;</number> In the example shown in <cross-reference target="DRAWINGS">FIG. 14</cross-reference>, when the flow of cells into the common buffer <highlight><bold>33</bold></highlight> of the input IN<highlight><bold>0</bold></highlight> in the interface <highlight><bold>230</bold></highlight><highlight><subscript>0 </subscript></highlight>exceeds the threshold value or there is an overflow, the RDY signal described above that is the equivalent of the back pressure signal BP<highlight><bold>2</bold></highlight> is transmitted to the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>by the flow control cells. </paragraph>
<paragraph id="P-0127" lvl="0"><number>&lsqb;0127&rsqb;</number> A description will now be given of other instances of back pressure control using the back pressure signal BP<highlight><bold>1</bold></highlight>, with reference to <cross-reference target="DRAWINGS">FIG. 15</cross-reference>. </paragraph>
<paragraph id="P-0128" lvl="0"><number>&lsqb;0128&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a diagram a case in which a cell number or flow within a queue corresponding to a class within an output buffer provided in an interface internal to a circuit processing unit of an L<highlight><bold>3</bold></highlight> processor exceeds a predetermined threshold value. </paragraph>
<paragraph id="P-0129" lvl="0"><number>&lsqb;0129&rsqb;</number> In the situation described above with reference to <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, back pressure control using the back pressure signal BP<highlight><bold>5</bold></highlight> stops the transmission of cells addressed to the interface <highlight><bold>220</bold></highlight><highlight><subscript>0 </subscript></highlight>from all the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7</subscript></highlight>, that is, back pressure control is exercised at link level. By contrast, the back pressure control described below with reference to <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is control exercised at by class unit. </paragraph>
<paragraph id="P-0130" lvl="0"><number>&lsqb;0130&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> shows a case in which the number of cells or the flow volume of cells inside the queue corresponding to a class within the output buffer <highlight><bold>36</bold></highlight> provided in the interface <highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>inside the circuit processor <highlight><bold>22</bold></highlight><highlight><subscript>7 </subscript></highlight>of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> exceeds the predetermined threshold value. In this case, the flow control cells FC that form the back pressure signal BP<highlight><bold>2</bold></highlight> are transmitted from the interface <highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>to the corresponding interface <highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>(step &lsqb;<highlight><bold>1</bold></highlight>&rsqb; in <cross-reference target="DRAWINGS">FIG. 15</cross-reference>). When the flow control cells FC are received, the interface <highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>outputs the back pressure signal BP<highlight><bold>5</bold></highlight> having the same data as the flow control cell FC to the apparatus and to all the other interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>6 </subscript></highlight>via the back pressure bus <highlight><bold>71</bold></highlight> (step &lsqb;<highlight><bold>2</bold></highlight>&rsqb;). The interface <highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>transmits the received flow control cell FC to the interface <highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>(step &lsqb;<highlight><bold>3</bold></highlight>&rsqb;). The interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>6 </subscript></highlight>that have received the back pressure signal BP<highlight><bold>5</bold></highlight> in step &lsqb;<highlight><bold>2</bold></highlight>&rsqb; then transmit the corresponding FC packets to the interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>6 </subscript></highlight>in step &lsqb;<highlight><bold>4</bold></highlight>&rsqb;. </paragraph>
<paragraph id="P-0131" lvl="0"><number>&lsqb;0131&rsqb;</number> A description will now be given of measures to prevent degradation of fragmenting efficiency attendant upon making the cells a fixed length. </paragraph>
<paragraph id="P-0132" lvl="0"><number>&lsqb;0132&rsqb;</number> The process of fragmenting, that is, turning variable-length packets into cells of fixed length, involves a process of padding that data which does not satisfy the number of cells needed to form a payload portion of a fixed-length cell. This padding, however, reduces actual throughput and produces wasted bandwidths. In order to prevent such bandwidth degradation, it is preferable that the main switch <highlight><bold>232</bold></highlight> be configured so as to be able to accommodate variable length cells as well. In response to an accumulation of cells in the output buffer in which cells bound for the same output port of the main switch <highlight><bold>232</bold></highlight> are saved, a plurality of individual cells are combined and sent together to the main switch <highlight><bold>232</bold></highlight> (multi-access method: Multi Adjoining Combined Cell). </paragraph>
<paragraph id="P-0133" lvl="0"><number>&lsqb;0133&rsqb;</number> Assuming each input port physical bandwidth is Bwp, cell transfer time is m, and interval between cells is n, the effective bandwidth Bwa&equals;Bwp&times;m/(m&plus;n). In the case of triple access multi-access where n&equals;3, Bwa&equals;Bwp&times;3 m/(3<highlight><italic>m</italic></highlight>&plus;n), making improvement in efficiency possible. </paragraph>
<paragraph id="P-0134" lvl="0"><number>&lsqb;0134&rsqb;</number> A description will now be given of the advantages of the communications apparatus according to a first embodiment of the present invention. </paragraph>
<paragraph id="P-0135" lvl="0"><number>&lsqb;0135&rsqb;</number> First, the fixed-length cells obtained from conversion of the variable length cells are switched, so differences in speed among various different interfaces can be effectively absorbed and jitter due to switching can be reduced. Thus, QoS control and back pressure control can be effectively and efficiently performed for a variety of interfaces such as ATM, ethernet and so forth. </paragraph>
<paragraph id="P-0136" lvl="0"><number>&lsqb;0136&rsqb;</number> Second, the back pressure signal BP<highlight><bold>2</bold></highlight> from the output side of the L<highlight><bold>3</bold></highlight> processor <highlight><bold>22</bold></highlight> interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>to the input side of the interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>of the switch unit <highlight><bold>23</bold></highlight> has been configured so as to bypass the main switch <highlight><bold>232</bold></highlight>, so the back pressure latency can be reduced, the buffer can be utilized efficiently and the main switch input-output port bandwidth can be used efficiently. </paragraph>
<paragraph id="P-0137" lvl="0"><number>&lsqb;0137&rsqb;</number> Third, when the switch unit <highlight><bold>23</bold></highlight> interfaces <highlight><bold>230</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>230</bold></highlight><highlight><subscript>7 </subscript></highlight>are congested or are predicted to be congested, cells are not discarded by the common buffer <highlight><bold>32</bold></highlight> on the output side of the interfaces <highlight><bold>220</bold></highlight><highlight><subscript>0</subscript></highlight>-<highlight><bold>220</bold></highlight><highlight><subscript>7 </subscript></highlight>but instead cells are discarded on the input side of the common buffer <highlight><bold>33</bold></highlight>, so any service reduction during periods of congestion can be localized. </paragraph>
<paragraph id="P-0138" lvl="0"><number>&lsqb;0138&rsqb;</number> Fourth, by providing link level second stage back pressure control using the back pressure bus <highlight><bold>71</bold></highlight> and the flow level using flow control cells, back pressure control can be carried out efficiently and effectively. </paragraph>
<paragraph id="P-0139" lvl="0"><number>&lsqb;0139&rsqb;</number> A description will now be given of a communications apparatus according to a second embodiment of the present invention, with reference to <cross-reference target="DRAWINGS">FIG. 16</cross-reference> and <cross-reference target="DRAWINGS">FIG. 17</cross-reference>. </paragraph>
<paragraph id="P-0140" lvl="0"><number>&lsqb;0140&rsqb;</number> The communications apparatus according to a second embodiment of the present invention solves the previously described drawback of the conventional art, that is, the inability of the conventional art to accommodate different networks efficiently and relay data efficiently, and in particular the second drawback of the conventional art, that is, overall router buffer utilization efficiency is low. </paragraph>
<paragraph id="P-0141" lvl="0"><number>&lsqb;0141&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16A</cross-reference> illustrates a configuration having a plurality of buffers and <cross-reference target="DRAWINGS">FIG. 16B</cross-reference> illustrates an occurrence of blocking. <cross-reference target="DRAWINGS">FIGS. 17A and 17B</cross-reference> are diagrams showing a communications apparatus according to a second embodiment of the present invention, in which <cross-reference target="DRAWINGS">FIG. 17A</cross-reference> illustrates a physical back pressure flow and <cross-reference target="DRAWINGS">FIG. 17B</cross-reference> illustrates a logical back pressure flow. </paragraph>
<paragraph id="P-0142" lvl="0"><number>&lsqb;0142&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 16A and 16B</cross-reference> show a conventional L<highlight><bold>3</bold></highlight> processor and circuit terminal. The L<highlight><bold>3</bold></highlight> processor comprises switch interface <highlight><bold>324</bold></highlight>, local switch <highlight><bold>325</bold></highlight> and circuit interface <highlight><bold>326</bold></highlight>. The circuit terminal comprises L<highlight><bold>3</bold></highlight> interface <highlight><bold>313</bold></highlight> and physical layer processor <highlight><bold>314</bold></highlight>. The L<highlight><bold>3</bold></highlight> processor is equipped with a buffer for every output circuit unit, and performs back pressure control at every output circuit unit. Since back pressure control is performed in output circuit units, then, as described above, the router buffers as a whole cannot be utilized efficiently. </paragraph>
<paragraph id="P-0143" lvl="0"><number>&lsqb;0143&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16B</cross-reference> shows another conventional example, in which the L<highlight><bold>3</bold></highlight> processor comprises a switch interface <highlight><bold>424</bold></highlight>, a local switch <highlight><bold>425</bold></highlight> and a wire interface. The local switch <highlight><bold>425</bold></highlight> is composed of a common buffer. The common buffer <highlight><bold>425</bold></highlight> aggregates the output circuit (port). As described above, when a request is received for back pressure control of an output circuit, the buffer continues to be influenced by back pressure until such time as it receives data indicating that the output circuit is no congested, leading to the occurrence of a blocking state in which data cannot be output. </paragraph>
<paragraph id="P-0144" lvl="0"><number>&lsqb;0144&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 17A and 17B</cross-reference> show a composition that solves the above-described problem. As stated above, <cross-reference target="DRAWINGS">FIG. 17A</cross-reference> illustrates a physical back pressure flow and <cross-reference target="DRAWINGS">FIG. 17B</cross-reference> illustrates a logical back pressure flow. The local switch <highlight><bold>225</bold></highlight> terminates the back pressure signal and discards cells at each output circuit. Accordingly, an occurrence of blocking like that shown in <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>b</italic></highlight>) can be avoided. </paragraph>
<paragraph id="P-0145" lvl="0"><number>&lsqb;0145&rsqb;</number> A description will now be given of a communications apparatus according to a third embodiment of the present invention, with reference to <cross-reference target="DRAWINGS">FIG. 18</cross-reference>. </paragraph>
<paragraph id="P-0146" lvl="0"><number>&lsqb;0146&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 18</cross-reference> is a diagram showing a communications apparatus according to a third embodiment of the present invention. </paragraph>
<paragraph id="P-0147" lvl="0"><number>&lsqb;0147&rsqb;</number> The communications apparatus according to a third embodiment of the present invention solves the previously described drawback of the conventional art, that is, the inability of the conventional art to accommodate different networks efficiently and relay data efficiently, and in particular the third drawback of the conventional art, that is, that a failure in the working system or the passive system may, depending on the back pressure controlled state and the buffering state, cause a doubling up or a skipping of data to occur. </paragraph>
<paragraph id="P-0148" lvl="0"><number>&lsqb;0148&rsqb;</number> In a multiplexed configuration, it is desirable to distinguish between back pressure of the working system and back pressure of the passive system. The working system, which receives requests for back pressure control from the passive system, discards such requests without stopping the transmission of cells. The determination as to working system or passive system may be made by reference to a signal indicating an apparatus state. That is, a flag indicating working system/passive system may be provided within the back pressure signal BP<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0149" lvl="0"><number>&lsqb;0149&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 18, a</cross-reference> back pressure signal from the working system is discarded by the passive system. By contrast, a back pressure signal from the working system to the passive system is not discarded by the passive system by is received by every point. </paragraph>
<paragraph id="P-0150" lvl="0"><number>&lsqb;0150&rsqb;</number> A description will now be given of a communications apparatus according to a fourth embodiment of the present invention, with reference to <cross-reference target="DRAWINGS">FIG. 19</cross-reference>. </paragraph>
<paragraph id="P-0151" lvl="0"><number>&lsqb;0151&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is a diagram showing a communications apparatus according to a fourth embodiment of the present invention. </paragraph>
<paragraph id="P-0152" lvl="0"><number>&lsqb;0152&rsqb;</number> The communications apparatus according to a third embodiment of the present invention solves the previously described drawback of the conventional art, that is, the inability of the conventional art to accommodate different networks efficiently and relay data efficiently, and in particular the third drawback of the conventional art, that is, whenever back pressure control must be performed frequently it is impossible to satisfy data jitter and delay standards. </paragraph>
<paragraph id="P-0153" lvl="0"><number>&lsqb;0153&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 19</cross-reference>, the circuit terminal <highlight><bold>21</bold></highlight> described previously comprises a buffer capacity monitor <highlight><bold>215</bold></highlight>. The buffer capacity monitor <highlight><bold>215</bold></highlight> monitors the capacity of the internal buffer corresponding to the circuits inside the physical layer processor <highlight><bold>214</bold></highlight> and transmits the results of that monitoring process directly to the local switch <highlight><bold>227</bold></highlight>. Additionally, the circuit interface <highlight><bold>226</bold></highlight> and the L<highlight><bold>3</bold></highlight> interface <highlight><bold>213</bold></highlight> are bufferless. As a result, cells are not subject to buffering between the local switch <highlight><bold>225</bold></highlight> and the physical layer processor <highlight><bold>214</bold></highlight>, so buffering does not take place even in the event that back pressure control is requested. Moreover, buffering is not performed on cells even after the back pressure control is released, so data is not transmitted to the output circuits in a burst. </paragraph>
<paragraph id="P-0154" lvl="0"><number>&lsqb;0154&rsqb;</number> As a result of the above-described measures, cell jitter and delay can be held to a minimum. </paragraph>
<paragraph id="P-0155" lvl="0"><number>&lsqb;0155&rsqb;</number> The above description is provided in order to enable any person skilled in the art to make and use the invention and sets forth the best mode contemplated by the inventors of carrying out the invention. </paragraph>
<paragraph id="P-0156" lvl="0"><number>&lsqb;0156&rsqb;</number> The present invention is not limited to the specifically disclosed embodiments, and variations and modifications may be made without departing from the scope and spirit of the present invention. </paragraph>
<paragraph id="P-0157" lvl="0"><number>&lsqb;0157&rsqb;</number> The present application is based on Japanese Priority Application No. 2001-196778, filed on Jun. 28, 2001, the entire contents of which are hereby incorporated by reference. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A communications apparatus for switching among different interfaces and comprising a switch unit, the switch unit comprising: 
<claim-text>a main switch for switching data of a fixed length; and </claim-text>
<claim-text>an interface having a first buffer for an input of the main switch and a second buffer for an output of the main switch. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the communications apparatus further comprises a processor that is connected to the switch unit and processes data according to a predetermined protocol, the processor having a third buffer and a fourth buffer connected to the first buffer and the second buffer, the processor performing back pressure control on the third buffer when the first buffer assumes a predetermined state. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the communications apparatus further comprises a processor that is connected to the switch unit and processes data according to a predetermined protocol, the processor having a third buffer and a fourth buffer connected to the first buffer and the second buffer, the processor performing back pressure control on the first buffer when the fourth buffer assumes a predetermined state. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the processor performs back pressure control on the first buffer when the second buffer assumes a predetermined state. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the communications apparatus further comprises a processor that is connected to the switch unit and processes data according to a predetermined protocol, the processor having a third buffer and a fourth buffer connected to the first buffer and the second buffer, the processor performing back pressure control on the fourth buffer when receiving a request for back pressure control from an apparatus that is connected to the processor. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the back pressure control request is formed by a predetermined flow control cell. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the back pressure control request is formed by a predetermined flow control cell. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the back pressure control request is formed by a predetermined flow control cell. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the back pressure control is performed by predetermined Quality of Service (QoS) class units. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the back pressure control is performed by predetermined Quality of Service (QoS) class units. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the back pressure control is performed by predetermined Quality of Service (QoS) class units. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00005">claim 5</dependent-claim-reference>, wherein the back pressure control is performed by predetermined Quality of Service (QoS) class units. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein back pressure control is performed in circuit units-. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein back pressure control is performed in circuit units. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein back pressure control is performed in circuit units. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00005">claim 5</dependent-claim-reference>, wherein back pressure control is performed in circuit units. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the predetermined state is determined at predetermined QoS class units. </claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the predetermined state is determined at predetermined QoS class units. </claim-text>
</claim>
<claim id="CLM-00019">
<claim-text><highlight><bold>19</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the predetermined state is determined at predetermined QoS class units. </claim-text>
</claim>
<claim id="CLM-00020">
<claim-text><highlight><bold>20</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the predetermined state is determined at circuit units. </claim-text>
</claim>
<claim id="CLM-00021">
<claim-text><highlight><bold>21</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the predetermined state is determined at circuit units. </claim-text>
</claim>
<claim id="CLM-00022">
<claim-text><highlight><bold>22</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the predetermined state is determined at circuit units. </claim-text>
</claim>
<claim id="CLM-00023">
<claim-text><highlight><bold>23</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the processor has a local switch that supplies data received from the switch unit to an internal buffer corresponding to the appropriate circuit. </claim-text>
</claim>
<claim id="CLM-00024">
<claim-text><highlight><bold>24</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein: 
<claim-text>the processor has a local switch equipped with a buffer that temporarily stores data received from the switch unit; and </claim-text>
<claim-text>the local switch itself has another local switch that reads the data from the buffer and supplies the data so read to an internal buffer of the appropriate circuit. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00025">
<claim-text><highlight><bold>25</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein a terminal unit is provided between the processor and the circuits, the terminal unit comprising: 
<claim-text>a buffer provided at each circuit; and </claim-text>
<claim-text>a buffer capacity monitor that monitors a capacity of the buffer and controls the buffer so as to temporarily store data received from the switch unit. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00026">
<claim-text><highlight><bold>26</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein: 
<claim-text>the switch unit is multiplexed; and </claim-text>
<claim-text>a working system receiving a back pressure control request from a passive system discards that back pressure control request. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00027">
<claim-text><highlight><bold>27</bold></highlight>. A communications apparatus for switching among different interfaces and comprising a plurality of switch units, each switch unit comprising: 
<claim-text>a main switch for switching data of a fixed length; and </claim-text>
<claim-text>an interface having a first buffer for an input of the main switch and a second buffer for an output of the main switch provided on each circuit. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00028">
<claim-text><highlight><bold>28</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 15</dependent-claim-reference>, further comprising: 
<claim-text>a plurality of processors connected to the switch unit for performing processes according to a predetermined protocol; and </claim-text>
<claim-text>a bus for transmitting a predetermined back pressure control signal to the plurality of processors. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00029">
<claim-text><highlight><bold>29</bold></highlight>. The communications apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 16</dependent-claim-reference>, wherein each one of the plurality of switch units receives a back pressure control signal and controls a flow of information form the first buffer. </claim-text>
</claim>
<claim id="CLM-00030">
<claim-text><highlight><bold>30</bold></highlight>. A communications control method for switching among different interfaces, comprising the steps of: 
<claim-text>switching data handled by the different interfaces after once buffering data of a fixed length related to the data handled by the different interfaces; and </claim-text>
<claim-text>sending the switched data to the circuits after once buffering the switched data. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00031">
<claim-text><highlight><bold>31</bold></highlight>. The communications control method as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 18</dependent-claim-reference>, further comprising the step of: 
<claim-text>bypassing the switching of data and sending the back pressure control request to another apparatus when the buffering assumes a predetermined state prior to switching.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>2</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002517A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002517A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002517A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030002517A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030002517A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030002517A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030002517A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030002517A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030002517A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030002517A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030002517A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030002517A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030002517A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00013">
<image id="EMI-D00013" file="US20030002517A1-20030102-D00013.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00014">
<image id="EMI-D00014" file="US20030002517A1-20030102-D00014.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00015">
<image id="EMI-D00015" file="US20030002517A1-20030102-D00015.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00016">
<image id="EMI-D00016" file="US20030002517A1-20030102-D00016.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00017">
<image id="EMI-D00017" file="US20030002517A1-20030102-D00017.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00018">
<image id="EMI-D00018" file="US20030002517A1-20030102-D00018.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00019">
<image id="EMI-D00019" file="US20030002517A1-20030102-D00019.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
