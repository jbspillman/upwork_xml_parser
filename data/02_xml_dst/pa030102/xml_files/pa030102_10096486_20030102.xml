<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002366A1-20030102-D00000.TIF SYSTEM "US20030002366A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00001.TIF SYSTEM "US20030002366A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00002.TIF SYSTEM "US20030002366A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00003.TIF SYSTEM "US20030002366A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00004.TIF SYSTEM "US20030002366A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00005.TIF SYSTEM "US20030002366A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00006.TIF SYSTEM "US20030002366A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00007.TIF SYSTEM "US20030002366A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00008.TIF SYSTEM "US20030002366A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00009.TIF SYSTEM "US20030002366A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00010.TIF SYSTEM "US20030002366A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00011.TIF SYSTEM "US20030002366A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00012.TIF SYSTEM "US20030002366A1-20030102-D00012.TIF" NDATA TIF>
<!ENTITY US20030002366A1-20030102-D00013.TIF SYSTEM "US20030002366A1-20030102-D00013.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002366</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10096486</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020313</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>2001-194927</doc-number>
</priority-application-number>
<filing-date>20010627</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>2001-310120</doc-number>
</priority-application-number>
<filing-date>20011005</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>G11C007/00</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>365</class>
<subclass>201000</subclass>
</uspc>
</classification-us-primary>
</classification-us>
<title-of-invention>Life warning generation system and method of semiconductor storage device equipped with flash memory</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Shinichi</given-name>
<family-name>Mizoguchi</family-name>
</name>
<residence>
<residence-non-us>
<city>Tokyo</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Masatoshi</given-name>
<family-name>Kimura</family-name>
</name>
<residence>
<residence-non-us>
<city>Tokyo</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Takayuki</given-name>
<family-name>Shinohara</family-name>
</name>
<residence>
<residence-non-us>
<city>Tokyo</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>Mitsubishi Denki Kabushiki Kaisha</organization-name>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>MCDERMOTT, WILL &amp; EMERY</name-1>
<name-2></name-2>
<address>
<address-1>600 13th Street, N.W.</address-1>
<city>WASHINGTON</city>
<state>DC</state>
<postalcode>20005-3096</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A semiconductor storage device is equipped with flash memories each flash memory has a limited size of spare storage area for rewriting data when a write error occurs, and the storage device calculates the remaining size of the spare storage area after the completion of the re-writing, and examines whether or not the remaining size is smaller than a predetermined value, and generates a warning when the remaining size is smaller than the predetermined value, to thereby acknowledge that the life of each flash memory comes close to the end before completely used up. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field of the Invention </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates to a semiconductor storage device such as a semiconductor card, equipped with flash memories of which the number of rewriting actions is limited, and particularly to a semiconductor storage device having spare sectors for replacing error sectors in rewriting data and arranged to give a warning when the number of rewriting actions is close to its limit. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Description of the Prior Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Recently, as semiconductor storage devices such as semiconductor cards using flash memories have been increased in storage capacity scale, they are now used as data storage devices in mobile terminals such as portable information apparatuses (PDAs) or factory automation system (referred to as &ldquo;FA&rdquo;, hereinafter). In particular, FA system requires a higher level of environmental durability and commonly employs a hard disk drive. Recently, many FA systems utilize semiconductor cards which have much higher environmental durability. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> For example, a flash ATAPC card, compact flash (registered trademark) card and flash drive are used as the semiconductor storage device for a substitute for a hard disk drive in various applications. These examples include nonvolatile or flash memories built therein, each memory having a floating gate structure of memory cells and capable of writing and reading data with protocols compatible with a hard disk drive. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> A flash memory has a floating gate structure where the number of rewriting actions is limited. It is hence schemed for increasing the operating life of the flash memory to prepare and use spare sectors (blocks) for replacing error sectors (blocks) of which the number of rewriting actions is exhausted. Accordingly, as each flash memory is increased in the number of rewriting actions more than that of rewritable actions per sector (block), it can favorably be used in a semiconductor storage device. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> However, when all the spare sectors (blocks) are used up and another error sector (block) is generated in the rewriting, the semiconductor storage device fails to replace the error sector (block) with a spare one and will thus be defective due to causing a rewriting error. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> Such a conventional semiconductor storage device having a flash memory includes no means for notifying a host apparatus of the exhaustion condition of the spare sectors (blocks). This results in that the operating life of the conventional semiconductor storage device is identified only at the time when a rewriting error suddenly occurs during a continuous operation. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a block diagram showing a conventional semiconductor card as a semiconductor storage device equipped with flash memories. As shown in the figure, the semiconductor card <highlight><bold>82</bold></highlight> comprises a card controller <highlight><bold>83</bold></highlight>, flash memories <highlight><bold>84</bold></highlight>, and a power supply circuit <highlight><bold>86</bold></highlight>. The card controller <highlight><bold>83</bold></highlight> includes a CPU <highlight><bold>85</bold></highlight>, a buffer portion <highlight><bold>88</bold></highlight>, and an error correction coding circuit <highlight><bold>89</bold></highlight> (referred to as &ldquo;ECC circuit&rdquo;, hereinafter). The card controller <highlight><bold>83</bold></highlight> is linked with an oscillator <highlight><bold>87</bold></highlight>. The card controller <highlight><bold>83</bold></highlight> executes data transmission to and from an external system <highlight><bold>81</bold></highlight> of various data signals including I/O signals, address signals, and control signals. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> The operation of the conventional semiconductor card will now be explained in brief. When acknowledging a message of a command received from the external system <highlight><bold>81</bold></highlight>, the card controller <highlight><bold>83</bold></highlight> starts control actions for implementation of the command. The control actions of the card controller <highlight><bold>83</bold></highlight> are basically programmed and executed by the CPU <highlight><bold>85</bold></highlight> provided in the card controller <highlight><bold>83</bold></highlight>. The read and write actions on the flash memories <highlight><bold>84</bold></highlight> are based on data transfer via the buffer portion <highlight><bold>88</bold></highlight> built in the card controller <highlight><bold>83</bold></highlight>. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> Generally, as each flash memory has a limited life in rewriting defective sectors, the semiconductor card prepares spare storage areas for prolonging the life of rewriting actions. The spare storage areas of the semiconductor card have specific rewritable size at each replacement action and entire replacement storage size, which are individually determined and managed depending on the type of equipped flash memories and the controlling method. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> The conventional semiconductor card is designed to notify the external system <highlight><bold>81</bold></highlight> of the occurrence of error only when the spare storage areas have been used up and a counteraction is needed, but not give an early warning to the system <highlight><bold>81</bold></highlight> before the spare storage areas are exhausted. In other words, exhaustion of the spare storage areas is not known before the occurrence of error is notified. Therefore, the degree of the used spare storage areas is hardly examined, which results in that the rewriting action may exceed the rewritable limit without precaution. This disables the function of the flash memories and causes the semiconductor card to have an erratic action. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> When the conventional flash memory provided in the semiconductor card is used in an FA system, the end of the rewriting life of the flash memories may suddenly cause an error, which hence results in functional faults of the system such as a sudden stop of the system line. It is thus urgently necessary to provide a method of warning that the life of the semiconductor card in storage capacity thereof comes close to its end or limit. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> The present invention has been developed for eliminating the foregoing drawbacks and its object is to provide a system and a method of generating a warning signal in a semiconductor card equipped with a set of flash memories which is arranged for examining a remaining size of a spare storage area in rewriting actions to judge that w the life of each flash memory c o m e s close to its end before the flash memory is completely used up, thus preventing any malfunction derived from careless use after the end of the life. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> It is another object of the present invention to provide a semiconductor storage device having flash memories capable of rewriting data in sector (block) units, employing a command for examining consumption of spare sectors (blocks) and the storage device is arranged for, when receiving the command from an external system such as a host apparatus, notifying the host apparatus of the consumption of spare sectors (blocks) that the number of spare sectors (blocks) comes close to its end. Namely, the time for replacement of the semiconductor device with a new device is notified before any fault resulting in malfunction occurs in the system. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> For achievement of the above objects, a first aspect of the present invention provides a semiconductor storage device equipped with flash memories each having a limited size of a spare storage area, which comprises: an error decision unit for judging whether or not an error occurs during writing of data; a replacing unit for rewriting data to the spare storage area when the error decision unit judges that an error occurs; a spare area size calculating unit for calculating a remaining size of the spare storage area after the data has been re-written to the spare storage area; a spare area checking unit for comparing the remaining size of the spare storage area with a predetermined value; and a warning generator for generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> In this arrangement, the replacing unit may acquire a start address of the spare storage area from a spare storage area management table which is saved in a management area of each flash memory to thereby rewrite the data to the spare storage area of the acquired address, and after the completion of the data rewriting, the replacing unit updates the spare storage area management table and a logic-to-physic conversion table saved in the management area. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> A second aspect of the present invention provides a warning generating system of a semiconductor storage device exchanging commands and data with an external system, the semiconductor storage device being equipped with flash memories each having a limited size of a spare storage area, where the system comprises: an error decision unit for judging whether or not an error occurs during writing of data; a replacing unit for rewriting data to the spare storage area when the error decision unit judges that an error occurs; a spare area size calculating unit for calculating a remaining size of the spare storage area after the data has been re-written to the spare storage area; a spare area checking unit for comparing the remaining size of the spare storage area with a predetermined value; and a warning generator for generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> A third aspect of the present invention provides a warning generating method of a semiconductor storage device equipped with flash memories each having a limited size of a spare storage area, where the method comprising the steps of: judging whether or not an error occurs during writing of data; rewriting data to the spare storage area when it is judged that an error occurs; calculating a remaining size of the spare storage area after the data has been rewritten to the spare storage area; comparing the remaining size of the spare storage area with a predetermined value; and generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> By the arrangements set forth in the first to third aspects of the present invention, when an error occurs during the writing of the data on the flash memory in the semiconductor storage device, after the data is rewritten to the spare storage area, the remaining size of the spare storage area is examined, and when the remaining size is smaller than the predetermined value, a warning is generated from a warning generating unit. As a result, the user of the semiconductor storage device such as a semiconductor card can timely be notified of the fact that the life of the device comes close to its end. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> The spare area size calculating unit may calculate the remaining size of the spare storage area in response to a check command for checking the remaining size of the spare storage area which is issued by an external system. Thus, it is decided whether or not a warning be raised only when the external system requests for the examination of the remaining size, and accordingly, the warning can effectively given to a user. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> The semiconductor storage device may further comprise a register for flagging a specific bit indicative of the warning when it is judged that the remaining size of the spare storage area is smaller than the predetermined value. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> Moreover, it may be further modified such that a warning indication signal is provided for transmission to an external system and when the spare area checking unit judges that the remaining size of the spare storage area is smaller than the predetermined value, the warning indication signal is changed in level to notify the external system of the warning. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> By this arrangement, it is decided whether or not a warning be raised only when the external system requests for the examination of the remaining size, and accordingly, the warning can effectively be notified to the system. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> The semiconductor storage device may further comprise an external switch wherein the spare area size calculating unit executes the calculation of the remaining size of the spare storage area when the external switch is turned on. As a result, the semiconductor storage device such as a semiconductor card can check the end of its life independently of the external system without giving any load to the external system. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> A fourth aspect of the present invention provides a semiconductor storage device equipped with flash memories each having a limited number of rewriting operations to be subjected and each flash memory being provided with a spare storage area for replacing a defective portion caused in a data writing operation, where the semiconductor storage device comprises: an error decision unit for judging whether or not an error occurs in a defective portion during a data writing operation; a replacing unit for replacing the defective portion by the spare storage area to write the data when the error decision unit judges that an error occurs; a command receiving unit for receiving a remaining number examination command from an external equipment requesting an examination of a remaining size of the spare storage area; a remaining spare size calculating unit for calculating a remaining size in number of the spare storage area in response to the remaining number examination command after the data has been written to the spare storage area; and a spare area checking unit for comparing the calculated remaining size of the spare storage area with a predetermined value. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> This allows the remaining number of the spare sectors to be monitored. The time for replacement with a new device can thus be acknowledged before any write error occurs due to the exhaustion of the spare sectors. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> In this fourth aspect, entry and response procedure of the remaining number examination command may be based on a non-data transfer command protocol. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> Moreover, it mabe modified such that, in response to the remaining number examination command, the remaining spare size calculating unit obtains the minimum of count numbers of good sectors existing in the spare storage areas of the entire flash memories and determines the minimum as the remaining number of the spare sectors of the semiconductor storage device and when the remaining number of the spare sectors is smaller than the predetermined value, the remaining number of the spare sectors is notified to the external equipment. Thus, the external host equipment can readily be notified of the remaining number of the spare sectors of the semiconductor storage device. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> Moreover, it may further be modified in which in response to the remaining number examination command, a particular code indicative of a consumption condition of the spare sectors is delivered. This allows the external host to readily judge whether or not the semiconductor storage device needs to be replaced with a new one through merely checking the returned value of each sector count register after the execution of the command.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> These and other objects and features of the present invention will be readily understood from the following detailed description taken in conjunction with preferred embodiments thereof with reference to the accompanying drawings, in which: </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram showing an arrangement of a warning generating system of a semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a flowchart showing an operation of the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a schematic model view showing a structure of a management area in the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a block diagram showing another arrangement of a warning generating system of the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram showing a further arrangement of a warning generating system of the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a block diagram showing a still further arrangement of a warning generating system of the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> is a block diagram showing a still further arrangement of a warning generating system of the semiconductor card according to the present invention; </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a block diagram showing a construction of a conventional semiconductor card; </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a block diagram showing an arrangement of a semiconductor storage device according to the present invention; </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a schematic model view showing a sector arrangement of an AND type flash memory used in the semiconductor storage device according to the present invention; </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a schematic model view showing sector conditions in an AND type flash memory used in the semiconductor storage device according to the present invention; </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a diagram showing parameters of each register before and after execution of a count replace sector command and description thereof; and </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a diagram showing parameters of each register before and after execution of a check replace condition command.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> Preferred embodiments of the present invention will be described referring to the accompanying drawings. It is noted that, throughout the drawings, like components are denoted by like numerals and their explanation will not be repeated. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram of a basic arrangement of a data writing and reading system using a semiconductor card as a semiconductor storage device according to the present invention. As shown in the figure, the semiconductor card <highlight><bold>12</bold></highlight> comprises a card controller <highlight><bold>13</bold></highlight>, flash memories <highlight><bold>14</bold></highlight>, and a power supply circuit <highlight><bold>16</bold></highlight>. The card controller <highlight><bold>13</bold></highlight> includes a microprocessor (referred to as &ldquo;CPU&rdquo;) <highlight><bold>15</bold></highlight>, a buffer portion <highlight><bold>18</bold></highlight>, and an error correction coding circuit (ECC) <highlight><bold>19</bold></highlight>. The card controller <highlight><bold>13</bold></highlight> is connected with an oscillator <highlight><bold>17</bold></highlight>. The card controller <highlight><bold>13</bold></highlight> exchanges with an external system <highlight><bold>11</bold></highlight> various data signals including I/O signals, address signals, and control signals. The semiconductor card <highlight><bold>12</bold></highlight> also includes a warning generator (LED) <highlight><bold>21</bold></highlight> which is controlled by an LED controller <highlight><bold>20</bold></highlight> for generating a warning or alarm signal. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> The operation of the card controller <highlight><bold>13</bold></highlight> is fundamentally controlled by commands from the CPU <highlight><bold>15</bold></highlight> built in the card controller <highlight><bold>13</bold></highlight>. The operation of writing and reading of data with respect to the flash memories <highlight><bold>14</bold></highlight> is carried out through data transfer using the buffer portion <highlight><bold>18</bold></highlight> built in the card controller <highlight><bold>13</bold></highlight>. The buffer portion <highlight><bold>18</bold></highlight> includes a plurality of buffers having different sizes corresponding to types of data read out of the flash memories such as management data internally needed by the memory card and external data from the system. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a flowchart showing a procedure of generating a warning in a data writing operation of the semiconductor card according to the present invention. As shown in the figure, when a command for data writing is issued from the external system <highlight><bold>11</bold></highlight> and is received by the buffer <highlight><bold>18</bold></highlight> for writing data into a flash memory in the semiconductor card in Step S<highlight><bold>1</bold></highlight>, the address of the subject data in the flash memory is obtained in Step S<highlight><bold>2</bold></highlight> and the writing operation of the data is commenced in Step S<highlight><bold>3</bold></highlight>. It is then examined in Step S<highlight><bold>4</bold></highlight> whether or not an error (or a fault) occurs during the writing operation. When no error (or fault) is detected, the writing operation is successfully carried out in Step S<highlight><bold>5</bold></highlight>. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> If any error (fault) is detected, a re-writing operation of the data into a spare storage area is executed in Step S<highlight><bold>6</bold></highlight>. After re-writing the data, the remaining size in capacity of the spare storage area is calculated in Step S<highlight><bold>7</bold></highlight>. The remaining size is then compared with a predetermined threshold value in Step S<highlight><bold>8</bold></highlight>. When the remaining size is smaller than the predetermined value (YES in Step S<highlight><bold>8</bold></highlight>), a warning is generated by the warning generator (<highlight><bold>21</bold></highlight>) provided in the semiconductor card in Step S<highlight><bold>9</bold></highlight>. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> Accordingly, when an error occurs during the writing of data with respect to the flash memory in the semiconductor card, the spare storage area is used in sector or block units for transferring the data, and then the remaining size of the spare storage area is examined. When the remaining size is smaller than the predetermined value, the warning generator in the semiconductor card generates a warning signal. This allows the user of the semiconductor card to be timely informed that the life of the flash memory is close to its limit. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> Embodiment 1 </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> This embodiment describes an operation of writing data into a flash memory in the semiconductor card in response to a data write command sent from the external system <highlight><bold>11</bold></highlight> and carrying out a counter-action when a write error on the flash memory occurs or when the card controller detects a generation of a write error, which will be described below referring to <cross-reference target="DRAWINGS">FIGS. 1 and 2</cross-reference>. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> When the power supply circuit <highlight><bold>16</bold></highlight> is turned on, the card controller <highlight><bold>13</bold></highlight> acknowledges a message of the command supplied from the external system <highlight><bold>11</bold></highlight> and starts various controlling actions for execution of the command. The writing of data into the flash memories <highlight><bold>14</bold></highlight> is implemented through data transfer using the buffer portion <highlight><bold>18</bold></highlight> which serves as an intermediate provided in the card controller <highlight><bold>13</bold></highlight>. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> An example of a procedure including processes of generating an error and giving a warning will now be explained in the case where the warning is generated when the external system <highlight><bold>11</bold></highlight> requests an action of data writing. In response to a command for data writing sent from the external system <highlight><bold>11</bold></highlight>, the card controller <highlight><bold>13</bold></highlight> accepts the command for writing the data when the subject data is determined to be writable by judging the address of the data. While the data to be written sent from the system <highlight><bold>11</bold></highlight> is received and saved in the buffer portion <highlight><bold>18</bold></highlight>, a logic-to-physic conversion table <highlight><bold>31</bold></highlight><highlight><italic>a </italic></highlight>is retrieved from a management area <highlight><bold>31</bold></highlight> in the flash memory <highlight><bold>14</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. Then, a logic address in the flash memory <highlight><bold>14</bold></highlight> to which the data is written is confirmed based on the logic address data contained in the command issued by the system <highlight><bold>11</bold></highlight>. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> The management area <highlight><bold>31</bold></highlight> is a specific storage area where the external system <highlight><bold>11</bold></highlight> is not allowed to read/write data from/to the management storage area. The management area holds various control data such as firm wares and conversion tables required for controlling the internal actions of the semiconductor card <highlight><bold>12</bold></highlight>. The conversion tables include not only a logic-to-physic conversion table <highlight><bold>31</bold></highlight><highlight><italic>a </italic></highlight>but also a spare storage area management table <highlight><bold>31</bold></highlight><highlight><italic>b </italic></highlight>for managing the start address and end address of the spare storage area, as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. When the power supply circuit <highlight><bold>16</bold></highlight> is turned on, the data in the management area of the flash memory <highlight><bold>14</bold></highlight> is downloaded to a RAM region in the card controller <highlight><bold>13</bold></highlight>. The contents of the downloaded data may be rewritten or overwritten to the flash memories <highlight><bold>14</bold></highlight> and may be updated when necessary. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> When the buffer portion <highlight><bold>18</bold></highlight> has completely received the data sent from the external system <highlight><bold>11</bold></highlight>, the action of data writing into the flash memory <highlight><bold>14</bold></highlight> is executed (see S<highlight><bold>3</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>). The writing of the data into the flash memory <highlight><bold>14</bold></highlight> is performed by execution of the data write command, and the data writing operation per se is left to the flash memory <highlight><bold>14</bold></highlight>. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> When the card controller <highlight><bold>13</bold></highlight> judges that an error occurs in the flash memory <highlight><bold>14</bold></highlight> such as time over of the writing action during the writing of the data into the flash memory <highlight><bold>14</bold></highlight>, the start address of the spare storage area is obtained from the spare storage area management table <highlight><bold>31</bold></highlight><highlight><italic>b </italic></highlight>of the management area <highlight><bold>31</bold></highlight>. Then the data saved in the buffer portion <highlight><bold>18</bold></highlight> is re-written to the obtained address of the spare storage area (see S<highlight><bold>6</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>). </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> When the re-writing of the data into the spare storage area has been correctly finished, both the logic-to-physic conversion table and the spare storage area management table in the management area <highlight><bold>31</bold></highlight> are updated. After updating the tables, the remaining size of the spare storage area is calculated to be examined (see S<highlight><bold>7</bold></highlight> in FIG. <highlight><bold>2</bold></highlight>). When the remaining size is smaller than the predetermined value (YES in Step S<highlight><bold>8</bold></highlight>), the card controller <highlight><bold>13</bold></highlight> instructs the LED controller <highlight><bold>20</bold></highlight> to emit the light warning generator LED <highlight><bold>21</bold></highlight> for notifying the user of a warning. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> Although the explanation is made in the case where the data to be written in the flash memory <highlight><bold>14</bold></highlight> is received from the external system <highlight><bold>11</bold></highlight>, the data may be derived from the management area without transferring data from the system <highlight><bold>11</bold></highlight>. In such a case, a warning can be raised when the remaining size of the spare storage area is judged smaller than the predetermined value after the management data is written into the spare storage area. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> In this embodiment, when an error occurs during the writing of the data into the flash memories <highlight><bold>14</bold></highlight> in the semiconductor card, the remaining size of the spare storage area is examined after the data is written into the spare storage area, and when the remaining size is smaller than the predetermined value, the LED controller <highlight><bold>20</bold></highlight> and the LED <highlight><bold>21</bold></highlight> in the semiconductor card <highlight><bold>12</bold></highlight> are actuated to generate a warning signal of illumination, thus allowing the user of the semiconductor card <highlight><bold>12</bold></highlight> to be timely notified of the warning. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> Although the warning signal is implemented by illumination of the LED <highlight><bold>21</bold></highlight> driven by the LED controller <highlight><bold>20</bold></highlight> in this embodiment, the LED illumination of the warning signal may be replaced by a sound generation through combination of a loudspeaker <highlight><bold>42</bold></highlight> and a sound controller <highlight><bold>41</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> Embodiment 2 </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> In this embodiment, the process shown by the step S<highlight><bold>7</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference> of examining the remaining size of the spare storage area is implemented by a relevant command in the warning generating procedure where the relevant command, if needed, is sent from the external system <highlight><bold>11</bold></highlight>. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> The procedure of generating a warning signal is explained by steps as below. When a check command is issued by the external system <highlight><bold>11</bold></highlight> for examining the remaining size of the spare storage area, the card controller <highlight><bold>13</bold></highlight> calculates the remaining size by examining the spare storage area management table <highlight><bold>31</bold></highlight><highlight><italic>b </italic></highlight>of the management area <highlight><bold>31</bold></highlight> which manages the start and end addresses of the spare storage area (see S<highlight><bold>7</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>). When it is judged that the remaining size is small enough to generate a warning or alarm signal (see S<highlight><bold>8</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>), the LED <highlight><bold>21</bold></highlight> or the loudspeaker <highlight><bold>42</bold></highlight> is actuated to give the warning or alarm signal to the user. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> In this embodiment, it is determined whether or not a warning signal is raised only when a check command for examining the remaining size of the spare storage area is received from the external system <highlight><bold>11</bold></highlight>. Thus, the user is allowed to be effectively notified of the warning. Details of the check command for examining the remaining size of the spare storage area will be explained later in Embodiments <highlight><bold>5</bold></highlight> and <highlight><bold>6</bold></highlight>, referring to <cross-reference target="DRAWINGS">FIGS. 12 and 13</cross-reference>. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> Embodiment 3 </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> In this embodiment, the process shown in Step S<highlight><bold>9</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference> of generating a warning signal is implemented by reading a specific bit flagged in a register <highlight><bold>43</bold></highlight> which is provided in the card controller <highlight><bold>13</bold></highlight> and accessible from the external system <highlight><bold>11</bold></highlight>. Then, the warning signal is given to the external system <highlight><bold>11</bold></highlight> and the user. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a block diagram showing an arrangement of this embodiment. The operation of this embodiment will be described referring to <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. When a check command is sent from the external system <highlight><bold>11</bold></highlight> for examining the remaining size of the spare storage area, the remaining size is calculated by reading the spare storage area management table <highlight><bold>31</bold></highlight><highlight><italic>b </italic></highlight>of the management area <highlight><bold>31</bold></highlight> which manages the start and end addresses of the spare storage area (see S<highlight><bold>7</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>). When the remaining size is small enough to raise a warning signal (see S<highlight><bold>8</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>), a specific bit is flagged in the register <highlight><bold>43</bold></highlight> which is accessible from the external system <highlight><bold>11</bold></highlight>. The flagged specific bit is then read by the external system <highlight><bold>11</bold></highlight> so that the system <highlight><bold>11</bold></highlight> in turn is notified of the warning. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> A modification of this embodiment is shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference> where a warning indication signal is transmitted from the card controller <highlight><bold>13</bold></highlight> to the external system <highlight><bold>11</bold></highlight> instead of providing the register <highlight><bold>43</bold></highlight>. For example, when the warning indication signal is turned to a high (H) level, the external system <highlight><bold>11</bold></highlight> acknowledges that the warning is sent from the semiconductor card <highlight><bold>12</bold></highlight>. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> In this embodiment, it is determined whether or not the warning is raised only when a relevant check command is issued by the external system <highlight><bold>11</bold></highlight>. Thus, the warning can be effectively given to the external system <highlight><bold>11</bold></highlight>. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> Embodiment 4 </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> In this embodiment, the step of examining the remaining size of the spare storage area is implemented by means of a switch <highlight><bold>71</bold></highlight> provided outside the semiconductor card <highlight><bold>12</bold></highlight> so that a warning signal can be raised when needed. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> is a block diagram showing an arrangement of this embodiment. As shown in the figure, the semiconductor card <highlight><bold>12</bold></highlight> includes a switch controller <highlight><bold>72</bold></highlight> for controlling the external switch <highlight><bold>71</bold></highlight> and a built-in battery <highlight><bold>73</bold></highlight> for independent power supply. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> The operation of this embodiment will be described by steps, concentrating to the procedure of raising a warning or alarm. When the switch <highlight><bold>71</bold></highlight> is turned on, the remaining size of the spare storage area is calculated by reading the spare storage area management table <highlight><bold>31</bold></highlight><highlight><italic>b </italic></highlight>of the management area <highlight><bold>31</bold></highlight> which manages the start and end addresses of the spare storage area (see S<highlight><bold>7</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>). When the remaining size is small enough to generate a warning signal (see S<highlight><bold>8</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>), the LED <highlight><bold>21</bold></highlight> or the loudspeaker <highlight><bold>42</bold></highlight> is actuated to raise a warning or alarm. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> In this embodiment, the life of the semiconductor card can be examined independently of the action of the external system <highlight><bold>11</bold></highlight>, and thus no load is given to the system <highlight><bold>11</bold></highlight> during the check of the life of the semiconductor card. Also, even in the case where the external system <highlight><bold>11</bold></highlight> feeds no power voltage to the semiconductor card <highlight><bold>12</bold></highlight> in a non-access mode, the semiconductor card <highlight><bold>12</bold></highlight> can be energized by the built-in battery <highlight><bold>73</bold></highlight> for conducting process for generating the warning. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> Embodiment 5 </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> This embodiment will be described below with reference to FIGS. <highlight><bold>9</bold></highlight> to <highlight><bold>12</bold></highlight>. In this embodiment, a semiconductor storage device (or flash storage device) is equipped with a flash memory portion for replacing error sectors in rewriting by spare sectors. The semiconductor storage device employs a specific command for examining the remaining number of spare sectors in order to notify a host computer or a like external equipment of the fact that the spare sectors provided for replacing the error sectors are reduced in remaining of the storage area. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a block diagram showing a fundamental construction for implementing internal functions of the semiconductor storage device according to Embodiment 5 of the present invention. The semiconductor storage device of this embodiment includes 256 Mb AND type flash memories as a storage flash memories and an ATA interface (I/F). </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> As shown in <cross-reference target="DRAWINGS">FIG. 9</cross-reference>, the semiconductor storage device <highlight><bold>91</bold></highlight> comprises a flash ATA controller <highlight><bold>92</bold></highlight>, AND type flash memories <highlight><bold>93</bold></highlight>, and an oscillator <highlight><bold>94</bold></highlight> and can be operated while being linked with a host equipment <highlight><bold>95</bold></highlight>. The flash ATA controller <highlight><bold>92</bold></highlight> comprises a CPU <highlight><bold>921</bold></highlight>, a ROM <highlight><bold>922</bold></highlight> where command codes for the CPU <highlight><bold>921</bold></highlight> are stored, a RAM <highlight><bold>923</bold></highlight> used as an operating area, a host I/F circuit <highlight><bold>924</bold></highlight> for providing an interface (I/F) with the host equipment <highlight><bold>95</bold></highlight>, a sequencer <highlight><bold>925</bold></highlight> for controlling internal data transfer and timing of actions responsive to the commands from the CPU <highlight><bold>921</bold></highlight>, a sector buffer <highlight><bold>927</bold></highlight>, a flash I/F circuit <highlight><bold>928</bold></highlight>, and an oscillator circuit <highlight><bold>929</bold></highlight>. The sequencer <highlight><bold>925</bold></highlight> includes an error correction coding/decoding (ECC) circuit <highlight><bold>926</bold></highlight>. The oscillator circuit <highlight><bold>929</bold></highlight> is connected to the oscillator <highlight><bold>94</bold></highlight> to generate clock signals for timing of the operations of the CPU <highlight><bold>921</bold></highlight> and the sequencer <highlight><bold>925</bold></highlight>. </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> In this embodiment, the semiconductor storage device <highlight><bold>91</bold></highlight> operates based on an ATA specified protocol which is widely used as an I/F protocol for an external storage device of personal computers. </paragraph>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> illustrates a sector construction of the 256 Mb AND type flash memory (M5M29F25611VP) employed in this embodiment. The AND type flash memory is comprised of 16384 physical sectors, each having a size of (2048&plus;64) bytes. Through specifying a sector address and column address, the read/write/delete operation for each sector can be conducted. In this embodiment, a mostly good memory (MGM) is used as an example of the AND type flash memory where primary defects in sectors are tolerable at most 2% of the entire sectors. Each sector can be judged for availability by reading good-quality codes saved in a column address range extending from 820H to 825H. </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> illustrates an example of the judgement conditions indicating whether each sector is in a good or error (not-good) state in the 256 Mb AND type flash memories which are denoted by &ldquo;Chips 1 to n&rdquo; provided in the semiconductor storage device. Each of the flash memories (Chips 1 to n) has segmented sector groups of a management area, user area and spare storage area. The management area comprises the starting several sectors where the logic-to-physic conversion table is stored indicative of a distribution of good sectors in each flash memory. The user area stores user data to be written and read. The spare storage area is used as the spare sectors which are provide for replacement of error sectors produced during the re-writing of user sectors. </paragraph>
<paragraph id="P-0083" lvl="0"><number>&lsqb;0083&rsqb;</number> In each flash memory, the start addresses of the user area and spare storage area are stored in the management area. In this arrangement, each sector stores a flag data indicating the attribute of the sector at a position defined by the control bytes of the sector as shown in <cross-reference target="DRAWINGS">FIG. 10</cross-reference>. The flag data is read out and examined by the CPU <highlight><bold>921</bold></highlight> to determine whether the sector belongs to the management area, user data area or spare storage area. </paragraph>
<paragraph id="P-0084" lvl="0"><number>&lsqb;0084&rsqb;</number> In the semiconductor storage device of this embodiment, an ATA specified non-data transfer command protocol is employed to implement the function of counting the remaining number of good sectors available as the spare sectors in the spare storage area. More specifically, when receiving a command for counting the remaining number of spare sectors (or command for counting sectors for replacement), the CPU <highlight><bold>921</bold></highlight> starts counting the number of available spare sectors in each flash memory. </paragraph>
<paragraph id="P-0085" lvl="0"><number>&lsqb;0085&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> illustrates parameters of each register before and after execution of the command for counting replace sectors and their description. The execution of the command for counting the remaining number of spare sectors involves the steps of setting the drive number (DRV) of a relevant drive (device) to a Drive bit in a Drive/Head Register and thereafter writing a command code (F0h) into the Command Register. </paragraph>
<paragraph id="P-0086" lvl="0"><number>&lsqb;0086&rsqb;</number> When the command is written to the Command Register, the drive (device) sets a busy bit (BST) in the Status Register. </paragraph>
<paragraph id="P-0087" lvl="0"><number>&lsqb;0087&rsqb;</number> Then, the CPU <highlight><bold>921</bold></highlight> counts the number of good sectors in the spare storage area in each flash memory, obtaining the minimum value of the count numbers in the flash memories as the remaining number of spare sectors (RepSecCount) set to the Sector Count Register, and clearing the busy bit (BSY) to zero and generating an interruption. When 255 or more of the spare sectors remain, the Sector Count Register is set with FFh (RepSecCount&equals;FFh). Thus, the host equipment is allowed to judge that the drive holds a sufficient number of spare sectors. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> If the number of the remaining spare sectors is smaller than 255, the same number thereof may be set in a hexadecimal notation to the Sector Count Register and the host equipment can thus acknowledge the number of the remaining spare sectors of the drive. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> The host equipment can monitor the number of spare sectors in each drive by periodically implementing the above commend. Accordingly, the host equipment can acknowledge the time for replacing the drive with a new one, so that generation of a write error derived from the exhaustion of the spare sectors can be effectively avoided in the drive. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> Embodiment 6 </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> Embodiment 6 of the present invention will be described below with reference to <cross-reference target="DRAWINGS">FIG. 13</cross-reference>. <cross-reference target="DRAWINGS">FIG. 13</cross-reference> illustrates measurements in each register before and after implementing Check Replace Condition command for examining the conditions of spare sectors. In this embodiment, as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference>, in response to a request from the host equipment after implementing Check Replace Condition command, the drive expresses the spare sector consumption condition, for example, in three levels; 00h, 0Fh, and FFh according to the remaining number of the spare sectors, instead of setting the remaining number of spare sectors (RepCode) directly to the Sector Count Register. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> More particularly, when the count replace sector command is received, the remaining numbers of spare sectors in the flash memories are calculated and the minimum value thereof is obtained. The minimum value is then examined whether or not it is smaller than the predetermined value. A result of the examination is transferred back to the host equipment as a reply indicative of the spare sector consumption condition of the semiconductor storage device. For example, when the spare sectors remain 50% or more of their original number, 00h is set as the RepCode to the Sector Count Register. When smaller than 50% but not smaller than 10%, 0Fh is set, and when smaller than 10%, FFh is set. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> This allows the host equipment to judge whether or not the drive is needed to be replaced with a new one through checking whether or not the set value in the Sector Count Register is FFh after implementing the count replace sector commend. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> As set forth above, the semiconductor card equipped with the flash memories of the present invention can check the remaining size of spare storage area to acknowledge that the life of each flash memory comes close to its limit before the flash memory is completely used up, thus preventing any malfunction derived from the end of the life and improving the operational reliability. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> The semiconductor storage device of the present invention employs the command for examining the consumption of spare sectors (blocks) and when receiving the command from the host equipment, notifies the host equipment of the consumption of the spare sectors so that the host equipment can acknowledge the fact that the remaining number of spare sectors comes close to its end. Accordingly, the host equipment can readily be advised the time of replacement of the device with a new one before the device generates a misconduct such as an error action in the system. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> Although the present invention has been described in connection with the preferred embodiments thereof with reference to the accompanying drawings, it is to be noted that various changes and modifications will be apparent to those skilled in the art. Such changes and modifications are to be understood as included within the scope of the present invention as defined by the appended claims, unless they depart therefrom. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A semiconductor storage device equipped with flash memories each having a limited size of a spare storage area, said semiconductor storage device comprising: 
<claim-text>an error decision unit for judging whether or not an error occurs during writing of data; </claim-text>
<claim-text>a replacing unit for rewriting data to the spare storage area when said error decision unit judges that an error occurs; </claim-text>
<claim-text>a spare area size calculating unit for calculating a remaining size of the spare storage area after the data has been re-written to the spare storage area; </claim-text>
<claim-text>a spare area checking unit for comparing the remaining size of the spare storage area with a predetermined value; and </claim-text>
<claim-text>a warning generator for generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the replacing unit acquires a start address of the spare storage area from a spare storage area management table which is saved in a management area of each flash memory to thereby rewrite the data to the spare storage area of the acquired address, and after the completion of the data rewriting, the replacing unit updates the spare storage area management table and a logic-to-physic conversion table saved in the management area. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the spare area size calculating unit calculates the remaining size of the spare storage area in response to a check command for checking the remaining size of the spare storage area which is issued by an external system. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, further comprising a register for flagging a specific bit indicative of the warning when it is judged that the remaining size of the spare storage area is smaller than the predetermined value. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein a warning indication signal is provided for transmission to an external system and when the spare area checking unit judges that the remaining size of the spare storage area is smaller than the predetermined value, the warning indication signal is changed in level to notify the external system of the warning. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> further comprising an external switch wherein the spare area size calculating unit executes the calculation of the remaining size of the spare storage area when the external switch is turned on. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. A warning generating system of a semiconductor storage device exchanging commands and data with an external system, the semiconductor storage device being equipped with flash memories each having a limited size of a spare storage area, said system comprising: 
<claim-text>an error decision unit for judging whether or not an error occurs during writing of data; </claim-text>
<claim-text>a replacing unit for rewriting data to the spare storage area when said error decision unit judges that an error occurs; </claim-text>
<claim-text>a spare area size calculating unit for calculating a remaining size of the spare storage area after the data has been re-written to the spare storage area; </claim-text>
<claim-text>a spare area checking unit for comparing the remaining size of the spare storage area with a predetermined value; and </claim-text>
<claim-text>a warning generator for generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. A warning generating method of a semiconductor storage device equipped with flash memories each having a limited size of a spare storage area, the method comprising: 
<claim-text>judging whether or not an error occurs during writing of data; </claim-text>
<claim-text>rewriting data to the spare storage area when it is judged that an error occurs; </claim-text>
<claim-text>calculating a remaining size of the spare storage area after the data has been re-written to the spare storage area; </claim-text>
<claim-text>comparing the remaining size of the spare storage area with a predetermined value; and </claim-text>
<claim-text>generating a warning when the remaining size of the spare storage area is smaller than the predetermined value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. A semiconductor storage device equipped with flash memories each having a limited number of rewriting operations to be subjected and each flash memory being provided with a spare storage area for replacing a defective portion caused in writing data, said semiconductor storage device comprising: 
<claim-text>an error decision unit for judging whether or not an error occurs in a defective portion during a data writing operation; </claim-text>
<claim-text>a replacing unit for replacing the defective portion by the spare storage area to write the data when the error decision unit judges that an error occurs; </claim-text>
<claim-text>a command receiving unit for receiving a remaining number examination command from an external equipment requesting an examination of a remaining size of the spare storage area; </claim-text>
<claim-text>a remaining spare size calculating unit for calculating a remaining size in number of the spare storage area in response to the remaining number examination command after the data has been written to the spare storage area; and </claim-text>
<claim-text>a spare area checking unit for comparing the calculated remaining size of the spare storage area with a predetermined value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein each of the flash memories a sector arrangement in which data is rewritable in sector units and each flash memory includes a management area (<highlight><bold>31</bold></highlight>) for saving a logic-to-physic conversion table which indicates a distribution of good sectors of each flash memory, a user area for saving user data, and a spare storage area having spare sectors which replace defective sectors, and wherein the start addresses of the user area and the spare storage area are written in the management area, and wherein a flag data indicative of an attribute of each sector is saved in a specified byte position in each sector. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein entry and response procedure of the remaining number examination command is based on a non-data transfer command protocol. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein, in response to the remaining number examination command, the remaining spare size calculating unit obtains the minimum of count numbers of good sectors existing in the spare storage areas of the entire flash memories and determines the minimum as the remaining number of the spare sectors of the semiconductor storage device and when the remaining number of the spare sectors is smaller than the predetermined value, the remaining number of the spare sectors is notified to the external equipment. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. The semiconductor storage device according to <dependent-claim-reference depends_on="CLM-00009">claim 9</dependent-claim-reference>, wherein, in response to the remaining number examination command, a particular code indicative of a consumption condition of the spare sectors is delivered.</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002366A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002366A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002366A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030002366A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030002366A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030002366A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030002366A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030002366A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030002366A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030002366A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030002366A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030002366A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030002366A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00013">
<image id="EMI-D00013" file="US20030002366A1-20030102-D00013.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
