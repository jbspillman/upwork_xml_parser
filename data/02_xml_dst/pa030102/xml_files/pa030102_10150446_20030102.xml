<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030005352A1-20030102-D00000.TIF SYSTEM "US20030005352A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030005352A1-20030102-D00001.TIF SYSTEM "US20030005352A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030005352A1-20030102-D00002.TIF SYSTEM "US20030005352A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030005352A1-20030102-D00003.TIF SYSTEM "US20030005352A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030005352A1-20030102-D00004.TIF SYSTEM "US20030005352A1-20030102-D00004.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030005352</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10150446</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020517</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>0115969.8</doc-number>
</priority-application-number>
<filing-date>20010629</filing-date>
<country-code>GB</country-code>
</foreign-priority-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>0117092.7</doc-number>
</priority-application-number>
<filing-date>20010713</filing-date>
<country-code>GB</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04L001/22</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>714</class>
<subclass>004000</subclass>
</uspc>
</classification-us-primary>
</classification-us>
<title-of-invention>Method and apparatus for recovery from faults in a loop network</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Reginald</given-name>
<family-name>Beer</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Paul</given-name>
<middle-name>Nicholas</middle-name>
<family-name>Cashman</family-name>
</name>
<residence>
<residence-non-us>
<city>Alton</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Paul</given-name>
<family-name>Hooton</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Ian</given-name>
<middle-name>David</middle-name>
<family-name>Judd</family-name>
</name>
<residence>
<residence-non-us>
<city>Winchester</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Robert</given-name>
<middle-name>Frank</middle-name>
<family-name>Maddock</family-name>
</name>
<residence>
<residence-non-us>
<city>Christchurch</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Neil</given-name>
<family-name>Morris</family-name>
</name>
<residence>
<residence-non-us>
<city>Southsea</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Robert</given-name>
<middle-name>Bruce</middle-name>
<family-name>Nicholson</family-name>
</name>
<residence>
<residence-non-us>
<city>Southsea</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Barry</given-name>
<middle-name>Douglas</middle-name>
<family-name>Whyte</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>International Business Machines Corporation</organization-name>
<address>
<city>Armonk</city>
<state>NY</state>
</address>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>HARRINGTON &amp; SMITH, LLP</name-1>
<name-2></name-2>
<address>
<address-1>4 RESEARCH DRIVE</address-1>
<city>SHELTON</city>
<state>CT</state>
<postalcode>06484-6212</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A method and apparatus for recovery from faults in a loop network (<highlight><bold>400</bold></highlight>) is provided. The loop network (<highlight><bold>400</bold></highlight>) has a host means (<highlight><bold>402</bold></highlight>), a first loop and a second loop (<highlight><bold>406, 408</bold></highlight>), a plurality of ports (<highlight><bold>410</bold></highlight>) connected to each of the loops (<highlight><bold>406, 408</bold></highlight>) and a control device (<highlight><bold>414, 440</bold></highlight>) on or connected to each loop (<highlight><bold>406, 408</bold></highlight>) with bypass control over at least one of the ports (<highlight><bold>410</bold></highlight>) connected to the loop (<highlight><bold>406, 408</bold></highlight>). In the event of a failure on the first loop (<highlight><bold>406</bold></highlight>), the host means (<highlight><bold>402</bold></highlight>) instructs the bypassing of at least one port (<highlight><bold>410</bold></highlight>) on the first loop (<highlight><bold>406</bold></highlight>), the host means (<highlight><bold>402</bold></highlight>) sending the instructions via the control device (<highlight><bold>414, 440</bold></highlight>) on or connected to the second loop (<highlight><bold>408</bold></highlight>). The host means (<highlight><bold>402</bold></highlight>) may determine the physical topology of the ports (<highlight><bold>410</bold></highlight>) on the first and second loops (<highlight><bold>406, 408</bold></highlight>) such that when a failure is reported to the host means (<highlight><bold>402</bold></highlight>) by a port (<highlight><bold>432</bold></highlight>) on the first loop (<highlight><bold>406</bold></highlight>), the host means (<highlight><bold>402</bold></highlight>) instructs the bypassing of a port (<highlight><bold>434</bold></highlight>) in a specific relationship to the reporting port (<highlight><bold>432</bold></highlight>) on the first loop (<highlight><bold>434</bold></highlight>). The host means (<highlight><bold>402</bold></highlight>) may instruct the bypassing of all ports (<highlight><bold>416</bold></highlight>) on the first loop (<highlight><bold>406</bold></highlight>) and subsequently selectively un-bypass ports (<highlight><bold>416</bold></highlight>) to ascertain the location of a faulty port or ports. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">FIELD OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> This invention relates to a method and apparatus for recovery from faults in a loop network. In particular, the invention relates to recovery from faults in Fibre Channel Arbitrated Loops. The invention could equally apply to recovery from faults in other unidirectional loops, for example, Token Ring networks, FDDI (Fibre Data Distributed Interfaces), etc </paragraph>
</section>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> Fibre Channel Arbitrated Loop (FC-AL) architecture is a member of the Fibre Channel family of ANSI standard protocols. FC-AL is typically used for connecting together computer peripherals, in particular disk drives. The FC-AL architecture is described in NCITS working draft proposal, American National Standard for Information Technology &ldquo;Fibre Channel Arbitrated Loop (FC-AL-2) Revision 7.0&rdquo;, Apr. 1, 1999. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> Electronic data systems can be interconnected using network communication systems. Area-wide networks and channels are two technologies that have been developed for computer network architectures. Area-wide networks (e.g. LANs and WANs) offer flexibility and relatively large distance capabilities. Channels, such as the Small Computer System Interface (SCSI), have been developed for high performance and reliability. Channels typically use dedicated short-distance connections between computers or between computers and peripherals. </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Fibre Channel technology has been developed from optical point-to-point communication of two systems or a system and a subsystem. It has evolved to include electronic (non-optical) implementations and has the ability to connect many devices, including disk drives, in a relatively low-cost manner. This addition to the Fibre Channel specifications is called Fibre Channel Arbitrated Loop (FC-AL). </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Fibre Channel technology consists of an integrated set of standards that defines new protocols for flexible information transfer using several interconnection topologies. Fibre Channel technology can be used to connect large amounts of disk storage to a server or cluster of servers. Compared to Small Computer Systems Interface (SCSI), Fibre Channel technology supports greater performance, scalability, availability, and distance for attaching storage systems to network servers. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> Fibre Channel Arbitrated Loop (FC-AL) is a loop architecture as opposed to a bus architecture like SCSI. FC-AL is a serial interface, where data and control signals pass along a single path rather than moving in parallel across multiple conductors as is the case with SCSI. Serial interfaces have many advantages including: increased reliability due to point-to-point use in communications; dual-porting capability, so data can be transferred over two independent data paths, enhancing speed and reliability; and simplified cabling and increased connectivity which are important in multi-drive environments. As a direct disk attachment interface, FC-AL has greatly enhanced I/O performance. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> Devices are connected to a FC-AL using hardware which is termed a &ldquo;port&rdquo;. A device which has connections for two loops has two ports. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> The operation of FC-AL involves a number of ports connected such that each port&apos;s transmitter is connected to the next port&apos;s receiver, and so on, forming a loop. Each port&apos;s receiver has an elasticity buffer that captures the incoming FC-AL frame or words and is then used to regenerate the FC-AL word as it is re-transmitted. This buffer exists to deal with slight clocking variations that occur. Each port receives a word, and then transmits that word to the next port, unless the port itself is the destination of that word, in which case it is consumed. The nature of FC-AL is therefore such that each intermediate port between the originating port and the destination port gets to &lsquo;see&rsquo; each word as it passes around the FC-AL loop. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> FC-AL architecture may be in the form of a single loop. Often two independent loops are used to connect the same devices in the form of dual loops. The aim of these loops is that a single fault should not cause both loops to fail simultaneously. However, some faults, for example in a protocol chip or microprocessor in a disk drive which is common to both loops, can cause both loops to fail. More than two loops can also be used. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> FC-AL devices typically have two sets of connections allowing them to be attached to two FC-ALs. Thus, in a typical configuration, two independent loops exist and each device is physically connected into both loops. When the system is working optimally, there are two possible loops that can be used to access any device. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> A FC-AL can incorporate bypass circuits with the aim of making the FC-AL interface sufficiently robust to permit devices to be removed from the loop without interrupting throughput and sacrificing data integrity. If a disk drive fails, port bypass circuits attempt to route around the problem so all disk drives on the loop remain accessible. Without port bypass circuits a fault in any device will break the loop. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> In dual loops, port bypass circuits are provided for each loop and these provide additional protection against faults. Most disk drive failures would cause the disk drive to request bypass; however, faults can occur in disk drives that do not request bypass and therefore do not prevent both loops from failing. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> A typical FC-AL may have one or two host bus adapters (HBA) and a set of six or so disk drive enclosures or drawers, each of which may contain a set of ten to sixteen disk drives. There is a physical cable connection between each enclosure and the HBA in the FC-AL. Also, there is a connection internal to the enclosure or drawer, between the cable connector and each disk drive in the enclosure or drawer, as well as other components within the enclosure or drawer, e.g. SES device (SCSI Enclosure Services node) or other enclosure services devices. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> A SES device is an example of an enclosure service device which manages a disk enclosure and allows the monitoring of power and cooling in an enclosure. The SES device also obtains information as to which slots in an enclosure are occupied. The SES device accepts a limited set of SCSI commands. SCSI Enclosure Services are described in the working draft proposed by the American National Standards for Information Systems &ldquo;SCSI-3 Enclosure Services Command Set (SES), Revision 8a&rdquo;, Jan. 16, 1997. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> SES devices may be dedicated SES nodes on the loop or alternatively there may be a disk drive that also supports the SES command set. For the purposes of this disclosure, either type of device will be referred to as an SES device. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> It is an aim of the present invention to provide increased reliability, availability and serviceability in a loop network. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> More particularly, the situation addressed by present invention is when one port of a device on or connected to a unidirectional loop network has become non-functional and this fault has not been detected by the device itself. It is the intention of the present invention to provide a method for determining the location of the faulty port and to enable the bypassing of the port. </paragraph>
</section>
<section>
<heading lvl="1">DISCLOSURE OF THE INVENTION </heading>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> According to a first aspect of the present invention there is provided a method for recovery from faults in a loop network, the loop network having a host means, a first loop and a second loop, a plurality of ports connected to each of the loops and a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop, wherein the method comprises: in the event of a fault on the first loop resulting in the failure of the first loop, bypassing a specific port if the location of the fault is known by the host means; if the location of the fault is not known by the host means, selectively bypassing and re-introducing ports to locate the fault and bypassing one or more ports once the fault is located; and wherein the host means instructs the bypassing of a port on the first loop by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> The method may include the host means determining the physical topology of the ports on the first and second loops. The failure may be reported to the host means by a port on the first loop and the host means instructs the bypassing of a port in a specific relationship to the reporting port. The specific relationship may be the port before the reporting port in the first loop. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> The host means may instruct the bypassing of all ports on the first loop. The method may include subsequently selectively un-bypassing ports to ascertain the location of a faulty port or ports, for example, using a binary search. The method may alternatively include the host means instructing the bypassing of a selected batch of ports on the first loop. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> The loop network may include at least one enclosure, each enclosure having a control device with bypass control over the ports in that enclosure and wherein the method includes un-bypassing all ports on the first loop in one enclosure at once, if the first loop again fails, re-bypassing all the ports on the first loop in the enclosure and selectively un-bypassing individual ports in the enclosure. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> The loop network may be a Fibre Channel Arbitrated Loop and the control device may be a SCSI Enclosure Services device. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> According to a second aspect of the present invention there is provided a loop network with means for recovery from faults, the loop network comprising: a host means; a first loop and a second loop; a plurality of ports connected to each of the loops; a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop; means for bypassing a specific port if the location of a fault is known by the host means; if the location of a fault is not known by the host means, means for selectively bypassing and re-introducing ports to locate the fault and means for bypassing one or more ports once the fault is located; and wherein the host means instructs the bypassing of a port on the first loop by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> The host means may have means for determining the physical topology of the ports on each of the loops. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> The plurality of ports may be ports of disk drives and wherein each disk drive has a port connected to each of the first and second loops. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> The loop network may include at least one enclosure, each enclosure having a control device with bypass control over the ports in that enclosure. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> The loop network may include more than two loops in the network. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> The loop network may be a Fibre Channel Arbitrated Loop and the control device may be a SCSI Enclosure Services device. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> According to a third aspect of the present invention there is provided a computer program product stored on a computer readable storage medium comprising computer readable program code means for recovery from faults in a loop network, the loop network having a host means, a first loop and a second loop, a plurality of ports connected to each of the loops and a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop, the program code means performing the steps of: in the event of a fault on the first loop resulting in the failure of the first loop, bypassing a specific port if the location of the fault is known by the host means; if the location of the fault is not known by the host means, selectively bypassing and re-introducing ports to locate the fault and bypassing one or more ports once the fault is located; and wherein bypassing of a port on the first loop is carried out by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> This invention also proposes a method and apparatus by which the SCSI Enclosure Services (SES) controllers, or any enclosure services controller, in an enclosure could provide assistance in a recovery procedure.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> Embodiments of the invention are now described, by means of examples only, with reference to the accompanying drawings in which: </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a diagram of a dual loop network in accordance with the present invention; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a diagram of a dual loop network in accordance with the present invention; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a diagram of a dual loop network with an enlarged view of a bypass circuit for a disk drive in the network; </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 4A and 4B</cross-reference> are diagrams of dual loop networks in accordance with the present invention including a fault in one of the loops; </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a diagram of a bypass circuit for a disk drive.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> A loop network system with a plurality of serially connected ports in the form of a Fibre Channel Arbitrated Loop (FC-AL) is described for connecting together computer peripherals, in particular disk drives. The described embodiments are given in the context of FC-AL architecture although the described method and apparatus could be applied to any unidirectional loop network. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> loop network <highlight><bold>100</bold></highlight> is shown in the form of a Fibre Channel Arbitrated Loop with two host bus adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight>. The loop network <highlight><bold>100</bold></highlight> in the shown embodiment has two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>. Each enclosure in this embodiment has three disk drives <highlight><bold>120</bold></highlight> although in practice there are usually 10 or more disk drives in an enclosure. Dual loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> each connect the components in the loop network <highlight><bold>100</bold></highlight>. A first loop <highlight><bold>116</bold></highlight> is shown along the top of the loop network <highlight><bold>100</bold></highlight> in the diagram and a second loop <highlight><bold>118</bold></highlight> is shown along the bottom of the loop network <highlight><bold>100</bold></highlight> in the diagram. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> The adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight> have external connectors <highlight><bold>110</bold></highlight> for cables <highlight><bold>114</bold></highlight> connecting each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> from the adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight> to external connectors <highlight><bold>112</bold></highlight> of the enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>. Cables <highlight><bold>114</bold></highlight> also connect the two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight> such that each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes from one enclosure <highlight><bold>106</bold></highlight> to the next enclosure <highlight><bold>108</bold></highlight>. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes from the first adapter <highlight><bold>102</bold></highlight> via an adapter external connector <highlight><bold>110</bold></highlight>, a cable <highlight><bold>114</bold></highlight> and an enclosure external connector <highlight><bold>112</bold></highlight> to the first enclosure <highlight><bold>106</bold></highlight>. In the first enclosure <highlight><bold>106</bold></highlight> each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes through its own SES (SCSI Enclosure Services) device or controller <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> and then through each of the disk drives <highlight><bold>120</bold></highlight> in turn. The two loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> both pass through the same shared disk drives <highlight><bold>120</bold></highlight>. Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> then leaves the first enclosure via an enclosure external connector <highlight><bold>112</bold></highlight> and passes through a cable <highlight><bold>114</bold></highlight> to a second enclosure <highlight><bold>108</bold></highlight> which it enters via an enclosure external connector <highlight><bold>112</bold></highlight>. The second enclosure <highlight><bold>108</bold></highlight> has the same set of components as the first enclosure <highlight><bold>106</bold></highlight>. Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight>, after passing through the second enclosure <highlight><bold>108</bold></highlight> is connected to the second adapter <highlight><bold>104</bold></highlight> via enclosure external connectors <highlight><bold>112</bold></highlight>, cables <highlight><bold>114</bold></highlight> and adapter external connectors <highlight><bold>110</bold></highlight>. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> In each enclosure <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>, a loop <highlight><bold>116</bold></highlight> enters from an external connector <highlight><bold>112</bold></highlight> and is routed through each of the disk drives <highlight><bold>120</bold></highlight> and an SES device <highlight><bold>122</bold></highlight>, <highlight><bold>126</bold></highlight>. Each disk drive <highlight><bold>120</bold></highlight> or SES device <highlight><bold>122</bold></highlight>, <highlight><bold>126</bold></highlight> has a bypass circuit to enable it to be bypassed by the loop, if required. The disk drives <highlight><bold>120</bold></highlight> are examples of dual port devices in that they are common to both the loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> of the loop network <highlight><bold>100</bold></highlight>. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> An SES device <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> is provided on each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> in each enclosure and the two SES devices <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> are connected together through the enclosure&apos;s backplane. One SES device can be used to control the other SES device. An SES device manages an enclosure and provides a point of control for each enclosure. It can monitor parameters such as power and cooling and obtain information as to which slots for disk drives are occupied. It accepts a limited set of SCSI commands. SES devices can be used to instruct a bypass of a disk drive and to check which disk drives are bypassed. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> The SES devices <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference> are provided as nodes in the loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight>. These are referred to as &ldquo;in loop&rdquo; SES devices. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> SES devices can also be provided by means of an Enclosure Services Interface (ESI) in which case the SES devices are not in the loop but are interfaced from one or more disk drives. SES devices of this nature are usually provided on a few disk drives in each enclosure. Commands can be sent to the SES device in an enclosure via the disk drive with the ESI. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> Only disk drive enclosures that contain an SES device or some other form of enclosure services device are described. One purpose of the SES devices is to control the port bypass circuits for the ports of disk drives housed within the enclosure. The SES command set provides an Enclosure Control Page which allows the setting fo the bypass circuits to be specified. The SES device therefore allows the host bus adapter to use the standard SES interface to bypass the ports of individual disk drives in a loop as required. The same interface can be used to un-bypass the ports. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> In the embodiment shown in <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> dual loop network <highlight><bold>100</bold></highlight> is shown by way of example, with two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight> each with three disk drives <highlight><bold>120</bold></highlight> and two SES controllers <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight>, one for each loop. Typical loop networks may have one or two host bus adapters and a set of six or so disk drive enclosures each of which may typically contain a set of ten to sixteen disk drives. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 2, a</cross-reference> loop network <highlight><bold>200</bold></highlight> is shown with the complete path of two loops <highlight><bold>216</bold></highlight>, <highlight><bold>218</bold></highlight> through a single enclosure <highlight><bold>206</bold></highlight> between two adapters <highlight><bold>202</bold></highlight>, <highlight><bold>204</bold></highlight> in a loop network <highlight><bold>200</bold></highlight>. On the top loop <highlight><bold>216</bold></highlight>, a fibre channel signal leaving the first adapter <highlight><bold>202</bold></highlight> will first reach the second adaptor <highlight><bold>204</bold></highlight> and then the enclosure devices, in the form of an SES device <highlight><bold>222</bold></highlight> and the disk drives <highlight><bold>220</bold></highlight>. On the bottom loop <highlight><bold>218</bold></highlight>, a fibre channel signal leaving the first adapter <highlight><bold>202</bold></highlight> will first reach the enclosure devices in the form of an SES device <highlight><bold>224</bold></highlight> and the disk drives <highlight><bold>220</bold></highlight> and then will reach the second adapter <highlight><bold>204</bold></highlight>. In this way the two loops <highlight><bold>216</bold></highlight>, <highlight><bold>218</bold></highlight> may travel through the enclosure devices in the same order. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> It is the nature of FC-AL architecture that each port connected to a loop needs to be functional in order for a loop initialisation procedure to complete which is a necessary requirement for the loop to operate. Therefore, enclosures include a mechanism for bypassing faulty ports in a loop, thereby removing the ports from the loop, allowing it to operate. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, the bypass circuits provided in an enclosure are shown in more detail. An enclosure <highlight><bold>306</bold></highlight> is shown of the same form as the enclosure <highlight><bold>206</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. The enclosure <highlight><bold>306</bold></highlight> may be one of several connected together in a loop network. The enclosure <highlight><bold>306</bold></highlight> has two loops <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight> each of which pass through common disk drives <highlight><bold>320</bold></highlight>. A bypass circuit <highlight><bold>326</bold></highlight> is provided for each disk drive <highlight><bold>320</bold></highlight> on each loop <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight>. Bypass circuits <highlight><bold>328</bold></highlight> are also provided for the SES devices <highlight><bold>322</bold></highlight>, <highlight><bold>324</bold></highlight> on each loop <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight>. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> The inset of <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows a schematic diagram of the effect of a bypass circuit <highlight><bold>326</bold></highlight> in the first loop <highlight><bold>316</bold></highlight> in more detail. The loop has a path <highlight><bold>330</bold></highlight> travelling from left to right which is routed off along a path <highlight><bold>332</bold></highlight> at right angles to travel to a disk drive <highlight><bold>320</bold></highlight>. The loop <highlight><bold>316</bold></highlight> returns from the disk drive <highlight><bold>320</bold></highlight> along a return path <highlight><bold>334</bold></highlight> parallel to the path <highlight><bold>332</bold></highlight> to the disk drive <highlight><bold>320</bold></highlight>. The return path <highlight><bold>334</bold></highlight> meets a junction <highlight><bold>336</bold></highlight> and turns a right angle to continue the left to right path <highlight><bold>338</bold></highlight> of the loop <highlight><bold>316</bold></highlight> towards the next disk drive <highlight><bold>320</bold></highlight>. The junction <highlight><bold>336</bold></highlight> in effect has a switch <highlight><bold>340</bold></highlight> which can join the left to right paths 330, 338 to bypass the disk drive <highlight><bold>320</bold></highlight>. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4A</cross-reference> shows a loop network <highlight><bold>400</bold></highlight> with dual loops in the form of a first loop <highlight><bold>406</bold></highlight> and a second loop <highlight><bold>408</bold></highlight>. This figure shows the ports <highlight><bold>410</bold></highlight> of the devices on or connected to the loops <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight>. In this embodiment, the loop network <highlight><bold>400</bold></highlight> has a single host bus adapter <highlight><bold>402</bold></highlight> and eight devices are shown in an enclosure <highlight><bold>426</bold></highlight> with one SES device <highlight><bold>414</bold></highlight>. Two communicating SES devices could be used with one on or connected to each loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight>. The eight devices of this example are disk drives <highlight><bold>412</bold></highlight>; however, other components could be connected in a similar manner. Each disk drive <highlight><bold>412</bold></highlight> has a first port <highlight><bold>416</bold></highlight> connected to the first loop <highlight><bold>406</bold></highlight> and a second port <highlight><bold>418</bold></highlight> connected to the second loop <highlight><bold>408</bold></highlight>. The first and second ports <highlight><bold>416</bold></highlight>, <highlight><bold>418</bold></highlight> are shown with a connection <highlight><bold>420</bold></highlight> between them to indicate that the first and second ports <highlight><bold>416</bold></highlight>, <highlight><bold>418</bold></highlight> belong to a single disk drive <highlight><bold>412</bold></highlight>. The SES device <highlight><bold>414</bold></highlight> has two SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>424</bold></highlight>. </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> Each port <highlight><bold>410</bold></highlight> on the first and second loops <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> has a bypass circuit (not shown) as previously described in relation to <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4A</cross-reference> shows that a break <highlight><bold>430</bold></highlight> has occurred in the first loop <highlight><bold>406</bold></highlight> between port A <highlight><bold>434</bold></highlight> and port B <highlight><bold>432</bold></highlight>. This has caused the first loop <highlight><bold>406</bold></highlight> to be non-functional. This means that there is no communication path along the broken first loop <highlight><bold>406</bold></highlight> to any of the devices in the form of the eight disk drives <highlight><bold>412</bold></highlight> and the SES device <highlight><bold>414</bold></highlight> on the first loop <highlight><bold>406</bold></highlight>. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> During initialisation of a loop, a Loop Initialisation Procedure (LIP) allows each port <highlight><bold>410</bold></highlight> to obtain an Arbitrated Loop Physical Address (AL_PA) that is unique within the loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> for that port. This effectively uniquely identifies each port <highlight><bold>410</bold></highlight> in a loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight>. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> The loop initialisation involves one port winning as Loop Initialisation Master (LIM). The LIM port manages the initialisation procedure. Disk drives <highlight><bold>412</bold></highlight> can indicate that they do not wish to be the LIM. The Arbitrated Loop Physical Addresses (AL_PAs) are then allocated to each of the ports <highlight><bold>410</bold></highlight> in the loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight>. The LIM sends a frame around the loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> with bits corresponding to AL_PAs. Each port <highlight><bold>410</bold></highlight> finds the relevant bit for its AL_PA and changes the bit from &ldquo;0&rdquo; to &ldquo;1&rdquo; indicating that the AL_PA is not available for subsequent ports. The AL_PAs can be defined by previous addresses, assigned hardware addresses or software addresses. If there are multiple enclosures, each address indicates the enclosure and the device within the enclosure ensuring that each port <highlight><bold>410</bold></highlight> in a loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> has a unique address. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> The initialisation procedure can also send special frames around the loop <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> called the Loop Initialisation Report Position (LIRP) frame and the Loop Initialisation Loop Position (LILP) frame which detail the topology of the loop as seen by the Loop Initialisation Master (LIM). This involves each port <highlight><bold>410</bold></highlight> indicating in a frame its AL_PA in the order that it is physically situated in the loop. This frame contains each port&apos;s AL_PA in turn as seen by the LIM for the whole of the loop and is broadcast around the loop. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> The loop initialisation allows the host bus adapter <highlight><bold>402</bold></highlight> to know where each port <highlight><bold>410</bold></highlight> is in relation to the adapter <highlight><bold>402</bold></highlight>. The host bus adapter <highlight><bold>402</bold></highlight> will identify all the devices in a loop including SES devices <highlight><bold>414</bold></highlight> as distinct from disk drives <highlight><bold>412</bold></highlight> and may also determine from the SES devices <highlight><bold>414</bold></highlight> details of the ports housed within that SES device&apos;s enclosure <highlight><bold>426</bold></highlight>. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> If an error occurs, as shown in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>A, and a loop <highlight><bold>406</bold></highlight> becomes broken, the next port <highlight><bold>432</bold></highlight> in the loop <highlight><bold>406</bold></highlight> sends a special loop initialisation primitive to the host bus adapter <highlight><bold>402</bold></highlight> indicating that it has detected the broken loop <highlight><bold>406</bold></highlight>. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4B</cross-reference> shows a similar loop network <highlight><bold>400</bold></highlight> to <cross-reference target="DRAWINGS">FIG. 4A</cross-reference> with two enclosures <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> shown in the loop network <highlight><bold>400</bold></highlight>. The second enclosure <highlight><bold>436</bold></highlight> also has a plurality of disk drives <highlight><bold>412</bold></highlight> and an SES device <highlight><bold>440</bold></highlight>. The disk drives <highlight><bold>412</bold></highlight> have ports <highlight><bold>410</bold></highlight> on each of the first and second loops <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> in the loop network <highlight><bold>400</bold></highlight>. The SES device <highlight><bold>440</bold></highlight> of the second enclosure <highlight><bold>436</bold></highlight> has SES node ports <highlight><bold>442</bold></highlight> and <highlight><bold>444</bold></highlight> on the first and second loops <highlight><bold>406</bold></highlight>, <highlight><bold>408</bold></highlight> respectively. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> If there is a break <highlight><bold>430</bold></highlight> in the first loop <highlight><bold>406</bold></highlight>, the present invention uses the second loop <highlight><bold>408</bold></highlight> for communication between the host bus adapter <highlight><bold>402</bold></highlight> and the SES device or devices <highlight><bold>414</bold></highlight> in each enclosure. Such communication allows the host bus adapter <highlight><bold>402</bold></highlight> to instruct the SES device <highlight><bold>414</bold></highlight> to bypass ports <highlight><bold>416</bold></highlight> of the disk drives <highlight><bold>412</bold></highlight> on the broken first loop <highlight><bold>406</bold></highlight>. The host bus adapter <highlight><bold>402</bold></highlight> can send a command via the second loop <highlight><bold>408</bold></highlight> to the SES node port <highlight><bold>424</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> to instruct the SES device <highlight><bold>414</bold></highlight> via SES node port <highlight><bold>422</bold></highlight> on the first loop <highlight><bold>406</bold></highlight> to bypass specific ports <highlight><bold>416</bold></highlight> on the first loop <highlight><bold>406</bold></highlight>. The host bus adapter <highlight><bold>402</bold></highlight> can also command the SES device <highlight><bold>414</bold></highlight> via SES node port <highlight><bold>424</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> to bypass all the ports <highlight><bold>410</bold></highlight> on the first loop <highlight><bold>406</bold></highlight> either including or excluding the SES node port <highlight><bold>422</bold></highlight> on the first loop <highlight><bold>406</bold></highlight>. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> In a situation in which the host bus adapter <highlight><bold>402</bold></highlight> knows the topology of the loop network <highlight><bold>400</bold></highlight>, it knows the physical location of each disk drive <highlight><bold>412</bold></highlight> in each enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> and a first recovery procedure can be followed. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> In the first recovery procedure, when there is a single break <highlight><bold>430</bold></highlight> in a first loop <highlight><bold>406</bold></highlight> this is detected by port B <highlight><bold>432</bold></highlight> immediately following the break <highlight><bold>430</bold></highlight> in the loop <highlight><bold>406</bold></highlight>. The host bus adapter <highlight><bold>402</bold></highlight> sees the error reported by port B <highlight><bold>432</bold></highlight>. The host bus adapter <highlight><bold>402</bold></highlight> knows the topology of the first loop <highlight><bold>406</bold></highlight> due to the initialisation procedure and the LILP frame and it knows that port A <highlight><bold>434</bold></highlight> was the last port in the first loop <highlight><bold>406</bold></highlight> before the detected failure. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> The host bus adapter <highlight><bold>402</bold></highlight> sends a command to the SES device <highlight><bold>414</bold></highlight> via SES node port <highlight><bold>424</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> in the enclosure <highlight><bold>426</bold></highlight> in which port A <highlight><bold>434</bold></highlight> is housed. The second loop <highlight><bold>408</bold></highlight> is still operational as it does not contain a break. The command instructs the SES device <highlight><bold>414</bold></highlight> to bypass the disk drive <highlight><bold>412</bold></highlight> in the slot of the enclosure <highlight><bold>426</bold></highlight> housing the broken port A <highlight><bold>434</bold></highlight>. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> If the first loop <highlight><bold>406</bold></highlight> now manages to re-initialise, the recovery has been successful and no further action is required. The error has been detected and the faulty device <highlight><bold>434</bold></highlight> is no longer part of the first loop <highlight><bold>406</bold></highlight> and therefore the first loop <highlight><bold>406</bold></highlight> is fully operational. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> This first recovery procedure will be effective as long as there is only one error in the loop. This procedure relies heavily on the ability to determine the precise physical location of the faulty device in the loop. If this does not work, there may be another failure, even possibly a failure of the SES node port&apos;s ability to bypass the faulty device. Loop initialisation must have previously succeeded so that each port has an address in the form of an AL_PA. If the first recovery procedure is not effective, a second recovery procedure can be carried out. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> If the SES device <highlight><bold>414</bold></highlight> in the enclosure <highlight><bold>426</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> is unable to bypass the disk drive <highlight><bold>410</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> for some reason, and an error is returned, the only course of action is for the host bus adapter <highlight><bold>402</bold></highlight> to send another command to the SES device <highlight><bold>414</bold></highlight> to bypass all the ports <highlight><bold>410</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> in the enclosure <highlight><bold>426</bold></highlight> including the SES node port <highlight><bold>422</bold></highlight>. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> It is possible that port B <highlight><bold>432</bold></highlight> which reported the failure is actually the source of the problem or that there are multiple errors in the first loop <highlight><bold>406</bold></highlight> prior to port B <highlight><bold>432</bold></highlight>. There may also be later errors in the first loop <highlight><bold>406</bold></highlight> preventing the first loop <highlight><bold>406</bold></highlight> from recovering. It may be possible to distinguish between these sources of error; however, as the recovery procedure is the same, such distinction is not necessary. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> The second recovery procedure can be used if the first recovery procedure does not result in reinstatement of the broken loop. The second recovery procedure can be used in the first instance if the physical arrangement of the devices in the loop is not known, for example, if the loop initialisation has failed. The second recovery procedure may simply be chosen by the host bus adapter as the default recovery method. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> Firstly in the second recovery procedure, it is assumed that all the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>424</bold></highlight>, <highlight><bold>442</bold></highlight>, <highlight><bold>444</bold></highlight> in the enclosures <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> are operational. The recovery option is to instruct the SES node port <highlight><bold>424</bold></highlight> in the second loop <highlight><bold>408</bold></highlight> to tell the SES node port <highlight><bold>422</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> to bypass all ports <highlight><bold>410</bold></highlight> of the disk drives <highlight><bold>412</bold></highlight> in the first loop <highlight><bold>406</bold></highlight>. If there is more than one enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> in the loop network <highlight><bold>400</bold></highlight> as shown in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>B, the SES node ports <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> in each enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> are similarly instructed to tell the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> to bypass all ports <highlight><bold>410</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> except the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> themselves. This means that only the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> should remain in the first loop <highlight><bold>406</bold></highlight> and the first loop <highlight><bold>406</bold></highlight> should recover. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> If the first loop <highlight><bold>406</bold></highlight> does not recover with only the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> remaining in the first loop <highlight><bold>406</bold></highlight>, then there is little to be done as the problem is no longer under the control of the host bus adapter <highlight><bold>402</bold></highlight> and the first loop <highlight><bold>406</bold></highlight> will remain broken. The loop network <highlight><bold>400</bold></highlight> can still operate using the second loop <highlight><bold>408</bold></highlight>. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> If the first loop <highlight><bold>406</bold></highlight> does recover with only the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> remaining in the loop, the action is to instruct each SES node port <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> in each enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> in turn to un-bypass all the disk drives <highlight><bold>412</bold></highlight> in its enclosure. If such un-bypassing again breaks the loop <highlight><bold>406</bold></highlight>, there is a solvable break in that enclosure. All the disk drives <highlight><bold>412</bold></highlight> in that enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> should be bypassed again and then each disk drive <highlight><bold>412</bold></highlight> should be un-bypassed one at a time. As soon as the loop <highlight><bold>406</bold></highlight> breaks, the host bus adapter <highlight><bold>402</bold></highlight> will know which disk drive <highlight><bold>412</bold></highlight> is faulty. This can be applied to all disk drives <highlight><bold>412</bold></highlight> in the enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight>, so that more than one faulty device can be located. Once the enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> has been un-bypassed as much as possible, the next enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> is tested, and so on. The result is that only the faulty devices are removed. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> The host bus adapter <highlight><bold>402</bold></highlight> monitors the resultant effect of bypassing ports <highlight><bold>416</bold></highlight> on the broken first loop <highlight><bold>406</bold></highlight> in order to isolate the faulty device or devices and to leave them bypassed resulting in the previously broken first loop <highlight><bold>406</bold></highlight> containing only non-faulty devices <highlight><bold>412</bold></highlight>. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> If an SES node port <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> in the first loop <highlight><bold>406</bold></highlight> in an enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> is itself faulty and is unable to perform the requested bypass operation, all the devices including the SES node port <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> in that enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> are bypassed by the SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> in that enclosure. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> The host bus adapter <highlight><bold>402</bold></highlight> can take the view that since a loop <highlight><bold>406</bold></highlight> is broken, it can force all the ports <highlight><bold>410</bold></highlight> in the loop in all enclosures <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> except the SES node ports <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> to be bypassed immediately, and gradually re-introduce one enclosure <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> at a time until all the enclosures <highlight><bold>426</bold></highlight>, <highlight><bold>436</bold></highlight> are re-introduced. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 5, a</cross-reference> bypass circuit <highlight><bold>500</bold></highlight> is shown. The bypass circuit <highlight><bold>500</bold></highlight> has an incoming fibre channel signal <highlight><bold>502</bold></highlight> from the previous disk drive bypass circuit <highlight><bold>504</bold></highlight> in the loop. The bypass circuit <highlight><bold>500</bold></highlight> also takes in a fibre channel signal <highlight><bold>506</bold></highlight> (referred to as the drive out signal) from the disk drive <highlight><bold>508</bold></highlight> for which the bypass circuit <highlight><bold>500</bold></highlight> operates. These two fibre channel signals <highlight><bold>502</bold></highlight>, <highlight><bold>506</bold></highlight> are the input signals to the bypass circuit <highlight><bold>500</bold></highlight>. The bypass circuit <highlight><bold>500</bold></highlight> selects which one of the incoming fibre channel signal <highlight><bold>502</bold></highlight> and the drive out signal <highlight><bold>506</bold></highlight> will be routed to the fibre channel outgoing signal <highlight><bold>510</bold></highlight> from the bypass circuit <highlight><bold>500</bold></highlight>. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> The selection of the input signals <highlight><bold>502</bold></highlight>, <highlight><bold>506</bold></highlight> is controlled by a port bypass control signal <highlight><bold>512</bold></highlight>. The disk drive <highlight><bold>508</bold></highlight> is bypassed by the incoming fibre channel signal <highlight><bold>502</bold></highlight> being routed to the outgoing signal <highlight><bold>510</bold></highlight> if the port bypass control signal is &ldquo;0&rdquo;. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> The port bypass control signal <highlight><bold>512</bold></highlight> will send a signal to bypass the disk drive <highlight><bold>508</bold></highlight> in the following situations: </paragraph>
<paragraph id="P-0078" lvl="2"><number>&lsqb;0078&rsqb;</number> 1. The disk drive <highlight><bold>508</bold></highlight> is requesting a bypass. This happens when a disk drive has performed an internal initialisation, it detects a failure mode, or it receives a primitive sequence instructing a bypass. If the disk drive itself is not present, the enclosure will assert a signal for the disk drive to be bypassed. </paragraph>
<paragraph id="P-0079" lvl="2"><number>&lsqb;0079&rsqb;</number> 2. The SES node port <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> for the first loop <highlight><bold>406</bold></highlight> containing the bypass circuit <highlight><bold>500</bold></highlight> wants to bypass the disk drive <highlight><bold>508</bold></highlight>. This can be controlled by sending SES commands to the SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> on the second loop <highlight><bold>408</bold></highlight>. </paragraph>
<paragraph id="P-0080" lvl="2"><number>&lsqb;0080&rsqb;</number> 3. The SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> in the enclosure on the second loop <highlight><bold>408</bold></highlight> wants all the devices on the first loop <highlight><bold>406</bold></highlight> containing the disk drive <highlight><bold>508</bold></highlight> to be bypassed. A signal is asserted by the SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> on the second loop <highlight><bold>408</bold></highlight> when a command has been received instructing it to bypass all devices on the first loop <highlight><bold>406</bold></highlight>. </paragraph>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> The port bypass control signal <highlight><bold>512</bold></highlight> will not bypass the disk drive <highlight><bold>508</bold></highlight> and will route the incoming drive out signal <highlight><bold>506</bold></highlight> to the outgoing signal <highlight><bold>510</bold></highlight> if the port bypass control signal is &ldquo;1&rdquo;. </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> The port bypass control signal <highlight><bold>512</bold></highlight> will send a signal not to bypass the disk drive <highlight><bold>508</bold></highlight> in the following situations: </paragraph>
<paragraph id="P-0083" lvl="2"><number>&lsqb;0083&rsqb;</number> 1. The disk drive <highlight><bold>508</bold></highlight> is not requesting a bypass. </paragraph>
<paragraph id="P-0084" lvl="2"><number>&lsqb;0084&rsqb;</number> 2. The SES node port <highlight><bold>422</bold></highlight>, <highlight><bold>442</bold></highlight> for the first loop <highlight><bold>406</bold></highlight> containing the bypass circuit <highlight><bold>500</bold></highlight> does not want to bypass the disk drive <highlight><bold>508</bold></highlight>. This can be controlled by sending SES commands to the SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> on the second loop <highlight><bold>408</bold></highlight>. </paragraph>
<paragraph id="P-0085" lvl="2"><number>&lsqb;0085&rsqb;</number> 3. The SES node port <highlight><bold>424</bold></highlight>, <highlight><bold>444</bold></highlight> in the enclosure on the second loop <highlight><bold>408</bold></highlight> does not want all the devices on first loop <highlight><bold>406</bold></highlight> bypassed. </paragraph>
<paragraph id="P-0086" lvl="0"><number>&lsqb;0086&rsqb;</number> A logical AND is taken of the three inputs to form the port bypass signal <highlight><bold>512</bold></highlight> which means that if anything wants the disk drive <highlight><bold>508</bold></highlight> to be bypassed, it will be bypassed. </paragraph>
<paragraph id="P-0087" lvl="0"><number>&lsqb;0087&rsqb;</number> The incoming fibre channel signal <highlight><bold>502</bold></highlight> will always be transmitted <highlight><bold>514</bold></highlight> to the disk drive <highlight><bold>508</bold></highlight> but the disk drive output signal <highlight><bold>506</bold></highlight> is only selectively transmitted onwards along the loop. When a disk drive is bypassed it continues to receive the inbound signal but the outbound signal is disconnected. When the disk drive is bypassed by SES control, the disk drive does not know that it is bypassed and behaves as normal. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> When a disk drive is un-bypassed, it rejoins the loop. The behaviour of the disk drive will depend on whether the disk drive has an address in the loop, if it does have an address it may rejoin the loop without disturbance. If the disk drive does not have an address, it will appear that the disk drive has logged out and the loop will not recognise the disk drive until the next network reconfiguration. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> There are advantages of using the described recovery technique as opposed to using only the remaining working loop. First, a separate failure on the second loop in a dual loop network would result in total loss of access if the first loop has not been recovered. With a recovery technique as described one loop can be used to repair the second loop at all times. Secondly, the availability of both loops allows the loops to be used for data transfer, increasing the bandwidth capability of the system. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> The invention is described in terms of using an SES device with the SES protocol. Any enclosure services controller device could be used in a similar manner. Similarly, reference is made to disk drives as examples of dual port devices. Any peripheral device, for example, an alternative form of storage device, could be substituted for a disk drive. </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> The method described herein is typically implemented as a computer program product, comprising a set of program instructions for controlling a computer or similar device. These instructions can be supplied preloaded into a system or recorded on a storage medium such as a CD-ROM, or made available for downloading over a network such as the Internet or a mobile telephone network. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> Improvements and modifications can be made to the foregoing without departing from the scope of the present invention. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A method for recovery from faults in a loop network, the loop network having a host means, a first loop and a second loop, a plurality of ports connected to each of the loops and a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop, wherein the method comprises: 
<claim-text>in the event of a fault on the first loop resulting in the failure of the first loop, </claim-text>
<claim-text>bypassing a specific port if the location of the fault is known by the host means; </claim-text>
<claim-text>if the location of the fault is not known by the host means, selectively bypassing and re-introducing ports to locate the fault and bypassing one or more ports once the fault is located; and </claim-text>
<claim-text>wherein the host means instructs the bypassing of a port on the first loop by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the method includes the host means determining the physical topology of the ports on the first and second loops. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the failure is reported to the host means by a port on the first loop and the host means instructs the bypassing of a specific port in a given relationship to the reporting port. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00003">claim 3</dependent-claim-reference>, wherein the given relationship is the port before the reporting port in the first loop. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the host means instructs the bypassing of all ports on the first loop. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00005">claim 5</dependent-claim-reference>, wherein the method includes subsequently selectively un-bypassing ports to ascertain the location of a faulty port or ports. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the host means instructs the bypassing of a selected batch of ports on the first loop. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the loop network includes at least one enclosure, each enclosure having a control device with bypass control over the ports in that enclosure. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00008">claim 8</dependent-claim-reference>, wherein the method includes un-bypassing all ports on the first loop in one enclosure at once, if the first loop again fails, re-bypassing all the ports on the first loop in the enclosure and selectively un-bypassing individual ports in the enclosure. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the loop network is a Fibre Channel Arbitrated Loop and the control device is a SCSI Enclosure Services device. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. A loop network with means for recovery from faults, the loop network comprising: 
<claim-text>a host means; </claim-text>
<claim-text>a first loop and a second loop; </claim-text>
<claim-text>a plurality of ports connected to each of the loops; </claim-text>
<claim-text>a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop; </claim-text>
<claim-text>means for bypassing a specific port if the location of a fault is known by the host means; </claim-text>
<claim-text>if the location of a fault is not known by the host means, means for selectively bypassing and re-introducing ports to locate the fault and means for bypassing one or more ports once the fault is located; and </claim-text>
<claim-text>wherein the host means instructs the bypassing of a port on the first loop by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. A loop network as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein the host means has means for determining the physical topology of the ports on each of the loops. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. A loop network as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein the plurality of ports are ports of disk drives and wherein each disk drive has a port connected to each of the first and second loops. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. A loop network as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein the loop network includes at least one enclosure, each enclosure having a control device with bypass control over the ports in that enclosure. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. A loop network as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 11</dependent-claim-reference>, wherein the loop network is a Fibre Channel Arbitrated Loop and the control device is a SCSI Enclosure Services device. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. A computer program product stored on a computer readable storage medium comprising computer readable program code means for recovery from faults in a loop network, the loop network having a host means, a first loop and a second loop, a plurality of ports connected to each of the loops and a control device on or connected to each loop with bypass control over at least one of the ports connected to the loop, the program code means performing the steps of: 
<claim-text>in the event of a fault on the first loop resulting in the failure of the first loop, </claim-text>
<claim-text>bypassing a specific port if the location of the fault is known by the host means; </claim-text>
<claim-text>if the location of the fault is not known by the host means, selectively bypassing and re-introducing ports to locate the fault and bypassing one or more ports once the fault is located; and </claim-text>
<claim-text>wherein bypassing of a port on the first loop is carried out by sending instructions via the control device on or connected to the second loop, thereby isolating the fault and allowing recovery of the first loop.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030005352A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030005352A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030005352A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030005352A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030005352A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
