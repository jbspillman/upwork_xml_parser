<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030005368A1-20030102-D00000.TIF SYSTEM "US20030005368A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030005368A1-20030102-D00001.TIF SYSTEM "US20030005368A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030005368A1-20030102-D00002.TIF SYSTEM "US20030005368A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030005368A1-20030102-D00003.TIF SYSTEM "US20030005368A1-20030102-D00003.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030005368</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10150578</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020517</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>0115969.8</doc-number>
</priority-application-number>
<filing-date>20010629</filing-date>
<country-code>GB</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04B001/74</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>714</class>
<subclass>043000</subclass>
</uspc>
</classification-us-primary>
</classification-us>
<title-of-invention>Method and apparatus for recovery from faults in a loop network</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Reginald</given-name>
<family-name>Beer</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Paul</given-name>
<middle-name>Nicholas</middle-name>
<family-name>Cashman</family-name>
</name>
<residence>
<residence-non-us>
<city>Alton</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Paul</given-name>
<family-name>Hooton</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Ian</given-name>
<middle-name>David</middle-name>
<family-name>Judd</family-name>
</name>
<residence>
<residence-non-us>
<city>Winchester</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Robert</given-name>
<middle-name>Frank</middle-name>
<family-name>Maddock</family-name>
</name>
<residence>
<residence-non-us>
<city>Christchurch</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Robert</given-name>
<middle-name>Bruce</middle-name>
<family-name>Nicholson</family-name>
</name>
<residence>
<residence-non-us>
<city>Southsea</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
<inventor>
<name>
<given-name>Barry</given-name>
<middle-name>Douglas</middle-name>
<family-name>Whyte</family-name>
</name>
<residence>
<residence-non-us>
<city>Eastleigh</city>
<country-code>GB</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>International Business Machines Corporation</organization-name>
<address>
<city>Armonk</city>
<state>NY</state>
</address>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>HARRINGTON &amp; SMITH, LLP</name-1>
<name-2></name-2>
<address>
<address-1>4 RESEARCH DRIVE</address-1>
<city>SHELTON</city>
<state>CT</state>
<postalcode>06484-6212</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A method and apparatus for recovery from faults in a loop network (<highlight><bold>500</bold></highlight>) is provided. The loop network (<highlight><bold>500</bold></highlight>) has a plurality of ports (<highlight><bold>520, 530, 532, 534</bold></highlight>) serially connected with means for bypassing the ports (<highlight><bold>520, 530, 532, 534</bold></highlight>) from the loop network (<highlight><bold>500</bold></highlight>). A control device (<highlight><bold>522, 524</bold></highlight>) is provided with bypass control over at least one of the ports (<highlight><bold>530, 532, 534</bold></highlight>). A host means (<highlight><bold>502</bold></highlight>) sends a command to the control device (<highlight><bold>522, 524</bold></highlight>) at regular intervals and the control device (<highlight><bold>522, 524</bold></highlight>) has a counter which restarts a time period at the receipt of each command. If the time period expires, the control device (<highlight><bold>522, 524</bold></highlight>) activates the means for bypassing all the ports (<highlight><bold>530, 532, 534</bold></highlight>) under its control. The loop network (<highlight><bold>500</bold></highlight>) may have two loops (<highlight><bold>516, 518</bold></highlight>) with at least some of the ports (<highlight><bold>520, 530, 532, 534</bold></highlight>) common to both loops (<highlight><bold>516, 518</bold></highlight>). </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">FIELD OF INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> This invention relates to a method and apparatus for recovery from faults in a loop network. In particular, the invention relates to recovery from faults in Fibre Channel Arbitrated Loops. The invention could equally apply to recovery from faults in other unidirectional loops, for example, Token Ring networks, FDDI (Fibre Data Distributed Interfaces), etc. </paragraph>
</section>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> Fibre Channel Arbitrated Loop (FC-AL) architecture is a member of the Fibre Channel family of ANSI standard protocols. FC-AL is typically used for connecting together computer peripherals, in particular disk drives. The FC-AL architecture is described in NCITS working draft proposals, American National Standard for Information Technology &ldquo;Fibre Channel Arbitrated Loop (FC-AL-2) Revision 7.0&rdquo;, Apr. 1, 1999 and &ldquo;Fibre Channel Arbitrated Loop (FC-AL-3) Version 1.0&rdquo;, Sep. 20, 1999. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> Electronic data systems can be interconnected using network communication systems. Area-wide networks and channels are two technologies that have been developed for computer network architectures. Area-wide networks (e.g. LANs and WANs) offer flexibility and relatively large distance capabilities. Channels, such as the Small Computer System Interface (SCSI), have been developed for high performance and reliability. Channels typically use dedicated short-distance connections between computers or between computers and peripherals. </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Fibre Channel technology has been developed from optical point-to-point communication of two systems or a system and a subsystem. It has evolved to include electronic (non-optical) implementations and has the ability to connect many devices, including disk drives, in a relatively low-cost manner. This addition to the Fibre Channel specifications is called Fibre Channel Arbitrated Loop (FC-AL). </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Fibre Channel technology consists of an integrated set of standards that defines new protocols for flexible information transfer using several interconnection topologies. Fibre Channel technology can be used to connect large amounts of disk storage to a server or cluster of servers. Compared to Small Computer Systems Interface (SCSI), Fibre Channel technology supports greater performance, scalability, availability, and distance for attaching storage systems to network servers. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> Fibre Channel Arbitrated Loop (FC-AL) is a loop architecture as opposed to a bus architecture like SCSI. FC-AL is a serial interface, where data and control signals pass along a single path rather than moving in parallel across multiple conductors as is the case with SCSI. Serial interfaces have many advantages including: increased reliability due to point-to-point use in communications; dual-porting capability, so data can be transferred over two independent data paths, enhancing speed and reliability; and simplified cabling and increased connectivity which are important in multi-drive environments. As a direct disk attachment interface, FC-AL has greatly enhanced I/O performance. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> The operation of FC-AL involves a number of ports connected such that each port&apos;s transmitter is connected to the next port&apos;s receiver, and so on, forming a loop. Each port&apos;s receiver has an elasticity buffer that captures the incoming FC-AL frame or words and is then used to regenerate the FC-AL word as it is re-transmitted. This buffer exists to deal with slight clocking errors that occur. Each port receives a word, and then transmits that word to the next port, unless the port itself is the destination of that word, in which case it is consumed. The nature of FC-AL is therefore such that each intermediate port between the originating port and the destination port gets to &lsquo;see&rsquo; each word as it passes around the FC-AL loop. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> FC-AL architecture may be in the form of a single loop. Often two independent loops are used to connect the same components in the form of dual loops. The aim of these loops is that a single fault should not cause both loops to fail simultaneously. However, some faults, for example in a protocol chip or microprocessor in a disk drive which is common to both loops, can cause both loops to fail. More than two loops can also be used. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> A FC-AL can incorporated bypass circuits with the aim of making the FC-AL interface sufficiently robust to permit devices to be removed from the loop without interrupting throughput and sacrificing data integrity. If a disk drive fails, port bypass circuits attempt to route around the problem so all disk drives on the loop remain accessible. Without port bypass circuits a fault in any device will break the loop. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> In dual loops, port bypass circuits are provided for each loop and these provide additional protection against faults. Most disk drive failures would cause the disk drive to request bypass; however, faults can occur in disk drives that do not request bypass and therefore do not prevent both loops from failing. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> A typical FC-AL may have one or two host bus adapters (HBA) and a set of six or so disk drive enclosures or drawers, each of which may contain a set of ten to sixteen disk drives. There is a physical cable connection between each enclosure and the HBA in the FC-AL. Also, there is a connection internal to the enclosure or drawer, between the cable connector and each disk drive in the enclosure or drawer, as well as other components within the enclosure or drawer, e.g. SES device (SCSI Enclosure Services node) or other enclosure services devices. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> A SES device is an example of an enclosure service device which manages a disk enclosure and allows the monitoring of power and cooling in an enclosure. The SES device also obtains information as to which slots in an enclosure are occupied. The SES device accepts a limited set of SCSI commands. SCSI Enclosure Services are described in the working draft proposed by the American National Standards for Information Systems &ldquo;SCSI-3 Enclosure Services Command Set (SES), Revision 8a&rdquo;, Jan. 16 1997. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> It is an aim of the present invention to provide increased reliability, availability and serviceability in a loop network. </paragraph>
</section>
<section>
<heading lvl="1">DISCLOSURE OF THE INVENTION </heading>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> According to a first aspect of the present invention there is provided a method for recovery from faults in a loop network, the loop network having a plurality of ports and a control device with bypass control over at least one of the ports, the method including: sending commands at regular intervals to the control device; restarting a time period in the control device at the receipt of a command; and if the time period expires in the control device, instructing the bypass of all ports under control of the control device. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> Preferably, there are two loops in the loop network with at least some of the ports common to both loops and one control device on or connected to each loop. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> The time period may be at least two times the interval between the commands. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> The step of bypassing of all the ports under the control of the control device reactivates the loop or loops with the control device in or connected to the loop or loops. The loop network does not know which device has failed; therefore, bypassing all the ports means there is a high probability that the failed port will be among those bypassed and thus the loop becomes connected again. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> The method may include subsequently selectively un-bypassing ports to ascertain the location of the faulty port. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> According to a second aspect of the present invention there is provided an apparatus for recovery from faults in a loop network comprising: a plurality of ports serially connected in the loop network; means for bypassing the ports from the loop network; a control device with bypass control over at least one of the ports; and a host means for contacting the loop network; wherein the host means sends a command to the control device at regular intervals and the control device has a counter which restarts a time period at the receipt of each command, wherein, if the predetermined time period expires, the control device activates the means for bypassing all the ports under its control. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> Preferably, the loop network has two loops and at least some of the ports are connected to both loops and wherein the control device bypasses the ports on both loops simultaneously. Preferably, there is one control device on or connected to each loop. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> The time period may be at least two times the interval between commands. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> The control device may also have a bypass means, but this is not activated by the timeout of the predetermined time period. If the control device is bypassed, the loop cannot be controlled and it will then be permanently bypassed. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> The host means may instruct the un-bypassing of the means for bypassing selected ports to ascertain the location of the faulty port. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> The loop network may be a Fibre Channel Arbitrated Loop pair with at least one enclosure, the control device being an enclosure services device in an enclosure. The control device may be a SCSI Enclosure Services device and may receive commands from the host means in the form of a host bus adapter. The ports may be disk drives. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> The SCSI Enclosure Services device may be connected in the loop network. Alternatively, the SCSI Enclosure Services device may be connected via an Enclosure Services Interface capable port in the loop network. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> According to a third aspect of the present invention there is provided a computer program product stored on a computer readable storage medium, comprising computer readable program code means for recovery from faults in a loop network, the loop network having a plurality of ports and a control device with bypass control over at least one of the ports, the program code means performing the steps of: sending commands at regular intervals to the control device; restarting a time period in the control device at the receipt of a command; and if the time period expires in the control device, instructing the bypass of all ports under control of the control device. The control device itself is not bypassed by the expiry of the time period. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> This invention particularly, but not exclusively, addresses the case when both loops in a Fibre Channel Arbitrated Loop (FC-AL) pair have stopped functioning possibly due to a defective dual port device (e.g. a disk drive). Disk drives tend to be designed with both ports implemented in a single interface chip, thus failure of this chip can affect both loops. There is normally an automatic bypass facility implemented to enable the device (the disk drive) to bypass itself out of the loops if it detects that there is a problem with its interface to the loops, but this is not effective for all failure modes so the device can cause the failure of both loops. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> This invention also proposes a method and apparatus by which the SCSI Enclosure Services (SES) controllers, or any enclosure services controller, in an enclosure could provide assistance in an automatic recovery procedure, rather than rely on manual intervention.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> Embodiments of the invention are now described, by means of example only, with reference to the accompanying drawings in which: </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a diagram of a dual loop network in accordance with the present invention; </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a diagram of a dual loop network in accordance with the present invention; </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a diagram of a dual loop network with an enlarged view of a bypass circuit for a disk drive in the network; </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a diagram of a bypass circuit for a disk drive; </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5A</cross-reference> is a diagram of the dual loop network of <cross-reference target="DRAWINGS">FIG. 1</cross-reference> with a failing disk drive; and </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5B</cross-reference> is a diagram of the dual loop network of <cross-reference target="DRAWINGS">FIG. 1</cross-reference> with the disk drives of one enclosure bypassed in accordance with the present invention.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> A loop network system with a plurality of serially connected ports in the form of a Fibre Channel Arbitrated Loop (FC-AL) is described for connecting together computer peripherals, in particular disk drives. This described embodiment is given in the context of FC-AL architecture although the described method and apparatus could be applied to any unidirectional loop network. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> loop network <highlight><bold>100</bold></highlight> is shown in the form of a Fibre Channel Arbitrated Loop with two host bus adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight>. The loop network <highlight><bold>100</bold></highlight> in the shown embodiment has two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>. Each enclosure in this embodiment has three disk drives <highlight><bold>120</bold></highlight> although in practice there are usually <highlight><bold>10</bold></highlight> or more disk drives in an enclosure. Dual loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> each connect the components in the loop network <highlight><bold>100</bold></highlight>. A first loop <highlight><bold>116</bold></highlight> is shown along the top of the loop network <highlight><bold>100</bold></highlight> in the diagram and a second loop <highlight><bold>118</bold></highlight> is shown along the bottom of the loop network <highlight><bold>100</bold></highlight> in the diagram. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> The adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight> have external connectors <highlight><bold>110</bold></highlight> for cables <highlight><bold>114</bold></highlight> connecting each loop <highlight><bold>114</bold></highlight>, <highlight><bold>116</bold></highlight> from the adapters <highlight><bold>102</bold></highlight>, <highlight><bold>104</bold></highlight> to external connectors <highlight><bold>112</bold></highlight> of the enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>. Cables <highlight><bold>114</bold></highlight> also connect the two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight> such that each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes from one enclosure <highlight><bold>106</bold></highlight> to the next enclosure <highlight><bold>108</bold></highlight>. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes from the first adapter <highlight><bold>102</bold></highlight> via an adapter external connector <highlight><bold>110</bold></highlight>, a cable <highlight><bold>114</bold></highlight> and an enclosure external connector <highlight><bold>112</bold></highlight> to the first enclosure <highlight><bold>106</bold></highlight>. In the first enclosure <highlight><bold>106</bold></highlight> each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> passes through its own SES (SCSI Enclosure Services) device or controller <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> and then through each of the disk drives <highlight><bold>120</bold></highlight> in turn. The two loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> both pass through the same shared disk drives <highlight><bold>120</bold></highlight>. Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> then leaves the first enclosure via an enclosure external connector <highlight><bold>112</bold></highlight> and passes through a cable <highlight><bold>114</bold></highlight> to a second enclosure <highlight><bold>108</bold></highlight> which it enters via an enclosure external connector <highlight><bold>112</bold></highlight>. The second enclosure <highlight><bold>108</bold></highlight> has the same set of components as the first enclosure <highlight><bold>106</bold></highlight>. Each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight>, after passing through the second enclosure <highlight><bold>108</bold></highlight> is connected to the second adapter <highlight><bold>104</bold></highlight> via enclosure external connectors <highlight><bold>112</bold></highlight>, cables <highlight><bold>114</bold></highlight> and adapter external connectors <highlight><bold>110</bold></highlight>. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> In each enclosure <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight>, a loop <highlight><bold>116</bold></highlight> enters from an external connector <highlight><bold>112</bold></highlight> and is routed through each of the disk drives <highlight><bold>120</bold></highlight> and an SES device <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight>. Each disk drive <highlight><bold>120</bold></highlight> or SES device <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> has a bypass circuit to enable it to be bypassed by the loop, if required. The disk drives <highlight><bold>120</bold></highlight> are examples of dual port devices in that they are common to both the loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> of the loop network <highlight><bold>100</bold></highlight>. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> An SES device <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> is provided on each loop <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight> in each enclosure and the two SES devices <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> are connected together through the enclosure&apos;s backplane. One SES device can be used to control the other SES device. An SES device manages an enclosure and provides a point of control for each enclosure. It can monitor parameters such as power and cooling and obtain information as to which slots for disk drives are occupied. It accepts a limited set of SCSI commands. SES devices can be used to instruct a bypass of a disk drive and to check which disk drives are bypassed. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> The SES devices <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference> are provided as nodes in the loops <highlight><bold>116</bold></highlight>, <highlight><bold>118</bold></highlight>. These are referred to as &ldquo;in loop&rdquo; SES devices. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> SES devices can also be provided by means of an Enclosure Services Interface (ESI) in which case the SES devices are not in the loop but are interfaced from one or more disk drives. SES devices of this nature are usually provided on a few disk drives in each enclosure. Commands can be sent to the SES device in an enclosure via the disk drive with the ESI. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> In the embodiment shown in <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> dual loop network <highlight><bold>100</bold></highlight> is shown by way of example, with two enclosures <highlight><bold>106</bold></highlight>, <highlight><bold>108</bold></highlight> each with three disk drives <highlight><bold>120</bold></highlight> and two SES controllers <highlight><bold>122</bold></highlight>, <highlight><bold>124</bold></highlight>, one for each loop. Typical loop networks may have one or two host bus adapters and a set of six or so disk drive enclosures each of which may typically contain a set of ten to sixteen disk drives. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 2, a</cross-reference> loop network <highlight><bold>200</bold></highlight> is shown with the path of two loops <highlight><bold>216</bold></highlight>, <highlight><bold>218</bold></highlight> through a single enclosure <highlight><bold>206</bold></highlight> between two adapters <highlight><bold>202</bold></highlight>, <highlight><bold>204</bold></highlight> in a loop network <highlight><bold>200</bold></highlight>. On the top loop <highlight><bold>216</bold></highlight>, a fibre channel signal leaving the first adapter <highlight><bold>202</bold></highlight> will first reach the second adaptor <highlight><bold>204</bold></highlight> and then the enclosure devices, in the form of an SES device <highlight><bold>222</bold></highlight> and the disk drives <highlight><bold>220</bold></highlight>. On the bottom loop <highlight><bold>218</bold></highlight>, a fibre channel signal leaving the first adapter <highlight><bold>202</bold></highlight> will first reach the enclosure devices in the form of an SES device <highlight><bold>224</bold></highlight> and the disk drives <highlight><bold>220</bold></highlight> and then will reach the second adapter <highlight><bold>204</bold></highlight>. In this way the two loops <highlight><bold>216</bold></highlight>, <highlight><bold>218</bold></highlight> travel through the enclosure devices in the same order. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, the bypass circuits provided in an enclosure are shown in more detail. An enclosure <highlight><bold>306</bold></highlight> is shown of the same form as the enclosure <highlight><bold>206</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. The enclosure <highlight><bold>306</bold></highlight> may be one of several connected together in a loop network. The enclosure <highlight><bold>306</bold></highlight> has two loops <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight> each of which pass through common disk drives <highlight><bold>320</bold></highlight>. A bypass circuit <highlight><bold>326</bold></highlight> is provided for each disk drive <highlight><bold>320</bold></highlight> on each loop <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight>. Bypass circuits <highlight><bold>328</bold></highlight> are also provided for the SES devices <highlight><bold>322</bold></highlight>, <highlight><bold>324</bold></highlight> on each loop <highlight><bold>316</bold></highlight>, <highlight><bold>318</bold></highlight>. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> The inset of <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows a schematic diagram of the effect of a bypass circuit <highlight><bold>326</bold></highlight> in the first loop <highlight><bold>316</bold></highlight> in more detail. The loop has a path <highlight><bold>330</bold></highlight> travelling from left to right which is routed off along a path <highlight><bold>332</bold></highlight> at right angles to travel to a disk drive <highlight><bold>320</bold></highlight>. The loop <highlight><bold>316</bold></highlight> returns from the disk drive <highlight><bold>320</bold></highlight> along a return path <highlight><bold>334</bold></highlight> parallel to the path <highlight><bold>332</bold></highlight> to the disk drive <highlight><bold>320</bold></highlight>. The return path <highlight><bold>334</bold></highlight> meets a junction <highlight><bold>336</bold></highlight> and turns a right angle to continue the left to right path <highlight><bold>338</bold></highlight> of the loop <highlight><bold>316</bold></highlight> towards the next disk drive <highlight><bold>320</bold></highlight>. The junction <highlight><bold>336</bold></highlight> in effect has a switch <highlight><bold>340</bold></highlight> which can join the left to right paths <highlight><bold>330</bold></highlight>, <highlight><bold>338</bold></highlight> to bypass the disk drive <highlight><bold>320</bold></highlight>. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 4, a</cross-reference> bypass circuit <highlight><bold>400</bold></highlight> is shown. The bypass circuit <highlight><bold>400</bold></highlight> has an incoming fibre channel signal <highlight><bold>402</bold></highlight> from the previous disk drive bypass circuit <highlight><bold>404</bold></highlight> in the loop. The bypass circuit <highlight><bold>400</bold></highlight> also takes in a fibre channel signal <highlight><bold>406</bold></highlight> (referred to as the drive out signal) from the disk drive <highlight><bold>408</bold></highlight> for which the bypass circuit <highlight><bold>400</bold></highlight> operates. These two fibre channel signals <highlight><bold>402</bold></highlight>, <highlight><bold>406</bold></highlight> are the input signals to the bypass circuit <highlight><bold>400</bold></highlight>. The bypass circuit <highlight><bold>400</bold></highlight> selects which one of the incoming fibre channel signal <highlight><bold>402</bold></highlight> and the drive out signal <highlight><bold>406</bold></highlight> will be routed to the fibre channel outgoing signal <highlight><bold>410</bold></highlight> from the bypass circuit <highlight><bold>400</bold></highlight>. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> The selection of the input signals <highlight><bold>402</bold></highlight>, <highlight><bold>406</bold></highlight> is controlled by a port bypass control signal <highlight><bold>412</bold></highlight>. The disk drive <highlight><bold>408</bold></highlight> is bypassed by the incoming fibre channel signal <highlight><bold>402</bold></highlight> being routed to the outgoing signal <highlight><bold>410</bold></highlight> if the port bypass control signal is &ldquo;0&rdquo;. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> The port bypass control signal <highlight><bold>412</bold></highlight> will send a signal to bypass the disk drive <highlight><bold>408</bold></highlight> in the following situations: </paragraph>
<paragraph id="P-0051" lvl="2"><number>&lsqb;0051&rsqb;</number> 1. The disk drive <highlight><bold>408</bold></highlight> is requesting a bypass. This happens when a disk drive has performed an internal initialisation, it detects a failure mode, or it receives a primitive sequence instructing a bypass. If the disk drive itself is not present, the enclosure will assert a signal for the disk drive to be bypassed. </paragraph>
<paragraph id="P-0052" lvl="2"><number>&lsqb;0052&rsqb;</number> 2. The SES device <highlight><bold>322</bold></highlight> for the loop <highlight><bold>316</bold></highlight> containing the bypass circuit <highlight><bold>400</bold></highlight> wants to bypass the disk drive <highlight><bold>408</bold></highlight>. This can be controlled by sending SES commands to the SES device <highlight><bold>322</bold></highlight>. </paragraph>
<paragraph id="P-0053" lvl="2"><number>&lsqb;0053&rsqb;</number> 3. The other SES device <highlight><bold>324</bold></highlight> in the enclosure for the dual loop <highlight><bold>318</bold></highlight> wants all the devices on the first loop <highlight><bold>316</bold></highlight> containing the disk drive <highlight><bold>408</bold></highlight> to be bypassed. A signal is asserted by the other SES device <highlight><bold>324</bold></highlight> on the second loop <highlight><bold>318</bold></highlight> when a command has been received instructing it to bypass all devices on the first loop <highlight><bold>316</bold></highlight>. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> The port bypass control signal <highlight><bold>412</bold></highlight> will not bypass the disk drive <highlight><bold>408</bold></highlight> and will route the incoming drive out signal <highlight><bold>406</bold></highlight> to the outgoing signal <highlight><bold>410</bold></highlight> if the port bypass control signal is &ldquo;1&rdquo;. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> The port bypass control signal <highlight><bold>412</bold></highlight> will send a signal not to bypass the disk drive <highlight><bold>408</bold></highlight> in the following situations: </paragraph>
<paragraph id="P-0056" lvl="2"><number>&lsqb;0056&rsqb;</number> 1. The disk drive <highlight><bold>408</bold></highlight> is not requesting a bypass. </paragraph>
<paragraph id="P-0057" lvl="2"><number>&lsqb;0057&rsqb;</number> 2. The SES device <highlight><bold>322</bold></highlight> for the loop <highlight><bold>316</bold></highlight> containing the bypass circuit <highlight><bold>400</bold></highlight> does not want to bypass the disk drive <highlight><bold>408</bold></highlight>. This can be controlled by sending SES commands to the SES device <highlight><bold>322</bold></highlight>. </paragraph>
<paragraph id="P-0058" lvl="2"><number>&lsqb;0058&rsqb;</number> 3. The other SES device <highlight><bold>324</bold></highlight> in the enclosure for the dual loop <highlight><bold>318</bold></highlight> does not want all the devices on first loop <highlight><bold>316</bold></highlight> bypassed. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> A logical AND is taken of the three inputs to form the port bypass signal <highlight><bold>412</bold></highlight> which means that if anything wants the disk drive <highlight><bold>408</bold></highlight> to by bypassed, it will be bypassed. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> The incoming fibre channel signal <highlight><bold>402</bold></highlight> will always be transmitted <highlight><bold>414</bold></highlight> to the disk drive <highlight><bold>408</bold></highlight> but the disk drive output signal <highlight><bold>406</bold></highlight> is only selectively transmitted onwards along the loop. When a disk drive is bypassed it continues to receive the inbound signal but the outbound signal is disconnected. When the disk drive is bypassed by SES control, the disk drive does not know that it is bypassed and behaves as normal. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> When a disk drive is un-bypassed, it rejoins the loop. The behaviour of the disk drive will depend on whether the disk drive has an address in the loop, if it does it will rejoin the look without disturbance. If the disk drive does not have an address, it will appear that the disk drive has logged out and the loop will not recognise the disk drive until the next network reconfiguration. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> The enclosures in the loop networks described support a &lsquo;set timeout&rsquo; command. A command is sent by an adapter at regular intervals to a processor in an enclosure, for example to an SES device. If another set timeout command is not received on either loop in the enclosure before the time expires then the enclosure will bypass all disk drives on both loops. Only the SES devices will remain in the loops. The adapter can then use the SES device in one of the loops to diagnose which disk drive is causing the problem. This disk drive can then be permanently bypassed and the error logged. The other devices can all be reattached to the loop. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> In the situation in which the SES device is not in loop but is enabled via an ESI disk drive, the enclosure processor should bypass all the disk drives on both loops except for one ESI-capable disk drive on each loop, but not the same disk drive on the two loops. If there is only one disk drive with ESI capability, it should be connected to one loop only. If there are no disk drives with ESI capability, the enclosure processor should take no action. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> The set timeout signal is of the order of seconds with a granularity of 50 ms. An interval of zero means no timeout. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> A problem addressed by the described method and apparatus is when disk drives fail and cause both loops to break at once. A disk drive can bypass itself when it believes that it is failing. However, it may fail in such a way that it fails to bypass itself and breaks both loops to which it is attached. If this happens then access to all devices (disk drives and SES devices) in both loops will be lost. If this problem is not quickly rectified then I/Os will be failed to a host. Also, if both loops are broken, there is no way to control the enclosures and the bypass circuits, and thus no way to repair the loop. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> Referring to <cross-reference target="DRAWINGS">FIG. 5A, a</cross-reference> loop network <highlight><bold>500</bold></highlight> is shown of the same form as the loop network <highlight><bold>100</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 1</cross-reference> in a failed situation. A first enclosure <highlight><bold>506</bold></highlight> has a failing disk drive <highlight><bold>530</bold></highlight> which breaks both loops <highlight><bold>516</bold></highlight>, <highlight><bold>518</bold></highlight>. The other disk drives <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> in the first enclosure <highlight><bold>506</bold></highlight> and any other devices on both loops are rendered inaccessible due to the breaks in the loops <highlight><bold>516</bold></highlight>, <highlight><bold>518</bold></highlight>. The two SES devices <highlight><bold>522</bold></highlight>, <highlight><bold>524</bold></highlight> for the two loops <highlight><bold>516</bold></highlight>, <highlight><bold>518</bold></highlight> in the first enclosure <highlight><bold>506</bold></highlight> are also inaccessible. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> Due to the fact that the SES devices <highlight><bold>522</bold></highlight>, <highlight><bold>524</bold></highlight> are inaccessible the timeout commands from the adapter cannot be received and the SES devices <highlight><bold>522</bold></highlight>, <highlight><bold>524</bold></highlight> will bypass all the disk drives <highlight><bold>530</bold></highlight>, <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> in the first enclosure <highlight><bold>506</bold></highlight> thereby creating complete loops bypassing all the disk drives. This is shown in <cross-reference target="DRAWINGS">FIG. 5B</cross-reference> with bypassed loops <highlight><bold>536</bold></highlight>, <highlight><bold>538</bold></highlight>. The second enclosure <highlight><bold>508</bold></highlight> may also timeout since as soon as the loops are broken it too will cease to receive timeout commands. When the loops are restored, the faulty device may be in any of the enclosures <highlight><bold>506</bold></highlight>, <highlight><bold>508</bold></highlight> which have timed out. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> Once the disk drives <highlight><bold>530</bold></highlight>, <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> are bypassed, both loops <highlight><bold>516</bold></highlight>, <highlight><bold>518</bold></highlight> will come back up into operation; however, all the disk drives <highlight><bold>530</bold></highlight>, <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> will be inaccessible. One of the adapters <highlight><bold>502</bold></highlight>, <highlight><bold>504</bold></highlight> can then find out which disk drive <highlight><bold>530</bold></highlight>, <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> is at fault. A configuration manager can inform the adapter if an SES device <highlight><bold>522</bold></highlight>, <highlight><bold>524</bold></highlight> is accessible via a certain loop and the adapter can instruct the SES device <highlight><bold>522</bold></highlight>, <highlight><bold>524</bold></highlight> to un-bypass disk drives from the other loop to see which disk drive causes the loop to break. Once the faulty disk drive <highlight><bold>530</bold></highlight> has been found, it can be bypassed from the loops <highlight><bold>516</bold></highlight>, <highlight><bold>518</bold></highlight> permanently, an error is logged and the other disk drives <highlight><bold>532</bold></highlight>, <highlight><bold>534</bold></highlight> un-bypassed. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> To find the faulty disk drive <highlight><bold>530</bold></highlight> as quickly as possible, a binary search can be performed. Half the disk drives in the enclosure <highlight><bold>506</bold></highlight> will be un-bypassed. If the loops go down then it one of these disk drives that is at fault. If the loops stay up then it is one of the other set of disk drives, and so on until the disk drive is identified. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> The set timeout signal is now described in detail. The described method implements two counters each controlled by one of the SES devices. Timers could equally be used in place of counters. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> The counters work in the following manner. At regular intervals a SES command (the set timeout command) is sent from an adapter or host system to each of the SES devices in the loops. This command, when received by a SES device, is used to set its counter. Which starts to count down over a predetermined timeout period to zero. The predetermined timeout period is determined by the value in the command. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> The commands are sent at regular intervals. The intervals are less than the predetermined timeout period. When the next command is received, the counter is set back to the beginning of the timeout period and again starts counting down to zero. The commands should arrive at the regular intervals such that the counter does not reach zero. If, however, the commands do not reach the counters due to a break in the loop, the counter does not reset to the beginning of the predetermined timeout period, but continues counting down to zero. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> The timeout period must be longer than one of the intervals, but can also be longer than two of the intervals at which the commands are sent. Depending on the relationship of the timeout period with the intervals, two or more commands can be missed in the time taken for the counter to count down to zero. Therefore, when one command is missed the counter continues to count down, but if the next command is then received, the counter is set back to the beginning of the timeout period without reaching zero. This allows for the invalid transmission of a command which is not due to an ongoing fault. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> In the event of both loops being broken by a failing device, the commands are not able to be transmitted. As a result, both the counters in an enclosure, one on each loop, will fail to be set before they count down to zero. The result is that the SES devices enable the bypass functions on all the dual port devices on both loops. This then means that the only FC-AL devices in the enclosure that are still connected to the loop, one to each, are the SES devices themselves. </paragraph>
<paragraph id="P-0075" lvl="7"><number>&lsqb;0075&rsqb;</number> The following rules apply: </paragraph>
<paragraph id="P-0076" lvl="2"><number>&lsqb;0076&rsqb;</number> 1. The &lsquo;set&rsquo; value would be such that the loss of at least two &lsquo;set&rsquo; commands would be tolerated before the &lsquo;counter&rsquo; stepped to zero. </paragraph>
<paragraph id="P-0077" lvl="2"><number>&lsqb;0077&rsqb;</number> 2. Both counters at zero&mdash;set all dual port devices to bypass. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> 3. One counter at zero and the other SES device card defective&mdash;set all dual port devices to bypass. </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> If the loops are populated with enclosures that support this function and the failed device is in such an enclosure, the result of the above is that the loops should reinitialise and the adapters will only be able to &lsquo;see&rsquo; SES devices. </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> The adapter needs to recognise that both loops in a pair have been broken and have then been restored. A procedure is detailed below to recover access to all the bypassed devices except the failing one. If there are multiple adapters on the loops then only one of them (the master) should be designated to perform this procedure </paragraph>
<paragraph id="P-0081" lvl="7"><number>&lsqb;0081&rsqb;</number> The master adapter performs the following recovery: </paragraph>
<paragraph id="P-0082" lvl="2"><number>&lsqb;0082&rsqb;</number> 1. Inform the other adapter/s not to try using any devices on the loops. </paragraph>
<paragraph id="P-0083" lvl="2"><number>&lsqb;0083&rsqb;</number> 2. Check if the SES device has detected &lsquo;both counters at zero&rsquo;, if so, then continue with step 3, if not, check next SES device. </paragraph>
<paragraph id="P-0084" lvl="2"><number>&lsqb;0084&rsqb;</number> 3. Send a command to one enclosure (SES device) on one loop of the pair (loop <highlight><bold>1</bold></highlight>) to disable all the bypass functions in that enclosure on the other loop of the pair (loop <highlight><bold>2</bold></highlight>). </paragraph>
<paragraph id="P-0085" lvl="2"><number>&lsqb;0085&rsqb;</number> 4. Check that the loop <highlight><bold>2</bold></highlight> initialised properly and all devices configured with no problem. </paragraph>
<paragraph id="P-0086" lvl="2"><number>&lsqb;0086&rsqb;</number> 5. If NOT, send a command to enable all the bypass functions again and then disable them one at a time to find the defective device (the one that stops the loop from initialising). Leave the defective device bypassed and continue on. </paragraph>
<paragraph id="P-0087" lvl="2"><number>&lsqb;0087&rsqb;</number> 6. If the loop <highlight><bold>2</bold></highlight> is initialised OK, then reset the &lsquo;both counters at zero&rsquo; status in this enclosure and continue on doing the same process to each enclosure in turn until all the enclosures and devices are configured on loop <highlight><bold>2</bold></highlight>. </paragraph>
<paragraph id="P-0088" lvl="2"><number>&lsqb;0088&rsqb;</number> 7. Log an error to the system identifying any device found to be defective. </paragraph>
<paragraph id="P-0089" lvl="2"><number>&lsqb;0089&rsqb;</number> 8. Disable the bypass functions in all the enclosure on the loop <highlight><bold>1</bold></highlight> to match those disabled on the loop <highlight><bold>2</bold></highlight> or repeat steps 3 to 7 with loop <highlight><bold>1</bold></highlight> and <highlight><bold>2</bold></highlight> swapped. </paragraph>
<paragraph id="P-0090" lvl="2"><number>&lsqb;0090&rsqb;</number> 9. Inform the other adapters that they can resume operations. </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> An automatic bypassing function can be controlled (enabled, disabled), via an SES command. When a &lsquo;set&rsquo; counter command is received the automatic bypass function can be &lsquo;enabled&rsquo; and there will be a separate SES command to &lsquo;disable&rsquo; the function. The disable function can simply set the timeout to &lsquo;0&rsquo;. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> The SES devices also monitor the external connectors of the enclosure. When they detect that all the external connections are in bypass mode and there are no active cables connected, then the automatic bypass function should be disabled. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> This approach to the problem, although having the disadvantage of an adapter having to issue commands at regular intervals to maintain the counters, does have the very real advantage of not requiring complex detection techniques within the enclosure to detect when both loops have failed. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> The invention is described in term of using an SES device with the SES protocol. Any enclosure services controller device could be used in a similar manner. Similarly, reference is made to disk drives as examples of dual port devices. Any peripheral device, for example, an alternative form of storage device, could be substituted for a disk drive. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> The method described herein is typically implemented as a computer program product, comprising a set of program instructions for controlling a computer or similar device. These instructions can be supplied preloaded into a system or recorded on a storage medium such as a CD-ROM, or made available for downloading over a network such as the Internet or a mobile telephone network. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> Improvements and modifications can be made to the foregoing without departing from the scope of the present invention. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A method for recovery from faults in a loop network, the loop network having a plurality of ports and a control device with bypass control over at least one of the ports, the method including: 
<claim-text>sending commands at regular intervals to the control device; </claim-text>
<claim-text>restarting a time period in the control device at the receipt of a command; and </claim-text>
<claim-text>if the time period expires in the control device, instructing the bypass of all ports under control of the control device. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein there are two loops in the loop network with at least some of the ports common to both loops and one control device on or connected to each loop. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the time period is at least two times the interval between the commands. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the bypassing of all the ports under the control of the control device reactivates the loop or loops with the control device in or connected to the loop or loops. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. A method as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the method includes subsequently selectively un-bypassing ports to ascertain the location of the faulty port. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. An apparatus for recovery from faults in a loop network comprising: 
<claim-text>a plurality of ports serially connected in the loop network; </claim-text>
<claim-text>means for bypassing the ports from the loop network; </claim-text>
<claim-text>a control device with bypass control over at least one of the ports; and </claim-text>
<claim-text>a host means for contacting the loop network; </claim-text>
<claim-text>wherein the host means sends a command to the control device at regular intervals and the control device has a counter which restarts a time period at the receipt of each command, </claim-text>
<claim-text>wherein, if the time period expires, the control device activates the means for bypassing all the ports under its control. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the loop network has two loops and at least some of the ports are connected to both loops and wherein the control device bypasses the ports on both loops simultaneously. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference>, wherein there is one control device on or connected to each loop. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the time period is at least two times the interval between commands. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the control device has a bypass means but this is not activated if the time period expires. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the host means instructs the un-bypassing of the means for bypassing selected ports to ascertain the location of the faulty port. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the loop network is a Fibre Channel Arbitrated Loop pair with at least one enclosure, the control device being an enclosure services device in an enclosure. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein the control device is a SCSI Enclosure Services device and receives commands from the host means in the form of a host bus adapter. </claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein the SCSI Enclosure Services device is connected in the loop network. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00011">claim 12</dependent-claim-reference>, wherein the SCSI Enclosure Services device is connected via an Enclosure Services Interface capable port in the loop network. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. An apparatus as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein the ports are disk drives. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. A computer program product stored on a computer readable storage medium, comprising computer readable program code means for recovery from faults in a loop network, the loop network having a plurality of ports and a control device with bypass control over at least one of the ports, the program code means performing the steps of: 
<claim-text>sending commands at regular intervals to the control device; </claim-text>
<claim-text>restarting a time period in the control device at the receipt of a command; and </claim-text>
<claim-text>if the time period expires in the control device, instructing the bypass of all ports under control of the control device.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030005368A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030005368A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030005368A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030005368A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
