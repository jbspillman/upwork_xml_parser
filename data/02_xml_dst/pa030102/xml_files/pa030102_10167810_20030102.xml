<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030005220A1-20030102-D00000.TIF SYSTEM "US20030005220A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030005220A1-20030102-D00001.TIF SYSTEM "US20030005220A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030005220A1-20030102-D00002.TIF SYSTEM "US20030005220A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030005220A1-20030102-D00003.TIF SYSTEM "US20030005220A1-20030102-D00003.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030005220</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10167810</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020611</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>10-366343</doc-number>
</priority-application-number>
<filing-date>19981224</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>G06F012/00</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>711</class>
<subclass>114000</subclass>
</uspc>
</classification-us-primary>
</classification-us>
<title-of-invention>Storage control unit and storage system</title-of-invention>
</technical-information>
<continuity-data>
<continuations>
<continuation-of>
<parent-child>
<child>
<document-id>
<doc-number>10167810</doc-number>
<kind-code>A1</kind-code>
<document-date>20020611</document-date>
</document-id>
</child>
<parent>
<document-id>
<doc-number>09397560</doc-number>
<document-date>19990916</document-date>
<country-code>US</country-code>
</document-id>
</parent>
<parent-status>GRANTED</parent-status>
<parent-patent>
<document-id>
<doc-number>6408358</doc-number>
<country-code>US</country-code>
</document-id>
</parent-patent>
</parent-child>
</continuation-of>
</continuations>
</continuity-data>
<inventors>
<first-named-inventor>
<name>
<given-name>Yoshihiro</given-name>
<family-name>Uchiyama</family-name>
</name>
<residence>
<residence-non-us>
<city>Odawara-shi</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Kenichi</given-name>
<family-name>Takamoto</family-name>
</name>
<residence>
<residence-non-us>
<city>Odawara-shi</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name> Hitachi, Ltd.</organization-name>
<address>
<city>Tokyo</city>
<country>
<country-code>JP</country-code>
</country>
</address>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>TOWNSEND AND TOWNSEND AND CREW, LLP</name-1>
<name-2></name-2>
<address>
<address-1>TWO EMBARCADERO CENTER</address-1>
<address-2>EIGHTH FLOOR</address-2>
<city>SAN FRANCISCO</city>
<state>CA</state>
<postalcode>94111-3834</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A structure of control units and storage units is provided in which, if a port for connecting the storage units fails, any storage unit in a plurality of storage unit groups can be accessed from one control unit. Specifically, a distinctively arranged structure is provided in which dual paths are provided, with each path connected to a plurality of storage unit groups, whereby, in normal operation, dual paths are used as data transfer paths to allow faster access. When a port or path failure occurs, the dual paths allow RAID functions to be maintained. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> The present invention is related to a storage control unit which is connected between a host unit, and a storage unit such as an external RAID unit, and controls data transfer between the host unit and the RAID or other external storage unit. In particular, the present invention is related to a storage system which has a distinctive structure for connecting the storage control unit and the external storage unit. </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The host unit can include a plurality of host computers or a single host computer with a plurality of ports, and the external storage unit includes a plurality of individual storage units, for example, such as hard disk drives. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> With the increasing scale of computer storage systems, faster data processing, and increasing amounts of data, it is necessary for a storage control unit to have improved performance, reliability and availability. Typically, to improve reliability in a storage control unit, redundant components and connections are used. For example, a plurality of controllers or a plurality of ports is provided. </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> <cross-reference target="DRAWINGS">FIGS. 2 and 3</cross-reference> are examples of connections between a storage control unit and a storage unit. As shown in those figures, the storage control unit has a plurality of control units in communication with dual port structures, and is arranged such that two SCSI access paths from each control unit are connected to the storage units. In the figures, SCSI is an abbreviation of Small Computer System Interface and means an input/output interface comprising SCSI-1 and SCSI-2 where SCSI-1 and SCSI-2 have the same well known specifications, but SCSI-2 also takes into consideration a system in which SCSI-1 units and SCSI-2 units are both used. When it is unnecessary to distinguish SCSI-1 and SCSI-2, SCSI-1 or just SCSI, is used as a general term. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Another way of improving performance and availability is to use optical fiber channel technology to replace SCSI-1. For example, a technology which uses an optical fiber channel to connect a storage control unit to storage units is disclosed in Japanese patent publication 5-241984. As known from the prior art, all these technologies use an optical fiber channel to connect a storage control unit and a host computer. As such, no description of this type of connection is necessary here. Moreover, equipment in which a storage control unit is connected to a storage unit through an optical fiber channel has been introduced as a product. See the disk array system FC5000 made by Data General Corporation. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> The conventional means of providing dual access paths between a control unit and storage units is to employ a storage unit which has a plurality of input/output ports (e.g., a dual port magnetic disk device, a dual port magnetic disk unit or other multi-port storage units) so that two access paths are provided in one control unit. When either path fails, the other path is used as the access path. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> In a conventional connection structure between a storage control unit and multiple storage units, when trouble occurs on one path (for example, when SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>1</bold></highlight> breaks down in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>), access to the storage units connected to the failed path can be executed only through one path from SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>2</bold></highlight>; therefore, concurrent access from the control unit <highlight><bold>1</bold></highlight> to multiple storage units connected to the failed path through a dual path route is impossible. This means that a function using two data paths generally cannot be used in a mode in which a data transfer operation has priority and in which the dual paths are not continually provided. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, when SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>1</bold></highlight> fails, control unit <highlight><bold>1</bold></highlight> cannot access all the disk units connected to SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>1</bold></highlight>. As a result, access to a target disk unit is executed by control unit <highlight><bold>2</bold></highlight> which must process it through other communication means. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> Similarly, if both paths break down (for example, when SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>1</bold></highlight> and SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>2</bold></highlight> break down in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>), the control unit <highlight><bold>1</bold></highlight> cannot access all the storage units connected to SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>1</bold></highlight> and SCSI-1 port <highlight><bold>1</bold></highlight>-<highlight><bold>2</bold></highlight>. As a result, access to a target disk unit is executed by control unit <highlight><bold>2</bold></highlight> which must process it through other communication means (not shown). Thus, when a path breaks down, access to a target disk cannot be executed, communication processing between control units is required, and performance deteriorates. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> Further, if the dual access paths are made merely by providing two ports for connecting storage units using fiber channel control chips, etc., manufacturing cost increases. On the other hand, if a system uses one access path, a data transfer operation between the control unit and a plurality of storage units connected to this path that executes primarily by accessing two paths at the same time, cannot be performed and system performance deteriorates. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> One objective of the present invention is to provide a system structure where, in normal operation, distinctively constructed dual paths are used as data transfer paths to enable faster access and, when a path failure occurs, to allow continued access to data. The benefit of a dual path structure is provided and manufacturing cost is decreased. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> The present invention provides a system structure for a storage control unit having a plurality of control units, where even if a failure occurs on a path between the control unit and the storage units, the control unit itself can still access the target storage unit, minimizing the need to request another control unit to execute the processing. Another benefit of the present invention is that it provides a system structure in which access to a storage unit is processed with distributed access load in the control unit. According to the present invention, these objectives are accomplished by providing a storage control unit that has at least two control units, each of which has a plurality of connecting ports for connecting a plurality of storage units to the control units that manage them. Moreover, a storage control unit is connected to an external storage unit, by a connecting structure in which a connecting port in a first control unit is connected by an access path (transfer path) to a connecting port in a second control unit, and a second connecting port in the first control unit is connected by another access path to a second connecting port in said second control unit. The two paths are connected to a storage unit, and a plurality of such storage units are used. The storage unit includes a magnetic disk unit having a dual port input/output function. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> Furthermore, in the structure described above, the present invention provides a connecting structure in which a plurality of storage units connected to the two paths are specified as one group, and striping for a RAID structure is executed in this group. Although RAID means Redundant Array of Independent Disks, it does not necessarily mean a Redundant Array comprising independent disks. RAID systems refers to an external storage system which has a disk array structure of RAID. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> A first embodiment of the above-described structure is shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, in which each storage unit is connected to two parallel, vertical fiber channel loops, each row is a communicating group, and the plurality of groups are vertically arranged. The present invention provides a storage control unit that has at least two control units, each having a plurality of connecting ports for connecting a plurality of storage units to the control units managing these storage units, and each having a connecting structure between a storage control unit and an external storage unit, such that the first connecting port in the first control unit is connected by a fiber channel loop to the first connecting port in a second control unit, a second connecting port in the first control unit is connected by a second fiber channel loop to a second connecting port in the second control unit, the two fiber channel loops are connected to the first storage unit, and a plurality of such storage units is used. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> A second embodiment of the present invention provides a storage control unit which has at least two control units, each having a plurality of connecting ports for connecting a plurality of storage units to the control units managing these storage units, and each having a connecting structure between a storage control unit and an external storage unit, such that the first connecting port in the first control unit is connected by a SCSI-1 path to the first connecting port in a second control unit, a second connecting port in the first control unit is connected by a second SCSI-1 path to a second connecting port in said second control unit, the two SCSI-1 paths are connected to the first storage unit, and a plurality of such storage units is used. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> Furthermore, in the first embodiment, the present invention provides a connecting structure in which a plurality of storage units connected to the two fiber channel loops are specified as one group, and striping for a RAID structure is executed in this group. In the second embodiment, the present invention provides a connecting structure in which a plurality of storage units connected to said two SCSI-1 paths are specified as one group, and striping for a RAID structure is executed in this group.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram of an embodiment of the present invention, which shows the structure of the storage control unit in which the storage units are connected to the control units with fiber channel loops; </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a block diagram showing an example of a conventional dual-path structure which connects storage units to control units by SCSI paths; and </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a block diagram showing another example of a conventional dual-path structure which connects storage units to control units by SCSI paths.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DESCRIPTION OF THE SPECIFIC EMBODIMENTS </heading>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> Embodiments of the present invention are disclosed with reference to <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows an example of the structure of a storage control unit having two control units. This structure can be applied to storage control units having an even number of control units. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> The external storage unit <highlight><bold>110</bold></highlight> comprises storage units (a dual port magnetic disk device, a dual port magnetic disk unit or other multi-port storage units, etc.) from <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>to <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and from <highlight><bold>121</bold></highlight>-<highlight><italic>a </italic></highlight>to <highlight><bold>121</bold></highlight>-<highlight><italic>d</italic></highlight>, and two control units <highlight><bold>112</bold></highlight>, <highlight><bold>113</bold></highlight> which control these storage units. For purposes of illustration, only two RAID storage unit groups <highlight><bold>130</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>130</bold></highlight>-<highlight><italic>b </italic></highlight>are shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, but the invention is not limited to this number. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> The control units <highlight><bold>112</bold></highlight>, <highlight><bold>113</bold></highlight> are equipped with ports <highlight><bold>111</bold></highlight>-<highlight><italic>a</italic></highlight>, <highlight><bold>111</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>111</bold></highlight>-<highlight><italic>c</italic></highlight>, <highlight><bold>111</bold></highlight>-<highlight><italic>d </italic></highlight>for connection to a host computer(s) through a SCSI bus or other data transfer path (access path). Moreover, the control units <highlight><bold>112</bold></highlight>, <highlight><bold>113</bold></highlight> are also equipped with ports <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>114</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>115</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>115</bold></highlight>-<highlight><italic>d </italic></highlight>for connecting storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>121</bold></highlight>-<highlight><italic>d</italic></highlight>. The ports <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>114</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>115</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>115</bold></highlight>-<highlight><italic>d </italic></highlight>preferably are composed of fiber channel control chips, through which the storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>are connected. Instead of the fiber channel control chip, a SCSI control chip may be used for a SCSI structure. The chip is an integrated circuit which provides an electronic control circuit. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> Although the invention can use some fiber channel control chips, each of which supports a function of class 1 through class 4 and an intermix of such functions (described below), the present invention relates to the dual structure of the physical transfer path and the effect of the present invention is attained whether or not a function is provided independently of the function supported by the fiber channel control chip. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> Class 1 is a connection function in which a communication path is dedicated prior to data transfer and is adequate for point-to-point topology. Class 2 and class 3 are connectionless functions in which data is divided into several kilobytes, at maximum, and a header containing the divided data address is transferred. Class 2 and class 3 are adequate for such loop topology as FC AL (Fiber Channel-Arbitrated Loop). Because division of data is allowed and the data structure has an address-bearing header, class 2 and class 3 are adequate for data transfer in the back-end of a RAID-based setup (transfer between a control unit and a storage unit). In class 2, after arrival of the previous data is confirmed, the next data is transferred, but in class 3, this step is omitted. If a storage unit having a command queue function is used, the control chip of class 3 is suitable for an embodiment of the present invention. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> In intermix, when the bandwidth of the communication channel connected in class 1 has a margin, an operation in which the marginal bandwidth is allocated to class 2 or class 3 is executed. In class 4, a Quality of Service function (QOS) in which bandwidth is dedicated to multimedia transfer is realized. In class 4 a plurality of virtual channels can be set on a physical channel, but QOS differs from the present invention in that the present invention realizes the dual paths through a plurality of physical channels. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> In the storage control unit <highlight><bold>110</bold></highlight> having the structure described above, storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to control units <highlight><bold>112</bold></highlight>, <highlight><bold>113</bold></highlight> by fiber channels as follows. Fiber channel control chip <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>is connected to fiber channel control chip <highlight><bold>115</bold></highlight>-<highlight><italic>a </italic></highlight>through a fiber channel loop <highlight><bold>116</bold></highlight>. Similarly, fiber channel control chips <highlight><bold>114</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>114</bold></highlight>-<highlight><italic>c </italic></highlight>and <highlight><bold>114</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to fiber channel control chips <highlight><bold>115</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>115</bold></highlight>-<highlight><italic>c </italic></highlight>and <highlight><bold>115</bold></highlight>-<highlight><italic>d </italic></highlight>through fiber channels <highlight><bold>117</bold></highlight>, <highlight><bold>118</bold></highlight> and <highlight><bold>119</bold></highlight>, respectively. Storage units are connected between the channels, for example, units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>are connected through fiber channel loops <highlight><bold>116</bold></highlight> and <highlight><bold>117</bold></highlight>. Fiber channel loop <highlight><bold>124</bold></highlight> is the same as loop <highlight><bold>116</bold></highlight>, illustrating the connection of storage units in loops. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> Similarly, storage units <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>b </italic></highlight>are connected to fiber channel loops <highlight><bold>117</bold></highlight> and <highlight><bold>118</bold></highlight>, storage units <highlight><bold>120</bold></highlight>-<highlight><italic>c </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>c </italic></highlight>are connected to fiber channel loops <highlight><bold>118</bold></highlight> and <highlight><bold>119</bold></highlight>, and storage units <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to fiber channel loops <highlight><bold>119</bold></highlight> and <highlight><bold>124</bold></highlight>. Fiber channel loop <highlight><bold>124</bold></highlight> is the same as fiber channel loop <highlight><bold>116</bold></highlight>. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, in the example of storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>a</italic></highlight>, a storage unit group, which is horizontally arranged, may be connected to any two loops among the fiber channel loops <highlight><bold>116</bold></highlight>, <highlight><bold>117</bold></highlight>, <highlight><bold>118</bold></highlight>, <highlight><bold>119</bold></highlight>, and <highlight><bold>124</bold></highlight>/<highlight><bold>116</bold></highlight> in the embodiment of <cross-reference target="DRAWINGS">FIG. 1</cross-reference>; therefore, it is necessary that the storage unit be connected to parallel loops. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> In the storage control unit <highlight><bold>110</bold></highlight> described above, a group comprising storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a</italic></highlight>, <highlight><bold>120</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>120</bold></highlight>-<highlight><italic>c</italic></highlight>, and <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>wherein each storage unit is connected to different fiber channel loop, is identified as RAID group <highlight><bold>130</bold></highlight>-<highlight><italic>a</italic></highlight>. Similarly, a group comprising storage units <highlight><bold>121</bold></highlight>-<highlight><italic>a</italic></highlight>, <highlight><bold>121</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>121</bold></highlight>-<highlight><italic>c</italic></highlight>, and <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>is identified as RAID group <highlight><bold>130</bold></highlight>-<highlight><italic>b</italic></highlight>. Data is divided and stored in the storage units in the above-defined RAID groups. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> In a RAID system, data is divided (striping) into a plurality of specified data units (slots); then, when the data is accessed by a host unit, multiple access procedures are needed to retrieve data from the storage units. For example, when the long data is read out, the data is usually stored in a plurality of storage units. When new data is written over old data (updated), parity data is needed in addition to the separately striped write data, and the parity data is usually stored in a different storage unit from the one storing the striped data. When access to such data is required, the connecting structure described above is effective. </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> Next is a description of storage control unit <highlight><bold>110</bold></highlight> when the storage control unit has received a command for processing demand (hereinafter processing demand) from a host computer. As an example, when the storage control unit receives a write demand to storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>through port <highlight><bold>111</bold></highlight>-<highlight><italic>a</italic></highlight>, the control unit <highlight><bold>112</bold></highlight> receives the processing demand. </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> The control unit <highlight><bold>112</bold></highlight> manages the storage unit (assumed to be storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>here) in which is stored the parity data corresponding to the write data to be stored in the storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a</italic></highlight>. Moreover, control unit <highlight><bold>112</bold></highlight> also directs that storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>can be accessed through the two ports <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>114</bold></highlight>-<highlight><italic>b</italic></highlight>, and storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>can be accessed through the two ports <highlight><bold>114</bold></highlight>-<highlight><italic>b </italic></highlight>and <highlight><bold>114</bold></highlight>-<highlight><italic>c. </italic></highlight></paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> When the control unit <highlight><bold>112</bold></highlight> intends to access to storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>or <highlight><bold>120</bold></highlight>-<highlight><italic>b</italic></highlight>, the control unit preferably calculates the load of each port (the extent of processing required to access the storage unit through the port), then selects the port having the smallest load, and accesses the storage unit through that port. If either of the two ports connected to a storage unit has failed, the access is executed from the remaining functional port. If both of the ports have failed, control unit <highlight><bold>113</bold></highlight> is asked to execute the processing demand through another path, such as a communication means between the control units, and access to the storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>or <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>is executed. </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> When control unit <highlight><bold>113</bold></highlight> receives a processing request, it executes access to storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>or <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>in a similar way to the procedure described for control unit <highlight><bold>112</bold></highlight>. If three ports <highlight><bold>115</bold></highlight>-<highlight><italic>a</italic></highlight>, <highlight><bold>115</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>115</bold></highlight>-<highlight><italic>c </italic></highlight>have failed in control unit <highlight><bold>113</bold></highlight>, access to storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>or <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>cannot be executed, and the host computer sends an error message in response to the processing demand. </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> In the embodiment of <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, control unit <highlight><bold>112</bold></highlight> can use a first path through fiber channel control chip <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>and fiber control loop <highlight><bold>116</bold></highlight> to access target storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a</italic></highlight>. Furthermore, a second path through fiber channel control chip <highlight><bold>114</bold></highlight>-<highlight><italic>b </italic></highlight>and fiber channel loop <highlight><bold>117</bold></highlight> also can be used. Control unit <highlight><bold>112</bold></highlight> can use a first path through fiber control channel chip <highlight><bold>114</bold></highlight>-<highlight><italic>b </italic></highlight>and fiber channel loop <highlight><bold>117</bold></highlight> to access target storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>b</italic></highlight>. Furthermore, a second path through fiber channel control chip <highlight><bold>114</bold></highlight>-<highlight><italic>c </italic></highlight>and fiber channel loop <highlight><bold>118</bold></highlight> also can be used. </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> It should be noted that in <cross-reference target="DRAWINGS">FIG. 1 a</cross-reference> storage unit is connected to two parallel fiber channel loops; therefore, at least two different paths are allocated to each storage unit. Because of this arrangement, even when one path has failed, the target storage unit can be accessed from control unit <highlight><bold>112</bold></highlight> through the remaining functional path. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> Further, even when failures occur in two paths, for example in the fiber channel control chips <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>114</bold></highlight>-<highlight><italic>c</italic></highlight>, control unit <highlight><bold>112</bold></highlight> can access the target storage unit through the path connected to fiber channel control chip <highlight><bold>114</bold></highlight>-<highlight><italic>b</italic></highlight>. That is, in the connecting structure presented in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, even when failures have occurred in two nonconsecutive paths, if a functional path exists between these failed paths, the target storage unit can be accessed through this functional path. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> When failures have occurred in both paths to a target storage unit, for example, in both paths connected to fiber channel control chips <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>114</bold></highlight>-<highlight><italic>b</italic></highlight>, there is no functional path from control unit <highlight><bold>112</bold></highlight> to storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a</italic></highlight>, so access is executed by control unit <highlight><bold>113</bold></highlight> through a communication means between control unit <highlight><bold>112</bold></highlight> and control unit <highlight><bold>113</bold></highlight>. Accordingly, a host computer is connected to both control unit <highlight><bold>112</bold></highlight> and control unit <highlight><bold>113</bold></highlight>. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> The connecting structure of the present invention can also be realized by using a SCSI bus instead of the fiber channel loop connecting the storage units to the control unit. An embodiment using the SCSI bus is described next. Control chips <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>114</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>115</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>115</bold></highlight>-<highlight><italic>d </italic></highlight>are SCSI control chips. Other components are the same as those in the embodiment using the fiber channel control chip. However, the path need not be a loop. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> Storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>a </italic></highlight>through <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to control units <highlight><bold>112</bold></highlight> and <highlight><bold>113</bold></highlight> by a SCSI bus as follows. SCSI control chip <highlight><bold>114</bold></highlight>-<highlight><italic>a </italic></highlight>is connected to SCSI control chip <highlight><bold>115</bold></highlight>-<highlight><italic>a </italic></highlight>by SCSI bus <highlight><bold>116</bold></highlight>. Similarly, SCSI control chips <highlight><bold>114</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>114</bold></highlight>-<highlight><italic>c</italic></highlight>, <highlight><bold>114</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to SCSI control chips <highlight><bold>115</bold></highlight>-<highlight><italic>b</italic></highlight>, <highlight><bold>115</bold></highlight>-<highlight><italic>c</italic></highlight>, <highlight><bold>115</bold></highlight>-<highlight><italic>d </italic></highlight>by SCSI buses <highlight><bold>117</bold></highlight>, <highlight><bold>118</bold></highlight>, <highlight><bold>119</bold></highlight>, respectively. Using the SCSI bus described above, storage units <highlight><bold>120</bold></highlight>-<highlight><italic>a </italic></highlight>and <highlight><bold>120</bold></highlight>-<highlight><italic>b </italic></highlight>are connected to SCSI buses <highlight><bold>116</bold></highlight> and <highlight><bold>117</bold></highlight>, storage units <highlight><bold>120</bold></highlight>- and <highlight><bold>121</bold></highlight>-<highlight><italic>b </italic></highlight>are connected to SCSI buses <highlight><bold>117</bold></highlight> and <highlight><bold>118</bold></highlight>, storage units <highlight><bold>120</bold></highlight>-<highlight><italic>c </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>c </italic></highlight>are connected to SCSI buses <highlight><bold>118</bold></highlight> and <highlight><bold>119</bold></highlight>, and storage units <highlight><bold>120</bold></highlight>-<highlight><italic>d </italic></highlight>and <highlight><bold>121</bold></highlight>-<highlight><italic>d </italic></highlight>are connected to SCSI buses <highlight><bold>119</bold></highlight> and <highlight><bold>124</bold></highlight>. SCSI bus <highlight><bold>124</bold></highlight> is the same as SCSI bus <highlight><bold>116</bold></highlight>. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> In the embodiment of <cross-reference target="DRAWINGS">FIG. 1, a</cross-reference> storage unit <highlight><bold>120</bold></highlight>-<highlight><italic>a</italic></highlight>, <highlight><bold>121</bold></highlight>-<highlight><italic>a</italic></highlight>, etc., belonging to a storage unit group which is horizontally aligned, may be connected to any two of the SCSI buses <highlight><bold>116</bold></highlight>, <highlight><bold>117</bold></highlight>, <highlight><bold>118</bold></highlight>, <highlight><bold>119</bold></highlight>, <highlight><bold>124</bold></highlight>/<highlight><bold>116</bold></highlight>. The storage unit need not be connected to consecutively positioned buses. The embodiment of <cross-reference target="DRAWINGS">FIG. 1</cross-reference> describes a control unit having four fiber channel control chips or four SCSI control chips; however, the control unit of the present invention may have any number of fiber channel control chips or SCSI control chips. As described above, the path between the control unit and the storage unit is a dual path according to the present invention, and the path is used in common by the storage units: therefore, the effect of the dual paths can b obtained without increase of path. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> Furthermore, when the above-mentioned path structure in which the dual paths are formed and used in common is applied to an external storage unit (storage units corresponding to a RAID group), the effect of the RAID arrangement/structure is such that if a failure has occurred in a storage unit that is a component of the RAID group, the data can be recovered, can be made redundant while maintaining reliability and without increasing the number of paths. Furthermore, two access paths are connected to a storage unit by two control units and from each control unit; therefore, an effect that an access to a storage unit is processed with dispersing load of access generated in the control unit, can be obtained. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> The preceding has been a description of the preferred embodiment of the invention. It will be appreciated that deviations and modifications can be made without departing from the scope of the invention, which is defined by the appended claims. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A data storage system for connection to a host unit, the data storage system containing a plurality of storage units, and at least two storage control units located between the host unit and the storage units to transfer data between the host unit and the storage units, in which the storage control unit comprises: 
<claim-text>each of the at least two storage control units having a plurality of connecting ports to connect to the storage units; </claim-text>
<claim-text>a first transfer path by which the first connecting port in a first storage control unit is connected to a first connecting port in a second storage control unit; </claim-text>
<claim-text>a second transfer path by which a second connecting port in the first storage control unit is connected to a second connecting port in the second storage control unit; </claim-text>
<claim-text>a third transfer path by which a third connecting port in the first storage control unit is connected to a third connecting port in the second storage control unit; </claim-text>
<claim-text>a first group of storage units connected to both the first transfer path and the second transfer path; and </claim-text>
<claim-text>a second group of storage units connected to both the second transfer path and the third transfer path. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The storage system as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> in which the storage units comprise a magnetic disk unit with a dual input/output port. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The storage system as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> in which the first storage unit in the first group and the first storage unit in the second group constitute a RAID. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. The storage system as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> in which the first, the second, and the third transfer paths comprise fiber channels. </claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The storage system as claimed in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference> in which the first, the second, and the third transfer paths provide a SCSI function. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. An external storage unit for controlling transfers of data between a host unit and a plurality of storage units, comprising: 
<claim-text>a control unit which has a plurality of connecting ports to provide connections to the storage units; </claim-text>
<claim-text>first, second and third storage unit groups, each of which comprises a plurality of storage units; </claim-text>
<claim-text>a first transfer path by which a first connecting port in the control unit is connected to the first storage unit group; </claim-text>
<claim-text>a second transfer path by which a second connecting port in the control unit is connected to both the first storage unit group and the second storage unit group; and </claim-text>
<claim-text>a third transfer path by which a third connecting port in the control unit is connected to both the second storage unit group and the third storage unit group. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The storage control unit as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> in which the storage units comprise magnetic disk units having dual input/output ports. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The storage control unit as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> in which a first storage unit in the first storage unit group and a first storage unit in the second storage unit group constitute a RAID. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The storage control unit as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> in which the first, second, and third transfer paths comprise fiber channels. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The storage control unit as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> in which the first, second, and third transfer paths provide a SCSI function. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The storage control unit as claimed in <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference> in which a plurality of control units are provided, 
<claim-text>the first transfer path is connected to the first connecting port in the first control unit and to a first connecting port in a second control unit, </claim-text>
<claim-text>the second transfer path is connected to the second connecting port in the first control unit and to a second connecting port in the second control unit, and </claim-text>
<claim-text>the third transfer path is connected to the third connecting port in the first control unit and to a third connecting port in the second control unit.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030005220A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030005220A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030005220A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030005220A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
