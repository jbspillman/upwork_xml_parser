<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002736A1-20030102-M00001.NB SYSTEM "US20030002736A1-20030102-M00001.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00001.TIF SYSTEM "US20030002736A1-20030102-M00001.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-M00002.NB SYSTEM "US20030002736A1-20030102-M00002.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00002.TIF SYSTEM "US20030002736A1-20030102-M00002.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-M00003.NB SYSTEM "US20030002736A1-20030102-M00003.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00003.TIF SYSTEM "US20030002736A1-20030102-M00003.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-M00004.NB SYSTEM "US20030002736A1-20030102-M00004.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00004.TIF SYSTEM "US20030002736A1-20030102-M00004.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-M00005.NB SYSTEM "US20030002736A1-20030102-M00005.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00005.TIF SYSTEM "US20030002736A1-20030102-M00005.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-M00006.NB SYSTEM "US20030002736A1-20030102-M00006.NB" NDATA NB>
<!ENTITY US20030002736A1-20030102-M00006.TIF SYSTEM "US20030002736A1-20030102-M00006.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00000.TIF SYSTEM "US20030002736A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00001.TIF SYSTEM "US20030002736A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00002.TIF SYSTEM "US20030002736A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00003.TIF SYSTEM "US20030002736A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00004.TIF SYSTEM "US20030002736A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00005.TIF SYSTEM "US20030002736A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00006.TIF SYSTEM "US20030002736A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00007.TIF SYSTEM "US20030002736A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00008.TIF SYSTEM "US20030002736A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00009.TIF SYSTEM "US20030002736A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00010.TIF SYSTEM "US20030002736A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00011.TIF SYSTEM "US20030002736A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00012.TIF SYSTEM "US20030002736A1-20030102-D00012.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00013.TIF SYSTEM "US20030002736A1-20030102-D00013.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00014.TIF SYSTEM "US20030002736A1-20030102-D00014.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00015.TIF SYSTEM "US20030002736A1-20030102-D00015.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00016.TIF SYSTEM "US20030002736A1-20030102-D00016.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00017.TIF SYSTEM "US20030002736A1-20030102-D00017.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00018.TIF SYSTEM "US20030002736A1-20030102-D00018.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00019.TIF SYSTEM "US20030002736A1-20030102-D00019.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00020.TIF SYSTEM "US20030002736A1-20030102-D00020.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00021.TIF SYSTEM "US20030002736A1-20030102-D00021.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00022.TIF SYSTEM "US20030002736A1-20030102-D00022.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00023.TIF SYSTEM "US20030002736A1-20030102-D00023.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00024.TIF SYSTEM "US20030002736A1-20030102-D00024.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00025.TIF SYSTEM "US20030002736A1-20030102-D00025.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00026.TIF SYSTEM "US20030002736A1-20030102-D00026.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00027.TIF SYSTEM "US20030002736A1-20030102-D00027.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00028.TIF SYSTEM "US20030002736A1-20030102-D00028.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00029.TIF SYSTEM "US20030002736A1-20030102-D00029.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00030.TIF SYSTEM "US20030002736A1-20030102-D00030.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00031.TIF SYSTEM "US20030002736A1-20030102-D00031.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00032.TIF SYSTEM "US20030002736A1-20030102-D00032.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00033.TIF SYSTEM "US20030002736A1-20030102-D00033.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00034.TIF SYSTEM "US20030002736A1-20030102-D00034.TIF" NDATA TIF>
<!ENTITY US20030002736A1-20030102-D00035.TIF SYSTEM "US20030002736A1-20030102-D00035.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002736</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10170626</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020614</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>2001-180642</doc-number>
</priority-application-number>
<filing-date>20010614</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>G06K009/00</ipc>
</classification-ipc-primary>
<classification-ipc-secondary>
<ipc>G06K009/40</ipc>
</classification-ipc-secondary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>382</class>
<subclass>168000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>382</class>
<subclass>274000</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Automatic tone correction apparatus, automatic tone correction method, and automatic tone correction program storage mediums</title-of-invention>
</technical-information>
<inventors>
<first-named-inventor>
<name>
<given-name>Kazutaka</given-name>
<family-name>Maruoka</family-name>
</name>
<residence>
<residence-non-us>
<city>Saijyo-shi</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Fumio</given-name>
<family-name>Fujimura</family-name>
</name>
<residence>
<residence-non-us>
<city>Saijyo-shi</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<correspondence-address>
<name-1>WENDEROTH, LIND &amp; PONACK, L.L.P.</name-1>
<name-2></name-2>
<address>
<address-1>2033 K STREET N. W.</address-1>
<address-2>SUITE 800</address-2>
<city>WASHINGTON</city>
<state>DC</state>
<postalcode>20006-1021</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">An automatic tone correction apparatus comprises a luminance distribution formation circuit for forming a luminance histogram of an input image; a center-of-gravity calculation circuit for calculating the center of gravity of a low-luminance part of the luminance histogram; a distribution range calculation circuit for calculating a maximum value and a minimum value on an input luminance level axis; a target value storage circuit for holding a luminance correction target value; a correction table formation circuit for forming a correction table for expanding the luminance distribution and, simultaneously, correcting the luminance histogram so that the center of gravity matches the luminance correction target value; and an image signal correction circuit for performing tone correction on the basis of the correction table. Therefore, whether the input image is a forward-light image or a back-lighted image, the apparatus performs tone correction using the same processing. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">FIELD OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> The present invention relates to automatic tone correction apparatuses, automatic tone correction methods, and automatic tone correction program storage mediums. To be specific, the invention relates to an improved digital image processing apparatus that can correct an input image, more specifically, that can automatically correct tones of an input image. </paragraph>
</section>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> As a conventional technique for automatically correcting tones of an image, a method as follows has been well known. That is, a luminance value or a density value of each pixel of an input image is calculated, a histogram indicating the sum of pixels having the same value is formed, and all pixels are subjected to such a correction process that optimizes the shape of the histogram. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> For example, Japanese Published Patent Application No. Hei.6-268866 discloses a method for performing correction using a histogram as mentioned above. The method disclosed in this literature will be described with reference to FIGS. <highlight><bold>40</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>40</bold></highlight>(<highlight><italic>c</italic></highlight>). In the following description, it is assumed that each pixel of a digital image has a density value ranging from &ldquo;0&rdquo; to &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> Initially, a density value of each pixel is calculated from a digital image signal, and a density histogram indicating the sum of pixels having the same density value is formed. An example of this histogram is shown in <cross-reference target="DRAWINGS">FIG. 40</cross-reference>(<highlight><italic>a</italic></highlight>). Next, assuming that the minimum density value of the created density histogram is dmin, the maximum density value is dmax, the number of pixels having a pixel density d is F1&lsqb;d&rsqb;, and the number of pixels after conversion is F2&lsqb;d&rsqb;, a histogram which is corrected so as to expand a pixel density distribution area over the whole pixel luminance (refer to <cross-reference target="DRAWINGS">FIG. 40</cross-reference>(<highlight><italic>b</italic></highlight>)) is formed according to formula (1) as follows and, simultaneously, a point (center of gravity) G which divides the area of the histogram into two equal parts is calculated. Thereafter, as shown in <cross-reference target="DRAWINGS">FIG. 40</cross-reference>(<highlight><italic>c</italic></highlight>), a &ggr; value at which the center of gravity G is positioned in the center of the density range is obtained. Assuming that the number of pixels after conversion of the F2&lsqb;d&rsqb; is expressed by F3&lsqb;d&rsqb;, a histogram which is subjected to &ggr; correction is formed according to formula (2) as follows, and correction is carried out on the basis of the histogram. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>F</italic></highlight>2<highlight><italic>&lsqb;d&rsqb;&equals;F</italic></highlight>1&lsqb;<highlight><italic>d</italic></highlight>&times;&lcub;(<highlight><italic>d</italic></highlight>max&minus;<highlight><italic>d</italic></highlight>min)/255<highlight><italic>&plus;d</italic></highlight>min&rcub;&rsqb;&emsp;&emsp;(1) </in-line-formula> 
<math-cwu id="MATH-US-00001">
<number>1</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>F3</mi>
          <mo>&af;</mo>
          <mrow>
            <mo>[</mo>
            <mi>d</mi>
            <mo>]</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mi>F2</mi>
          <mo>[</mo>
          <msup>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mi>d</mi>
                <mo>/</mo>
                <mn>256</mn>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mfrac>
              <mn>1</mn>
              <mi>&gamma;</mi>
            </mfrac>
          </msup>
          <mo>]</mo>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>2</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00001" file="US20030002736A1-20030102-M00001.NB"/>
<image id="EMI-M00001" wi="216.027" he="15.11055" file="US20030002736A1-20030102-M00001.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> In this way, the distribution of pixel densities is expanded over all tones, evenly from the center tone to the both sides, whereby the brightness is adjusted so that the center of gravity of the density distribution is positioned in the center. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> Meanwhile, Japanese Published Patent Application No. 2000-102033 discloses another method for performing tone correction on an image using a histogram. This method will be described with reference to <cross-reference target="DRAWINGS">FIG. 41</cross-reference>. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> In this method, an input luminance level axis, which is calculated for a luminance histogram generated from a digital image signal, is divided into equal n regions (n: integer that satisfies n&gt;3), and feature parameters, such as a ratio of the number of pixels in each region to all pixels, a ratio of the number of pixels in each region exceeding a predetermined limit value to all pixels, and a radio of the number of pixels in each of three equal regions into which the input luminance-level axis is divided, are captured (step <highlight><bold>2501</bold></highlight>). Next, various kinds of curve data which have previously been formed are captured (step <highlight><bold>2502</bold></highlight>). Then, the process is branched into different processes (case branching) in step <highlight><bold>2503</bold></highlight> and step <highlight><bold>2505</bold></highlight> on the basis of the feature parameters, and a tone correction curve is formed from the feature parameters and curve data, which are captured in steps <highlight><bold>2501</bold></highlight> and <highlight><bold>2502</bold></highlight>, by under processing (step <highlight><bold>2504</bold></highlight>), over processing (step <highlight><bold>2506</bold></highlight>), or linear processing (step <highlight><bold>2507</bold></highlight>), and tone correction curve data is stored (step <highlight><bold>2508</bold></highlight>). Then, tone correction is carried out on the basis of the tone correction curve so obtained. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> That is, in this method, the correction process is branched into different processes according to the shape of the luminance histogram of the input image, and a tone correction curve is formed by a process most suited to the input image, and then tone correction is carried out on the basis of the tone correction curve. </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> As described above, according to the tone correction method disclosed in Japanese Published Patent Application No. Hei.6-268866, even when an input image includes a lot of halftones, a sharp-contrast image can be obtained. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> On the other hand, according to the tone correction method disclosed in Japanese Published Patent Application No. 2000-102033, an image of improved quality is obtained as compared with the case of using the accumulated luminance distribution as it is. Further, since the correction process can be implemented by software, it can easily deal with an alteration of image data or the like. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> However, the tone correction method disclosed in Japanese Published Patent Application No. Hei.6-268866 has a drawback as follows. Although, in this method, &ggr; correction is carried to bring the center of gravity of the histogram to the center of tones, when two peaks are generated on the low-tone side and the high-tone side of the histogram as in a back-lighted imager correction is hardly carried out because the center of gravity of the histogram is originally positioned in the vicinity of the center tone. Consequently, the back-lighted area of the image is not corrected at all. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> Furthermore, as for a natural image such as a scenic shot, a natural image having a histogram the center of gravity of which is in the vicinity of the center tone is not always beautiful. For example, when an image including a person who wears black clothes is corrected, the clothes unfavorably turn to gray. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> On the other hand, in the tone correction method disclosed in Japanese Published Patent Application No. 2000-102033, appropriate tone correction is carried out by branching the correction process according to the shape of the luminance histogram of the input image. In this method, however, accurate case branching is required, whereby the process is complicated and the volume of calculation is increased. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> Moreover, different correction processes must be prepared for the respective cases, whereby the required storage capacity is increased, and the scale of the correction apparatus is increased, resulting in an increase in costs. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> Furthermore, in the above-described methods, when a person exists in the center of the image and the area occupied by the person is small, since information of the person is hardly included in the histogram, an unintended correction is carried out, whereby a skin color region such as a face, which is visually conspicuous, occurs halation. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> The present invention is made to solve the above-described problems and has for its object to provide an automatic tone correction apparatus, an automatic tone correction method, and an automatic tone correction program storage medium, that can realize satisfactory correction for a back-lighted image without collapsing a high-luminance part of the image, that can optimize the contrast and brightness of a forward-lighted image by the same processing as that for the back-lighted image, and that can suppress unintended correction. </paragraph>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> Other objects and advantages of the invention will become apparent from the detailed description that follows. The detailed description and specific embodiments described are provided only for illustration since various additions and modifications within the scope of the invention will be apparent to those of skill in the art from the detailed description. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> According to a 1st aspect of the present invention, an automatic tone correction apparatus comprises: a luminance histogram formation unit for forming a luminance histogram of a digital image; a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction unit for forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and performing tone correction using the correction table, thereby expanding the luminance distribution and, simultaneously, matching the center of gravity of the low-luminance part of the luminance histogram to the luminance correction target value. Therefore, a back-lighted image can be brightly corrected so that the luminance value of a low-luminance region in the back-lighted state is brought to a target luminance value, thereby obtaining an image the whole contrast of which is enhanced Further, also a forward-lighted image can be corrected so that the luminance value of a low-luminance region is brought to a target luminance value, resulting in an image the whole contrast of which is enhanced. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> According to a 2nd aspect of the present invention, in the automatic tone correction apparatus according to the 1st aspect, a restriction is put on the amount of correction in the tone correction. Therefore, even when the luminance correction target value is not an optimum value, the property of the original image is prevented from being damaged significantly. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> According to a 3rd aspect of the present invention, in the automatic tone correction apparatus according to the first aspect, the luminance correction target value to be used in the tone correction is previously set according to the position of the center of gravity. Therefore, a work of setting a luminance correction target value for every input image is dispensed with. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> According to a 4th aspect of the present invention, an automatic tone correction apparatus comprises: a luminance histogram formation unit for forming a luminance histogram of a digital image; a target value calculation unit for calculating a luminance correction target value from a target luminance distribution; a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction unit for forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and the luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. Therefore, an image having a target brightness and an enhanced contrast as a whole can be obtained using a target luminance distribution of the same shape for a forward-lighted image and a back-lighted image. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> According to a 5th aspect of the present invention, in the automatic tone correction apparatus according to the 4th aspect, when performing the tone correction, the target value calculation unit sets a target luminance distribution with a curve. Therefore, setting of a target luminance distribution is facilitated, whereby the storage capacity is reduced. </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> According to a 6th aspect of the present invention, in the automatic tone correction apparatus according to the 4th aspect, when performing the tone correction, the target value calculation unit sets a plurality of target luminance distributions, and stores them. Therefore, the luminance correction target value can be easily adjusted. </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> According to a 7th aspect of the present invention, an automatic tone correction apparatus comprises: a luminance histogram formation unit for forming a luminance histogram of a digital image; a boundary value calculation unit for calculating a boundary value for determining a low-luminance part of the luminance histogram; a center-of-gravity calculation unit for calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated by the boundary value calculation unit; and a tone correction unit for forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. Therefore, in a back-lighted image, a low-luminance part including a back-lighted region is correctly calculated, whereby the luminance value of the back-lighted region is corrected to a target luminance value more accurately. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> According to an 8th aspect of the present invention, in the automatic tone correction apparatus according to the 7th aspect, when performing the tone correction, the boundary value calculation unit divides a luminance range into plural regions, and calculates a boundary value from the feature parameters of the respective regions. Therefore, a boundary value that accurately separates the high-luminance side and the low-luminance side is obtained. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> According to a 9th aspect of the present invention, in the automatic tone correction apparatus according to the 8th aspect, when performing the tone correction, the boundary value calculation unit divides the luminance range into two regions, and a center of gravity calculated on the lower luminance side is used as the center of gravity of the low-luminance part of the luminance histogram. Therefore, the tones can be corrected without recalculating the center of gravity of the low-luminance part. </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> According to a 10th aspect of the present invention, an automatic tone correction apparatus comprises: a luminance histogram formation unit for forming a luminance histogram of a digital image; a mountain-shape distribution detection unit for detecting a range of a mountain-shape distribution of the luminance histogram; a boundary value calculation unit for calculating a boundary value for determining a low-luminance part of the luminance histogram from the range of the mountain-shape distribution detected by the mountain-shape distribution detection unit; a center-of-gravity calculation unit for calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated by the boundary value calculation unit; and a tone correction unit for forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. Therefore, when the input image is a back-lighted image, it is corrected so as to have a target brightness and, simultaneously, the whole contrast is enhanced. On the other hand, when the input image is a forward-lighted image, the contrast is enhanced without changing the original brightness. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> According to an 11th aspect of the present invention, in the automatic tone correction apparatus according to the 10th aspect, when performing the tone correction, the boundary value calculation unit sets the boundary value calculated from the range of the mountain-shape distribution, using the luminance histogram. Therefore, a more accurate boundary value can be calculated. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> According to a 12th aspect of the present invention, in the automatic tone correction apparatus according to the 10th aspect, when performing the tone correction, the mountain-shape distribution detection unit puts a restriction on the range of the mountain-shape distribution. Therefore, even when the input image is a forward-lighted image, the brightness of the image can be corrected. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> According to a 13th aspect of the present invention, an automatic tone correction apparatus comprises: a luminance histogram formation unit for forming a luminance histogram of a digital image; a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and a target value correction unit for correcting a luminance correction target value, that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and a tone correction unit for forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and the luminance correction target value, and using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value which is corrected or not corrected by the target value correction unit. Therefore, it is prevented that the corrected image becomes darker than the input image. </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> According to a 14th aspect of the present invention, in the automatic tone correction apparatus according to the 13th aspect, when performing the tone correction, if the luminance correction target value is larger than the center of gravity of the low-luminance part of the luminance histogram, the target value correction unit corrects the luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram. Therefore, it is prevented that the corrected image becomes brighter than the input image. </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> According to a 15th aspect of the present invention, in the automatic tone correction apparatus according to the 13th or 14th aspect, when performing the tone correction, the luminance correction target value is corrected so that the target value becomes a value in the vicinity of the center of gravity of the low-luminance part of the luminance histogram. Therefore, the corrected brightness can be minutely adjusted on the basis of the brightness of the input image. </paragraph>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> According to a 16th aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st to 14th aspects, when performing the tone correction, the distribution of the luminance histogram is expanded only toward the low-luminance side and, simultaneously, the luminance histogram is corrected so that the center of gravity of the luminance histogram matches the luminance correction target value. Therefore, tone correction can be carried out without collapsing the high-luminance part. </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> According to a 17th aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, the tone correction unit performs the tone correction by executing &ggr; correction. Therefore, matching of the center of gravity of the low-luminance part of the luminance histogram to the target value is realized by just once formation of a conversion table. </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> According to an 18th aspect of the present invention, in the go automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, the tone correction unit forms the correction table so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. Therefore, matching of the center of gravity of the low-luminance part of the luminance histogram to the target value is realized by just once formation of a conversion table. </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> According to a 19th aspect of the present invention, the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects further comprises a luminance distribution expansion unit for expanding the luminance distribution of the luminance histogram formed by the luminance histogram formation unit; and the center-of-gravity calculation unit calculates the center of gravity of the low-luminance part of the luminance histogram in which the luminance distribution is expanded. Therefore, automatic tone correction is realized by performing the process of matching the center of gravity of the low-luminance part to the target value, after expanding the luminance distribution of the luminance histogram. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> According to a 20th aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. Therefore, even when the tone distribution of the luminance histogram concentrates on a certain portion, the amount of correction can be accurately calculated. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> According to a 21st aspect of the present invention, the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects further comprises a skin color region extraction unit for extracting a skin color region from color-difference signals and a luminance signal; and when forming the luminance histogram, the luminance distribution of a skin color portion of the image is added to the luminance distribution of the whole image according to the area of the skin color region. Therefore, when a person exists in the image, tone correction can be carried out so that the brightness of the skin color is optimized according to the area of the person. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> According to a 22nd aspect of the present invention, in the automatic tone correction apparatus according to the 21st aspect, when the luminance distribution of the skin color portion of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance part of the skin color portion is weighted. Therefore, halation of the skin color is minimized. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> According to a 23rd aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated by the luminance histogram formation unit, and an amount of tone correction on the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. Therefore, halation of the high-luminance part is minimized. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> According to a 24th aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, tone correction is not carried out when the luminance distribution is discrete. Therefore, tone correction is not performed on an image that needs no tone correction. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> According to a 25th aspect of the present invention, in the automatic tone correction apparatus according to any of the 1st, 4th, 7th, 10th, and 13th aspects, color-difference signals of the image are corrected according to the correction table. Therefore, such a phenomenon that the saturation appears degraded due to luminance correction is suppressed. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> According to a 26th aspect of the present invention, an automatic tone correction method for correcting tones of a digital image comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, a back-lighted image can be brightly corrected so that the luminance value of a low-luminance region in the back-lighted state is brought to a target luminance value, thereby obtaining an image the whole contrast of which is enhanced. Further, also a forward-lighted image can be corrected so that the luminance value of a low-luminance region is brought to a target luminance value, resulting in an image the whole contrast of which is enhanced. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> According to a 27th aspect of the present invention, in the automatic tone correction method according to the 26th aspect, in the tone correction step, a restriction is put on the amount of correction. Therefore, even when the luminance correction target value is not an optimum value, the property of the original image is prevented from being damaged significantly. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> According to a 28th aspect of the present invention, in the automatic tone correction method according to the 26th aspect, the luminance correction target value to be used in the tone correction step is previously set according to the position of the center of gravity. Therefore, a work of setting a luminance correction target value for every input image is dispensed with. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> According to a 29th aspect of the present invention, an automatic tone correction method for correcting tones of a digital image comprises: a target value calculation step of calculating a luminance correction target value from a target luminance distribution; a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value that is calculated in the target value calculation step. Therefore, an image having a target brightness and an enhanced contrast as a whole can be obtained using a target luminance distribution of the same shape for a forward-lighted image and a back-lighted image. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> According to a 30th aspect of the present invention, in the automatic tone correction method according to the 29th aspect, in the target value calculation step, a target luminance distribution is set with a curve. Therefore, setting of a target luminance distribution is facilitated, whereby the storage capacity is reduced. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> According to a 31st aspect of the present invention, in the automatic tone correction method according to the 29th aspect, in the target value calculation step, a plurality of target luminance distributions are stored. Therefore, the luminance correction target value can be easily adjusted. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> According to a 32nd aspect of the present invention, an automatic tone correction method for correcting tones of a digital image comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a boundary value calculation step of calculating a boundary value for setting a range of a low-luminance part of the luminance histogram; a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, in a back-lighted image, a low-luminance part including a back-lighted region is correctly calculated, whereby the luminance value of the back-lighted region is corrected to a target luminance value more accurately. </paragraph>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> According to a 33rd aspect of the present invention, in the automatic tone correction method according to the 32nd aspect, in the boundary value calculation step, a luminance range is divided into plural regions, and a boundary value is calculated from feature parameters of the respective regions. Therefore, a boundary value that accurately separates the high-luminance side and the low-luminance side is obtained. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> According to a 34th aspect of the present invention, in the automatic tone correction method according to the 33rd aspect, in the boundary value calculation step, the luminance range is divided into two regions, and a center of gravity calculated on the lower-luminance side is used as the center of gravity of the low-luminance part of the luminance histogram. Therefore, the tones can be corrected without recalculating the center of gravity of the low-luminance part. </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> According to a 35th aspect of the present invention, an automatic tone correction method for correcting tones of a digital image comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a mountain-shape distribution detection step of detecting a range of a mountain-shape distribution of the luminance histogram; a boundary value calculation step of calculating a boundary value for setting a low-luminance part of the luminance histogram, from the range of the mountain-shape distribution detected in the mountain-shape distribution detection step; a center-of-gravity calculation step of calculating a center of gravity or the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, when the input image is a back-lighted image, it is corrected so as to have a target brightness and, simultaneously, the whole contrast is enhanced. On the other hand, when the input image is a forward-lighted image, the contrast is enhanced without changing the original brightness. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> According to a 36th aspect of the present invention, in the automatic tone correction method according to the 35th aspect, in the boundary value calculation step, the boundary value calculated from the range of the mountain-shape distribution is set by using the luminance histogram. Therefore, a more accurate boundary value can be calculated. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> According to a 37th aspect of the present invention, in the automatic tone correction method according to the 35th aspect, in the mountain-shape distribution detection step, a restriction is put on the range of the mountain-shape distribution. Therefore, even when the input image is a forward-lighted image, the brightness of the image can be corrected. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> According to a 38th aspect of the present invention, an automatic tone correction method for correcting tones of a digital image comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; a target value correction step of correcting a luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated in the center-of-gravity calculation step, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the uncorrected luminance correction target value when correction of the target value is not performed, or it matches the corrected luminance correction target value when correction of the target value is performed. Therefore, it is prevented that the corrected image becomes darker than the input image. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> According to a 39th aspect of the present invention, in the automatic tone correction method according to the 38th aspect, in the target value correction step, when the luminance correction target value is larger than the center of gravity of the low-luminance part of the luminance histogram, the luminance correction target value is corrected so that the target value matches the center of gravity of the low luminance part of the luminance histogram. Therefore, it is prevented that the corrected image becomes brighter than the input image. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> According to a 40th aspect of the present invention, in the automatic tone correction method according to the 38th or 39th aspect, the luminance correction target value is corrected so that the target value becomes a value in the vicinity of the center of gravity of the low-luminance part of the luminance histogram. Therefore, the corrected brightness can be minutely adjusted on the basis of the brightness of the input image. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> According to a 41st aspect of the present invention, in the automatic tone correction method according to any of the 26th to 40th aspects, the distribution of the luminance histogram is expanded only toward the lower-luminance side and, simultaneously, the luminance histogram is corrected so that the center of gravity of the luminance histogram matches the luminance correction target value. Therefore, tone correction can be carried out without collapsing the high-luminance part. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> According to a 42nd aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, the tone correction step is performed by executing &ggr; correction. Therefore, matching of the center of gravity of the low-luminance part of the luminance histogram to the target value is realized by just once formation of a conversion table. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> According to a 43rd aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, in the tone correction step, a correction table is formed so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. Therefore, matching of the center of gravity of the low-luminance part of the luminance histogram to the target value is realized by just once formation of a conversion table. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> According to a 44th aspect of the present invention, the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects further comprises a luminance distribution expansion step of expanding the luminance distribution of the luminance histogram, between the luminance histogram formation step and the center-of-gravity calculation step; and, in the center-of-gravity calculation step, calculation of a center of gravity is performed on the low-luminance part of the luminance histogram in which the luminance distribution is expanded. Therefore, automatic tone correction is realized by performing the process of matching the center of gravity of the low-luminance part to the target value, after expanding the luminance distribution of the luminance histogram. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> According to a 45th aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. Therefore, even when the tone distribution of the luminance histogram concentrates on a certain portion, the amount of correction can be accurately calculated. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> According to a 46th aspect of the present invention, the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects further comprises a skin color region extraction step of extracting a skin color region from color-difference signals and a luminance signal; and, in the luminance histogram formation step, a luminance histogram, in which the luminance distribution of a skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, is formed. Therefore, when a person exists in the image, tone correction can be carried out so that the brightness of the skin color is optimized according to the area of the person. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> According to a 47th aspect of the present invention, in the automatic tone correction method according to the 46th aspect, when the luminance distribution of the skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance portion of the skin color part is weighted. Therefore, halation of the skin color is minimized. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> According to a 48th aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated in the luminance histogram formation step, and an amount of tone correction for the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. Therefore, halation of the high-luminance part is minimized. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> According to a 49th aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, in the tone correction, tone correction is not carried out when the luminance distribution is discrete. Therefore, tone correction is not performed on an image that needs no tone correction. </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> According to a 50th aspect of the present invention, in the automatic tone correction method according to any of the 26th, 29th, 32nd, 35th, and 38th aspects, color-difference signals of the image are corrected according to the correction table. Therefore, such a phenomenon that the saturation appears degraded due to luminance correction is suppressed. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> According to a 51st aspect of the present invention, there is provided an automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, wherein the automatic tone correction method comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, a back-lighted image can be brightly corrected so that the luminance value of a low-luminance region in the back-lighted state is brought to a target luminance value, thereby obtaining an image the whole contrast of which is enhanced. Further, also a forward-lighted image can be corrected so that the luminance value of a low-luminance region is brought to a target luminance value, resulting in an image the whole contrast of which is enhanced. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> According to a 52nd aspect of the present invention, there is provided an automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, wherein the automatic tone correction method comprises: a target value calculation step of calculating a luminance correction target value from a target luminance distribution; a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value that is calculated in the target value calculation step. Therefore, an image having a target brightness and an enhanced contrast as a whole can be obtained using a target luminance distribution of the same shape for a forward-lighted image and a back-lighted image. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> According to a 53rd aspect of the present invention, there is provided an automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is recorded, wherein the automatic tone correction method comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a boundary value calculation step of calculating a boundary value for setting a range of a low-luminance part of the luminance histogram; a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, in a back-lighted image, a low-luminance part including a back-lighted region is correctly calculated, whereby the luminance value of the back-lighted region is corrected to a target luminance value more accurately. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> According to a 54th aspect of the present invention, there is provided an automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, wherein the automatic tone correction method comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a mountain-shape distribution detection step of detecting a range of a mountain-shape distribution of the luminance histogram; a boundary value calculation step of calculating a boundary value for setting a low-luminance part of the luminance histogram, from the range of the mountain-shape distribution detected in the mountain-shape distribution detection step; a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. Therefore, when the input image is a back-lighted image, it is corrected so as to have a target brightness and, simultaneously, the whole contrast is enhanced. On the other hand, when the input image is a forward-lighted image, the contrast is enhanced without changing the original brightness. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> According to a 55th aspect of the present invention, there is provided an automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, wherein the automatic tone correction method comprises: a luminance histogram formation step of forming a luminance histogram of the digital image; a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; a target value correction step of correcting a luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated in the center-of-gravity calculation step, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the uncorrected luminance correction target value when correction of the target value is not performed, or it matches the corrected luminance correction target value when correction of the target value is performed. Therefore, it is prevented that the corrected image becomes darker than the input image. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> According to a 56th aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, in the tone correction step, a correction table is formed so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. Therefore, matching of the center of gravity of the low-luminance part of the luminance histogram to the target value is realized by just once formation of a conversion table. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> According to a 57th aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, the automatic tone correction method further comprises a luminance distribution expansion step of expanding the luminance distribution of the luminance histogram, between the luminance histogram formation step and the center-of-gravity calculation step; and in the center-of-gravity calculation step, calculation of a center of gravity is performed on the low-luminance part of the luminance histogram in which the luminance distribution is expanded. Therefore, automatic tone correction is realized by performing the process of matching the center of gravity of the low-luminance part to the target value, after expanding the luminance distribution of the luminance histogram. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> According to a 58th aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. Therefore, even when the tone distribution of the luminance histogram concentrates on a certain portion, the amount of correction can be accurately calculated. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> According to a 59th aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, the automatic tone correction method further comprises a skin color region extraction step of extracting a skin color region from color-difference signals and a luminance signal; and in the luminance histogram formation step, a luminance histogram, in which the luminance distribution of a skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, is formed. Therefore, when a person exists in the image, tone correction can be carried out so that the brightness of the skin color is optimized according to the area of the person. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> According to a 60th aspect of the present invention, in the automatic tone correction program storage medium according to the 59th aspect, when the luminance distribution of the skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance portion of the skin color part is weighted. Therefore, halation of the skin color is minimized. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> According to a 61st aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated in the luminance histogram formation step, and an amount of tone correction for the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. Therefore, halation of the high-luminance part is minimized. </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> According to a 62nd aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, tone correction is not carried out when the luminance distribution is discrete. Therefore, tone correction is not performed on an image that needs no tone correction. </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> According to a 63rd aspect of the present invention, in the automatic tone correction program storage medium according to any of the 51st to 55th aspects, color-difference signals of the image are corrected according to the correction table. Therefore, such a phenomenon that the saturation appears degraded due to luminance correction is suppressed.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to a first embodiment of the present invention. </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> FIGS. <highlight><bold>2</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>2</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating luminance histograms of a forward-lighted image and a back-lighted image, respectively. </paragraph>
<paragraph id="P-0083" lvl="0"><number>&lsqb;0083&rsqb;</number> FIGS. <highlight><bold>3</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>3</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining a tone correcting process according to the first embodiment. </paragraph>
<paragraph id="P-0084" lvl="0"><number>&lsqb;0084&rsqb;</number> FIGS. <highlight><bold>4</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>4</bold></highlight>(<highlight><italic>b</italic></highlight>) are flowcharts illustrating a tone correcting process and its principle according to the first embodiment, respectively. </paragraph>
<paragraph id="P-0085" lvl="0"><number>&lsqb;0085&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a graph in which a correction table is set with a straight line. </paragraph>
<paragraph id="P-0086" lvl="0"><number>&lsqb;0086&rsqb;</number> FIGS. <highlight><bold>6</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>6</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams for explaining setting of a correction table according to the frequency of distribution of a luminance histogram. </paragraph>
<paragraph id="P-0087" lvl="0"><number>&lsqb;0087&rsqb;</number> FIGS. <highlight><bold>7</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>7</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams for explaining calculation of an amount of correction in a high-luminance part according to the center of gravity of the high-luminance part. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a graph illustrating a correction table for matching the center of gravity of the low-luminance part to a target value. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a diagram illustrating a discrete histogram. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a block diagram illustrating an automatic tone correction apparatus as defined in claim 21. </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> FIGS. <highlight><bold>11</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>11</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating skin color regions. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> FIGS. <highlight><bold>12</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>12</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining application of a weight on a skin color luminance histogram. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a graph illustrating a weight value on the high-luminance part. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a block diagram illustrating an automatic tone correction apparatus as defined in claim 25. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a graph illustrating a luminance conversion table. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> FIGS. <highlight><bold>16</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>16</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating the correcting operation by an automatic tone correction apparatus as defined in claim 16. </paragraph>
<paragraph id="P-0097" lvl="0"><number>&lsqb;0097&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to a second embodiment of the present invention. </paragraph>
<paragraph id="P-0098" lvl="0"><number>&lsqb;0098&rsqb;</number> FIGS. <highlight><bold>18</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>18</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating a luminance histogram on a back-lighted image and a target luminance distribution, respectively. </paragraph>
<paragraph id="P-0099" lvl="0"><number>&lsqb;0099&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> is a diagram illustrating a corrected luminance histogram of the back-lighted image shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>a</italic></highlight>). </paragraph>
<paragraph id="P-0100" lvl="0"><number>&lsqb;0100&rsqb;</number> FIGS. <highlight><bold>20</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>20</bold></highlight>(<highlight><italic>b</italic></highlight>) are flowcharts illustrating a tone correcting process and its principle according to the second embodiment, respectively. </paragraph>
<paragraph id="P-0101" lvl="0"><number>&lsqb;0101&rsqb;</number> FIGS. <highlight><bold>21</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>21</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating target luminance distributions and centers of gravity in a forward-lighted image and a back-lighted image, respectively. </paragraph>
<paragraph id="P-0102" lvl="0"><number>&lsqb;0102&rsqb;</number> FIGS. <highlight><bold>22</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>22</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams illustrating target luminance distributions represented by curves. </paragraph>
<paragraph id="P-0103" lvl="0"><number>&lsqb;0103&rsqb;</number> FIGS. <highlight><bold>23</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>23</bold></highlight>(<highlight><italic>d</italic></highlight>) are diagrams for explaining synthesis of target luminance distributions. </paragraph>
<paragraph id="P-0104" lvl="0"><number>&lsqb;0104&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 24</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to a third embodiment of the invention. </paragraph>
<paragraph id="P-0105" lvl="0"><number>&lsqb;0105&rsqb;</number> FIGS. <highlight><bold>25</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>25</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating the centers of gravity in a back-lighted image. </paragraph>
<paragraph id="P-0106" lvl="0"><number>&lsqb;0106&rsqb;</number> FIGS. <highlight><bold>26</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>26</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating boundary values in histograms in which the frequency concentrates on a certain tone. </paragraph>
<paragraph id="P-0107" lvl="0"><number>&lsqb;0107&rsqb;</number> FIGS. <highlight><bold>21</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>27</bold></highlight>(<highlight><italic>b</italic></highlight>) are flowcharts illustrating a tone correcting process and its principle according to the third embodiment, respectively. </paragraph>
<paragraph id="P-0108" lvl="0"><number>&lsqb;0108&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 28</cross-reference> is a block diagram illustrating an automatic tone correction apparatus as defined in claim 9. </paragraph>
<paragraph id="P-0109" lvl="0"><number>&lsqb;0109&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 29</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to a fourth embodiment of the invention. </paragraph>
<paragraph id="P-0110" lvl="0"><number>&lsqb;0110&rsqb;</number> FIGS. <highlight><bold>30</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>30</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams illustrating boundary values in a back-lighted image and a forward-lighted image according to the fourth embodiment. </paragraph>
<paragraph id="P-0111" lvl="0"><number>&lsqb;0111&rsqb;</number> FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>31</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining a correction process in a back-lighted image, according to the fourth embodiment. </paragraph>
<paragraph id="P-0112" lvl="0"><number>&lsqb;0112&rsqb;</number> FIGS. <highlight><bold>32</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>32</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining a correction process in a forward-lighted image, according to the fourth embodiment. </paragraph>
<paragraph id="P-0113" lvl="0"><number>&lsqb;0113&rsqb;</number> FIGS. <highlight><bold>33</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>33</bold></highlight>(<highlight><italic>b</italic></highlight>) are flowcharts illustrating a tone correcting process and its principle according to the fourth embodiment, respectively. </paragraph>
<paragraph id="P-0114" lvl="0"><number>&lsqb;0114&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 34</cross-reference> is a diagram illustrating a boundary value in a luminance histogram having three peaks. </paragraph>
<paragraph id="P-0115" lvl="0"><number>&lsqb;0115&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 35</cross-reference> is a diagram illustrating a boundary value in a luminance histogram having three peaks, which histogram is formed by an automatic tone correction apparatus as defined in claim 11. </paragraph>
<paragraph id="P-0116" lvl="0"><number>&lsqb;0116&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 36</cross-reference> is a diagram for explaining a correction process of an automatic tone correction apparatus as defined in claim 12. </paragraph>
<paragraph id="P-0117" lvl="0"><number>&lsqb;0117&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 37</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to a fifth embodiment of the invention. </paragraph>
<paragraph id="P-0118" lvl="0"><number>&lsqb;0118&rsqb;</number> FIGS. <highlight><bold>38</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>38</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams illustrating the center of gravity, target value, and luminance histogram when tone correction is carried out according to the fourth and fifth embodiments. </paragraph>
<paragraph id="P-0119" lvl="0"><number>&lsqb;0119&rsqb;</number> FIGS. <highlight><bold>39</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>39</bold></highlight>(<highlight><italic>b</italic></highlight>) are flowcharts illustrating a tone correcting process and its principle according to the fifth embodiment, respectively. </paragraph>
<paragraph id="P-0120" lvl="0"><number>&lsqb;0120&rsqb;</number> FIGS. <highlight><bold>40</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>40</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining the conventional tone correcting process. </paragraph>
<paragraph id="P-0121" lvl="0"><number>&lsqb;0121&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 40</cross-reference> is a flowchart illustrating the conventional tone correcting process.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0122" lvl="7"><number>&lsqb;0122&rsqb;</number> &lsqb;Embodiment 1&rsqb;</paragraph>
<paragraph id="P-0123" lvl="0"><number>&lsqb;0123&rsqb;</number> Hereinafter, a description will be given of a first embodiment corresponding to inventions described in claims 1, 2, 3, 26, 27, 28, and 51 (further, claims 16&tilde;25, 41&tilde;50, 56&tilde;63), with reference to the drawings. </paragraph>
<paragraph id="P-0124" lvl="0"><number>&lsqb;0124&rsqb;</number> In this first embodiment, the whole luminance distribution of a luminance histogram is expanded over all tones to improve the contrast of an input image as a whole, and simultaneously, the luminance histogram is corrected so that the center of gravity of a low-luminance part of the histogram is shifted to a target value. </paragraph>
<paragraph id="P-0125" lvl="0"><number>&lsqb;0125&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to the first embodiment. In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, reference numeral <highlight><bold>101</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>102</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>101</bold></highlight>; reference. numeral <highlight><bold>103</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>102</bold></highlight>; reference numeral <highlight><bold>104</bold></highlight> denotes a luminance distribution formation circuit (luminance histogram formation unit) to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>103</bold></highlight>; reference numeral <highlight><bold>105</bold></highlight> denotes a center-of-gravity calculation circuit (center-of-gravity calculation unit) to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>104</bold></highlight>; reference numeral <highlight><bold>106</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>104</bold></highlight>; reference numeral <highlight><bold>107</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>108</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the center of gravity supplied from the center-of-gravity calculation circuit <highlight><bold>105</bold></highlight>, a maximum value and a minimum value of the distribution range supplied from the distribution range calculation circuit <highlight><bold>106</bold></highlight>, and the target value supplied from the target value storage circuit <highlight><bold>107</bold></highlight>; and reference numeral <highlight><bold>109</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>102</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>108</bold></highlight>. The correction table formation circuit <highlight><bold>108</bold></highlight> and the image signal correction circuit <highlight><bold>109</bold></highlight> constitute a tone correction unit. However, when the tone correction unit does not include a function of expanding the distribution of the luminance histogram, the correction table formation circuit <highlight><bold>108</bold></highlight> and the image signal correction circuit <highlight><bold>109</bold></highlight> constitute a luminance distribution expansion unit as well as a tone correction unit. </paragraph>
<paragraph id="P-0126" lvl="0"><number>&lsqb;0126&rsqb;</number> Next, the operation will be described. An analog image signal outputted from the image pickup device <highlight><bold>101</bold></highlight> is converted into a multi-tone digital image signal by the A/D converter <highlight><bold>102</bold></highlight>. This A/D conversion may be carried out for any number of bits. In this first embodiment, the image signal is an 8-bit signal, and its luminance value ranges from &ldquo;0&rdquo; to &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0127" lvl="0"><number>&lsqb;0127&rsqb;</number> Next, the luminance signal calculation circuit <highlight><bold>103</bold></highlight> calculates a luminance signal out of the digital image signal. In the luminance signal calculation circuit <highlight><bold>103</bold></highlight>, a luminance signal Y is calculated from R, G, and B values, according to formula (3) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Y&equals;</italic></highlight>0.299&times;<highlight><italic>R&plus;</italic></highlight>0.587&times;<highlight><italic>G&plus;</italic></highlight>0.114&times;<highlight><italic>B</italic></highlight>&emsp;&emsp;(3) </in-line-formula></paragraph>
<paragraph id="P-0128" lvl="0"><number>&lsqb;0128&rsqb;</number> The luminance distribution formation circuit <highlight><bold>104</bold></highlight> forms a luminance histogram indicating the sum of pixels having the same value, on the basis of the luminance value calculated by the luminance signal calculation circuit <highlight><bold>103</bold></highlight>. </paragraph>
<paragraph id="P-0129" lvl="0"><number>&lsqb;0129&rsqb;</number> FIGS. <highlight><bold>2</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>2</bold></highlight>(<highlight><italic>b</italic></highlight>) show examples of luminance histograms formed by the luminance distribution formation circuit <highlight><bold>104</bold></highlight>. <cross-reference target="DRAWINGS">FIG. 2</cross-reference>(<highlight><italic>a</italic></highlight>) shows a luminance histogram of a forward-lighted image, and <cross-reference target="DRAWINGS">FIG. 2</cross-reference>(<highlight><italic>b</italic></highlight>) shows a luminance histogram of a back-lighted image. As is evident from <cross-reference target="DRAWINGS">FIG. 2</cross-reference>(<highlight><italic>b</italic></highlight>), the luminance histogram of the back-lighted image has peaks at the low-luminance side and the high-luminance side, respectively. </paragraph>
<paragraph id="P-0130" lvl="0"><number>&lsqb;0130&rsqb;</number> In the center-of-gravity calculation circuit <highlight><bold>105</bold></highlight>, the luminance histogram is divided into two equal areas at the center luminance level of the input luminance level axis, and the area on the low-luminance side is regarded as a low-luminance part while the area on the high-luminance side is regarded as a high-luminance part, and then the center of gravity of the low-luminance part is calculated. Assuming that each tone is i and the frequency of each tone is Y&lsqb;i&rsqb;, the center of gravity G is calculated by formula (4) as follows.  
<math-cwu id="MATH-US-00002">
<number>2</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mi>G</mi>
        <mo>=</mo>
        <mrow>
          <munderover>
            <mrow>
              <mo>&Sum;</mo>
              <mstyle>
                <mtext>&emsp;</mtext>
              </mstyle>
            </mrow>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>0</mn>
            </mrow>
            <mn>127</mn>
          </munderover>
          <mo>&it;</mo>
          <mrow>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mrow>
                  <mi>Y</mi>
                  <mo>&af;</mo>
                  <mrow>
                    <mo>[</mo>
                    <mi>i</mi>
                    <mo>]</mo>
                  </mrow>
                </mrow>
                <mo>*</mo>
                <mi>i</mi>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mo>/</mo>
            <mrow>
              <munderover>
                <mo>&Sum;</mo>
                <mrow>
                  <mi>i</mi>
                  <mo>=</mo>
                  <mn>0</mn>
                </mrow>
                <mn>127</mn>
              </munderover>
              <mo>&it;</mo>
              <mstyle>
                <mtext>&emsp;</mtext>
              </mstyle>
              <mo>&it;</mo>
              <mrow>
                <mi>Y</mi>
                <mo>&af;</mo>
                <mrow>
                  <mo>[</mo>
                  <mi>i</mi>
                  <mo>]</mo>
                </mrow>
              </mrow>
            </mrow>
          </mrow>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>4</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00002" file="US20030002736A1-20030102-M00002.NB"/>
<image id="EMI-M00002" wi="216.027" he="24.97635" file="US20030002736A1-20030102-M00002.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0131" lvl="0"><number>&lsqb;0131&rsqb;</number> The distribution range calculation circuit <highlight><bold>106</bold></highlight> calculates a maximum value and a minimum value on the input luminance level axis of the luminance histogram which is formed by the luminance distribution formation circuit <highlight><bold>104</bold></highlight>. The maximum value and the minimum value become a maximum luminance level and a minimum luminance level after expanding the luminance distribution to improve the contrast in the correction process. </paragraph>
<paragraph id="P-0132" lvl="0"><number>&lsqb;0132&rsqb;</number> The maximum and minimum luminance values may be obtained, not from the both ends of the luminance distribution, but from a little inner sides from the both ends, to avoid influences of noises. In this case, the maximum value can be obtained as follows. The number of pixels for every tone is accumulated from the high-luminance side of the luminance histogram, and the maximum value is calculated from a tone at which the accumulated value exceeds, for example, 0.5% of the number of pixels. Likewise, the minimum value can be obtained as follows. The number of pixels for each tone is accumulated from the low-luminance side, and the minimum value is calculated from a tone at which the accumulated value exceeds 0.5% of the number of pixels. </paragraph>
<paragraph id="P-0133" lvl="0"><number>&lsqb;0133&rsqb;</number> Next, a luminance conversion table is formed by using the center of gravity calculated by the center-of-gravity calculation circuit <highlight><bold>105</bold></highlight>, the maximum and minimum values calculated by the distribution range calculation circuit <highlight><bold>106</bold></highlight>, and the target value which has previously been stored in the target value storage circuit <highlight><bold>107</bold></highlight>. This luminance conversion table is used for expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the expanded luminance histogram matches the target value. </paragraph>
<paragraph id="P-0134" lvl="0"><number>&lsqb;0134&rsqb;</number> FIGS. <highlight><bold>3</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>3</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams for explaining the tone correcting process. More specifically, <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>a</italic></highlight>) shows a luminance histogram of a back-lighted image, <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>b</italic></highlight>) shows a luminance histogram which is corrected so as to expand the luminance distribution of <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>a</italic></highlight>), and <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>c</italic></highlight>) is a luminance histogram which is corrected so that the center of gravity of the low-luminance part of the expanded luminance histogram matches the target value. </paragraph>
<paragraph id="P-0135" lvl="0"><number>&lsqb;0135&rsqb;</number> Furthermore, <cross-reference target="DRAWINGS">FIG. 4</cross-reference>(<highlight><italic>a</italic></highlight>) is a flowchart illustrating the principle of the tone correcting process. </paragraph>
<paragraph id="P-0136" lvl="0"><number>&lsqb;0136&rsqb;</number> Initially, a luminance histogram is formed from an input image shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>a</italic></highlight>) (step S<highlight><bold>101</bold></highlight>), and the whole luminance distribution of the luminance histogram is extended over all tones as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>b</italic></highlight>) (step S<highlight><bold>102</bold></highlight>). Thereby, the contrast of the input image as a whole is improved. </paragraph>
<paragraph id="P-0137" lvl="0"><number>&lsqb;0137&rsqb;</number> Next, in the image the contrast of which is improved as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>b</italic></highlight>), the center of gravity of the low-luminance part, which has been shifted from the center of gravity of the low-luminance part shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>a</italic></highlight>) due to expansion of the luminance distribution, is obtained (step S<highlight><bold>103</bold></highlight>). Then, tone correction is carried out so that the center of gravity of the low-luminance part, which has been shifted due to expansion of the luminance distribution, is brought to the target value as shown in <cross-reference target="DRAWINGS">FIG. 3</cross-reference>(<highlight><italic>c</italic></highlight>) (step S<highlight><bold>104</bold></highlight>). Thereby, the luminance value of the low-luminance part is corrected to the target luminance value, and the brightness of the whole image is optimized. </paragraph>
<paragraph id="P-0138" lvl="0"><number>&lsqb;0138&rsqb;</number> As a result of these two processes, the input image is brightly corrected so that the low-luminance region in the back-lighted state matches the target luminance value, and the contrast of the whole image is improved. </paragraph>
<paragraph id="P-0139" lvl="0"><number>&lsqb;0139&rsqb;</number> In the process of expanding the luminance distribution, each luminance level is converted so that the minimum value and maximum value calculated by the distribution range calculation circuit <highlight><bold>106</bold></highlight> become the minimum luminance level &ldquo;0&rdquo; and the maximum luminance level &ldquo;255&rdquo;, respectively. Assuming that the input luminance level is Yin, and the minimum value and maximum value of the luminance distribution are Ymin and Ymax, respectively, an output luminance level Yout is calculated by formula (5) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Y</italic></highlight>out&equals;(<highlight><italic>Y</italic></highlight>in&minus;<highlight><italic>Y</italic></highlight>min)&times;255/(<highlight><italic>Y</italic></highlight>max&minus;<highlight><italic>Y</italic></highlight>min)&emsp;&emsp;(5) </in-line-formula></paragraph>
<paragraph id="P-0140" lvl="0"><number>&lsqb;0140&rsqb;</number> The process of correcting the luminance histogram so that the center of gravity of the low-luminance part matches the target value, can be executed by &ggr; correction. In &ggr; correction, tones are corrected according to a &ggr; correction function, with reference to the histogram. Assuming that the original tone is Y1, corrected tone Y2 is represented by formula (6) as follows.  
<math-cwu id="MATH-US-00003">
<number>3</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mi>Y2</mi>
        <mo>=</mo>
        <mrow>
          <mn>255</mn>
          <mo>&times;</mo>
          <msup>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mi>Y1</mi>
                <mo>/</mo>
                <mn>255</mn>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mfrac>
              <mn>1</mn>
              <mi>&gamma;</mi>
            </mfrac>
          </msup>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>6</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00003" file="US20030002736A1-20030102-M00003.NB"/>
<image id="EMI-M00003" wi="216.027" he="15.11055" file="US20030002736A1-20030102-M00003.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0141" lvl="0"><number>&lsqb;0141&rsqb;</number> Accordingly, a &ggr; value, with which the center of gravity of the low-luminance part of the luminance histogram is converted to the target value, is calculated in formula (6), and the above-mentioned conversion is performed on all tones using a &ggr; correction function having the &ggr; value, whereby the center of gravity of the low-luminance part of the luminance histogram matches the target value. </paragraph>
<paragraph id="P-0142" lvl="0"><number>&lsqb;0142&rsqb;</number> In this case, since tone correction is carried out so that the center of gravity of the low-luminance part of the luminance distribution which is corrected by formula (5) matches the target value, when the center of gravity calculated by the center-of-gravity calculation circuit <highlight><bold>105</bold></highlight> is indicated by G and the target value stored in the target value storage circuit <highlight><bold>107</bold></highlight> is indicated by g, a &ggr; value that satisfies the following formula (7) should be calculated.  
<math-cwu id="MATH-US-00004">
<number>4</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mi>g</mi>
        <mo>=</mo>
        <mrow>
          <mn>255</mn>
          <mo>&times;</mo>
          <msup>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mi>G</mi>
                    <mo>-</mo>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>min</mi>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>/</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>max</mi>
                    </mrow>
                    <mo>-</mo>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>min</mi>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mfrac>
              <mn>1</mn>
              <mi>&gamma;</mi>
            </mfrac>
          </msup>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>7</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00004" file="US20030002736A1-20030102-M00004.NB"/>
<image id="EMI-M00004" wi="216.027" he="15.11055" file="US20030002736A1-20030102-M00004.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0143" lvl="0"><number>&lsqb;0143&rsqb;</number> In the correction process according to formulae (5) and (6), in order to increase the computation speed, 256 conversion tables as many as the number of tones is formed in advance, and the actual image data are converted with reference to these tables. </paragraph>
<paragraph id="P-0144" lvl="0"><number>&lsqb;0144&rsqb;</number> However, when the calculation of formula (5) and the calculation of formula (6) are carried out separately, since the tones are integral values ranging from &ldquo;0&rdquo; to &ldquo;255&rdquo;, errors occurs in the decimal level. So the calculations of formulae (5) and (6) are simultaneously carried out to remove such errors in the decimal level. </paragraph>
<paragraph id="P-0145" lvl="0"><number>&lsqb;0145&rsqb;</number> The correction table formation circuit <highlight><bold>108</bold></highlight> forms a luminance conversion table which performs, simultaneously, the process of expanding the luminance distribution, and the process of converting the luminance histogram so that the center of gravity of the low-luminance part of the luminance histogram matches the target value. </paragraph>
<paragraph id="P-0146" lvl="0"><number>&lsqb;0146&rsqb;</number> Thereby, a luminance distribution expansion part (a conversion table for only expansion of luminance distribution), which is required when expanding a luminance distribution immediately after formation of the luminance histogram as shown in <cross-reference target="DRAWINGS">FIG. 4</cross-reference>(<highlight><italic>a</italic></highlight>), is dispensed with, and further, the above-mentioned arithmetic errors in the decimal level are avoided. </paragraph>
<paragraph id="P-0147" lvl="0"><number>&lsqb;0147&rsqb;</number> Assuming that the &ggr; value calculated by formula (7) is K and the input luminance level is i (i&equals;0, 1, . . . , 255), a conversion table T&lsqb;i&rsqb; for expanding the luminance distribution of the input image, and performing such conversion that the center of gravity of the low-luminance part of the expanded luminance histogram matches the target value, can be calculated by formula (8) as follows.  
<math-cwu id="MATH-US-00005">
<number>5</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>T</mi>
          <mo>&af;</mo>
          <mrow>
            <mo>[</mo>
            <mi>i</mi>
            <mo>]</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mn>255</mn>
          <mo>&times;</mo>
          <msup>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mi>i</mi>
                    <mo>-</mo>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>min</mi>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
                <mo>/</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>max</mi>
                    </mrow>
                    <mo>-</mo>
                    <mrow>
                      <mi>Y</mi>
                      <mo>&it;</mo>
                      <mstyle>
                        <mtext>&emsp;</mtext>
                      </mstyle>
                      <mo>&it;</mo>
                      <mi>min</mi>
                    </mrow>
                  </mrow>
                  <mo>)</mo>
                </mrow>
              </mrow>
              <mo>)</mo>
            </mrow>
            <mfrac>
              <mn>1</mn>
              <mi>K</mi>
            </mfrac>
          </msup>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>8</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00005" file="US20030002736A1-20030102-M00005.NB"/>
<image id="EMI-M00005" wi="216.027" he="13.91985" file="US20030002736A1-20030102-M00005.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph id="P-0148" lvl="0"><number>&lsqb;0148&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a graph illustrating an example of a conversion property of the luminance conversion table. The luminance conversion table has such a property that maps (Ymin, Ymax) to (0, 255) so that the tone at the center of gravity of the low-luminance part of the luminance histogram matches the target tone. </paragraph>
<paragraph id="P-0149" lvl="0"><number>&lsqb;0149&rsqb;</number> Next, the image signal correction circuit <highlight><bold>109</bold></highlight> corrects the image luminance signal using the luminance conversion table formed by the correction table formation circuit <highlight><bold>108</bold></highlight>, and thereafter, forms R, G, B signals from the image luminance signal. The R, G, B signals may be directly converted according to the luminance conversion table to perform luminance correction. </paragraph>
<paragraph id="P-0150" lvl="0"><number>&lsqb;0150&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference>(<highlight><italic>b</italic></highlight>) shows a flowchart for explaining a tone correcting process which is actually carried out by the image signal correction circuit <highlight><bold>109</bold></highlight> of the automatic tone correction apparatus shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. </paragraph>
<paragraph id="P-0151" lvl="0"><number>&lsqb;0151&rsqb;</number> Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>111</bold></highlight>), and the center of gravity of a low-luminance part of this luminance histogram is obtained before expanding the luminance distribution (step S<highlight><bold>112</bold></highlight>). Next, in step S<highlight><bold>113</bold></highlight>, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance distribution of the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and thereafter, expansion of the luminance histogram and correction of the luminance distribution to match the center of gravity of the low-luminance part to the target value are simultaneously carried out using the correction table. </paragraph>
<paragraph id="P-0152" lvl="0"><number>&lsqb;0152&rsqb;</number> As described above, the center of gravity of the low-luminance part of the luminance histogram, and the maximum and minimum values of the luminance distribution are calculated, and the luminance distribution is expanded and, simultaneously, tone correction is carried out so that the center of gravity of the low-luminance part of the luminance histogram matches the pre-stored target value. Therefore, a back-lighted image can be brightly corrected so that the low-luminance area in the back-lighted state has a target luminance value, thereby obtaining an image the whole contrast of which is improved. Furthermore, even a forward-lighted image can be corrected so that the luminance value of the low-luminance area of the image matches a target value, resulting in an image the whole contrast of which is improved. </paragraph>
<paragraph id="P-0153" lvl="0"><number>&lsqb;0153&rsqb;</number> When a target value is stored in the target value storage circuit <highlight><bold>107</bold></highlight>, an optimum target value must be set for every input image. In this case, an inappropriate target value might be set by mistake. This problem can be solved by putting a restriction on the &ggr; value of the &ggr; correction function which is used when forming the luminance conversion table by the correction table formation circuit <highlight><bold>108</bold></highlight>. For example, the &ggr; value is restricted within a range represented by formula (9) as follows (corresponding to claim 2). </paragraph>
<paragraph lvl="0"><in-line-formula>0.65&lE;&ggr;&lE;1.0&emsp;&emsp;(9) </in-line-formula></paragraph>
<paragraph id="P-0154" lvl="0"><number>&lsqb;0154&rsqb;</number> In this way, the strength of correction is restricted by putting a restriction on the &ggr; value, whereby the property of the original image is prevented from being damaged significantly even when the target value is not an optimum value to the input image. </paragraph>
<paragraph id="P-0155" lvl="0"><number>&lsqb;0155&rsqb;</number> The correction table formation circuit <highlight><bold>108</bold></highlight> may set a correction table with a straight line, instead of the above-mentioned &ggr; curve. <cross-reference target="DRAWINGS">FIG. 5</cross-reference> shows a correction table that is set with a straight line, in which the minimum value and maximum value of the luminance distribution, which are calculated by the distribution range calculation circuit <highlight><bold>106</bold></highlight>, become the minimum luminance level &ldquo;0&rdquo; and the maximum luminance level &ldquo;255&rdquo;, respectively, and the tone at the center of gravity of the low-luminance part of the luminance histogram matches the target tone. By setting the correction table with a straight line, the computational complexity is significantly reduced. </paragraph>
<paragraph id="P-0156" lvl="0"><number>&lsqb;0156&rsqb;</number> Furthermore, the tones between the three points, i.e., the minimum value and maximum value calculated by the distribution range calculation circuit <highlight><bold>106</bold></highlight> and the center of gravity of the low-luminance part, may be set according to the frequency of the distribution of the luminance histogram. To be specific, referring to the frequency of the luminance histogram, more tones are assigned to an area having a larger frequency. An example is shown in FIGS. <highlight><bold>6</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>6</bold></highlight>(<highlight><italic>b</italic></highlight>). For a luminance histogram as shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>(<highlight><italic>a</italic></highlight>), a correction table as shown in <cross-reference target="DRAWINGS">FIG. 6</cross-reference>(<highlight><italic>b</italic></highlight>) is formed. </paragraph>
<paragraph id="P-0157" lvl="0"><number>&lsqb;0157&rsqb;</number> In this way, by forming a correction table according to the frequency of the luminance histogram, more tones can be assigned to an area having many tones in the image. </paragraph>
<paragraph id="P-0158" lvl="0"><number>&lsqb;0158&rsqb;</number> Furthermore, in the luminance distribution formation circuit <highlight><bold>104</bold></highlight>, a restriction may be put on the amount of accumulation of luminance distribution. That is, a threshold value is set, and accumulation is stopped when this threshold value is exceeded. For example, the threshold value can be calculated from the sum of sample points as follows. </paragraph>
<paragraph lvl="0"><in-line-formula>threshold value&equals;total number of counts/80&emsp;&emsp;(10) </in-line-formula></paragraph>
<paragraph id="P-0159" lvl="0"><number>&lsqb;0159&rsqb;</number> By previously setting a restriction on the luminance histogram, the amount of correction can be accurately calculated even when there is an extreme deviation such that the tone distribution concentrates on a certain tone, for example, when a background of a back-lighted image or the like occurs halation and thus the luminance level concentrates on &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0160" lvl="0"><number>&lsqb;0160&rsqb;</number> Furthermore, the center of gravity of the high-luminance part is calculated from the luminance histogram, and an amount of correction of the high-luminance part may be calculated according to the center of gravity of the high-luminance part (corresponding to claim 23). An example is shown in <cross-reference target="DRAWINGS">FIG. 7</cross-reference>. It is assumed that Ymin and Ymax are the minimum value and the maximum value of the luminance distribution described above, respectively. Initially, a straight line, which divides an interior angle formed between a straight line connecting the Ymin and the center of gravity of the low-luminance part and a straight line connecting the center of gravity of the low-luminance part and the Ymax into two parts, is set. Then, an input value of a correction point is set at a middle point (Y1) between the center of gravity of the low-luminance part and the Ymax, and an output or the Y1 on the line dividing the interior angle into two parts is set at an output value (Y2) of the correction point (refer to <cross-reference target="DRAWINGS">FIG. 7</cross-reference>(<highlight><italic>a</italic></highlight>)). Thereby, a difference in gradients between the inflection points can be reduced. However, when the input image is bright, halation of the high-luminance part may occur. In order to solve this problem, as shown in <cross-reference target="DRAWINGS">FIG. 7</cross-reference>(<highlight><italic>b</italic></highlight>), the input value Y1 is shifted toward the low-luminance side (Y1&prime;) as the center of gravity of the high-luminance part gets closer to the maximum tone, and an output of the input value Y1&prime; on the line that divides the interior angle into two parts is set as an output value Y2&prime; of the correction point (refer to <cross-reference target="DRAWINGS">FIG. 7</cross-reference>(<highlight><italic>b</italic></highlight>)) Thereby, halation of the high-luminance part is prevented. </paragraph>
<paragraph id="P-0161" lvl="0"><number>&lsqb;0161&rsqb;</number> Of course, a correction table may be formed according to a correction point which is set so that the center of gravity of the high-luminance part matches a predetermined target value of the high-luminance part, in like manner as described for correction of the low-luminance part. This is shown in <cross-reference target="DRAWINGS">FIG. 8</cross-reference>. </paragraph>
<paragraph id="P-0162" lvl="0"><number>&lsqb;0162&rsqb;</number> Although the correction table shown in <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is set by a straight line, correction points, which are calculated as described above, may be set according to a curve or the frequency of the luminance histogram. </paragraph>
<paragraph id="P-0163" lvl="0"><number>&lsqb;0163&rsqb;</number> Furthermore, a skin-color region is extracted from color-difference signals and a luminance signal and, when a luminance histogram is formed, the luminance distribution of the skin-color region may be added to the luminance distribution of the whole image according to the area of the skin-color region (corresponding to claim 21). </paragraph>
<paragraph id="P-0164" lvl="0"><number>&lsqb;0164&rsqb;</number> The construction of an automatic tone correction apparatus at this time is shown in <cross-reference target="DRAWINGS">FIG. 10</cross-reference>. </paragraph>
<paragraph id="P-0165" lvl="0"><number>&lsqb;0165&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, reference numeral <highlight><bold>3101</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>3102</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>3101</bold></highlight>; reference numeral <highlight><bold>3103</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>3102</bold></highlight>; reference numeral <highlight><bold>3104</bold></highlight> denotes a luminance distribution formation circuit to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>3103</bold></highlight>, and a skin-color luminance distribution is supplied from a skin-color distribution formation circuit <highlight><bold>3112</bold></highlight> which is described later; reference numeral <highlight><bold>3105</bold></highlight> denotes a center-of-gravity calculation circuit to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>3104</bold></highlight>; reference numeral <highlight><bold>3106</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>3104</bold></highlight>; reference numeral <highlight><bold>3107</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>3108</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction on the basis of the center of gravity outputted from the center-of-gravity calculation circuit <highlight><bold>3105</bold></highlight>, the maximum value and minimum value of the distribution range outputted from the distribution range calculation circuit <highlight><bold>3106</bold></highlight>, and the target value outputted from the target value storage circuit <highlight><bold>3107</bold></highlight>; reference numeral <highlight><bold>3109</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>3102</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>3108</bold></highlight>; reference numeral <highlight><bold>3110</bold></highlight> denotes a color-difference signal calculation circuit to which the digital image signal is supplied the A/D converter <highlight><bold>3102</bold></highlight>; reference numeral <highlight><bold>3111</bold></highlight> denotes a skin-color region extraction circuit (skin-color region extraction unit) to which the luminance signal and the color-difference signal are supplied from the luminance signal calculation circuit <highlight><bold>3103</bold></highlight> and the color-difference signal calculation circuit <highlight><bold>3110</bold></highlight>, respectively; and reference numeral <highlight><bold>3112</bold></highlight> denotes a skin-color distribution formation circuit to which a luminance signal of a skin-color region is supplied from the skin-color region extraction circuit <highlight><bold>3111</bold></highlight>. </paragraph>
<paragraph id="P-0166" lvl="0"><number>&lsqb;0166&rsqb;</number> Next, the operation will be described. The fundamental operation of the apparatus shown in <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is identical to the operation of the apparatus shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, except that the apparatus of <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is provided with the color-difference signal calculation circuit <highlight><bold>3110</bold></highlight>, the skin-color region calculation circuit <highlight><bold>3111</bold></highlight>, and the skin-color luminance distribution formation circuit <highlight><bold>3112</bold></highlight>, and a skin-color region is extracted from color-difference signals and a luminance signal, and when a luminance histogram is formed, the luminance distribution of the skin-color region is added to the luminance distribution of the whole image according to the area of the skin-color region. </paragraph>
<paragraph id="P-0167" lvl="0"><number>&lsqb;0167&rsqb;</number> The color-difference signal calculation circuit <highlight><bold>3110</bold></highlight> calculates color-difference signals Cr and Cb, on the basis of formulae (11) and (12) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cr&equals;</italic></highlight>0.500&times;<highlight><italic>R&minus;</italic></highlight>0.419&times;<highlight><italic>G&minus;</italic></highlight>0.081<highlight><italic>&times;B</italic></highlight>&emsp;&emsp;(11) </in-line-formula></paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cb&equals;&minus;</italic></highlight>0.169&times;<highlight><italic>R&minus;</italic></highlight>0.331<highlight><italic>&times;G&minus;</italic></highlight>0.5<highlight><italic>&times;B</italic></highlight>&emsp;&emsp;(12) </in-line-formula></paragraph>
<paragraph id="P-0168" lvl="0"><number>&lsqb;0168&rsqb;</number> The skin-color region extraction circuit <highlight><bold>3111</bold></highlight> extracts a skin-color region in the input image. The skin-color region extraction circuit <highlight><bold>3111</bold></highlight> is previously provided with ranges of the color-difference signals and the luminance signal corresponding to the skin-color region. When the color-difference signals and the luminance signal of the input signal are within the skin-color region, pixels in this region are regarded as skin-color. </paragraph>
<paragraph id="P-0169" lvl="0"><number>&lsqb;0169&rsqb;</number> Hereinafter, a skin-color region will be described with reference to <cross-reference target="DRAWINGS">FIG. 11</cross-reference>. </paragraph>
<paragraph id="P-0170" lvl="0"><number>&lsqb;0170&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference>(<highlight><italic>a</italic></highlight>) shows a distribution of skin color on the axes of the color-difference signal Cr and Cb, and a hatched region is a skin-color region. It can be seen that the skin color is distributed in a specific region of the color difference signals. <cross-reference target="DRAWINGS">FIG. 11</cross-reference>(<highlight><italic>b</italic></highlight>) shows a distribution of skin color on the Cr axis and the luminance axis. Also in <cross-reference target="DRAWINGS">FIG. 11</cross-reference>(<highlight><italic>b</italic></highlight>), the skin color is distributed in a specific region. The regions shown in FIGS. <highlight><bold>11</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>11</bold></highlight>(<highlight><italic>b</italic></highlight>) are previously stored, and it is judged whether the input signal is skin color or not. That is, when the color-difference signals and the luminance signal of the input signal are positioned within the skin color region, pixels in this region are judged as skin-color. The judgement may be performed with only the color-difference signals to simplify the processing. </paragraph>
<paragraph id="P-0171" lvl="0"><number>&lsqb;0171&rsqb;</number> When the skin color region extraction circuit <highlight><bold>3111</bold></highlight> judges that the input pixels are skin color, the skin color luminance distribution formation circuit <highlight><bold>3112</bold></highlight> forms a luminance distribution of the skin color region. <cross-reference target="DRAWINGS">FIG. 12</cross-reference>(<highlight><italic>a</italic></highlight>) shows an example of a skin color region luminance distribution so formed. When the luminance distribution of the whole image is as shown in <cross-reference target="DRAWINGS">FIG. 12</cross-reference>(<highlight><italic>b</italic></highlight>), the distribution (number of pixels) at each tone of the luminance distribution shown in <cross-reference target="DRAWINGS">FIG. 12</cross-reference>(<highlight><italic>a</italic></highlight>) which is the luminance distribution of the skin-color region is added to the distribution at each tone of the whole luminance distribution shown in <cross-reference target="DRAWINGS">FIG. 12</cross-reference>(<highlight><italic>b</italic></highlight>), whereby the luminance data in the skin color region is weighted. When performing the addition, the luminance distribution of the skin-color region is weighted. The reason is as follows. Since the ratio of the skin-color region to the whole image is small, if the distribution of the skin-color region is added as it is, the luminance distribution of the skin-color region cannot be reflected onto the tone correcting process. The weighting realizes tone correction with the skin-color region being optimized. The weighting can be performed by multiplying the luminance distribution of the skin-color region by a coefficient. For example, the luminance distribution of the skin-color region which is multiplied by 5 is added. <cross-reference target="DRAWINGS">FIG. 12</cross-reference>(<highlight><italic>c</italic></highlight>) shows the luminance distribution obtained by the above-mentioned weighting. </paragraph>
<paragraph id="P-0172" lvl="0"><number>&lsqb;0172&rsqb;</number> In the luminance distribution of the skin-color region, the distribution in the high-luminance part may be weighted (corresponding to claim 22). For example, the luminance distribution of the skin-color region is multiplied by a coefficient as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> to weight the high-luminance part. Thereby, halation of skin color, which is visually conspicuous, is avoided. </paragraph>
<paragraph id="P-0173" lvl="0"><number>&lsqb;0173&rsqb;</number> Further, when the luminance distribution formed by the luminance distribution formation circuit <highlight><bold>104</bold></highlight> is discrete, tone correction is not carried out (corresponding to claim 24). An example of luminance distribution in this case is shown in <cross-reference target="DRAWINGS">FIG. 9</cross-reference>. When the luminance distribution is discrete, the input image can be judged as an artificial image, not a natural image. When an artificial image is inputted, it is better not to perform tone correction. </paragraph>
<paragraph id="P-0174" lvl="0"><number>&lsqb;0174&rsqb;</number> Although, in the above description, tone correction is performed on the R, G, B signals, it may be performed on a luminance signal after separating an input digital image signal into the luminance signal and color-difference signals. In this case, however, tone correction may cause a phenomenon in which the saturation appears degraded. So, as described in claim 25, the color-difference signals of the image may be corrected according to the correction table. Thereby, when R, G, B signals are formed from the luminance signal and the color-difference signals which have been subjected to tone correction, a phenomenon, in which the saturation appears degraded due to luminance correction, is suppressed. </paragraph>
<paragraph id="P-0175" lvl="0"><number>&lsqb;0175&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a block diagram illustrating the construction of an automatic tone correction apparatus in this case. In <cross-reference target="DRAWINGS">FIG. 14</cross-reference>, reference numeral <highlight><bold>3001</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>3002</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>3001</bold></highlight>; reference numeral <highlight><bold>3003</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>3002</bold></highlight>; reference numeral <highlight><bold>3004</bold></highlight> denotes a luminance distribution formation circuit to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>3003</bold></highlight>; reference numeral <highlight><bold>3005</bold></highlight> denotes a center-of-gravity calculation circuit to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>3004</bold></highlight>; reference numeral <highlight><bold>3006</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>3004</bold></highlight>; reference numeral <highlight><bold>3007</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>3008</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction on the basis of the center of gravity outputted from the center-of-gravity calculation circuit <highlight><bold>3005</bold></highlight>, the maximum value and minimum value of the distribution range outputted from the distribution range calculation circuit <highlight><bold>3006</bold></highlight>, and the target value outputted from the target value storage circuit <highlight><bold>3007</bold></highlight>, reference numeral <highlight><bold>3009</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>3002</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>3008</bold></highlight>; reference numeral <highlight><bold>3010</bold></highlight> denotes a color-difference signal calculation circuit to which the digital image signal is supplied the A/D converter <highlight><bold>3002</bold></highlight>; and reference numeral <highlight><bold>3011</bold></highlight> is a color-difference signal correction circuit for calculating a color-difference gain value on the basis of the correction table formed by the correction table formation circuit <highlight><bold>3008</bold></highlight>, and correcting color-difference signals outputted from the color-difference signal calculation circuit <highlight><bold>3010</bold></highlight>. </paragraph>
<paragraph id="P-0176" lvl="0"><number>&lsqb;0176&rsqb;</number> Next the operation will be described. The fundamental operation of the apparatus shown in <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is identical to the operation of the apparatus shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, except that the apparatus of <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is provided with the luminance signal correction circuit <highlight><bold>3009</bold></highlight>, the color-difference signal calculation circuit <highlight><bold>3010</bold></highlight>, and the color-difference signal correction circuit <highlight><bold>3011</bold></highlight>, and tone correction is performed on the luminance signal while the color-difference signals are corrected by calculating a color-difference gain value on the basis of the correction table and multiplying the color-difference signals by the gain value. </paragraph>
<paragraph id="P-0177" lvl="0"><number>&lsqb;0177&rsqb;</number> The color-difference signal calculation circuit <highlight><bold>3010</bold></highlight> calculates color-difference signals Cr and Cb by the above-described formulae (11) and (12). </paragraph>
<paragraph id="P-0178" lvl="0"><number>&lsqb;0178&rsqb;</number> The luminance signal correction circuit <highlight><bold>3009</bold></highlight> performs tone correction on the luminance signal with reference to the correction table which is formed by the correction table formation circuit <highlight><bold>3008</bold></highlight>, in the same manner as described for the image signal correction circuit <highlight><bold>109</bold></highlight>. </paragraph>
<paragraph id="P-0179" lvl="0"><number>&lsqb;0179&rsqb;</number> Assuming that the color-difference signals are Cr and Cb, the input luminance level is i, the output value of the correction table according to the input luminance level is Table &lsqb;i&rsqb;, and the gain value of each color-difference signal is Cg, the color-difference signal correction circuit <highlight><bold>3011</bold></highlight> calculates the gain value G and performs color-difference correction by using formulae (13), (14), (15), and (16) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cg</italic></highlight>&equals;(Table&lsqb;<highlight><italic>i&rsqb;&minus;i</italic></highlight>)/30&times;0.2&plus;1.0 (Table&lsqb;i&rsqb;&gE;i)&emsp;&emsp;(13) </in-line-formula></paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cg&equals;</italic></highlight>1.0 (Table &lsqb;i&rsqb;&lt;i)&emsp;&emsp;(14) </in-line-formula></paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cr&equals;Cr&times;Cg</italic></highlight>&emsp;&emsp;(15) </in-line-formula></paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>Cb&equals;Cb&times;Cg</italic></highlight>&emsp;&emsp;(16) </in-line-formula></paragraph>
<paragraph id="P-0180" lvl="0"><number>&lsqb;0180&rsqb;</number> However, these formulae are merely examples, and formulae to be employed are not restricted to them. For example, when the color-difference signals Cr and Cb are multiplied by the gain value, if the Cr reaches the maximum level of the color-difference signal, the Cr is clipped at the maximum level, while the Cb is multiplied by the gain as it is and thus its color phase changes. At this time, the Cg is adjusted so that the Cr does not exceed the maximum level of the color-difference signal, and the Cb is multiplied by the adjusted Cg, whereby the change in the color phase can be suppressed. </paragraph>
<paragraph id="P-0181" lvl="0"><number>&lsqb;0181&rsqb;</number> Furthermore, target values may be previously set according to the possible positions of the center of gravity of the low-luminance part of the luminance histogram, and stored in the target value storage circuit <highlight><bold>107</bold></highlight>, whereby a work of setting a target value for every input image is dispensed with (corresponding to claim 3). </paragraph>
<paragraph id="P-0182" lvl="0"><number>&lsqb;0182&rsqb;</number> When the strength of correction is restricted by setting a target value for every possible range of the center of gravity, even if the target value is not optimum to the input image, the property of the original image is prevented from being damaged significantly. </paragraph>
<paragraph id="P-0183" lvl="0"><number>&lsqb;0183&rsqb;</number> Furthermore, the correction table formation circuit <highlight><bold>108</bold></highlight> in the automatic tone correction apparatus according to any of claims 1 to 3 may create a conversion table by which expansion of the luminance distribution is performed on only the low-luminance side while expansion of the luminance distribution on the high-luminance side is performed during the process of performing correction so as to match the center of gravity of the low-luminance part of the luminance histogram to the target value, whereby the tone of the high-luminance part is prevented from being collapsed due to tone correction (corresponding to claim 16). </paragraph>
<paragraph id="P-0184" lvl="0"><number>&lsqb;0184&rsqb;</number> The effect of preventing collapse of tone will be described in more detail with reference to FIGS. <highlight><bold>16</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>16</bold></highlight>(<highlight><italic>b</italic></highlight>). <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>a</italic></highlight>) shows a case where the luminance distribution is expanded over all tones, and the luminance histogram is corrected so that the center of gravity of the low-luminance part of the luminance histogram matches the target value, and <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>b</italic></highlight>) shows a case where only the luminance distribution on the low-luminance side is expanded, and the luminance histogram is corrected so that the center of gravity of the low-luminance part of the luminance histogram matches the target value. </paragraph>
<paragraph id="P-0185" lvl="0"><number>&lsqb;0185&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>a</italic></highlight>), the luminance distribution is expanded over all tones, and the luminance histogram is corrected so that the center of gravity of the low-luminance part of the luminance histogram matches the target value, whereby the luminance distribution is twice compressed toward the higher-luminance side, resulting in collapse of the high-luminance part. </paragraph>
<paragraph id="P-0186" lvl="0"><number>&lsqb;0186&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>b</italic></highlight>), however, since the luminance distribution is compressed toward the high-luminance side only when the luminance histogram is corrected so that the center of gravity of the low-luminance part of the luminance histogram matches the target value, collapse of the high-luminance part is reduced as compared with that shown in <cross-reference target="DRAWINGS">FIG. 16</cross-reference>(<highlight><italic>a</italic></highlight>). </paragraph>
<paragraph id="P-0187" lvl="0"><number>&lsqb;0187&rsqb;</number> Since, in this case, the maximum value of the luminance distribution is not necessary, only the minimum value may be calculated by the distribution range calculation circuit <highlight><bold>106</bold></highlight>. Thereby, the amount of calculation can be reduced. </paragraph>
<paragraph id="P-0188" lvl="0"><number>&lsqb;0188&rsqb;</number> As described above, according to the first embodiment, a luminance histogram of a digital image is formed, the center of gravity of its low-luminance part is calculated, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance histogram so that the center of gravity of the low-luminance part of the distribution-expanded luminance histogram matches a target value, is formed, and then tone correction is carried out. Therefore, just once formation of a conversion table enables expansion of the luminance distribution of the luminance histogram created from the digital image signal as well as correction of the luminance histogram so that the center of gravity of the low-luminance part matches the target luminance value, whereby a back-lighted image can be brightly corrected so that the luminance value of the low-luminance area in the back-lighted state matches a target luminance value, resulting in an image the whole contrast of which is improved. Furthermore, also a forward-lighted image can be corrected so that the luminance value in the low-luminance area matches a target value, resulting in an image the whole contrast of which is improved. </paragraph>
<paragraph id="P-0189" lvl="0"><number>&lsqb;0189&rsqb;</number> In this first embodiment, the description has been given of the automatic tone correction apparatus which performs expansion of the luminance distribution simultaneously with tone correction for correcting the luminance distribution so that the center of gravity of the low-luminance part matches the target value, by using the correction table. However, an automatic tone correction method for performing processing that corresponds to the automatic tone correction apparatus is also within the scope of the invention. Furthermore, an automatic tone correction method corresponding to the flowchart of <cross-reference target="DRAWINGS">FIG. 4</cross-reference>(<highlight><italic>a</italic></highlight>) which illustrates the correction principle, an automatic tone correction apparatus corresponding to this automatic tone correction method, and an automatic tone correction program storage medium for recording an automatic tone correction program which makes a computer perform the automatic tone correction method, on various recording mediums, are also within the scope of the invention. Also in these cases, the same effects as achieved by the above-described automatic tone correction apparatus can be realized although expansion of the luminance distribution and tone correction cannot be performed simultaneously. </paragraph>
<paragraph id="P-0190" lvl="7"><number>&lsqb;0190&rsqb;</number> &lsqb;Embodiment 2&rsqb;</paragraph>
<paragraph id="P-0191" lvl="0"><number>&lsqb;0191&rsqb;</number> Hereinafter, a description will be given of a second embodiment of the present invention corresponding to claims 4, 5, 6, 29, 30, 31, and 52 (further, claims 16&tilde;25, 41&tilde;50, 56&tilde;63), with reference to the drawings. </paragraph>
<paragraph id="P-0192" lvl="0"><number>&lsqb;0192&rsqb;</number> In this second embodiment, not a target value but a target luminance distribution is set to perform tone correction. </paragraph>
<paragraph id="P-0193" lvl="0"><number>&lsqb;0193&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to the second embodiment. In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, reference numeral <highlight><bold>601</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>602</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>601</bold></highlight>; reference numeral <highlight><bold>603</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>602</bold></highlight>; reference numeral <highlight><bold>604</bold></highlight> denotes a luminance distribution formation circuit (luminance histogram formation unit) to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>603</bold></highlight>; reference numeral <highlight><bold>605</bold></highlight> denotes a target luminance distribution storage circuit for holding a target luminance distribution to be a goal in performing tone correction; <highlight><bold>606</bold></highlight> denotes a center-of-gravity calculation circuit (center-of-gravity calculation unit) to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>604</bold></highlight>; reference numeral <highlight><bold>607</bold></highlight> denotes a distribution range calculation circuit to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>604</bold></highlight>; reference numeral <highlight><bold>608</bold></highlight> denotes a target value calculation circuit (target value calculation unit) to which a target luminance distribution is supplied from the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>; reference numeral <highlight><bold>609</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the center of gravity supplied from the center-of-gravity calculation circuit <highlight><bold>606</bold></highlight>, a maximum value and a minimum value of the distribution range supplied from the distribution range calculation circuit <highlight><bold>607</bold></highlight>, and the target value supplied from the target value storage circuit <highlight><bold>608</bold></highlight>; and reference numeral <highlight><bold>610</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>602</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>609</bold></highlight>. The correction table formation circuit <highlight><bold>609</bold></highlight> and the image signal correction circuit <highlight><bold>610</bold></highlight> constitute a tone correction section. However, when the tone correction section does not include a function of expanding the distribution of the luminance histogram, the correction table formation circuit <highlight><bold>609</bold></highlight> and the image signal correction circuit <highlight><bold>610</bold></highlight> constitute a luminance distribution expansion section as well as a tone correction section. </paragraph>
<paragraph id="P-0194" lvl="0"><number>&lsqb;0194&rsqb;</number> Next, the operation will be described. The operation of the tone correction apparatus according to this second embodiment is fundamentally identical to the operation of the apparatus according to the first embodiment, except that not a target value but a target luminance distribution is previously set in the storage circuit, and a target value is calculated using the target luminance distribution. </paragraph>
<paragraph id="P-0195" lvl="0"><number>&lsqb;0195&rsqb;</number> In the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>, a luminance histogram to be a target in tone correction is previously set, and the distribution of the luminance histogram is stored. </paragraph>
<paragraph id="P-0196" lvl="0"><number>&lsqb;0196&rsqb;</number> FIGS. <highlight><bold>18</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>18</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams for explaining an example of a luminance histogram to be stored in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>. <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>a</italic></highlight>) is a luminance histogram of an input image in the back-lighted state, and <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>b</italic></highlight>) is a luminance histogram of a target image. In the luminance histogram shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>b</italic></highlight>), the low-luminance part in the back-lighted state shifts toward the higher-luminance side, whereby the back-lighted state is resolved. </paragraph>
<paragraph id="P-0197" lvl="0"><number>&lsqb;0197&rsqb;</number> Next, in the target value calculation circuit <highlight><bold>608</bold></highlight>, a target value is calculated from the target luminance distribution. To be specific, the center of gravity of the low-luminance part of the target luminance distribution stored in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight> is calculated in like manner as calculating the center of gravity by the center-of-gravity calculation circuit <highlight><bold>606</bold></highlight>, and this center of gravity is set as a target value (step S<highlight><bold>200</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 20</cross-reference>). The low-luminance part in the target value calculation circuit <highlight><bold>608</bold></highlight> must be set within the same range as that of the low-luminance part in the center-of-gravity calculation circuit <highlight><bold>606</bold></highlight>. In this second embodiment, the low-luminance part ranges from the tone &ldquo;0&rdquo; to the center tone &ldquo;127&rdquo;. </paragraph>
<paragraph id="P-0198" lvl="0"><number>&lsqb;0198&rsqb;</number> Using the calculated target value, tone correction is carried out in the same manner as described for the first embodiment. To be specific, a luminance conversion table is formed on the basis of the center of gravity calculated by the center-of-gravity calculation circuit <highlight><bold>606</bold></highlight>, the maximum value and minimum value calculated by the distribution range calculation circuit <highlight><bold>607</bold></highlight>, and the target value previously calculated by the target value storage circuit <highlight><bold>608</bold></highlight>. This luminance conversion table is used for expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram after expansion matches the target value. </paragraph>
<paragraph id="P-0199" lvl="0"><number>&lsqb;0199&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 20</cross-reference>(<highlight><italic>a</italic></highlight>) is a flowchart for explaining the principle of the tone correcting process. Initially, a luminance histogram is generated from an input image (step S<highlight><bold>200</bold></highlight>), and the whole luminance distribution of the luminance histogram so generated is expanded over all tones (step S<highlight><bold>201</bold></highlight>). Thereby, the contrast of the input image as a whole can be improved. </paragraph>
<paragraph id="P-0200" lvl="0"><number>&lsqb;0200&rsqb;</number> Next, the center of gravity of the low-luminance part of the image whose contrast is improved as shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>b</italic></highlight>) is obtained (step S<highlight><bold>202</bold></highlight>). Then, a luminance correction target value is calculated from the target luminance distribution (step S<highlight><bold>203</bold></highlight>), and correction is carried out so that the center of gravity of the low-luminance part, which has been shifted due to the expansion of the luminance distribution, is brought to the target value, as shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>b</italic></highlight>) (step S<highlight><bold>204</bold></highlight>). Thereby, the luminance value of the low-tone part can be corrected to the target luminance value. </paragraph>
<paragraph id="P-0201" lvl="0"><number>&lsqb;0201&rsqb;</number> As a result of these two processes, the input image is corrected so that the low-luminance region in the back-lighted state has the target luminance value, and the whole contrast of the image is improved. </paragraph>
<paragraph id="P-0202" lvl="0"><number>&lsqb;0202&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 20</cross-reference>(<highlight><italic>b</italic></highlight>) is a flowchart for explaining a tone correcting process which is actually performed by the automatic tone correction apparatus shown in <cross-reference target="DRAWINGS">FIG. 17</cross-reference>. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>210</bold></highlight>), and the center of gravity of a low-luminance part of this luminance histogram is obtained before expanding the luminance distribution (S<highlight><bold>211</bold></highlight>). Then, a luminance correction target value is calculated (step S<highlight><bold>212</bold></highlight>). Next, in step S<highlight><bold>213</bold></highlight>, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance distribution of the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and thereafter, using this correction table, expansion of the luminance histogram and correction of the luminance distribution so as to match the center of gravity of the low-luminance part to the target value are carried out simultaneously. </paragraph>
<paragraph id="P-0203" lvl="0"><number>&lsqb;0203&rsqb;</number> Thereby, a luminance distribution expansion section (i.e., a conversion table for only expansion of luminance distribution), which is required when expanding the luminance distribution of the luminance histogram immediately after formation of the histogram as shown in <cross-reference target="DRAWINGS">FIG. 20</cross-reference>(<highlight><italic>a</italic></highlight>), becomes unnecessary. Furthermore, as described above, arithmetic errors in the decimal level can be removed. </paragraph>
<paragraph id="P-0204" lvl="0"><number>&lsqb;0204&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 19</cross-reference> shows a luminance histogram of an image which is obtained by calculating a target value from the luminance histogram shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>b</italic></highlight>), and performing tone correction on the input image shown in <cross-reference target="DRAWINGS">FIG. 18</cross-reference>(<highlight><italic>a</italic></highlight>). It can be seen from <cross-reference target="DRAWINGS">FIG. 19</cross-reference> that the peak of the distribution of the low-luminance part shifts toward the higher-luminance side, whereby the low-luminance part is brightly corrected. Furthermore, the distribution is expanded, and the contrast is improved. </paragraph>
<paragraph id="P-0205" lvl="0"><number>&lsqb;0205&rsqb;</number> As described above, the luminance distribution of the luminance histogram generated from the input image is expanded and, simultaneously, tone correction is carried out so that the center of gravity of the low-luminance part of the luminance histogram is shifted to the target value calculated from the target luminance histogram, whereby an image having a target brightness and an enhanced contrast can be obtained. </paragraph>
<paragraph id="P-0206" lvl="0"><number>&lsqb;0206&rsqb;</number> The above-mentioned method further provides an effect as follows. </paragraph>
<paragraph id="P-0207" lvl="0"><number>&lsqb;0207&rsqb;</number> FIGS. <highlight><bold>21</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>21</bold></highlight>(<highlight><italic>b</italic></highlight>) show target luminance distributions for two kinds of input images. To be specific, <cross-reference target="DRAWINGS">FIG. 21</cross-reference>(<highlight><italic>a</italic></highlight>) is a target luminance distribution of a forward-lighted image, and <cross-reference target="DRAWINGS">FIG. 21</cross-reference>(<highlight><italic>b</italic></highlight>) is a target luminance distribution of a back-lighted image. These images have the same shape of distribution in the low-luminance part. </paragraph>
<paragraph id="P-0208" lvl="0"><number>&lsqb;0208&rsqb;</number> For example, as a tone correction method other than the above-mentioned method using the target luminance distribution, there is a method for correcting tones so that the shape of the luminance distribution of the input image becomes identical to the shape of the target luminance distribution. In this method, since the result of correction significantly varies as the shape of distribution varies, it is necessary to provide different processes (case branching) for the forward-lighted image and the back-lighted image having different shapes of luminance histograms to set the target luminance distributions suited to their respective states as shown in FIGS. <highlight><bold>21</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>21</bold></highlight>(<highlight><italic>b</italic></highlight>). </paragraph>
<paragraph id="P-0209" lvl="0"><number>&lsqb;0209&rsqb;</number> However, since the target value calculation circuit <highlight><bold>608</bold></highlight> of this second embodiment calculates the center of gravity of only the low-luminance part and uses the obtained center of gravity as a target value, the target values calculated from the two target luminance distributions shown in FIGS. <highlight><bold>21</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>21</bold></highlight>(<highlight><italic>b</italic></highlight>) become the same value. Therefore, in the correction method according to this second embodiment, either of the two target luminance distributions provides the same correction result. Accordingly, whichever target luminance distribution may be used for tone correction. </paragraph>
<paragraph id="P-0210" lvl="0"><number>&lsqb;0210&rsqb;</number> Consequently, according to the method of this second embodiment, the same target luminance distribution can be used in tone correction for the forward-light image and the back-lighted image as long as the target luminance values of their low-luminance parts are the same. Therefore, it is not necessary to provide different processes (case branching) for plural images having different characteristics of brightness, whereby tone correction can be executed speedily. </paragraph>
<paragraph id="P-0211" lvl="0"><number>&lsqb;0211&rsqb;</number> Since tone correction can be carried out even when the shape of the luminance histogram is not identical to the shape of the target luminance distribution in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>, the target luminance distribution may be approximated to a curve and this curve may be stored in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>, as defined in claim 5. Then, in the target value calculation circuit <highlight><bold>608</bold></highlight>, a luminance distribution expanding over the tones from &ldquo;0&rdquo; to &ldquo;255&rdquo; is formed from the curve, and a target value is calculated. </paragraph>
<paragraph id="P-0212" lvl="0"><number>&lsqb;0212&rsqb;</number> Further, since the target value relates to only the low-luminance part of the target luminance distribution, the curve to be stored in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight> may be a normal distribution curve shown in <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>a</italic></highlight>) that is expressed by formula (17) wherein the average value is &mgr; and the standard deviation is &sgr;, or a cosine curve shown in <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>b</italic></highlight>) that is expressed by formula (18), or a straight line shown in <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>c</italic></highlight>) that is expressed by formula (19).  
<math-cwu id="MATH-US-00006">
<number>6</number>
<math>
<mtable>
  <mtr>
    <mtd>
      <mrow>
        <mrow>
          <mi>f</mi>
          <mo>&af;</mo>
          <mrow>
            <mo>(</mo>
            <mi>x</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>=</mo>
        <mrow>
          <mfrac>
            <mn>1</mn>
            <mrow>
              <msqrt>
                <mrow>
                  <mn>2</mn>
                  <mo>&it;</mo>
                  <mi>&pi;</mi>
                </mrow>
              </msqrt>
              <mo>&times;</mo>
              <mi>&sigma;</mi>
            </mrow>
          </mfrac>
          <mo>&times;</mo>
          <msup>
            <mi>e</mi>
            <mrow>
              <mo>-</mo>
              <mfrac>
                <msup>
                  <mrow>
                    <mo>(</mo>
                    <mrow>
                      <mi>x</mi>
                      <mo>-</mo>
                      <mi>&mu;</mi>
                    </mrow>
                    <mo>)</mo>
                  </mrow>
                  <mn>2</mn>
                </msup>
                <mrow>
                  <mn>2</mn>
                  <mo>&it;</mo>
                  <msup>
                    <mi>&sigma;</mi>
                    <mn>2</mn>
                  </msup>
                </mrow>
              </mfrac>
            </mrow>
          </msup>
        </mrow>
      </mrow>
    </mtd>
    <mtd>
      <mrow>
        <mo>(</mo>
        <mn>17</mn>
        <mo>)</mo>
      </mrow>
    </mtd>
  </mtr>
</mtable>
</math>
<mathematica-file id="MATHEMATICA-00006" file="US20030002736A1-20030102-M00006.NB"/>
<image id="EMI-M00006" wi="216.027" he="23.04855" file="US20030002736A1-20030102-M00006.TIF" imf="TIFF" ti="MF"/>
</math-cwu>
</paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>f</italic></highlight>(<highlight><italic>x</italic></highlight>)&equals;<highlight><italic>A</italic></highlight>&times;Cos(<highlight><italic>x</italic></highlight>) (A:constant)&emsp;&emsp;(18) </in-line-formula></paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>f</italic></highlight>(<highlight><italic>x</italic></highlight>)&equals;<highlight><italic>A </italic></highlight>(A:constant)&emsp;&emsp;(19) </in-line-formula></paragraph>
<paragraph id="P-0213" lvl="0"><number>&lsqb;0213&rsqb;</number> When providing the target luminance distribution by a curve or a straight line as described above, setting of the target luminance value is facilitated, whereby the storage capacity of the memory can be reduced as compared with the case where all of coordinates of points constituting the target luminance distribution are stored. </paragraph>
<paragraph id="P-0214" lvl="0"><number>&lsqb;0214&rsqb;</number> Further, a plurality of target luminance distributions may be previously stored in the target luminance distribution storage circuit <highlight><bold>605</bold></highlight>, and an optimum target value may be calculated by changing the shapes of the stored target luminance distributions according to the luminance histogram of the input image. Thereby, the target value can be easily adjusted. </paragraph>
<paragraph id="P-0215" lvl="0"><number>&lsqb;0215&rsqb;</number> When providing the target luminance distribution by a curve, curves having different gradients may be stored. For example, in the curve shown in <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>b</italic></highlight>), a cosine curve in which the value A is changed is stored. </paragraph>
<paragraph id="P-0216" lvl="0"><number>&lsqb;0216&rsqb;</number> Alternatively, previously given two curves may be synthesized according to the luminance histogram of the input image to make a new curve. For example, in the case where the curves shown in FIGS. <highlight><bold>22</bold></highlight>(<highlight><italic>b</italic></highlight>) and <highlight><bold>22</bold></highlight>(<highlight><italic>c</italic></highlight>) are given, when the luminance histogram of the input image is as shown in <cross-reference target="DRAWINGS">FIG. 23</cross-reference>(<highlight><italic>a</italic></highlight>), a curve as shown in <cross-reference target="DRAWINGS">FIG. 23</cross-reference>(<highlight><italic>c</italic></highlight>), in which the ratio of the curve of <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>b</italic></highlight>) is increased, is formed. When the luminance histogram is as shown in <cross-reference target="DRAWINGS">FIG. 23</cross-reference>(<highlight><italic>b</italic></highlight>), a curve as shown in <cross-reference target="DRAWINGS">FIG. 23</cross-reference>(<highlight><italic>d</italic></highlight>), in which the ratio of the curve of <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>c</italic></highlight>) is increased, is formed. </paragraph>
<paragraph id="P-0217" lvl="0"><number>&lsqb;0217&rsqb;</number> Furthermore, the correction table formation circuit <highlight><bold>609</bold></highlight> included in the automatic tone correction apparatus according to any of claims 4, 5, and 6 may form a conversion table such that expansion of the luminance distribution is performed on only the low-luminance side while expansion of the luminance distribution on the high-luminance side is performed during the process of performing correction so that the center of gravity of the low-luminance part of the luminance histogram matches the target value, whereby the tones of the high-luminance part is prevented from being collapsed due to tone correction (corresponding to claim 16). </paragraph>
<paragraph id="P-0218" lvl="0"><number>&lsqb;0218&rsqb;</number> In this case, since the maximum value of the luminance distribution is not necessary, the distribution range calculation circuit <highlight><bold>607</bold></highlight> may calculate only the minimum value, whereby the computational complexity is reduced. </paragraph>
<paragraph id="P-0219" lvl="0"><number>&lsqb;0219&rsqb;</number> Furthermore, as described for the first embodiment, modifications as defined in claims 20 to 25 may be added. </paragraph>
<paragraph id="P-0220" lvl="0"><number>&lsqb;0220&rsqb;</number> More specifically, in the luminance distribution formation circuit <highlight><bold>104</bold></highlight>, a restriction may be put on the amount of accumulation of the luminance distribution (corresponding to claim 20). By setting a restriction on the luminance histogram, the amount of correction can be accurately calculated even when there is an extreme deviation such that the tone distribution concentrates on a certain tone, for example, when a background of a back-lighted image or the like occurs halation and thus the luminance level concentrates on &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0221" lvl="0"><number>&lsqb;0221&rsqb;</number> Further, a skin-color region may be extracted from color-difference signals and a luminance signal and, when a luminance histogram is created, the luminance distribution of the skin color region in the image may be added to the luminance distribution of the whole image, according to the area of the skin-color region (corresponding to claim 21). By adding a weight in this way, tone correction in which the skin-color region is optimized can be carried out. </paragraph>
<paragraph id="P-0222" lvl="0"><number>&lsqb;0222&rsqb;</number> Furthermore, in the luminance distribution of the skin-color region, the distribution of the high-luminance part may be weighted (corresponding to claim 22). For example, the luminance distribution of the skin-color region is multiplied by a coefficient as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> to weight the high-luminance part. </paragraph>
<paragraph id="P-0223" lvl="0"><number>&lsqb;0223&rsqb;</number> Moreover, the center of gravity of the high-luminance part may be calculated from the luminance histogram, and the amount of correction in the high-luminance part may be calculated according to the center of gravity of the high-luminance part (corresponding to claim 23). </paragraph>
<paragraph id="P-0224" lvl="0"><number>&lsqb;0224&rsqb;</number> Of course, a correction table may be formed according to a correction point which is set so that the center of gravity of the high-luminance part matches a predetermined target value of the high-luminance part, in like manner as described for correction of the low-luminance part. </paragraph>
<paragraph id="P-0225" lvl="0"><number>&lsqb;0225&rsqb;</number> When the luminance distribution formed by the luminance distribution formation circuit is discrete, tone correction is not carried out (corresponding to claim 24). The reason is as follows. When the luminance distribution is discrete, the image can be judged as an artificial image and, generally, it is better not to perform tone correction on an artificial image. </paragraph>
<paragraph id="P-0226" lvl="0"><number>&lsqb;0226&rsqb;</number> When a digital image signal is separated into a luminance signal and color-difference signals and tone correction is performed on the luminance signal, the color-difference signals may be corrected according to the correction table (corresponding to claim 25). Thereby, when R, G, B signals are formed from the tone-corrected luminance signal and color-difference signals, a phenomenon, in which the saturation appears degraded due to luminance correction, is suppressed. </paragraph>
<paragraph id="P-0227" lvl="0"><number>&lsqb;0227&rsqb;</number> As described above, according to the second embodiment, a luminance histogram of a digital image is formed, the center of gravity of a low-luminance part of the histogram is calculated, a luminance correction target value is calculated from a target luminance distribution, and a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and then tone correction is carried out using the correction table. Therefore, just once formation of a conversion table enables expansion of the luminance distribution of the luminance histogram formed from the digital image signal as well as correction of the luminance histogram so as to match the center of gravity of the low-luminance part to the target luminance value, whereby a back-lighted image can be brightly corrected so that the low-luminance region in the back-lighted state has a target luminance value, resulting in an image the whole contrast of which is improved. Furthermore, even a forward-lighted image can be corrected so that the luminance value in the low-luminance area matches a target value, resulting in an image the whole contrast of which is improved. </paragraph>
<paragraph id="P-0228" lvl="0"><number>&lsqb;0228&rsqb;</number> In this second embodiment, the description has been given of the automatic tone correction apparatus which performs expansion of the luminance distribution simultaneously with tone correction for correcting the luminance distribution so that the center of gravity of the low-luminance part matches the target value, by using the correction table. However, an automatic tone correction method for performing processing corresponding to the automatic tone correction apparatus is also within the scope of the invention. Furthermore, an automatic tone correction method corresponding to the flowchart of <cross-reference target="DRAWINGS">FIG. 20</cross-reference>(<highlight><italic>a</italic></highlight>) which illustrates the correction principle, an automatic tone correction apparatus corresponding to this automatic tone correction method, and an automatic tone correction program storage medium for recording an automatic tone correction program which makes a computer perform the automatic tone correction method, into various recording mediums, are also within the scope of the invention. Also in these cases, the same effects as achieved by the above-described automatic tone correction apparatus can be realized although expansion of the luminance distribution and tone correction cannot be performed simultaneously. </paragraph>
<paragraph id="P-0229" lvl="7"><number>&lsqb;0229&rsqb;</number> &lsqb;Embodiment 3&rsqb;</paragraph>
<paragraph id="P-0230" lvl="0"><number>&lsqb;0230&rsqb;</number> Hereinafter, a description will be given of a third embodiment of the present invention corresponding to claims 7, 32, and 35 (further, claims 8, 9, 16&tilde;25, 33, 34, 41&tilde;50, 56&tilde;63), with reference to the drawings. </paragraph>
<paragraph id="P-0231" lvl="0"><number>&lsqb;0231&rsqb;</number> In this third embodiment, a boundary of a low-luminance part and a high-luminance part can be changed according to the center of gravity of a luminance histogram of an input image. </paragraph>
<paragraph id="P-0232" lvl="0"><number>&lsqb;0232&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 24</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to the third embodiment. </paragraph>
<paragraph id="P-0233" lvl="0"><number>&lsqb;0233&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 24</cross-reference>, reference numeral <highlight><bold>1101</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; Preference numeral <highlight><bold>1102</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>1101</bold></highlight>; reference numeral <highlight><bold>1103</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>1102</bold></highlight>; reference numeral <highlight><bold>1104</bold></highlight> denotes a luminance distribution formation circuit (luminance histogram formation unit) to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>1103</bold></highlight>; reference numeral <highlight><bold>1110</bold></highlight> denotes a boundary value calculation circuit (boundary value calculation unit) to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1104</bold></highlight>; reference numeral <highlight><bold>1105</bold></highlight> denotes a center-of-gravity calculation circuit (center-of-gravity calculation unit) to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1104</bold></highlight>, and a boundary value is supplied from the boundary value calculation circuit <highlight><bold>1110</bold></highlight>; reference numeral <highlight><bold>1106</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1104</bold></highlight>; reference numeral <highlight><bold>1107</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>1108</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the center of gravity supplied from the center-of-gravity calculation circuit <highlight><bold>1105</bold></highlight>, a maximum value and a minimum value of the redistribution range supplied from the distribution range calculation circuit <highlight><bold>1106</bold></highlight>, and the target value supplied from the target value storage circuit <highlight><bold>1107</bold></highlight>; and reference numeral <highlight><bold>1109</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>1102</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>1108</bold></highlight>. The correction table formation circuit <highlight><bold>1108</bold></highlight> and the image signal correction circuit <highlight><bold>1109</bold></highlight> constitute a tone correction section. However, when the tone correction section does not include a function of expanding the distribution of the luminance histogram, the correction table formation circuit <highlight><bold>1108</bold></highlight> and the image signal correction circuit <highlight><bold>1109</bold></highlight> constitute a luminance distribution expansion section as well as a tone correction section. </paragraph>
<paragraph id="P-0234" lvl="0"><number>&lsqb;0234&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 27</cross-reference>(<highlight><italic>a</italic></highlight>) is a flowchart illustrating the principle of a tone correcting process according to the third embodiment. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>301</bold></highlight>), and the luminance histogram is expanded (step S<highlight><bold>302</bold></highlight>). Next, the center of gravity of the expanded luminance histogram over all tones is calculated (step S<highlight><bold>310</bold></highlight>), and a boundary value between a low-luminance part and a high-luminance part of the expanded luminance histogram is calculated (step S<highlight><bold>311</bold></highlight>). Then, the center of gravity of the low-luminance part of the luminance histogram is obtained (step S<highlight><bold>303</bold></highlight>), and the luminance histogram is corrected so that the center of gravity of the low-luminance part matches a target value (step S<highlight><bold>304</bold></highlight>). </paragraph>
<paragraph id="P-0235" lvl="0"><number>&lsqb;0235&rsqb;</number> Next, the operation will be described. The operation of the tone correction apparatus according to this third embodiment is fundamentally identical to that of the apparatus according to the first embodiment. However, in this third embodiment, a boundary value between the low-luminance part and the high-luminance part is variable, and the boundary value calculation circuit <highlight><bold>1110</bold></highlight> sets a boundary value according to an input image, although in the first embodiment the luminance histogram is divided into two equal parts, i.e., the low-luminance part and the high-luminance part, using the center luminance level of the input luminance level axis as a boundary value. </paragraph>
<paragraph id="P-0236" lvl="0"><number>&lsqb;0236&rsqb;</number> Since the boundary value is variable, a low-luminance part including a back-lighted region in a back-lighted image can be accurately extracted, whereby the back-lighted region can be corrected to a target luminance value more accurately. </paragraph>
<paragraph id="P-0237" lvl="0"><number>&lsqb;0237&rsqb;</number> As already described above, a luminance histogram formed from a back-lighted image has two peaks, one on its high-luminance side and the other on its low-luminance side, as shown in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>(<highlight><italic>b</italic></highlight>). When the center of gravity over all tones is calculated in this state, if the ratio of a dark region including a back-lighted area to the while image region is large, the center of gravity shifts toward the low-luminance side with respect to the center luminance level (127) as shown in <cross-reference target="DRAWINGS">FIG. 25</cross-reference>(<highlight><italic>a</italic></highlight>). On the other hand, if the ratio of the dark region including a back-lighted area to the whole image region is small, the center of gravity shifts toward the high-luminance side with respect to the center luminance level as shown in <cross-reference target="DRAWINGS">FIG. 25</cross-reference>(<highlight><italic>b</italic></highlight>). </paragraph>
<paragraph id="P-0238" lvl="0"><number>&lsqb;0238&rsqb;</number> So, in this third embodiment, the center of gravity over all tones of the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight> is calculated, and the boundary value is shifted on the basis of the calculated center of gravity. Thereby, the luminance histogram can be accurately separated into the low-luminance part including the back-lighted area and the high-luminance part. </paragraph>
<paragraph id="P-0239" lvl="0"><number>&lsqb;0239&rsqb;</number> To be specific, in the boundary value calculation circuit <highlight><bold>1110</bold></highlight>, the center of gravity over all tones of the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight> is obtained, and a tone which is shifted from the center tone by an amount calculated on the basis of the obtained center of gravity is regarded as a boundary value between the low-luminance part and the high-luminance part. </paragraph>
<paragraph id="P-0240" lvl="0"><number>&lsqb;0240&rsqb;</number> Assuming that the center of gravity of the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight> is G and the center tone is H, the boundary value T is calculated by formula (20) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>T&equals;H</italic></highlight>&plus;(<highlight><italic>H&minus;G</italic></highlight>)&times;0.5&emsp;&emsp;(20) </in-line-formula></paragraph>
<paragraph id="P-0241" lvl="7"><number>&lsqb;0241&rsqb;</number> wherein &ldquo;0.5&rdquo; is a coefficient for controlling the amount of shift, and it is not restricted to &ldquo;0.5&rdquo;. For example, when the coefficient is &ldquo;1.0&rdquo;, a difference between the center tone and the center of gravity over all tones becomes the amount of shift. </paragraph>
<paragraph id="P-0242" lvl="0"><number>&lsqb;0242&rsqb;</number> Next, assuming that the region from the &ldquo;0&rdquo; level to the boundary value calculated by the boundary value calculation circuit <highlight><bold>1110</bold></highlight> is a low-luminance part, the center-of-gravity calculation circuit <highlight><bold>1105</bold></highlight> calculates the center of gravity of the low luminance part of the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight>, and then the correction table formation circuit <highlight><bold>1108</bold></highlight> forms a luminance conversion table on the basis of the center of gravity, the target value stored in the target value storage circuit <highlight><bold>1107</bold></highlight>, and the maximum and minimum values calculated by the distribution range calculation circuit <highlight><bold>1106</bold></highlight>. Thereafter, the image signal correction circuit <highlight><bold>1109</bold></highlight> performs tone correction. </paragraph>
<paragraph id="P-0243" lvl="0"><number>&lsqb;0243&rsqb;</number> Thereby, an image having a target brightness and an enhanced contrast as a whole is obtained. </paragraph>
<paragraph id="P-0244" lvl="0"><number>&lsqb;0244&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 27</cross-reference>(<highlight><italic>b</italic></highlight>) is a flowchart for explaining a tone correcting process the automatic tone correction apparatus shown in <cross-reference target="DRAWINGS">FIG. 24</cross-reference> actually performs. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>321</bold></highlight>), and the center of gravity of this luminance histogram over all tones is obtained before expanding the luminance distribution (step S<highlight><bold>330</bold></highlight>). Next, a boundary value between the low-luminance part and the high-luminance part of the luminance histogram is calculated (in step S<highlight><bold>331</bold></highlight>), and the center of gravity of the low-luminance part of the luminance histogram is obtained (step S<highlight><bold>322</bold></highlight>). Next, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance distribution of the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed. Using this correction table, expansion of the luminance histogram and correction of the luminance distribution so as to make the center of gravity of the low-luminance part match the target value are carried out simultaneously (step S<highlight><bold>323</bold></highlight>). </paragraph>
<paragraph id="P-0245" lvl="0"><number>&lsqb;0245&rsqb;</number> Thereby, a luminance distribution expansion section (i.e., a conversion table for only expansion of luminance distribution), which is required when expanding the luminance distribution of the luminance histogram immediately after formation of the histogram as shown in <cross-reference target="DRAWINGS">FIG. 27</cross-reference>(<highlight><italic>a</italic></highlight>), becomes unnecessary. Furthermore, as described above, arithmetic errors in the decimal level can be removed. </paragraph>
<paragraph id="P-0246" lvl="0"><number>&lsqb;0246&rsqb;</number> While in this third embodiment a target value is previously set and stored in the target value storage circuit <highlight><bold>1107</bold></highlight>, a target value may be calculated from a target luminance distribution and stored in the target value storage circuit <highlight><bold>1107</bold></highlight> as described for the second embodiment. In this case, as in the center-of-gravity calculating method employed by the center-of-gravity calculation circuit <highlight><bold>1105</bold></highlight>, a range from the &ldquo;0&rdquo; level to the boundary value is set as a low-luminance part, the center of gravity of the low luminance part of the target luminance distribution is obtained, and the obtained center of gravity is used as a target value. </paragraph>
<paragraph id="P-0247" lvl="0"><number>&lsqb;0247&rsqb;</number> The above-described boundary value calculating method is merely an example, and other methods may be employed so long as the low-luminance part can be accurately detected from the whole luminance histogram. </paragraph>
<paragraph id="P-0248" lvl="0"><number>&lsqb;0248&rsqb;</number> For example, in the boundary value calculation circuit <highlight><bold>1110</bold></highlight>, the luminance range is divided into plural areas, and the center of gravity is obtained as a feature parameter of each area, and a boundary value is calculated from the obtained center of gravity (corresponding to claim 8). </paragraph>
<paragraph id="P-0249" lvl="0"><number>&lsqb;0249&rsqb;</number> More specifically, the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight> is divided into two areas at the center tone, and the center of gravity of each area is obtained. Then, the middle point between the obtained two centers of gravity is used for calculating an amount of shift. </paragraph>
<paragraph id="P-0250" lvl="0"><number>&lsqb;0250&rsqb;</number> Assuming that, when the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1104</bold></highlight> is divided into two equal parts, the center of gravity of the low-luminance-side region is G1, the center of gravity of the high-luminance-side region is G2, and the-center tone is H, a boundary value T is calculated by formula (21) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>T&equals;H</italic></highlight>&plus;((<highlight><italic>G</italic></highlight>1<highlight><italic>&plus;G</italic></highlight>2)/2<highlight><italic>&minus;H</italic></highlight>)&times;1.0&emsp;&emsp;(21) </in-line-formula></paragraph>
<paragraph id="P-0251" lvl="7"><number>&lsqb;0251&rsqb;</number> wherein &ldquo;1.0&rdquo; is a coefficient for controlling the amount of shift and, when the coefficient is &ldquo;1.0&rdquo;, the middle point between the two centers of gravity is a boundary value. </paragraph>
<paragraph id="P-0252" lvl="0"><number>&lsqb;0252&rsqb;</number> FIGS. <highlight><bold>26</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>26</bold></highlight>(<highlight><italic>b</italic></highlight>) illustrates boundary values which are calculated using formulae (20) and (21) for the same luminance histogram, respectively. As shown in FIGS. <highlight><bold>26</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>26</bold></highlight>(<highlight><italic>b</italic></highlight>), when the frequency concentrates on limited tones on the high-luminance side to be higher than the total frequency on the low-luminance side, the center of gravity over all tones is placed on the side where the frequency concentrates. Accordingly, in <cross-reference target="DRAWINGS">FIG. 26</cross-reference>(<highlight><italic>a</italic></highlight>), the boundary value is unfavorably set in the mountain-shape distribution of the low-luminance part. In <cross-reference target="DRAWINGS">FIG. 26</cross-reference>(<highlight><italic>b</italic></highlight>), however, the high-luminance side and the low-luminance side are separated from each other, and the &ldquo;mountain&rdquo; on the low-luminance side and the &ldquo;mountain&rdquo; on the high-luminance side are considered separately, whereby the boundary value can be set in the &ldquo;valley&rdquo; of the mountain-shape distributions. </paragraph>
<paragraph id="P-0253" lvl="0"><number>&lsqb;0253&rsqb;</number> As described above, since a boundary value which divides the luminance histogram into two parts is obtained, even when the frequency of luminance distribution is extremely biased to one side, an accurate boundary value can be calculated. </paragraph>
<paragraph id="P-0254" lvl="0"><number>&lsqb;0254&rsqb;</number> There is another method for calculating a boundary value, in which the luminance region is divided into plural parts, the frequency in each region is calculated, and a region of a low frequency, which is sandwiched by regions of high frequencies, is used as a boundary value. </paragraph>
<paragraph id="P-0255" lvl="0"><number>&lsqb;0255&rsqb;</number> In the above-mentioned boundary value calculation method in which the luminance histogram is divided into two regions at the center tone and the center of gravity of each region is calculated, the center of gravity of the low-luminance region that is obtained by dividing the luminance range into two regions with the boundary value calculation circuit <highlight><bold>1110</bold></highlight> may be the center of gravity to be used in the correction table formation circuit <highlight><bold>1108</bold></highlight>, as defined in claim 9. </paragraph>
<paragraph id="P-0256" lvl="0"><number>&lsqb;0256&rsqb;</number> In this case, since it is not necessary to calculate the center of gravity of the low-luminance region up to the boundary value by the center-of-gravity calculation circuit <highlight><bold>1105</bold></highlight>, the center-of-gravity calculation circuit <highlight><bold>1105</bold></highlight> can be dispensed with. </paragraph>
<paragraph id="P-0257" lvl="0"><number>&lsqb;0257&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 28</cross-reference> is a block diagram illustrating the construction of the automatic tone correction apparatus in this case. In <cross-reference target="DRAWINGS">FIG. 28</cross-reference>, reference numeral <highlight><bold>1401</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>1402</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>1401</bold></highlight>; reference numeral <highlight><bold>1403</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>1402</bold></highlight>; reference numeral <highlight><bold>1404</bold></highlight> denotes a luminance distribution formation circuit to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>1403</bold></highlight>; reference numeral <highlight><bold>1410</bold></highlight> denotes a target luminance distribution storage circuit for holding a target luminance distribution to be a goal in performing tone correction; reference numeral <highlight><bold>1409</bold></highlight> denotes a boundary value calculation circuit to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1404</bold></highlight>; reference numeral <highlight><bold>1406</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1404</bold></highlight>; reference numeral <highlight><bold>1405</bold></highlight> denotes a target value calculation circuit to which a boundary value is supplied from the boundary value calculation circuit <highlight><bold>1409</bold></highlight>, and a target luminance distribution is supplied from the target luminance distribution storage circuit <highlight><bold>1410</bold></highlight>; reference numeral <highlight><bold>1407</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the target value supplied from the target value calculation circuit <highlight><bold>1405</bold></highlight>, a maximum value and a minimum value of the distribution range supplied from the distribution range calculation circuit <highlight><bold>1406</bold></highlight>, and the center of gravity supplied from the boundary value calculation circuit <highlight><bold>1409</bold></highlight>; and reference numeral <highlight><bold>1408</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>1402</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>1407</bold></highlight>. </paragraph>
<paragraph id="P-0258" lvl="0"><number>&lsqb;0258&rsqb;</number> Next, the operation will be described. Although the fundamental operation is identical to that of the apparatus defined in claim 4 or 7, the boundary value calculation circuit <highlight><bold>1409</bold></highlight> calculates a boundary value, and a center of gravity of the low-luminance part. Then, the target value calculation circuit <highlight><bold>1405</bold></highlight> calculates a target value on the basis of the target luminance distribution stored in the target luminance distribution storage circuit <highlight><bold>1410</bold></highlight>, and the boundary value calculated by the boundary value calculation circuit <highlight><bold>1409</bold></highlight>. The correction table formation circuit <highlight><bold>1407</bold></highlight> forms a correction table for tone correction, on the basis of the target value calculated by the target value calculation circuit <highlight><bold>1405</bold></highlight>, the maximum and minimum values obtained by the distribution range calculation circuit <highlight><bold>1406</bold></highlight>, and the center of gravity of the low-luminance part obtained by the boundary value calculation circuit <highlight><bold>1409</bold></highlight>. </paragraph>
<paragraph id="P-0259" lvl="0"><number>&lsqb;0259&rsqb;</number> Furthermore, the correction table formation circuit in the automatic tone correction apparatus according to any of claims 7 to 9 may create a conversion table by which expansion of the luminance distribution is performed on only the low-luminance side while expansion of the luminance distribution on the high-luminance side is performed during the process of performing correction so as to match the center of gravity of the low-luminance part of the luminance histogram to the target value, whereby the tone of the high-luminance part is prevented from being collapsed due to tone correction (corresponding to claim 16). </paragraph>
<paragraph id="P-0260" lvl="0"><number>&lsqb;0260&rsqb;</number> In this case, since the maximum value of the luminance distribution is not necessary, the distribution range calculation circuit may calculate only the minimum value, whereby the computational complexity is reduced. </paragraph>
<paragraph id="P-0261" lvl="0"><number>&lsqb;0261&rsqb;</number> Furthermore, as described for the first embodiment, modifications as described in claims 20 to 25 may be added to this third embodiment. </paragraph>
<paragraph id="P-0262" lvl="0"><number>&lsqb;0262&rsqb;</number> That is, in the luminance distribution formation circuit <highlight><bold>1404</bold></highlight>, a restriction may be put on the amount of accumulation of the luminance distribution (corresponding to claim 20). By setting a restriction on the luminance histogram, the amount of correction can be accurately calculated even when there is an extreme deviation such that the tone distribution concentrates on a certain tone, for example, when a background of a back-lighted image or the like occurs halation and thus the luminance level concentrates on &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0263" lvl="0"><number>&lsqb;0263&rsqb;</number> Further, a skin-color region may be extracted from color-difference signals and a luminance signal and, when a luminance histogram is created, the luminance distribution of the skin color region in the image may be added to the luminance distribution of the whole image, according to the area of the skin-color region (corresponding to claim 21). By adding a weight in this way, tone correction in which the skin-color region is optimized can be carried out. </paragraph>
<paragraph id="P-0264" lvl="0"><number>&lsqb;0264&rsqb;</number> Furthermore, in the luminance distribution of the skin-color region, the distribution of the high-luminance part may be weighted (corresponding to claim 22). For example, the luminance distribution of the skin-color region is multiplied by a coefficient as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> to weight the high-luminance part. </paragraph>
<paragraph id="P-0265" lvl="0"><number>&lsqb;0265&rsqb;</number> Moreover, the center of gravity of the high-luminance part may be calculated from the luminance histogram, and the amount of correction in the high-luminance part may be calculated according to the center of gravity of the high-luminance part (corresponding to claim 23). </paragraph>
<paragraph id="P-0266" lvl="0"><number>&lsqb;0266&rsqb;</number> When the luminance distribution formed by the luminance distribution formation circuit is discrete, tone correction is not carried out (corresponding to claim 24). The reason is as follows. When the luminance distribution is discrete, the image can be judged as an artificial image and, generally, it is better not to perform tone correction on an artificial image. </paragraph>
<paragraph id="P-0267" lvl="0"><number>&lsqb;0267&rsqb;</number> When a digital image signal is separated into a luminance signal and color-difference signals and tone correction is performed on the luminance signal, the color-difference signals may be corrected according to the correction table (corresponding to claim 25). Thereby, when R, G, B signals are formed from the tone-corrected luminance signal and color-difference signals, a phenomenon, in which the saturation appears degraded due to luminance correction, is suppressed. </paragraph>
<paragraph id="P-0268" lvl="0"><number>&lsqb;0268&rsqb;</number> As described above, according to the third embodiment, a luminance histogram of a digital image is formed, the center of gravity over all tones of this histogram is calculated, a boundary value between a low-luminance part and a high-luminance part is calculated on the basis of the center of gravity, the center of gravity of the low-luminance part is calculated, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and tone correction is carried out using the correction table. Therefore, the low-luminance part and the high-luminance part can be accurately separated according to the center of gravity of the whole luminance histogram. Further, just once formation of a conversion table enables expansion of the luminance distribution of the luminance histogram formed from the digital image signal and, simultaneously, correction of the luminance histogram so that the center of gravity of the low-luminance part matches the target luminance value, whereby a back-lighted image can be brightly corrected so that the low-luminance area in the back-lighted state has a target luminance value, resulting in an image the whole contrast of which is improved. Furthermore, even a forward-lighted image can be corrected so that the luminance value in the low-luminance area matches a target value, resulting in an image the whole contrast of which is improved. </paragraph>
<paragraph id="P-0269" lvl="0"><number>&lsqb;0269&rsqb;</number> In this third embodiment, the description has been given of the automatic tone correction apparatus which performs expansion of the luminance distribution simultaneously with tone correction for correcting the luminance distribution so that the center of gravity of the low-luminance part matches the target value, by using the correction table. However, an automatic tone correction method for performing processing corresponding to the automatic tone correction apparatus is also within the scope of the invention. Furthermore, an automatic tone correction method corresponding to the flowchart of <cross-reference target="DRAWINGS">FIG. 27</cross-reference>(<highlight><italic>a</italic></highlight>) which illustrates the correction principle, an automatic tone correction apparatus corresponding to this automatic tone correction method, and an automatic tone correction program storage medium for recording an automatic tone correction program which makes a computer perform the automatic tone correction method, into various recording mediums, are also within the scope of the invention. Also in these cases, the same effects as achieved by the above-described automatic tone correction apparatus can be realized although expansion of the luminance distribution and tone correction cannot be performed simultaneously. </paragraph>
<paragraph id="P-0270" lvl="7"><number>&lsqb;0270&rsqb;</number> &lsqb;Embodiment 4&rsqb;</paragraph>
<paragraph id="P-0271" lvl="0"><number>&lsqb;0271&rsqb;</number> Hereinafter, a description will be given of a fourth embodiment of the present invention corresponding to claims 10, 35, and 54 (further, claims 11, 12, 16&tilde;25, 36, 37, 41&tilde;50, 56&tilde;63), with reference to the drawings. </paragraph>
<paragraph id="P-0272" lvl="0"><number>&lsqb;0272&rsqb;</number> In this fourth embodiment, a boundary of a low-luminance part and a high-luminance part is detected on the basis of the shape of a luminance histogram. </paragraph>
<paragraph id="P-0273" lvl="0"><number>&lsqb;0273&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 29</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to the fourth embodiment. </paragraph>
<paragraph id="P-0274" lvl="0"><number>&lsqb;0274&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 29</cross-reference>, reference numeral <highlight><bold>1501</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>1502</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>1501</bold></highlight>; reference numeral <highlight><bold>1503</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>1502</bold></highlight>; reference numeral <highlight><bold>1504</bold></highlight> denotes a luminance distribution formation circuit (luminance histogram formation unit) to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>1503</bold></highlight>; reference numeral <highlight><bold>1512</bold></highlight> denotes a mountain-shape distribution detection circuit (mountain-shape distribution detector) to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>; reference numeral <highlight><bold>1511</bold></highlight> denotes a boundary value calculation circuit (boundary value calculation unit) to which the range of a mountain-shape distribution is supplied from the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>, and a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>; reference numeral <highlight><bold>1106</bold></highlight> denotes a center-of-gravity calculation circuit (center-of-gravity calculation unit) to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>, and a boundary value is supplied from the boundary value calculation circuit <highlight><bold>1511</bold></highlight>; reference numeral <highlight><bold>1507</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>; reference numeral <highlight><bold>1505</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>1508</bold></highlight> denotes a target value calculation circuit to which a target luminance distribution is supplied from the target luminance distribution storage circuit <highlight><bold>1505</bold></highlight>, and the boundary value is supplied from the boundary value calculation circuit <highlight><bold>1511</bold></highlight>; reference numeral <highlight><bold>1509</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the center of gravity supplied from the center-of-gravity calculation circuit <highlight><bold>1506</bold></highlight>, a maximum value and a minimum value of the distribution range supplied from the distribution range calculation circuit <highlight><bold>1507</bold></highlight>, and the target value supplied from the target value storage circuit <highlight><bold>1508</bold></highlight>; and reference numeral <highlight><bold>1510</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>1502</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>1509</bold></highlight>. The correction table formation circuit <highlight><bold>1509</bold></highlight> and the image signal correction circuit <highlight><bold>1510</bold></highlight> constitute a tone correction section. However, when the tone correction section does not include a function of expanding the distribution of the luminance histogram, the correction table formation circuit <highlight><bold>1509</bold></highlight> and the image signal correction circuit <highlight><bold>1510</bold></highlight> constitute a luminance distribution expansion section as well as a tone correction section. </paragraph>
<paragraph id="P-0275" lvl="0"><number>&lsqb;0275&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 33</cross-reference>(<highlight><italic>a</italic></highlight>) is a flowchart illustrating the principle of a tone correcting process according to the fourth embodiment. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>401</bold></highlight>), and the luminance histogram is expanded (step S<highlight><bold>402</bold></highlight>). Next, the range of mountain-shape distribution in the luminance histogram is detected (step S<highlight><bold>411</bold></highlight>), and a boundary value between a low-luminance part and a high-luminance part is calculated on the basis of the range of mountain-shape distribution (step S<highlight><bold>411</bold></highlight>). Then, the center of gravity of the low-luminance part of the luminance histogram is obtained (step S<highlight><bold>403</bold></highlight>), and the luminance, histogram is corrected so that the center of gravity of the low-luminance part matches a target value (step S<highlight><bold>404</bold></highlight>). </paragraph>
<paragraph id="P-0276" lvl="0"><number>&lsqb;0276&rsqb;</number> Next, the operation will be described. The fundamental operation of the apparatus according to this fourth embodiment is identical to the operation of the apparatus according to the second or third embodiment, except that the boundary value calculation circuit <highlight><bold>1511</bold></highlight> calculates a boundary value using the range of a mountain-shape distribution of a histogram, which is detected by the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>. Hereinafter, the processing will be described with reference to FIGS. <highlight><bold>30</bold></highlight> to <highlight><bold>33</bold></highlight>. </paragraph>
<paragraph id="P-0277" lvl="0"><number>&lsqb;0277&rsqb;</number> In the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>, the luminance histogram formed by the luminance distribution formation circuit <highlight><bold>1504</bold></highlight> is scanned from the lowest value of the luminance level toward the higher luminance level, and the range of a mountain-shape distribution that is detected first is stored. Assume that this range is a range A. Likewise, the luminance histogram is scanned from the highest value of the luminance level toward the lower luminance level, and the range of a mountain-shape distribution that is detected first is stored. Assume that this range is a range B. </paragraph>
<paragraph id="P-0278" lvl="0"><number>&lsqb;0278&rsqb;</number> Next, in the boundary value calculation circuit <highlight><bold>1511</bold></highlight>, the centers of gravity of the ranges A and B of the luminance histogram are respectively calculated, and the middle point between these two points (centers of gravity) is obtained as a boundary value between a low-luminance part and a high-luminance part. </paragraph>
<paragraph id="P-0279" lvl="0"><number>&lsqb;0279&rsqb;</number> FIGS. <highlight><bold>30</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>30</bold></highlight>(<highlight><italic>b</italic></highlight>) are diagrams for explaining a case where luminance histograms are formed for a back-lighted image and a forward-lighted image by the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>, the ranges of mountain-shape distributions are detected by the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>, and boundary values are obtained by the boundary value calculation circuit <highlight><bold>1511</bold></highlight>. </paragraph>
<paragraph id="P-0280" lvl="0"><number>&lsqb;0280&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 30</cross-reference>(<highlight><italic>a</italic></highlight>) is a luminance histogram of an image in the back-lighted state. In this state, two peaks of mountain-shape distributions are generated on the low-luminance side and the high-luminance side, and the range A of the peak (mountain-shape distribution) on the low-luminance side and the range B of the peak on the high-luminance side are detected, and the boundary value is positioned at the &ldquo;valley&rdquo; of the two mountain-shape distributions. On the other hand, in the forward-lighted image shown in <cross-reference target="DRAWINGS">FIG. 30</cross-reference>(<highlight><italic>b</italic></highlight>), the range A and the range B are the same range because there is only one peak of a mountain-shape distribution, and the boundary value between the low-luminance part and the high-luminance part is positioned at the center of gravity of the ranges A and B. </paragraph>
<paragraph id="P-0281" lvl="0"><number>&lsqb;0281&rsqb;</number> Next, assuming that the range from the &ldquo;0&rdquo; level to the boundary value calculated by the boundary value calculation circuit <highlight><bold>1511</bold></highlight> is the low-luminance part, the target value and the center of gravity of the low-luminance part are calculated by the target value calculation circuit <highlight><bold>1508</bold></highlight> and the center-of-gravity calculation circuit <highlight><bold>1506</bold></highlight>, respectively, and a correction table is formed by the correction table formation circuit <highlight><bold>1509</bold></highlight>, and thereafter, tone correction is carried out by the image signal correction circuit <highlight><bold>1510</bold></highlight>, in the same manner as described for the second embodiment. </paragraph>
<paragraph id="P-0282" lvl="0"><number>&lsqb;0282&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 33</cross-reference>(<highlight><italic>b</italic></highlight>) is a flowchart illustrating a tone correcting process the automatic tone correction apparatus shown in <cross-reference target="DRAWINGS">FIG. 29</cross-reference> actually performs. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>421</bold></highlight>), and the range of a mountain-shape distribution of this luminance histogram is detected before expanding the luminance distribution (step S<highlight><bold>430</bold></highlight>). Next, a boundary value between the low-luminance part and the high-luminance part of the luminance histogram is calculated before expanding the luminance distribution (step S<highlight><bold>431</bold></highlight>), and the center of gravity of the low-luminance part of the luminance histogram is obtained before expanding the luminance distribution (step S<highlight><bold>422</bold></highlight>). Next, in step S<highlight><bold>423</bold></highlight>, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance distribution of the luminance histogram so that the center of gravity of the low-luminance part of the distribution-expanded luminance histogram matches the target value, is formed, and thereafter, using this correction table, expansion of the luminance histogram and correction of the luminance distribution to bring the center of gravity of the low-luminance part to the target value are carried out simultaneously. </paragraph>
<paragraph id="P-0283" lvl="0"><number>&lsqb;0283&rsqb;</number> Thereby, a luminance distribution expansion section (i.e., a conversion table for only expansion of luminance distribution), which is required when expanding the luminance distribution of the luminance histogram immediately after formation of the histogram as shown in <cross-reference target="DRAWINGS">FIG. 33</cross-reference>(<highlight><italic>a</italic></highlight>), is dispensed with. Furthermore, as described above, arithmetic errors in the decimal level can be removed. </paragraph>
<paragraph id="P-0284" lvl="0"><number>&lsqb;0284&rsqb;</number> FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>31</bold></highlight>(<highlight><italic>c</italic></highlight>) illustrate the correction process for the back-lighted image shown in <cross-reference target="DRAWINGS">FIG. 30</cross-reference>(<highlight><italic>a</italic></highlight>), and FIGS. <highlight><bold>32</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>32</bold></highlight>(<highlight><italic>c</italic></highlight>) illustrate the correction process for the forward-lighted image shown in <cross-reference target="DRAWINGS">FIG. 30</cross-reference>(<highlight><italic>b</italic></highlight>). More specifically, FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>a</italic></highlight>) and <highlight><bold>32</bold></highlight>(<highlight><italic>a</italic></highlight>) illustrate the target value calculating process by the target value calculation circuit <highlight><bold>1508</bold></highlight>, FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>b</italic></highlight>) and <highlight><bold>32</bold></highlight>(<highlight><italic>b</italic></highlight>) illustrate the center-of-gravity calculating process by the center-of-gravity calculation circuit <highlight><bold>1506</bold></highlight>, and FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>c</italic></highlight>) and <highlight><bold>32</bold></highlight>(<highlight><italic>c</italic></highlight>) illustrate the correcting process by the image signal correction circuit <highlight><bold>1510</bold></highlight>. It is assumed that a luminance distribution having a normal distribution shape is stored in the target luminance distribution storage circuit <highlight><bold>1505</bold></highlight>. </paragraph>
<paragraph id="P-0285" lvl="0"><number>&lsqb;0285&rsqb;</number> In FIGS. <highlight><bold>31</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>31</bold></highlight>(<highlight><italic>c</italic></highlight>), since the peak on the low-luminance side shifts toward the high-luminance side and the distribution is expanded, the low-luminance part is brightly corrected, and the contrast is improved. However, in FIGS. <highlight><bold>32</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>32</bold></highlight>(<highlight><italic>c</italic></highlight>), the peak of the luminance histogram is hardly shifted because there is little difference between the center of gravity and the target value. Accordingly, the brightness hardly changes although the contrast is improved. </paragraph>
<paragraph id="P-0286" lvl="0"><number>&lsqb;0286&rsqb;</number> As described above, according to the fourth embodiment of the invention, without providing different processes for a back-lighted image and a forward-lighted image, the back-lighted image is brightly corrected so that the low-luminance region in the back-lighted state has a target luminance value and, further, the contrast is improved, while the forward-lighted image is hardly changed in brightness, but the contrast is improved. </paragraph>
<paragraph id="P-0287" lvl="0"><number>&lsqb;0287&rsqb;</number> Although the conventional tone correction method has a problem that, when an image of a person who wares black clothes is corrected, the clothes turn to gray, the tone correction apparatus according to this fourth embodiment can solve this problem without providing different processes for a back-lighted image and a forward-lighted image. </paragraph>
<paragraph id="P-0288" lvl="0"><number>&lsqb;0288&rsqb;</number> While in this fourth embodiment the target luminance distribution has the shape of a normal distribution, the target luminance distribution is not restricted thereto. For example, the same effects as mentioned above are achieved with a target luminance distribution shown in <cross-reference target="DRAWINGS">FIG. 22</cross-reference>(<highlight><italic>b</italic></highlight>). </paragraph>
<paragraph id="P-0289" lvl="0"><number>&lsqb;0289&rsqb;</number> Furthermore, as described in claim 11, the boundary value calculation circuit <highlight><bold>1511</bold></highlight> may adjust the boundary value calculated from the range of the mountain-shape distribution that is detected by the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>, using the luminance histogram formed by the luminance histogram formation circuit <highlight><bold>1504</bold></highlight>, whereby a more accurate boundary value can be obtained in the back-lighted image. </paragraph>
<paragraph id="P-0290" lvl="0"><number>&lsqb;0290&rsqb;</number> In the boundary value calculation circuit <highlight><bold>1511</bold></highlight>, the centers of gravity of the two mountain-shape distribution ranges detected by the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight> are calculated, and a boundary value is obtained using the two centers of gravity and the frequency of the luminance histogram between the two points. </paragraph>
<paragraph id="P-0291" lvl="0"><number>&lsqb;0291&rsqb;</number> By the way, since, in the above-described boundary value calculation method, the boundary value calculation circuit <highlight><bold>1511</bold></highlight> calculates a boundary value from only the first mountain-shape distribution detected by the detection circuit <highlight><bold>1512</bold></highlight>, the boundary value is not positioned in the &ldquo;valley&rdquo; of the mountain-shape distributions in a luminance histogram wherein three or more mountain-shape distributions. </paragraph>
<paragraph id="P-0292" lvl="0"><number>&lsqb;0292&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 34</cross-reference> shows a boundary value of a luminance histogram having three mountain-shape distributions. In this case, a boundary value is set in the center mountain-shape distribution. </paragraph>
<paragraph id="P-0293" lvl="0"><number>&lsqb;0293&rsqb;</number> So, assuming that the two centers of gravity are g1 and g2 and the center of gravity of the luminance histogram between the g1 and the g2 is G, a target value T is calculated by formula (22) as follows. </paragraph>
<paragraph lvl="0"><in-line-formula><highlight><italic>T&equals;g</italic></highlight>1&plus;(<highlight><italic>g</italic></highlight>2&minus;<highlight><italic>G</italic></highlight>)&emsp;&emsp;(22) </in-line-formula></paragraph>
<paragraph id="P-0294" lvl="0"><number>&lsqb;0294&rsqb;</number> In formula (22), since the center of gravity G surely exists between the g1 and the g2, the boundary value T is surely obtained between the g1 and g2. Accordingly, in a forward-lighted image in which the space between the two centers of gravity is narrow, the boundary value is not different from the boundary value being the middle point between the two centers of gravity. However, in the case of a back-lighted image in which the space between the two centers of gravity is broad, the boundary value changes according to the positions of the centers of gravity. </paragraph>
<paragraph id="P-0295" lvl="0"><number>&lsqb;0295&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 35</cross-reference> shows a boundary value of the luminance histogram shown in <cross-reference target="DRAWINGS">FIG. 34</cross-reference>, which is obtained using formula (22). Since the boundary value is adjusted according to the centers of gravity of the luminance distributions, the boundary value is positioned in the &ldquo;valley&rdquo; of the luminance distributions. </paragraph>
<paragraph id="P-0296" lvl="0"><number>&lsqb;0296&rsqb;</number> In this way, using the two centers of gravity and the frequency of the luminance histogram between the two points, a more accurate boundary value can be obtained. </paragraph>
<paragraph id="P-0297" lvl="0"><number>&lsqb;0297&rsqb;</number> Furthermore, as defined in claim 12, a restriction may be put on the range of the mountain-shape distribution detected by the mountain-shape distribution detection circuit <highlight><bold>1512</bold></highlight>. </paragraph>
<paragraph id="P-0298" lvl="0"><number>&lsqb;0298&rsqb;</number> This is shown in <cross-reference target="DRAWINGS">FIG. 36</cross-reference>. In <cross-reference target="DRAWINGS">FIG. 36, a</cross-reference> restriction is put on scanning from &ldquo;255&rdquo; toward &ldquo;0&rdquo;. Therefore, scanning from &ldquo;255&rdquo; toward &ldquo;0&rdquo; is interrupted although the mountain-shape distribution continues, and the detected range is narrower than the range which is detected by scanning from &ldquo;0&rdquo; toward &ldquo;255&rdquo;. As a result, the center of gravity of the range with the restriction becomes higher, and the boundary value also becomes higher. Accordingly, the target value shifts toward the higher-luminance side. </paragraph>
<paragraph id="P-0299" lvl="0"><number>&lsqb;0299&rsqb;</number> Thereby, also in the tone correction apparatus according to the fourth embodiment, the brightness can be increased even when the input image is a forward-lighted image, by setting a restriction on detection of a mountain-shape distribution. </paragraph>
<paragraph id="P-0300" lvl="0"><number>&lsqb;0300&rsqb;</number> Furthermore, the correction table formation circuit in the automatic tone correction apparatus according to any of claims 10 to 12 may create a conversion table by which expansion of the luminance distribution is performed on only the low-luminance side while expansion of the luminance distribution on the high-luminance side is performed during the process of performing correction so as to match the center of gravity of the low-luminance part of the luminance histogram to the target value, whereby the tone of the high-luminance part is prevented from being collapsed due to tone correction (corresponding to claim 16). </paragraph>
<paragraph id="P-0301" lvl="0"><number>&lsqb;0301&rsqb;</number> In this case, since the maximum value of the luminance distribution is not necessary, the distribution range calculation circuit may calculate only the minimum value, whereby the computational complexity is reduced. </paragraph>
<paragraph id="P-0302" lvl="0"><number>&lsqb;0302&rsqb;</number> Furthermore, as described for the first embodiment, modifications as described in claims 20 to 25 may be added to this fourth embodiment. </paragraph>
<paragraph id="P-0303" lvl="0"><number>&lsqb;0303&rsqb;</number> That is, in the luminance distribution formation circuit <highlight><bold>1504</bold></highlight>, a restriction may be put on the amount of accumulation of the luminance distribution (corresponding to claim 20). By setting a restriction on the luminance histogram, the amount of correction can be accurately calculated even when there is an extreme deviation such that the tone distribution concentrates on a certain tone, for example, when a background of a back-lighted image or the like occurs halation and thus the luminance level concentrates on &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0304" lvl="0"><number>&lsqb;0304&rsqb;</number> Further, a skin-color region may be extracted from color-difference signals and a luminance signal and, when a luminance histogram is created, the luminance distribution of the skin color region in the image may be added to the luminance distribution of the whole image, according to the area of the skin-color region (corresponding to claim 21). By adding a weight in this way, tone correction in which the skin-color region is optimized can be carried out. </paragraph>
<paragraph id="P-0305" lvl="0"><number>&lsqb;0305&rsqb;</number> Furthermore, in the luminance distribution of the skin-color region, the distribution of the high-luminance part may be weighted (corresponding to claim 22). For example, the luminance distribution of the skin-color region is multiplied by a coefficient as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> to weight the high-luminance part. </paragraph>
<paragraph id="P-0306" lvl="0"><number>&lsqb;0306&rsqb;</number> Moreover, the center of gravity of the high-luminance part may be calculated from the luminance histogram, and the amount of correction in the high-luminance part may be calculated according to the center of gravity of the high-luminance part (corresponding to claim 23). </paragraph>
<paragraph id="P-0307" lvl="0"><number>&lsqb;0307&rsqb;</number> When the luminance distribution formed by the luminance distribution formation circuit is discrete, tone correction is not carried out (corresponding to claim 24). The reason is as follows. When the luminance distribution is discrete, the image can be judged as an artificial image and, generally, it is better not to perform tone correction on an artificial image. </paragraph>
<paragraph id="P-0308" lvl="0"><number>&lsqb;0308&rsqb;</number> When a digital image signal is separated into a luminance signal and color-difference signals and tone correction is performed on the luminance signal, the color-difference signals may be corrected according to the correction table (corresponding to claim 25). Thereby, when R, G, B signals are formed from the tone-corrected luminance signal and color-difference signals, a phenomenon, in which the saturation appears degraded due to luminance correction, is suppressed. </paragraph>
<paragraph id="P-0309" lvl="0"><number>&lsqb;0309&rsqb;</number> As described above, according to the fourth embodiment, a luminance histogram of a digital image is formed, the range of a mountain-shape distribution of the luminance histogram is detected, a boundary value between a low-luminance part and a high-luminance part of the luminance histogram is calculated on the basis of the range of the mountain-shape distribution, the center of gravity of the low-luminance part is calculated, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and tone correction is carried out using the correction table. Therefore, the low-luminance part and the high-luminance part can be accurately separated according to the shape of the luminance histogram. Further, just once formation of a conversion table enables expansion of the luminance distribution of the luminance histogram formed from the digital image signal and, simultaneously, correction of the luminance histogram so that the center of gravity of the low-luminance part matches the target luminance value. Accordingly, without providing different processes for a back-lighted image and a forward-lighted image, the back-lighted image is brightly corrected so that the low-luminance region in the back-lighted state has a target luminance value and, moreover, the contrast is improved, while the forward-lighted image is hardly changed in brightness, but the contrast is improved. </paragraph>
<paragraph id="P-0310" lvl="0"><number>&lsqb;0310&rsqb;</number> In this fourth embodiment, the description has been given of the automatic tone correction apparatus which performs expansion of the luminance distribution simultaneously with tone correction for correcting the luminance distribution so that the center of gravity of the low-luminance part matches the target value, by using the correction table. However, an automatic tone correction method for performing processing corresponding to the automatic tone correction apparatus is also within the scope of the invention. Furthermore, an automatic tone correction method corresponding to the flowchart of <cross-reference target="DRAWINGS">FIG. 33</cross-reference>(<highlight><italic>a</italic></highlight>) which illustrates the correction principle, an automatic tone correction apparatus corresponding to this automatic tone correction method, and an automatic tone correction program storage medium for recording an automatic tone correction program which makes a computer perform the automatic tone correction method, into various recording mediums, are also within the scope of the invention. Also in these cases, the same effects as achieved by the above-described automatic tone correction apparatus can be realized although expansion of the luminance distribution and tone correction cannot be performed simultaneously. </paragraph>
<paragraph id="P-0311" lvl="7"><number>&lsqb;0311&rsqb;</number> &lsqb;Embodiment 5&rsqb;</paragraph>
<paragraph id="P-0312" lvl="0"><number>&lsqb;0312&rsqb;</number> Hereinafter, a description will be given of a fifth embodiment of the present invention corresponding to claims 13, 38, and 55 (further, claims 14&tilde;25, 39&tilde;50, 56&tilde;63), with reference to the drawings. </paragraph>
<paragraph id="P-0313" lvl="0"><number>&lsqb;0313&rsqb;</number> In this fifth embodiment, the target value is corrected. </paragraph>
<paragraph id="P-0314" lvl="0"><number>&lsqb;0314&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 37</cross-reference> is a block diagram illustrating an automatic tone correction apparatus according to the fifth embodiment. </paragraph>
<paragraph id="P-0315" lvl="0"><number>&lsqb;0315&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 37</cross-reference>, reference numeral <highlight><bold>2201</bold></highlight> denotes an image pickup device for light-to-electricity converting a shot image; reference numeral <highlight><bold>2202</bold></highlight> denotes an A/D converter to which an analog image signal is supplied from the image pickup device <highlight><bold>2201</bold></highlight>; reference numeral <highlight><bold>2203</bold></highlight> denotes a luminance signal calculation circuit to which a digital image signal is supplied from the A/D converter <highlight><bold>2202</bold></highlight>; reference numeral <highlight><bold>2204</bold></highlight> denotes a luminance distribution formation circuit (luminance histogram formation unit) to which a luminance signal is supplied from the luminance signal calculation circuit <highlight><bold>2203</bold></highlight>; reference numeral <highlight><bold>2212</bold></highlight> denotes a mountain-shape distribution detection circuit to which a luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>2204</bold></highlight>; reference numeral <highlight><bold>2211</bold></highlight> denotes a boundary value calculation circuit to which a range of a mountain-shape distribution is supplied from the mountain-shape distribution detection circuit <highlight><bold>2212</bold></highlight>, and the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>2204</bold></highlight>; reference numeral <highlight><bold>2206</bold></highlight> denotes a center-of-gravity calculation circuit (center-of-gravity calculation unit) to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>2204</bold></highlight>, and a boundary value is supplied from the boundary value calculation circuit <highlight><bold>2211</bold></highlight>; reference numeral <highlight><bold>2207</bold></highlight> denotes a distribution range calculation circuit to which the luminance distribution is supplied from the luminance distribution formation circuit <highlight><bold>2204</bold></highlight>; reference numeral <highlight><bold>2205</bold></highlight> denotes a target value storage circuit for holding a target value to be a goal in performing tone correction; reference numeral <highlight><bold>2208</bold></highlight> denotes a target value calculation circuit to which a target luminance distribution is supplied from the target luminance distribution storage circuit <highlight><bold>2205</bold></highlight>, and the boundary value is supplied from the boundary value calculation circuit <highlight><bold>2211</bold></highlight>; reference numeral <highlight><bold>2213</bold></highlight> denotes a target value correction circuit (target value correction unit) to which a center of gravity in supplied from the center-of-gravity calculation circuit <highlight><bold>2206</bold></highlight>, and a target value is supplied from the target value calculation circuit <highlight><bold>2208</bold></highlight>; reference numeral <highlight><bold>2209</bold></highlight> denotes a correction table formation circuit for forming a correction table for tone correction, on the basis of the center of gravity supplied from the center-of-gravity calculation circuit <highlight><bold>2206</bold></highlight>, a maximum value and a minimum value of the distribution range supplied from the distribution range calculation circuit <highlight><bold>2207</bold></highlight>, and a target value that is corrected by the target value correction circuit <highlight><bold>2213</bold></highlight>; and reference numeral <highlight><bold>2210</bold></highlight> denotes an image signal correction circuit for performing tone correction on the digital image signal outputted from the A/D converter <highlight><bold>2202</bold></highlight>, on the basis of the correction table formed by the correction table formation circuit <highlight><bold>2209</bold></highlight>. The correction table formation circuit <highlight><bold>2209</bold></highlight> and the image signal correction circuit <highlight><bold>2210</bold></highlight> constitute a tone correction section. However, when the tone correction section does not include a function of expanding the distribution of the luminance histogram, the correction table formation circuit <highlight><bold>2209</bold></highlight> and the image signal correction circuit <highlight><bold>2210</bold></highlight> constitute a luminance distribution expansion section as well as a tone correction section. </paragraph>
<paragraph id="P-0316" lvl="0"><number>&lsqb;0316&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 39</cross-reference>(<highlight><italic>a</italic></highlight>) is a flowchart illustrating the principle of the tone correcting process. </paragraph>
<paragraph id="P-0317" lvl="0"><number>&lsqb;0317&rsqb;</number> Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>501</bold></highlight>), and the luminance histogram is expanded (step S<highlight><bold>502</bold></highlight>). Next, the center of gravity of the low-luminance part of the expanded luminance histogram is obtained (step S<highlight><bold>503</bold></highlight>), and it is judged whether or not the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram before being expanded (step S<highlight><bold>510</bold></highlight>). </paragraph>
<paragraph id="P-0318" lvl="0"><number>&lsqb;0318&rsqb;</number> When the target value is smaller than the center of gravity, the target value is corrected (step S<highlight><bold>511</bold></highlight>). Otherwise, step S<highlight><bold>511</bold></highlight> is skipped. Than, the luminance histogram is corrected so that the center of gravity of the low-luminance part matches the target value (step S<highlight><bold>504</bold></highlight>). </paragraph>
<paragraph id="P-0319" lvl="0"><number>&lsqb;0319&rsqb;</number> Next, the operation will be described. The fundamental operation of the apparatus according to the fifth embodiment is identical to that of the apparatus according to the fourth embodiment except that the target value obtained in the target value calculation circuit <highlight><bold>2208</bold></highlight> is corrected by the target value correction circuit <highlight><bold>2213</bold></highlight>. </paragraph>
<paragraph id="P-0320" lvl="0"><number>&lsqb;0320&rsqb;</number> In the target value calculation circuit <highlight><bold>2208</bold></highlight>, a target value is calculated using the luminance histogram that is stored in the target luminance distribution storage circuit <highlight><bold>2205</bold></highlight>, in like manner as described for the fourth embodiment. </paragraph>
<paragraph id="P-0321" lvl="0"><number>&lsqb;0321&rsqb;</number> Next, in the target value correction circuit <highlight><bold>2213</bold></highlight>, when the target value is smaller the center of gravity that is obtained in the center-of-gravity calculation circuit <highlight><bold>2206</bold></highlight>, the target value is corrected so that the center of gravity becomes a new target value. </paragraph>
<paragraph id="P-0322" lvl="0"><number>&lsqb;0322&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 39</cross-reference>(<highlight><italic>b</italic></highlight>) is a flowchart, illustrating a tone correcting process the automatic tone correction apparatus shown in <cross-reference target="DRAWINGS">FIG. 37</cross-reference> actually performs. Initially, a luminance histogram of a digital image is formed (step S<highlight><bold>521</bold></highlight>), and the center of gravity of the low-luminance part of this luminance histogram is obtained before expanding the luminance distribution (step S<highlight><bold>522</bold></highlight>). Next, it is judged whether or not the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram (step S<highlight><bold>530</bold></highlight>). When the target value is smaller than the center of gravity, the target value is corrected (step S<highlight><bold>531</bold></highlight>). Otherwise, step S<highlight><bold>531</bold></highlight> is skipped. Next, in step S<highlight><bold>523</bold></highlight>, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance distribution of the luminance histogram so that the center of gravity of the low-luminance part of the distribution-expanded luminance histogram matches the target value, is formed, and thereafter, using this correction table, expansion of the luminance histogram and correction of the luminance distribution to bring the center of gravity of the low-luminance part to the target value are carried out simultaneously. </paragraph>
<paragraph id="P-0323" lvl="0"><number>&lsqb;0323&rsqb;</number> Thereby, a luminance distribution expansion section (i.e., a conversion table for only expansion of luminance distribution), which is required when expanding the luminance distribution of the luminance histogram immediately after formation of the histogram as shown in <cross-reference target="DRAWINGS">FIG. 39</cross-reference>(<highlight><italic>a</italic></highlight>), is dispensed with. Furthermore, as described above, arithmetic errors in the decimal level can be removed. </paragraph>
<paragraph id="P-0324" lvl="0"><number>&lsqb;0324&rsqb;</number> FIGS. <highlight><bold>38</bold></highlight>(<highlight><italic>a</italic></highlight>)-<highlight><bold>38</bold></highlight>(<highlight><italic>c</italic></highlight>) are diagrams illustrating examples of centers of gravity, target values, and luminance histograms when a forward-light image is corrected by the automatic tone correction apparatus of the fourth embodiment which is not provided with the target value correction circuit, and the automatic tone correction apparatus according to the fifth embodiment which is provided with the target value correction circuit. More specifically, <cross-reference target="DRAWINGS">FIG. 38</cross-reference>(<highlight><italic>a</italic></highlight>) shows the center of gravity and the target value, <highlight><bold>38</bold></highlight>(<highlight><italic>b</italic></highlight>) shows the result of correction performed by the automatic tone correction apparatus of the fourth embodiment, and <cross-reference target="DRAWINGS">FIG. 38</cross-reference>(<highlight><italic>c</italic></highlight>) shows the result of correction performed by the automatic tone correction apparatus of the fifth embodiment. </paragraph>
<paragraph id="P-0325" lvl="0"><number>&lsqb;0325&rsqb;</number> With reference to <cross-reference target="DRAWINGS">FIG. 38</cross-reference>(<highlight><italic>a</italic></highlight>), since the peak position of the target luminance distribution exists on the lower-luminance side than the peak position of the distribution of the luminance histogram, the target value is on the lower-luminance side than the center of gravity. Accordingly, in <cross-reference target="DRAWINGS">FIG. 38</cross-reference>(<highlight><italic>b</italic></highlight>), the luminance histogram is corrected so that the center of gravity matches the target value that is smaller than the center of gravity, whereby the contrast is improved, but the image is darkly corrected. However, in <cross-reference target="DRAWINGS">FIG. 38</cross-reference>(<highlight><italic>c</italic></highlight>), since the target value is corrected to the center of gravity, the contrast is improved while maintaining the original brightness. </paragraph>
<paragraph id="P-0326" lvl="0"><number>&lsqb;0326&rsqb;</number> Therefore, when an input image of a scenic shot or the like is not desired to be corrected to an image darker than the original, if the target value is smaller than the center of gravity, the target value is corrected so that the center of gravity becomes a target value, thereby preventing the corrected image from becoming darker than the input image. </paragraph>
<paragraph id="P-0327" lvl="0"><number>&lsqb;0327&rsqb;</number> In the target value correction circuit <highlight><bold>2213</bold></highlight>, as defined in claim 14, the target value may be corrected so that it matches the center of gravity when the target value is larger than the center of gravity. In this case, the input image is prevented from being corrected to a brighter image. </paragraph>
<paragraph id="P-0328" lvl="0"><number>&lsqb;0328&rsqb;</number> While in this fifth embodiment the target value is corrected to the center of gravity by the target value correction circuit <highlight><bold>2213</bold></highlight>, the target value may be corrected to a value a little higher or lower than the center of gravity, as defined in claim 15. Thereby, the brightness of the corrected image can be minutely adjusted on the basis of the brightness of the input image. </paragraph>
<paragraph id="P-0329" lvl="0"><number>&lsqb;0329&rsqb;</number> Furthermore, the correction table formation circuit in the automatic tone correction apparatus according to any of claims 13 to 15 may create a conversion table by which expansion of the luminance distribution is performed on only the low-luminance side while expansion of the luminance distribution on the high-luminance side is performed during the process of performing correction so as to match the center of gravity of the low-luminance part of the luminance histogram to the target value, whereby the tone of the high-luminance part is prevented from being collapsed due to tone correction (corresponding to claim 16). </paragraph>
<paragraph id="P-0330" lvl="0"><number>&lsqb;0330&rsqb;</number> Furthermore, as described for the first embodiment, modifications as described in claims 20 to 25 may be added to this fifth embodiment. </paragraph>
<paragraph id="P-0331" lvl="0"><number>&lsqb;0331&rsqb;</number> That is, in the luminance distribution formation circuit <highlight><bold>2204</bold></highlight>, a restriction may be put on the amount of accumulation of the luminance distribution (corresponding to claim 20). By setting a restriction on the luminance histogram, the amount of correction can be accurately calculated even when there is an extreme deviation such that the tone distribution concentrates on a certain tone, for example, when a background of a back-lighted image or the like occurs halation and thus the luminance level concentrates on &ldquo;255&rdquo;. </paragraph>
<paragraph id="P-0332" lvl="0"><number>&lsqb;0332&rsqb;</number> Further, a skin-color region may be extracted from color-difference signals and a luminance signal and, when a luminance histogram is created, the luminance distribution of the skin color region in the image may be added to the luminance distribution of the whole image, according to the area of the skin-color region (corresponding to claim 21). By adding a weight in this way, tone correction in which the skin-color region is optimized can be carried out. </paragraph>
<paragraph id="P-0333" lvl="0"><number>&lsqb;0333&rsqb;</number> Furthermore, in the luminance distribution of the skin-color region, the distribution of the high-luminance part may be weighted (corresponding to claim 22). For example, the luminance distribution of the skin-color region is multiplied by a coefficient as shown in <cross-reference target="DRAWINGS">FIG. 13</cross-reference> to weight the high-luminance part. </paragraph>
<paragraph id="P-0334" lvl="0"><number>&lsqb;0334&rsqb;</number> Moreover, the center of gravity of the high-luminance part may be calculated from the luminance histogram, and the amount of correction in the high-luminance part may be calculated according to the center of gravity of the high-luminance part (corresponding to claim 23). </paragraph>
<paragraph id="P-0335" lvl="0"><number>&lsqb;0335&rsqb;</number> When the luminance distribution formed by the luminance distribution formation circuit is discrete, tone correction is not carried out (corresponding to claim 24). The reason is as follows. When the luminance distribution is discrete, the image can be judged as an artificial image and, generally, it is better not to perform tone correction on an artificial image. </paragraph>
<paragraph id="P-0336" lvl="0"><number>&lsqb;0336&rsqb;</number> When a digital image signal is separated into a luminance signal and color-difference signals and tone correction is performed on the luminance signal, the color-difference signals may be corrected according to the correction table (corresponding to claim 25). Thereby, when R, G, B signals are formed from the tone-corrected luminance signal and color-difference signals, a phenomenon, in which the saturation appears degraded due to luminance correction, is suppressed. </paragraph>
<paragraph id="P-0337" lvl="0"><number>&lsqb;0337&rsqb;</number> As described above, according to the fifth embodiment, a luminance histogram of a digital image is formed, the range of a mountain-shape distribution of the luminance histogram is detected, a boundary value between a low-luminance part and a high-luminance part of the luminance histogram is calculated on the basis of the range of the mountain-shape distribution, a target value is corrected to be a new target value when the target value is smaller than the center of gravity of the low-luminance part, a correction table for expanding the luminance distribution of the luminance histogram and, simultaneously, correcting the luminance histogram so that the center of gravity of the low-luminance part of the expanded luminance histogram matches a target value, is formed, and tone correction is carried out using the correction table. Therefore, the low-luminance part and the high-luminance part can be accurately separated according to the shape of the luminance histogram, and the luminance histogram is prevented from being undesirably corrected, by correcting the target value. Further, just once formation of a conversion table enables expansion of the luminance distribution of the luminance histogram formed from the digital image signal and, simultaneously, correction of the luminance histogram so that the center of gravity of the low-luminance part matches the target luminance value. Accordingly, without providing different processes for a back-lighted image and a forward-lighted image, the back-lighted image is brightly corrected so that the low-luminance region in the back-lighted state has a target luminance value and, further, the contrast is improved, while the forward-lighted image is hardly changed in brightness, but the contrast is improved. </paragraph>
<paragraph id="P-0338" lvl="0"><number>&lsqb;0338&rsqb;</number> In this fifth embodiment, the description has been given of the automatic tone correction apparatus which performs expansion of the luminance distribution simultaneously with tone correction for correcting the luminance distribution so that the center of gravity of the low-luminance part matches the target value, by using the correction table. However, an automatic tone correction method for performing processing corresponding to the automatic tone correction apparatus is also within the scope of the invention. Furthermore, an automatic tone correction method corresponding to the flowchart of <cross-reference target="DRAWINGS">FIG. 39</cross-reference>(<highlight><italic>a</italic></highlight>) which illustrates the correction principle, an automatic tone correction apparatus corresponding to this automatic tone correction method, and an automatic tone correction program storage medium for recording an automatic tone correction program which makes a computer perform the automatic tone correction method, into various recording mediums, are also within the scope of the invention. Also in these cases, the same effects as achieved by the above-described automatic tone correction apparatus can be realized although expansion of the luminance distribution and tone correction cannot be performed simultaneously. </paragraph>
<paragraph id="P-0339" lvl="0"><number>&lsqb;0339&rsqb;</number> The target value correction circuit according to this fifth embodiment is applicable to any of the first to fourth embodiments, with the same effects as mentioned above. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. An automatic tone correction apparatus comprising: 
<claim-text>a luminance histogram formation unit for forming a luminance histogram of a digital image; </claim-text>
<claim-text>a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction unit for 
<claim-text>forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and </claim-text>
<claim-text>performing tone correction using the correction table, thereby expanding the luminance distribution and, simultaneously, matching the center of gravity of the low-luminance part of the luminance histogram to the luminance correction target value. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein a restriction is put on the amount of correction in the tone correction. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the luminance correction target value to be used in the tone correction is previously set according to the position of the center of gravity. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. An automatic tone correction apparatus comprising: 
<claim-text>a luminance histogram formation unit for forming a luminance histogram of a digital image; </claim-text>
<claim-text>a target value calculation unit for calculating a luminance correction target value from a target luminance distribution; </claim-text>
<claim-text>a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction unit for 
<claim-text>forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and the luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and </claim-text>
<claim-text>using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference> wherein, when performing the tone correction, the target value calculation unit sets a target luminance distribution with a curve. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference> wherein, when performing the tone correction, the target value calculation unit sets a plurality of target luminance distributions, and stores them. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. An automatic tone correction apparatus comprising: 
<claim-text>a luminance histogram formation unit for forming a luminance histogram of a digital image; </claim-text>
<claim-text>a boundary value calculation unit for calculating a boundary value for determining a low-luminance part of the luminance histogram; </claim-text>
<claim-text>a center-of-gravity calculation unit for calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated by the boundary value calculation unit; and </claim-text>
<claim-text>a tone correction unit for 
<claim-text>forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and </claim-text>
<claim-text>using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference> therein, when performing the tone correction, the boundary value calculation unit divides a luminance range into plural regions, and calculates a boundary value from the feature parameters of the respective regions. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00008">claim 8</dependent-claim-reference> wherein, when performing the tone correction, the boundary value calculation unit divides the luminance range into two regions, and a center of gravity calculated on the lower luminance side is used as the center of gravity of the low-luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. An automatic tone correction apparatus comprising: 
<claim-text>a luminance histogram formation unit for forming a luminance histogram of a digital image; </claim-text>
<claim-text>a mountain-shape distribution detection unit for detecting a range of a mountain-shape distribution of the luminance histogram; </claim-text>
<claim-text>a boundary value calculation unit for calculating a boundary value for determining a low-luminance part of the luminance histogram from the range of the mountain-shape distribution detected by the mountain-shape distribution detection unit; </claim-text>
<claim-text>a center-of-gravity calculation unit for calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated by the boundary value calculation unit; and </claim-text>
<claim-text>a tone correction unit for 
<claim-text>forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and a luminance correction target value that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, and </claim-text>
<claim-text>using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value calculated by the target value calculation unit. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference> wherein, when performing the tone correction, the boundary value calculation unit sets the boundary value calculated from the range of the mountain-shape distribution, using the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00011">claim 10</dependent-claim-reference> wherein, when performing the tone correction, the mountain-shape distribution detection unit puts a restriction on the range of the mountain-shape distribution. </claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. An automatic tone correction apparatus comprising: 
<claim-text>a luminance histogram formation unit for forming a luminance histogram of a digital image; </claim-text>
<claim-text>a center-of-gravity calculation unit for calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a target value correction unit for correcting a luminance correction target value, that is a target value to which the center of gravity of the low-luminance part of the luminance histogram should be shifted, so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction unit for 
<claim-text>forming a correction table on the basis of the luminance histogram which is formed by the luminance histogram formation unit, the center of gravity of the low-luminance part of the luminance histogram which is calculated by the center-of-gravity calculation unit, and the luminance correction target value, and </claim-text>
<claim-text>using the correction table, expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value which is corrected or not corrected by the target value correction unit. </claim-text>
</claim-text>
</claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00011">claim 13</dependent-claim-reference> wherein, when performing the tone correction, if the luminance correction target value is larger than the center of gravity of the low-luminance part of the luminance histogram, the target value correction unit corrects the luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00011">claim 13</dependent-claim-reference> or <highlight><bold>14</bold></highlight> wherein, when performing the tone correction, the luminance correction target value is corrected so that the target value becomes a value in the vicinity of the center of gravity of the low-luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. An automatic tone correction apparatus as defined in any of <dependent-claim-reference depends_on="CLM-00001">claims 1</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00014">14</dependent-claim-reference> wherein, when performing the tone correction, the distribution of the luminance histogram is expanded only toward the low-luminance side and, simultaneously, the luminance histogram is corrected so that the center of gravity of the luminance histogram matches the luminance correction target value. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight>, wherein the tone correction unit performs the tone correction by executing &ggr; correction. </claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight>, wherein the tone correction unit forms the correction table so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. </claim-text>
</claim>
<claim id="CLM-00019">
<claim-text><highlight><bold>19</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight> further comprising a luminance distribution expansion unit for expanding the luminance distribution of the luminance histogram formed by the luminance histogram formation unit; 
<claim-text>wherein the center-of-gravity calculation unit calculates the center of gravity of the low-luminance part of the luminance histogram in which the luminance distribution is expanded. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00020">
<claim-text><highlight><bold>20</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight> wherein, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. </claim-text>
</claim>
<claim id="CLM-00021">
<claim-text><highlight><bold>21</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight> further comprising a skin color region extraction unit for extracting a skin color region from color-difference signals and a luminance signal; 
<claim-text>wherein, when forming the luminance histogram, the luminance distribution of a skin color portion of the image is added to the luminance distribution of the whole image according to the area of the skin color region. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00022">
<claim-text><highlight><bold>22</bold></highlight>. An automatic tone correction apparatus as defined in <dependent-claim-reference depends_on="CLM-00022">claim 21</dependent-claim-reference> wherein, when the luminance distribution of the skin color portion of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance part of the skin color portion is weighted. </claim-text>
</claim>
<claim id="CLM-00023">
<claim-text><highlight><bold>23</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight>, wherein the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated by the luminance histogram formation unit, and an amount of tone correction on the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. </claim-text>
</claim>
<claim id="CLM-00024">
<claim-text><highlight><bold>24</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight>, wherein tone correction is not carried out when the luminance distribution is discrete. </claim-text>
</claim>
<claim id="CLM-00025">
<claim-text><highlight><bold>25</bold></highlight>. An automatic tone correction apparatus as defined in any of claims <highlight><bold>1</bold></highlight>, <highlight><bold>4</bold></highlight>, <highlight><bold>7</bold></highlight>, <highlight><bold>10</bold></highlight>, and <highlight><bold>13</bold></highlight>, wherein color-difference signals of the image are corrected according to the correction table. </claim-text>
</claim>
<claim id="CLM-00026">
<claim-text><highlight><bold>26</bold></highlight>. An automatic tone correction method for correcting tones of a digital image, comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00027">
<claim-text><highlight><bold>27</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00022">claim 26</dependent-claim-reference> wherein, in the tone correction step, a restriction is put on the amount of correction. </claim-text>
</claim>
<claim id="CLM-00028">
<claim-text><highlight><bold>28</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00022">claim 26</dependent-claim-reference>, wherein the luminance correction target value to be used in the tone correction step is previously set according to the position of the center of gravity. </claim-text>
</claim>
<claim id="CLM-00029">
<claim-text><highlight><bold>29</bold></highlight>. An automatic tone correction method for correcting tones of a digital image, comprising: 
<claim-text>a target value calculation step of calculating a luminance correction target value from a target luminance distribution; </claim-text>
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value that is calculated in the target value calculation step. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00030">
<claim-text><highlight><bold>30</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00022">claim 29</dependent-claim-reference> wherein, in the target value calculation step, a target luminance distribution is set with a curve. </claim-text>
</claim>
<claim id="CLM-00031">
<claim-text><highlight><bold>31</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00022">claim 29</dependent-claim-reference> wherein, in the target value calculation step, a plurality of target luminance distributions are stored. </claim-text>
</claim>
<claim id="CLM-00032">
<claim-text><highlight><bold>32</bold></highlight>. An automatic tone correction method for correcting tones of a digital image, comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a boundary value calculation step of calculating a boundary value for setting a range of a low-luminance part of the luminance histogram; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00033">
<claim-text><highlight><bold>33</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 32</dependent-claim-reference> wherein, in the boundary value calculation step, a luminance range is divided into plural regions, and a boundary value is calculated from feature parameters of the respective regions. </claim-text>
</claim>
<claim id="CLM-00034">
<claim-text><highlight><bold>34</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 33</dependent-claim-reference> wherein, in the boundary value calculation step, the luminance range is divided into two regions, and a center of gravity calculated on the lower-luminance side is used as the center of gravity of the low-luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00035">
<claim-text><highlight><bold>35</bold></highlight>. An automatic tone correction method for correcting tones of a digital image, comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a mountain-shape distribution detection step of detecting a range of a mountain-shape distribution of the luminance histogram; </claim-text>
<claim-text>a boundary value calculation step of calculating a boundary value for setting a low-luminance part of the luminance histogram, from the range of the mountain-shape distribution detected in the mountain-shape distribution detection step; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00036">
<claim-text><highlight><bold>36</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 35</dependent-claim-reference> wherein, in the boundary value calculation step, the boundary value calculated from the range of the mountain-shape distribution is set by using the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00037">
<claim-text><highlight><bold>37</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 35</dependent-claim-reference> wherein, in the mountain-shape distribution detection step, a restriction is put on the range of the mountain-shape distribution. </claim-text>
</claim>
<claim id="CLM-00038">
<claim-text><highlight><bold>38</bold></highlight>. An automatic tone correction method for correcting tones of a digital image, comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; </claim-text>
<claim-text>a target value correction step of correcting a luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated in the center-of-gravity calculation step, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the uncorrected luminance correction target value when correction of the target value is not performed, or it matches the corrected luminance correction target value when correction of the target value is performed. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00039">
<claim-text><highlight><bold>39</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 38</dependent-claim-reference> wherein, in the target value correction step, when the luminance correction target value is larger than the center of gravity of the low-luminance part of the luminance histogram, the luminance correction target value is corrected so that the target value matches the center of gravity of the low luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00040">
<claim-text><highlight><bold>40</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00033">claim 38</dependent-claim-reference> or <highlight><bold>39</bold></highlight>, wherein the luminance correction target value is corrected so that the target value becomes a value in the vicinity of the center of gravity of the low-luminance part of the luminance histogram. </claim-text>
</claim>
<claim id="CLM-00041">
<claim-text><highlight><bold>41</bold></highlight>. An automatic tone correction method as defined in any of <dependent-claim-reference depends_on="CLM-00026">claims 26</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00039">39</dependent-claim-reference>, wherein the distribution of the luminance histogram is expanded only toward the lower-luminance side and, simultaneously, the luminance histogram is corrected so that the center of gravity of the luminance histogram matches the luminance correction target value. </claim-text>
</claim>
<claim id="CLM-00042">
<claim-text><highlight><bold>42</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>39</bold></highlight>, wherein the tone correction step is performed by executing &ggr; correction. </claim-text>
</claim>
<claim id="CLM-00043">
<claim-text><highlight><bold>43</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight> wherein, in the tone correction step, a correction table is formed so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. </claim-text>
</claim>
<claim id="CLM-00044">
<claim-text><highlight><bold>44</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight> further comprising a luminance distribution expansion step of expanding the luminance distribution of the luminance histogram, between the luminance histogram formation step and the center-of-gravity calculation step; 
<claim-text>wherein, in the center-of-gravity calculation step, calculation of a center of gravity is performed on the low-luminance part of the luminance histogram in which the luminance distribution is expanded. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00045">
<claim-text><highlight><bold>45</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight> wherein, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. </claim-text>
</claim>
<claim id="CLM-00046">
<claim-text><highlight><bold>46</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight> further comprising a skin color region extraction step of extracting a skin color region from color-difference signals and a luminance signal; 
<claim-text>wherein, in the luminance histogram formation step, a luminance histogram, in which the luminance distribution of a skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, is formed. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00047">
<claim-text><highlight><bold>47</bold></highlight>. An automatic tone correction method as defined in <dependent-claim-reference depends_on="CLM-00044">claim 46</dependent-claim-reference> wherein, when the luminance distribution of the skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance portion of the skin color part is weighted. </claim-text>
</claim>
<claim id="CLM-00048">
<claim-text><highlight><bold>48</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight>, wherein the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated in the luminance histogram formation step, and an amount of tone correction for the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. </claim-text>
</claim>
<claim id="CLM-00049">
<claim-text><highlight><bold>49</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight> wherein, in the tone correction, tone correction is not carried out when the luminance distribution is discrete. </claim-text>
</claim>
<claim id="CLM-00050">
<claim-text><highlight><bold>50</bold></highlight>. An automatic tone correction method as defined in any of claims <highlight><bold>26</bold></highlight>, <highlight><bold>29</bold></highlight>, <highlight><bold>32</bold></highlight>, <highlight><bold>35</bold></highlight>, and <highlight><bold>38</bold></highlight>, wherein color-difference signals of the image are corrected according to the correction table. </claim-text>
</claim>
<claim id="CLM-00051">
<claim-text><highlight><bold>51</bold></highlight>. An automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, said automatic tone correction method comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00052">
<claim-text><highlight><bold>52</bold></highlight>. An automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, said automatic tone correction method comprising: 
<claim-text>a target value calculation step of calculating a luminance correction target value from a target luminance distribution; </claim-text>
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the luminance correction target value that is calculated in the target value calculation step. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00053">
<claim-text><highlight><bold>53</bold></highlight>. An automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is recorded, said automatic tone correction method comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a boundary value calculation step of calculating a boundary value for setting a range of a low-luminance part of the luminance histogram; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00054">
<claim-text><highlight><bold>54</bold></highlight>. An automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, said automatic tone correction method comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a mountain-shape distribution detection step of detecting a range of a mountain-shape distribution of the luminance histogram; </claim-text>
<claim-text>a boundary value calculation step of calculating a boundary value for setting a low-luminance part of the luminance histogram, from the range of the mountain-shape distribution detected in the mountain-shape distribution detection step; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of the low-luminance part of the luminance histogram, on the basis of the boundary value calculated in the boundary value calculation step; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches a luminance correction target value. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00055">
<claim-text><highlight><bold>55</bold></highlight>. An automatic tone correction program storage medium in which a program for making a computer execute an automatic tone correction method for correcting tones of a digital image is stored, said automatic tone correction method comprising: 
<claim-text>a luminance histogram formation step of forming a luminance histogram of the digital image; </claim-text>
<claim-text>a center-of-gravity calculation step of calculating a center of gravity of a low-luminance part of the luminance histogram; </claim-text>
<claim-text>a target value correction step of correcting a luminance correction target value so that the target value matches the center of gravity of the low-luminance part of the luminance histogram which is calculated in the center-of-gravity calculation step, when the target value is smaller than the center of gravity of the low-luminance part of the luminance histogram; and </claim-text>
<claim-text>a tone correction step of expanding the luminance distribution and, simultaneously, performing tone correction so that the center of gravity of the low-luminance part of the luminance histogram matches the uncorrected luminance correction target value when correction of the target value is not performed, or it matches the corrected luminance correction target value when correction of the target value is performed. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00056">
<claim-text><highlight><bold>56</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference> wherein, in the tone correction step, a correction table is formed so that it contains a correction which performs, simultaneously, a process of expanding the luminance distribution of the luminance histogram, and a process of matching the center of gravity of the low-luminance part of the distribution-expanded luminance histogram to the luminance correction target value. </claim-text>
</claim>
<claim id="CLM-00057">
<claim-text><highlight><bold>57</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference>, wherein the automatic tone correction method further comprises a luminance distribution expansion step of expanding the luminance distribution of the luminance histogram, between the luminance histogram formation step and the center-of-gravity calculation step; and 
<claim-text>in the center-of-gravity calculation step, calculation of a center of gravity is performed on the low-luminance part of the luminance histogram in which the luminance distribution is expanded. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00058">
<claim-text><highlight><bold>58</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference> wherein, when forming the luminance histogram, a restriction is put on the amount of accumulation of luminance distribution. </claim-text>
</claim>
<claim id="CLM-00059">
<claim-text><highlight><bold>59</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference>, wherein the automatic tone correction method further comprises a skin color region extraction step of extracting a skin color region from color-difference signals and a luminance signal; and 
<claim-text>in the luminance histogram formation step, a luminance histogram, in which the luminance distribution of a skin color part of the image is added to the luminance distribution the . whole image according to the area of the skin color region, is formed. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00060">
<claim-text><highlight><bold>60</bold></highlight>. An automatic tone correction program storage medium as defined in <dependent-claim-reference depends_on="CLM-00055">claim 59</dependent-claim-reference> wherein, when the luminance distribution of the skin color part of the image is added to the luminance distribution of the whole image according to the area of the skin color region, the distribution of a high-luminance portion of the skin color part is weighted. </claim-text>
</claim>
<claim id="CLM-00061">
<claim-text><highlight><bold>61</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference>, wherein the center of gravity of the high-luminance part is calculated from the luminance histogram which is calculated in the luminance histogram formation step, and an amount of tone correction for the high-luminance part is calculated according to the position of the center of gravity of the high-luminance part. </claim-text>
</claim>
<claim id="CLM-00062">
<claim-text><highlight><bold>62</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference>, wherein tone correction is not carried out when the luminance distribution is discrete. </claim-text>
</claim>
<claim id="CLM-00063">
<claim-text><highlight><bold>63</bold></highlight>. An automatic tone correction program storage medium as defined in any of <dependent-claim-reference depends_on="CLM-00051">claims 51</dependent-claim-reference> to <dependent-claim-reference depends_on="CLM-00055">55</dependent-claim-reference>, wherein color-difference signals of the image are corrected according to the correction table.</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002736A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002736A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002736A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030002736A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030002736A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030002736A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030002736A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030002736A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030002736A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030002736A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030002736A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030002736A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030002736A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00013">
<image id="EMI-D00013" file="US20030002736A1-20030102-D00013.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00014">
<image id="EMI-D00014" file="US20030002736A1-20030102-D00014.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00015">
<image id="EMI-D00015" file="US20030002736A1-20030102-D00015.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00016">
<image id="EMI-D00016" file="US20030002736A1-20030102-D00016.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00017">
<image id="EMI-D00017" file="US20030002736A1-20030102-D00017.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00018">
<image id="EMI-D00018" file="US20030002736A1-20030102-D00018.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00019">
<image id="EMI-D00019" file="US20030002736A1-20030102-D00019.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00020">
<image id="EMI-D00020" file="US20030002736A1-20030102-D00020.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00021">
<image id="EMI-D00021" file="US20030002736A1-20030102-D00021.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00022">
<image id="EMI-D00022" file="US20030002736A1-20030102-D00022.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00023">
<image id="EMI-D00023" file="US20030002736A1-20030102-D00023.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00024">
<image id="EMI-D00024" file="US20030002736A1-20030102-D00024.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00025">
<image id="EMI-D00025" file="US20030002736A1-20030102-D00025.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00026">
<image id="EMI-D00026" file="US20030002736A1-20030102-D00026.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00027">
<image id="EMI-D00027" file="US20030002736A1-20030102-D00027.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00028">
<image id="EMI-D00028" file="US20030002736A1-20030102-D00028.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00029">
<image id="EMI-D00029" file="US20030002736A1-20030102-D00029.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00030">
<image id="EMI-D00030" file="US20030002736A1-20030102-D00030.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00031">
<image id="EMI-D00031" file="US20030002736A1-20030102-D00031.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00032">
<image id="EMI-D00032" file="US20030002736A1-20030102-D00032.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00033">
<image id="EMI-D00033" file="US20030002736A1-20030102-D00033.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00034">
<image id="EMI-D00034" file="US20030002736A1-20030102-D00034.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00035">
<image id="EMI-D00035" file="US20030002736A1-20030102-D00035.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
