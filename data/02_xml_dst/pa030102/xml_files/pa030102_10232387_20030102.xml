<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE patent-application-publication SYSTEM "pap-v16-2002-01-01.dtd" [
<!ENTITY US20030002511A1-20030102-D00000.TIF SYSTEM "US20030002511A1-20030102-D00000.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00001.TIF SYSTEM "US20030002511A1-20030102-D00001.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00002.TIF SYSTEM "US20030002511A1-20030102-D00002.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00003.TIF SYSTEM "US20030002511A1-20030102-D00003.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00004.TIF SYSTEM "US20030002511A1-20030102-D00004.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00005.TIF SYSTEM "US20030002511A1-20030102-D00005.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00006.TIF SYSTEM "US20030002511A1-20030102-D00006.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00007.TIF SYSTEM "US20030002511A1-20030102-D00007.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00008.TIF SYSTEM "US20030002511A1-20030102-D00008.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00009.TIF SYSTEM "US20030002511A1-20030102-D00009.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00010.TIF SYSTEM "US20030002511A1-20030102-D00010.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00011.TIF SYSTEM "US20030002511A1-20030102-D00011.TIF" NDATA TIF>
<!ENTITY US20030002511A1-20030102-D00012.TIF SYSTEM "US20030002511A1-20030102-D00012.TIF" NDATA TIF>
]>
<patent-application-publication>
<subdoc-bibliographic-information>
<document-id>
<doc-number>20030002511</doc-number>
<kind-code>A1</kind-code>
<document-date>20030102</document-date>
</document-id>
<publication-filing-type>new</publication-filing-type>
<domestic-filing-data>
<application-number>
<doc-number>10232387</doc-number>
</application-number>
<application-number-series-code>10</application-number-series-code>
<filing-date>20020903</filing-date>
</domestic-filing-data>
<foreign-priority-data>
<priority-application-number>
<doc-number>9-316846</doc-number>
</priority-application-number>
<filing-date>19971118</filing-date>
<country-code>JP</country-code>
</foreign-priority-data>
<technical-information>
<classification-ipc>
<classification-ipc-primary>
<ipc>H04L012/28</ipc>
</classification-ipc-primary>
<classification-ipc-edition>07</classification-ipc-edition>
</classification-ipc>
<classification-us>
<classification-us-primary>
<uspc>
<class>370</class>
<subclass>400000</subclass>
</uspc>
</classification-us-primary>
<classification-us-secondary>
<uspc>
<class>370</class>
<subclass>395420</subclass>
</uspc>
</classification-us-secondary>
</classification-us>
<title-of-invention>Node device and packet transfer method using priority in plural hierarchical levels</title-of-invention>
</technical-information>
<continuity-data>
<continuations>
<continuation-of>
<parent-child>
<child>
<document-id>
<doc-number>10232387</doc-number>
<kind-code>A1</kind-code>
<document-date>20020903</document-date>
</document-id>
</child>
<parent>
<document-id>
<doc-number>09193846</doc-number>
<document-date>19981118</document-date>
<country-code>US</country-code>
</document-id>
</parent>
<parent-status>PENDING</parent-status>
</parent-child>
</continuation-of>
</continuations>
</continuity-data>
<inventors>
<first-named-inventor>
<name>
<given-name>Yoshihiro</given-name>
<family-name>Ohba</family-name>
</name>
<residence>
<residence-non-us>
<city>Kanagawa</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</first-named-inventor>
<inventor>
<name>
<given-name>Yoshimitsu</given-name>
<family-name>Shimojo</family-name>
</name>
<residence>
<residence-non-us>
<city>Kanagawa</city>
<country-code>JP</country-code>
</residence-non-us>
</residence>
<authority-applicant>INV</authority-applicant>
</inventor>
</inventors>
<assignee>
<organization-name>KABUSHIKI KAISHA TOSHIBA</organization-name>
<assignee-type>03</assignee-type>
</assignee>
<correspondence-address>
<name-1>FOLEY AND LARDNER</name-1>
<name-2>SUITE 500</name-2>
<address>
<address-1>3000 K STREET NW</address-1>
<city>WASHINGTON</city>
<state>DC</state>
<postalcode>20007</postalcode>
<country>
<country-code>US</country-code>
</country>
</address>
</correspondence-address>
</subdoc-bibliographic-information>
<subdoc-abstract>
<paragraph id="A-0001" lvl="0">A packet transfer scheme that applies markings at different levels to packets while they are transferred from their source to destination, in which a marking information at one level will not be lost by a marking at another level is disclosed. A node device receives packets each having a plurality of regions into which priority information can be written, and then transmits each received packet to a next hop node by writing the priority information according to criteria of the own node into one region into which the own node is allowed to write the priority information among the plurality of regions contained in each packet, while maintaining the priority information in other regions as received. </paragraph>
</subdoc-abstract>
<subdoc-description>
<summary-of-invention>
<section>
<heading lvl="1">BACKGROUND OF THE INVENTION </heading>
<paragraph id="P-0001" lvl="0"><number>&lsqb;0001&rsqb;</number> 1. Field of the Invention </paragraph>
<paragraph id="P-0002" lvl="0"><number>&lsqb;0002&rsqb;</number> The present invention relates to a node device for transferring packets by attaching priority information, a node device for processing packets attached with priority information, and a packet transfer method using priority information attached to packets. </paragraph>
<paragraph id="P-0003" lvl="0"><number>&lsqb;0003&rsqb;</number> 2. Description of the Background Art </paragraph>
<paragraph id="P-0004" lvl="0"><number>&lsqb;0004&rsqb;</number> A mechanism for guaranteeing QoS (Quality of Service) in IP (Internet Protocol) network has been proposed in a form of providing a constant QoS with respect to individual TCP/UDP session, based on an approach disclosed in R. Braden, L. Zhang, S. Berson. S. Herzog and S. Jamin, &ldquo;Resource ReSerVation Protocol (RSVP)&mdash;Version I Functional Specification&rdquo;, Internet RFC 2205, September 1997; J. Wroclawski, &ldquo;Specification of the Controlled-Load Network Element Service&rdquo;, Internet RFC 2211, September 1997; and S. Shenker, C. Partridge and R. Guerin, &ldquo;Specification of Guaranteed Quality of Service&rdquo;, Internet RFC 2212, September 1997. However, this approach has been associated with a problem of scalability because it is necessary for each router of the network to maintain a state with respect to individual session so that it has been considered rather difficult to employ this approach in a large scale network. </paragraph>
<paragraph id="P-0005" lvl="0"><number>&lsqb;0005&rsqb;</number> Instead, there is a proposition of a framework called Differentiated Service (DS). The goal of DS is provide a mechanism in which the quality of service can be changed according to an amount of money paid by a user as simply as possible. At the data transfer level, a TOS (Type Of Service) field of the packet header is used in order to distinguish different QoSs, rather than having a state for each session in the network. </paragraph>
<paragraph id="P-0006" lvl="0"><number>&lsqb;0006&rsqb;</number> As for the priority bit to be used in the TOS field, there are a scheme for using just one bit as disclosed in D. Clark and J. Wroclawski, &ldquo;An Approach to Service Allocation in the Internet&rdquo;, Internet Draft, draft-clark-diff-svc-alloc-00.txt, July 1997, and a scheme for using plural bits as disclosed in K. Kilkki, &ldquo;Simple Integrated Media Access (SIMA)&rdquo;, Internet Draft, draft-kalevi-simple-media-access-01.txt, June 1997. </paragraph>
<paragraph id="P-0007" lvl="0"><number>&lsqb;0007&rsqb;</number> The basic scheme of DS is as follows. A subscribed rate is specified between a user and a network or between two neighboring management networks (domains), and packets are marked as high priority packets while the transmission rate is less than or equal to the subscribed rate, or as low priority packets when the transmission rate exceeds the subscribed rate, according to a relationship between the subscribed rate and the monitored packet transmission rate. Then, the high priority packets are handled with priority over the low priority packets within the network or domain so as to provide different QoSs. Here, the marking is done by attaching (writing) an information indicating the priority level to the packet. </paragraph>
<paragraph id="P-0008" lvl="0"><number>&lsqb;0008&rsqb;</number> In the present specification, the subscribed rate between a user and a network will be referred to as an edge level rate (ELR) and the subscribed rate between two neighboring domains will be referred to as a domain level rate (DLR). </paragraph>
<paragraph id="P-0009" lvl="0"><number>&lsqb;0009&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows an exemplary network to which DS is applied. In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, U<highlight><bold>1</bold></highlight>, U<highlight><bold>2</bold></highlight> and U<highlight><bold>3</bold></highlight> are users (user terminals or user networks), E<highlight><bold>1</bold></highlight> and E<highlight><bold>2</bold></highlight> are edge routers, B<highlight><bold>1</bold></highlight>, B<highlight><bold>2</bold></highlight>, B<highlight><bold>3</bold></highlight>, B<highlight><bold>4</bold></highlight>, B<highlight><bold>5</bold></highlight> and B<highlight><bold>6</bold></highlight> are domain border routers, and R<highlight><bold>1</bold></highlight> is a relay router. <cross-reference target="DRAWINGS">FIG. 1</cross-reference> shows a case involving four domains A, B, C and D. For instance, a network managed by one ISP (Internet Service Provider) corresponds to one domain. </paragraph>
<paragraph id="P-0010" lvl="0"><number>&lsqb;0010&rsqb;</number> Suppose that users U<highlight><bold>1</bold></highlight>, U<highlight><bold>2</bold></highlight> and U<highlight><bold>3</bold></highlight> in the domain A have subscribed edge level rates (ELR) of 2 Mbps, 2 Mbps and 5 Mbps, respectively, with respect to the domain A. In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, only the subscribed rate for one direction is indicated for the sake of simplicity but it is possible to have the subscribed rate for both directions. It is assumed that the user is allowed to carry out the marking of high/low priority levels with respect to transmission packets at will. The edge routers E<highlight><bold>1</bold></highlight> and E<highlight><bold>2</bold></highlight> measure the arrival rate of the transmission packets from the user, and marks those high priority packets that arrived at rate above the subscribed edge level rate as low priority ones. </paragraph>
<paragraph id="P-0011" lvl="0"><number>&lsqb;0011&rsqb;</number> Then, suppose that the domain level rate (DLR) of 5 Mbps has been subscribed for traffic passing from the domain A to the domain B, for example. In <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, only the subscribed rate for one direction is indicated for the sake of simplicity but it is possible to have the subscribed rate for both directions. The domain border router B<highlight><bold>2</bold></highlight> measures the arrival rate of packets from the domain A, and marks those high priority packets that arrived from the domain border router B<highlight><bold>1</bold></highlight> at rate above the DLR as low priority ones. Similarly, when the DLR of 2 Mbps has been subscribed for traffic passing from the domain B to the domain C, the domain border router B<highlight><bold>5</bold></highlight> marks those high priority packets that arrived from the domain border router B<highlight><bold>3</bold></highlight> at rate above the DLR as low priority ones. Also, when the DLR of 10 Mbps has been subscribed for traffic passing from the domain B to the domain D, the domain border router B<highlight><bold>6</bold></highlight> marks those high priority packets that arrived from the domain border router B<highlight><bold>4</bold></highlight> at rate above the DLR as low priority ones. </paragraph>
<paragraph id="P-0012" lvl="0"><number>&lsqb;0012&rsqb;</number> Now, consider the case of using only one bit of the priority bit in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>. In this case, both the edge routers and the domain border routers will rewrite the same priority bit at a time of marking. </paragraph>
<paragraph id="P-0013" lvl="0"><number>&lsqb;0013&rsqb;</number> When the receiving rate of the high priority packets is above the subscribed rate at the domain level, the high priority packets below the subscribed rate will be passed as they are while packets above the subscribed rate will be marked as low priority ones regardless of whether they are originally high priority ones or low priority ones. </paragraph>
<paragraph id="P-0014" lvl="0"><number>&lsqb;0014&rsqb;</number> Suppose now that the user U<highlight><bold>1</bold></highlight> transmitted the high priority packets destined to a host in the domain C at the ELR value of 2 Mbps. Also suppose that no transmission packets other than those from the user U<highlight><bold>1</bold></highlight> are flowing from the domain border router B<highlight><bold>3</bold></highlight> to the domain border router B<highlight><bold>5</bold></highlight>. Then, if the total transmission rate of the high priority packets from the users U<highlight><bold>2</bold></highlight> and U<highlight><bold>3</bold></highlight> is less than or equal to 3 Mbps, all the high priority packets from the user U<highlight><bold>1</bold></highlight> will be delivered to the domain C as they are. </paragraph>
<paragraph id="P-0015" lvl="0"><number>&lsqb;0015&rsqb;</number> However, if the users U<highlight><bold>2</bold></highlight> and U<highlight><bold>3</bold></highlight> also transmit the high priority packets to the domain D and the total transmission rate of the high priority packets from the users U<highlight><bold>2</bold></highlight> and U<highlight><bold>3</bold></highlight> exceeds 3 Mbps, a part of the high priority packets from the user U<highlight><bold>1</bold></highlight> will be changed into the low priority packets. In this case, there is a problem in that these high priority packets from the user U<highlight><bold>1</bold></highlight> which are changed into the low priority packets at the domain border router B<highlight><bold>2</bold></highlight> will be handled as the low priority ones in the domain C as well even if the domain border router B<highlight><bold>5</bold></highlight> of the domain C has enough margin to pass 2 Mbps of the high priority packets from the user U<highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0016" lvl="0"><number>&lsqb;0016&rsqb;</number> This problem is also present in the case of using plural priority bits as long as the same plural bits are to be rewritten at both the edge level and the domain level similarly as in the case of using one priority bit. </paragraph>
</section>
<section>
<heading lvl="1">SUMMARY OF THE INVENTION </heading>
<paragraph id="P-0017" lvl="0"><number>&lsqb;0017&rsqb;</number> It is therefore an object of the present invention to provide a mechanism for a packet transfer scheme that applies markings at different levels to packets while they are transferred from their source to destination, in which a marking information at one level will not be lost by a marking at another level. </paragraph>
<paragraph id="P-0018" lvl="0"><number>&lsqb;0018&rsqb;</number> In order to achieve this object, the present invention provides a plurality of regions to which the priority information can be attached in a packet in correspondence to the plural levels, such that a region corresponding to one level will not be rewritten by a node that carries out the marking at another level. </paragraph>
<paragraph id="P-0019" lvl="0"><number>&lsqb;0019&rsqb;</number> A node device according to the present invention is thus characterized by writing the priority information according to criteria of the own node into a region in a packet into which the own node is allowed to write the priority information among the plurality of regions to which the priority information can be written, and transmitting that packet to a next hop node while maintaining the priority information in the other regions as received. </paragraph>
<paragraph id="P-0020" lvl="0"><number>&lsqb;0020&rsqb;</number> For example, when this node device is an edge router for transferring packets from a user (user terminal or user network) to a network, this node device writes the priority information into a region corresponding to the edge level (which can be considered as a network level in the case of using only two hierarchical levels of a user level and a network level), according to a rate specified between the user and the network for instance, without rewriting the priority information in a region corresponding to the user level. In addition, when there are three hierarchical levels of a user level, an edge level and a domain level, this edge router may writes the priority information into a region corresponding to the domain level, according to a policy of a domain to which this edge router belongs for instance. Else, when there are three hierarchical levels of a user level, an edge level and a neighboring node level, this edge router may writes the priority information into a region corresponding to the neighboring node level, according to a rate specified between this edge router and a next hop node. </paragraph>
<paragraph id="P-0021" lvl="0"><number>&lsqb;0021&rsqb;</number> Also, when this node device is a domain border router for transferring packets from one domain to another domain, this node device writes the priority information into a region corresponding to the domain level, according to a rate specified between domains or a policy of one of the domains to which this domain border router is connected for instance, without rewriting the priority information in any existing regions corresponding to the user level and the edge level (which includes the case where a value to be written by this domain border router happens to be the same as a value written in the same region by a previous hop domain border router so that it is left unchanged). Note that when there is only one level of either the user level or the edge level besides the domain level (as in the case where the edge router is to rewrite a region corresponding to the user level and no region corresponding to the edge level is provided for example), the priority information in a region corresponding to that one existing level is not to be rewritten by this domain border router. Also, when the neighboring node level also exists, this domain border router may write the priority information into a region corresponding to the neighboring node level, according to a rate specified between this domain border router and a next hop node. </paragraph>
<paragraph id="P-0022" lvl="0"><number>&lsqb;0022&rsqb;</number> Also, when this node device is a device for transferring packets from a previous hop node to a next hop node and a region corresponding to the neighboring node level exists, this node device writes the priority information into a region corresponding to the neighboring node level, according to a rate specified between this node and the next hop node for instance, without rewriting the priority information in any existing regions corresponding to the user level, the edge level, and the domain level (which includes the case where a value to be written by this node device happens to be the same as a value written in the same region by a previous hop node so that it is left unchanged). </paragraph>
<paragraph id="P-0023" lvl="0"><number>&lsqb;0023&rsqb;</number> As such, according to the present invention, packets are transferred while the priority information corresponding to one level is rewritten by a node that carries out the marking at the same level but not by a node that carries out the marking at another level. Namely, while packets are transferred from a source to a destination, the priority information corresponding to the domain level for instance will be rewritten every time packets are transferred across a range in which the priority information of that level is valid (i.e., a border of that domain), and the priority information corresponding to the neighboring node level for instance will be rewritten every time packets are transferred across a range in which the priority information of that level is valid (i.e., a next hop node), while the priority information corresponding to the user level for instance will not be rewritten within a range in which the priority information of that level is valid (i.e., until packets are received by the user). </paragraph>
<paragraph id="P-0024" lvl="0"><number>&lsqb;0024&rsqb;</number> By utilizing such hierarchical priority information, each node through which packets pass can carry out a flexible priority control reflecting an intention of the user or a policy of the domain, as in the following examples. </paragraph>
<paragraph id="P-0025" lvl="0"><number>&lsqb;0025&rsqb;</number> One example of the priority control is the priority control at a time of attaching the priority information. Namely, a transmission unit of this node device can determine the priority information to be written by the own node according to the priority level specified by one or a combination of plural of the priority information written in a plurality of regions contained in the received packet. </paragraph>
<paragraph id="P-0026" lvl="0"><number>&lsqb;0026&rsqb;</number> At this point, the priority information to be written can be determined according to the priority level specified as described above such that an amount of communication resources to be used by selected packets, which are to be transmitted by writing the priority information indicating the high priority into a region to which the own node is allowed to attach the priority information, will approach an amount of communication resources allocated to a set of packets to which these selected packets belong. Here, the reference amount of communication resources should preferably be that which is allocated within a range in which the priority information attached by the own node is valid (such as within the domain, or between neighboring nodes). </paragraph>
<paragraph id="P-0027" lvl="0"><number>&lsqb;0027&rsqb;</number> Note that this provision of determining the priority information according to the allocated amount of communication resources is valid even in the case where the edge router transmits a received packet by rewriting the priority information in a region corresponding to the user level instead of maintaining it. In such a case, the reference amount of communication resources can be an amount of communication resources allocated between the user and the network. </paragraph>
<paragraph id="P-0028" lvl="0"><number>&lsqb;0028&rsqb;</number> In order to make the amount of communication resources to be used by a packet which is to be written as the high priority one by the own node approaching to the reference amount, there can be a case where that packet is written as the low priority one even when a referenced region (which can be a region to which the own node is allowed to write the priority information or a region to which the own node is not allowed to write the priority information) indicates the high priority (the case of having many high priority packets) as well as a case where that packet is written as the high priority one even when the referenced region indicates the low priority (the case of having few high priority packets). As described below, there are many possible variations regarding how to determine the priority level at a time of attaching the priority information according to referenced one or plural priority information, and regarding how to use the determined priority level in relation to the reference amount in determining the priority information to be attached. </paragraph>
<paragraph id="P-0029" lvl="0"><number>&lsqb;0029&rsqb;</number> Another example of the priority control is the priority control at a time of packet transfer. Namely, a node device (which by itself does not attach the priority information) on a transfer route of a packet transmitted by the above described node device which attaches the priority information can carry out the transfer processing for that packet (including packet discarding or delay control) according to the priority level specified by referring to one or plural of the plurality of regions in which the respective priority information is written in that packet as received. Here, in the case of carrying out the packet discarding, the controlling is made such that packets with higher priority level will be less likely to be discarded, and in the case of carrying out the delay control, the controlling is made such that packets with higher priority level will be delayed shorter. </paragraph>
<paragraph id="P-0030" lvl="0"><number>&lsqb;0030&rsqb;</number> Note that when the node device which attaches the priority information itself transmits (transfers) the received packet, this node device may carry out the priority control related to the packet transfer according to the priority information written in that received packet, or according to the priority information written by the own node, or else by using another mechanism unrelated to the priority information in the packet. Also, a way of determining the priority level at a time of attaching the priority information and a way of determining the priority level at a time of packet transfer may be the same or different. </paragraph>
<paragraph id="P-0031" lvl="0"><number>&lsqb;0031&rsqb;</number> Note also that each aspect of the present invention described herein as a feature of a node device can be also conceived as a feature of a packet transfer method or an article of manufacture storing programs for causing the computer to function as the node device or to execute steps of the packet transfer method. </paragraph>
<paragraph id="P-0032" lvl="0"><number>&lsqb;0032&rsqb;</number> Other features and advantages of the present invention will become apparent from the following description taken in conjunction with the accompanying drawings.</paragraph>
</section>
</summary-of-invention>
<brief-description-of-drawings>
<section>
<heading lvl="1">BRIEF DESCRIPTION OF THE DRAWINGS </heading>
<paragraph id="P-0033" lvl="0"><number>&lsqb;0033&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 1</cross-reference> is a diagram showing a network using a conventional differential service scheme. </paragraph>
<paragraph id="P-0034" lvl="0"><number>&lsqb;0034&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> is a diagram showing an exemplary bit assignment for a priority bit region according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0035" lvl="0"><number>&lsqb;0035&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 3</cross-reference> is a block diagram showing an exemplary configuration of a router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0036" lvl="0"><number>&lsqb;0036&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 4</cross-reference> is a table for explaining the first exemplary manner of marking in the case of an edge router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0037" lvl="0"><number>&lsqb;0037&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 5</cross-reference> is a table for explaining the second exemplary manner of marking in the case of an edge router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0038" lvl="0"><number>&lsqb;0038&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> is a table for explaining the first exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0039" lvl="0"><number>&lsqb;0039&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> is a table for explaining the second exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0040" lvl="0"><number>&lsqb;0040&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> is a table for explaining the third exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0041" lvl="0"><number>&lsqb;0041&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> is a table for explaining the fourth exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0042" lvl="0"><number>&lsqb;0042&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> is a table for explaining the fifth exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0043" lvl="0"><number>&lsqb;0043&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> is a table for explaining the sixth exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0044" lvl="0"><number>&lsqb;0044&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> is a table for explaining the seventh exemplary manner of marking in the case of a domain border router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0045" lvl="0"><number>&lsqb;0045&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 13</cross-reference> is a flow chart for an exemplary marking algorithm according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0046" lvl="0"><number>&lsqb;0046&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 14</cross-reference> is a block diagram showing an exemplary configuration of a marking unit in the router according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0047" lvl="0"><number>&lsqb;0047&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 15</cross-reference> is a diagram showing a network in the case of specifying destination specific ELR and neighboring domain border router specific DLR according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0048" lvl="0"><number>&lsqb;0048&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 16</cross-reference> is a diagram showing an exemplary priority bit region allocation in an IPv<highlight><bold>4</bold></highlight> packet according to one embodiment of the present invention. </paragraph>
<paragraph id="P-0049" lvl="0"><number>&lsqb;0049&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 17</cross-reference> is a diagram showing an exemplary priority bit region allocation in an IPv<highlight><bold>6</bold></highlight> packet according to one embodiment of the present invention.</paragraph>
</section>
</brief-description-of-drawings>
<detailed-description>
<section>
<heading lvl="1">DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS </heading>
<paragraph id="P-0050" lvl="0"><number>&lsqb;0050&rsqb;</number> Now, the preferred embodiments of the present invention will be described in detail. First, the main features of the present invention will be summarized. </paragraph>
<paragraph id="P-0051" lvl="0"><number>&lsqb;0051&rsqb;</number> A node device according to one embodiment of the present invention has a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network, and a transmission unit for attaching a second priority information to the received packet according to an amount of communication resources allocated to a flow to which the received packet belongs, and transmitting the packet that contains this second priority information and maintains the first priority information to a next hop node. </paragraph>
<paragraph id="P-0052" lvl="0"><number>&lsqb;0052&rsqb;</number> Here, the flow is a set of packets that are identified by some information contained in the packets, which corresponds to a set of packets having the same destination network, a set of packets having the same egress node in a domain to which this node device belongs, a set of packets having the same ingress node in a next hop domain of a domain to which this node device belongs, a set of packets having the same node as a next hop of this node device, a set of packets having the same destination network and source network, a set of packets having the same destination host, a set of packets having the same destination host and source host, a set of packets having the same destination host and destination port, a set of packets having the same destination host, destination port, source host and source port, or variations of these, for example. A type of set of packets that is to be treated as the flow may be different at different nodes. </paragraph>
<paragraph id="P-0053" lvl="0"><number>&lsqb;0053&rsqb;</number> Also, the amount of communication resources corresponds to a bandwidth or a transmission rate (which can be any of a peak rate, an average rate, etc.), for example. The allocation of communication resources may be made according to communication resources of physical communication links, or according to a subscription between a user and a domain, a subscription between domains, a subscription between neighboring nodes, etc., or else dynamically according to a report from the transmitting side or a request from the receiving side. In the case of making the allocation with respect to each flow at the finer granularity than what is specified by the physical link or the subscription, the allocation may be made manually by a network manager in view of an amount of traffic of each flow, or an amount of communication resources to be allocated to each flow may be determined by a node according to the control information exchanged by nodes. It is also possible to carry out the admission control for a report from the transmitting side or a request from the receiving side. </paragraph>
<paragraph id="P-0054" lvl="0"><number>&lsqb;0054&rsqb;</number> The transmission unit of this node device should preferably refer to the first priority information contained in the received packet and attach the second priority information indicating the high priority to those packets in which the first priority information indicates the high priority, at a higher priority over those packets in which the first priority information indicates the low priority. </paragraph>
<paragraph id="P-0055" lvl="0"><number>&lsqb;0055&rsqb;</number> In addition, it is also possible to attach the second priority information indicating the high priority even to those packets in which the first priority information indicates the low priority, within a range in accordance with the allocated amount of communication resources. </paragraph>
<paragraph id="P-0056" lvl="0"><number>&lsqb;0056&rsqb;</number> Here, the range in accordance with the allocated amount of communication resources may be set such that the second priority information indicating the high priority will be attached as long as a total number of packets to which the second priority information indicating the high priority does not exceed the allocated amount of communication resources, or such that the second priority information indicating the high priority will be attached to those packets in which the first priority information indicates the low priority as long as a total number of packets to which the second priority information indicating the high priority does not exceed a prescribed value less than the allocated amount of communication resources so as to account for a possibility for having bursty arrival of packets with the first priority information indicating the high priority later on. </paragraph>
<paragraph id="P-0057" lvl="0"><number>&lsqb;0057&rsqb;</number> Then, when the received packet exceeds a range in accordance with the allocated amount of communication resources upon receiving a packet with the first priority information indicating the high priority within a prescribed period of time after the second priority information indicating the high priority is attached to a packet with the first priority information indicating the low priority, the second priority information indicating the high priority may be attached to the received packet up to a prescribed range beyond the range in accordance with the allocated amount of communication resources. In addition, upon receiving a packet with the first priority information indicating the low priority within a prescribed period of time after that, the second priority information indicating the low priority may be attached to the received packet until a part that exceeded the range in accordance with the allocated amount of communication resources is compensated even if that received packet is within the range in accordance with the allocated amount of communication resources. </paragraph>
<paragraph id="P-0058" lvl="0"><number>&lsqb;0058&rsqb;</number> These are examples of the case for using the first priority information as the priority level at a time of attaching the priority information, which are also examples of a way of using this priority level in relation to the allocated amount of communication resources in determining the second priority information to be attached. </paragraph>
<paragraph id="P-0059" lvl="0"><number>&lsqb;0059&rsqb;</number> A node device according to another embodiment of the present invention has a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network, and a transmission unit for transmitting to a next hop node a packet to which a second priority information indicating a high priority is attached and in which the received first priority information is contained as it is when the first priority information contained in the received packet indicates the high priority, or for transmitting to the next hop node a packet to which the second priority information is attached according to an amount of communication resources allocated to a flow to which that packet belongs and in which the received first priority information is contained as it is when the first priority information contained in the received packet indicates the low priority. </paragraph>
<paragraph id="P-0060" lvl="0"><number>&lsqb;0060&rsqb;</number> This is another example of a way in which the first priority information is used as the priority level at a time of attaching the priority information and a way in which this priority level is used in relation to the allocated amount of communication resources in determining the second priority information to be attached. </paragraph>
<paragraph id="P-0061" lvl="0"><number>&lsqb;0061&rsqb;</number> A node device according to another embodiment of the present invention has a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network and a second priority information which is attached at a previous hop node or a previous hop network, and a transmission unit for transmitting a received packet to a next hop node by rewriting the second priority information into that which indicates the high priority according to the amount of communication resources allocated to a flow to which the received packet belongs, without rewriting the first priority information, when the received packet contains the first priority information indicating the high priority and the second priority information indicating the low priority. </paragraph>
<paragraph id="P-0062" lvl="0"><number>&lsqb;0062&rsqb;</number> In this way, when an originally high priority packet comes transferred as a low priority packet due to a resource limitation at an upstream side node of the own node, it becomes possible to transfer that packet by setting it back into the high priority packet as long as the resource at the own node permits, by utilizing the information indicating the high priority that is maintained in that packet. </paragraph>
<paragraph id="P-0063" lvl="0"><number>&lsqb;0063&rsqb;</number> Here, the second priority information may be rewritten from that which indicates the low priority into that which indicates the high priority within a range in accordance with the allocated amount of communication resources, even if it is a packet in which the first priority information indicates the low priority. </paragraph>
<paragraph id="P-0064" lvl="0"><number>&lsqb;0064&rsqb;</number> It is also possible to write the second priority information indicating the high priority in a packet to be transmitted, at a higher priority for those packets in which the second priority information indicates the high priority over those packets in which the second priority information indicates the low priority, among a plurality of packets in which the first priority information indicates the same priority level, or regardless of what is indicated by the first priority information in packets. This is an example of a way of using the second priority information in determining the priority level at a time of attaching the priority information, in addition to the first priority information or instead of the first priority information. </paragraph>
<paragraph id="P-0065" lvl="0"><number>&lsqb;0065&rsqb;</number> In this way, a packet that comes transferred as a high priority packet from a previous hop will have a high probability of being transferred as a high priority packet within a range in which the second priority information attached by the own node is valid, which lies on the downstream side of the own node, so that it is possible to increase a possibility by which that packet will be transferred at the high priority end-to-end. </paragraph>
<paragraph id="P-0066" lvl="0"><number>&lsqb;0066&rsqb;</number> At each node device described above, the first priority information may be attached as determined arbitrarily by the transmission node or the transmission network, or according to an amount of communication resources allocated to a flow to which that packet belongs as determined between the transmission node or the transmission network and the management network for managing the transmission node or the transmission network (which manages communication resources to be used by a packet flowing in from the transmission node or the transmission network). </paragraph>
<paragraph id="P-0067" lvl="0"><number>&lsqb;0067&rsqb;</number> Note that each node device described above transmits (transfers) a packet in a state of maintaining the first priority information as received, but in the case of the edge router, it is also possible to adopt a configuration which transmits a packet by overwriting the first priority information with the priority information that is determined as described above and attaching another information as the second priority information. </paragraph>
<paragraph id="P-0068" lvl="0"><number>&lsqb;0068&rsqb;</number> Also, when some node device functions as an edge router with respect to some packet group and as a domain border router with respect to some other packet group, there are cases where a region to which the priority information is to be attached changes or a manner of determining the priority information to be attached changes depending on which function it assumes, so that it is also possible to distinguish a packet group to which a received packet belongs among these packet groups, according to an input interface at which that packet is received, for example. Else, it is also possible to store an address of the transmission node or the transmission network that is to be managed by the own node functioning as an edge router, and function as an edge router when the source address of the received packet coincides with the stored address or as a domain border router otherwise. </paragraph>
<paragraph id="P-0069" lvl="0"><number>&lsqb;0069&rsqb;</number> Examples described up to here are directed to the case of forming criteria for determining the priority information to be written into a region to which the own node is allowed to write among a plurality of regions in a packet according to the priority information indicated in the received packet or the allocated amount of communication resources, but it is also possible to use the following criteria. </paragraph>
<paragraph id="P-0070" lvl="0"><number>&lsqb;0070&rsqb;</number> Namely, it is also possible to adopt such criteria that the node device judges whether a packet to be transmitted is a first packet received from a previous hop network (or a first packet which has a node within a network to which the own node belongs as the destination and which is received from a previous hop network) or a second packet which has nodes within a network to which the own node belongs as its source and destination, and transmits to a next hop node a packet which contains the first priority information that was attached by a node other than the own node and that will not be rewritten by the own node and which is attached with the second priority information indicating the high priority as the second priority information that can be rewritten by the own node when the packet is judged as the first packet, or transmits to a next hop node a packet which is attached with the second priority information indicating the low priority as the second priority information that can be rewritten by the own node when the packet is judged as the second packet. </paragraph>
<paragraph id="P-0071" lvl="0"><number>&lsqb;0071&rsqb;</number> In this way, the packet that is transferred across networks and that is remaining on the network for a long time can be delivered to its destination at a higher priority. </paragraph>
<paragraph id="P-0072" lvl="0"><number>&lsqb;0072&rsqb;</number> Next, a node device for transferring a packet to which the priority information is attached as described above (which corresponds to a node which does not have a function to attach the priority information by itself and which exists in the network so that it is to carry out the priority control at a time of the packet transfer) will be described. This type of a node device according to the present invention has a reception unit for receiving a packet that contains a first priority information that will not be rewritten after it is attached at a transmission node, a transmission network, or a management network that manages the transmission node or the transmission network, for example, and a second priority information that can be rewritten at a node on a transfer route of that packet, and a processing unit for carrying out a transfer processing of that packet according to the second priority information contained in that packet as received. </paragraph>
<paragraph id="P-0073" lvl="0"><number>&lsqb;0073&rsqb;</number> For example, a node within some network (domain) through which the packet passes will be carrying out the priority control with respect to that packet according to the second priority information that was attached at an ingress node of that domain (which is valid within that domain). In addition to that, it is also possible to carry out the priority control using the first priority information that was attached at the user level or the edge level and that is maintained within the domain. </paragraph>
<paragraph id="P-0074" lvl="0"><number>&lsqb;0074&rsqb;</number> In the latter case, the transfer processing of that packet will be carried out at different priority levels depending on whether the first and second priority information contained in that packet as received indicate the high priority, or one of the first and second priority information indicates the high priority while the other one indicates the low priority, or else the first and second priority information indicate the low priority, for example. Depending on the policy within that domain, a packet with the first priority information indicating the high priority and the second priority information indicating the low priority and a packet with the first priority information indicating the low priority and the second priority information indicating the high priority may be treated as the same priority level, or the former may be treated at a higher priority over the latter, or else the latter may be treated at a higher priority over the former. </paragraph>
<paragraph id="P-0075" lvl="0"><number>&lsqb;0075&rsqb;</number> Note that, in the case where the transmission unit of each node device that attaches the priority information as described above transmits a packet by encapsulating the packet in a lower layer, it is also effective to transmit the packet by encapsulating at least an information corresponding to the second priority information (which is the priority information to be used in the priority control at a node within the network) into a packet header of the lower layer. At this point, the second priority information may or may not be attached to an original packet that is to be encapsulated. In this way, when a node on a route within that network (domain) is a node that carries out the packet exchange by referring to an information contained in the lower layer packet (which carries out the packet transfer without carrying out the assembling into an upper layer packet), that node on the route can carry out the packet exchange (transfer) while carrying out the priority control according to the priority information written in the received lower layer packet. </paragraph>
<paragraph id="P-0076" lvl="0"><number>&lsqb;0076&rsqb;</number> Moreover, when the transmission unit of each node device that attaches the priority information as described above transmits a packet by encapsulating it in a packet of the same layer (as in the case of IP tunneling), it is also possible to use the received packet containing the first priority information and including its header as a payload of a transmission packet and write the second priority information (the priority information that is used in the priority control at a node within the network) into a specific region in a transmission packet header that is to be newly attached. In this case, a destination to be written into a header to be newly attached will be a next hop domain border router (an egress router of the domain) or a next hop node, for example. </paragraph>
<paragraph id="P-0077" lvl="0"><number>&lsqb;0077&rsqb;</number> Now, terms used in the following description of the preferred embodiments of the present invention will be explained. </paragraph>
<paragraph id="P-0078" lvl="0"><number>&lsqb;0078&rsqb;</number> A term &ldquo;priority bit region&rdquo; indicates a bit region which is a target of the marking. In the following embodiments, two bits or more of the priority bit region will be necessary overall. The priority bit region will be provided in a packet header but it is not absolutely necessary for every packet to have this priority bit region, so that the priority bit region may be provided in an option header. Also, in the case of using the encapsulation (IP tunneling) which puts an IP packet within another IP packet, a part of the priority bit region will be provided in a header of an original IP packet and another part of the priority bit region will be provided in a packet header that is to be newly attached at a time of the encapsulation. </paragraph>
<paragraph id="P-0079" lvl="0"><number>&lsqb;0079&rsqb;</number> Bits constituting the priority bit region may not necessarily be located at a continuous region, and can be logical entities so that their physical locations may be changed at each router. </paragraph>
<paragraph id="P-0080" lvl="0"><number>&lsqb;0080&rsqb;</number> In addition, in the case where a packet is encapsulated in a lower layer packet and the lower layer packet has the priority bit region, a part or a whole of the priority bit region of the original packet (which is preferably a portion to be referred at a node on a route in that network for the purpose of the priority control) may be mapped or copied to the priority bit region of the lower layer packet. </paragraph>
<paragraph id="P-0081" lvl="0"><number>&lsqb;0081&rsqb;</number> A term &ldquo;priority class&rdquo; indicates a set of packets that is classified according to a value in the priority bit region. When the priority bit region has N bits overall, there will be 2<highlight><superscript>N </superscript></highlight>sets of the priority class. </paragraph>
<paragraph id="P-0082" lvl="0"><number>&lsqb;0082&rsqb;</number> A term &ldquo;level&rdquo; indicates a range of a network in which a part of the priority bit region that was marked once will not be rewritten. The level is defined hierarchically and a smaller value for the level implies a wider range for a network. Namely, a range of a network at the level i&plus;1 will be contained within a range of a network at the level i. The following embodiments will be directed to the case of using a packet network in which two or more levels are defined. Examples of the level are as follows. </paragraph>
<paragraph id="P-0083" lvl="2"><number>&lsqb;0083&rsqb;</number> (1) User level: networks as a whole which are exterior to a transmission terminal of a user. </paragraph>
<paragraph id="P-0084" lvl="2"><number>&lsqb;0084&rsqb;</number> (2) Edge level: networks as a whole which are exterior from a viewpoint of some network. </paragraph>
<paragraph id="P-0085" lvl="2"><number>&lsqb;0085&rsqb;</number> (3) Domain level: one autonomously managed network (domain). A domain is a network in which the routing of packets can be carried out using only information of the routing protocol that is operating locally within its interior, in the case of carrying out the packet transfer that is closed within its interior, for example. A network in which one OSPF (Open Shortest Path First) protocol is operating can be a domain. Also, a network magaged by one ISP can be a domain. The present invention is equally applicable to any suitable definition of a domain. </paragraph>
<paragraph id="P-0086" lvl="2"><number>&lsqb;0086&rsqb;</number> (4) Neighboring node level: a network between two neighboring nodes. A broadcast LAN such as Ethernet can be a neighboring node level. </paragraph>
<paragraph id="P-0087" lvl="2"><number>&lsqb;0087&rsqb;</number> (5) Intra-node level: an interior of one node. </paragraph>
<paragraph id="P-0088" lvl="0"><number>&lsqb;0088&rsqb;</number> A term &ldquo;level i priority bit region&rdquo; indicates a region of one or more bits in the priority bit region which cannot be rewritten at interior (excluding a border) of a level i network. The priority bit regions of different levels will not overlap. As a consequence, the priority bit region in which a value was written at the user or edge level can maintain that value even when packets pass through a plurality of domains. Note that a router that can rewrite the level i priority bit region is also capable of rewriting the level j (j&gE;i) priority bit region as well. </paragraph>
<paragraph id="P-0089" lvl="0"><number>&lsqb;0089&rsqb;</number> A term &ldquo;packet transfer priority level&rdquo; indicates the priority level at a time of packet transfer that is determined according to a value of the priority class. The higher priority level implies an ability of being processed at higher priority at a time of packet transfer. One packet transfer priority level may be assigned to one priority class, or the same packet transfer priority level may be assigned to a plurality of priority classes. </paragraph>
<paragraph id="P-0090" lvl="0"><number>&lsqb;0090&rsqb;</number> The assignment of the packet transfer priority level can be defined globally in an entire packet network, locally within a domain, locally within a subnet, locally within a router, or in any other suitable manner. For example, it is possible to define the mapping such that packets having the same level i priority bit region will have the same packet transfer priority level in the level i network. In this case, it suffices to refer to the level i priority bit region alone at a time of the packet transfer priority control within the level i network (including a border). </paragraph>
<paragraph id="P-0091" lvl="0"><number>&lsqb;0091&rsqb;</number> A term &ldquo;packet transfer priority control&rdquo; indicates the priority control at a time of packet transfer that is carried out according to the packet transfer priority level in routers (not necessarily all routers) within a packet network which adopts the mechanism of the present invention, which includes the scheduling control at a time of packet output and the discarding control at a time of packet arrival. </paragraph>
<paragraph id="P-0092" lvl="0"><number>&lsqb;0092&rsqb;</number> A term &ldquo;packet marking priority level&rdquo; indicates the priority level at a time of marking that is determined according to a value of the priority class. It implies that a packet with a higher packet marking priority level will have a higher probability of being marked as the high priority one than a packet with a lower packet marking priority level, at a time of making the level i priority bit region. One packet marking priority level may be assigned to one priority class, or the same packet marking priority level may be assigned to a plurality of priority classes. Also, the packet marking priority level can be determined independently from the packet transfer priority level. </paragraph>
<paragraph id="P-0093" lvl="0"><number>&lsqb;0093&rsqb;</number> A term &ldquo;packet marking priority control&rdquo; indicates the priority control that is carried out at a time of marking a specified priority bit region (which can be rewritten by that router), and in the case of specifying a maximum amount of communication resources available to a packet that is set with the specified priority bit region indicating the high priority, a packet with a higher packet marking priority level will be marked as the high priority one at higher priority over a packet with a lower packet marking priority level. The marking can be made in units of flows. </paragraph>
<paragraph id="P-0094" lvl="0"><number>&lsqb;0094&rsqb;</number> More specifically, packets with the low packet marking priority level will be marked as the high priority ones when few packets with the high packet marking priority level arrive, but packets with the low packet marking priority level will be less likely to be marked as the high priority ones than packets with the high packet marking priority level when many packets with the high packet marking priority level arrive. </paragraph>
<paragraph id="P-0095" lvl="0"><number>&lsqb;0095&rsqb;</number> There are cases where a packet with the low packet marking priority level is marked as the high priority one at some point so that, when a packet with the high packet marking priority level arrives later on, the amount of communication resources available to a packet that is to be set as the high priority one exceeds the maximum amount of communication resources available when packets with the high and low packet marking priority levels are both taken into account, despite of the fact that the amount of communication resources available to a packet that is to be set as the high priority one is less than the maximum amount of communication resources available when packets with the high packet marking priority level alone are taken into account. </paragraph>
<paragraph id="P-0096" lvl="0"><number>&lsqb;0096&rsqb;</number> In such a case, it is possible to carry out the following control. Namely, a packet with the high packet marking priority level will be marked as the high priority one if the amount of communication resources available to a packet that is to be set as the high priority one is less than or equal to the maximum amount of communication resources available when packets with the high packet marking priority level alone are taken into account. In that case, the amount of communication resources available to a packet that is to be set as the high priority one will exceed the maximum amount of communication resources available when packets with the high and low packet marking priority levels are both taken into account, and while this is case a packet with the low packet marking priority level will not be marked as the high priority one. </paragraph>
<paragraph id="P-0097" lvl="0"><number>&lsqb;0097&rsqb;</number> In this way, packets with the high packet marking priority level can use a constant amount of communication resources at a time of marking regardless of the presence or absence of packets with the low packet marking priority level. </paragraph>
<paragraph id="P-0098" lvl="0"><number>&lsqb;0098&rsqb;</number> A term &ldquo;reference rate for the packet marking priority level i&rdquo; indicates an amount of communication resources currently used by packets with the packet marking priority level i at a time of carrying out the marking of a specified priority bit region. It is managed such that &lsqb;reference rate for the packet marking priority level i&rsqb;&gE;&lsqb;reference rate for the packet marking priority level i&plus;1&rsqb;. </paragraph>
<paragraph id="P-0099" lvl="0"><number>&lsqb;0099&rsqb;</number> Examples of the reference rate for the packet marking priority level i include an input rate of packets with the packet marking priority level higher than or equal to i, and a rate by which packets with the packet marking priority level higher than or equal to i are outputted with a value indicating the high priority in the priority bit region of the specified level (in the case where the priority bit region of the specified level has one bit). </paragraph>
<paragraph id="P-0100" lvl="0"><number>&lsqb;0100&rsqb;</number> A term &ldquo;target rate for the packet marking priority level i&rdquo; indicates a maximum amount of communication resources (allocated amount of communication resources) available to a packet with the packet marking priority level i at a time of carrying out the marking of a specified priority bit region. </paragraph>
<paragraph id="P-0101" lvl="0"><number>&lsqb;0101&rsqb;</number> The target rate for the packet marking priority level i can be changed dynamically according to an amount of traffic, or can be set to a fixed value during each month or year, or else can be set or changed in any other suitable way. </paragraph>
<paragraph id="P-0102" lvl="0"><number>&lsqb;0102&rsqb;</number> Examples of the marking that is carried out with respect to the priority bit region of the specified level using the reference rate for the packet marking priority level i and the target rate for the packet marking priority level i are as follows. </paragraph>
<paragraph id="P-0103" lvl="0"><number>&lsqb;0103&rsqb;</number> One example is a scheme in which the marking value is set to a standard value when the reference rate for the packet marking priority level i and the target rate for the packet marking priority level i are equal, the marking value is set to a higher priority value as the reference rate for the packet marking priority level i becomes smaller compared with the target rate for the packet marking priority level i, and the marking value is set to a lower priority value as the reference rate for the packet marking priority level i becomes larger compared with the target rate for the packet marking priority level i. </paragraph>
<paragraph id="P-0104" lvl="0"><number>&lsqb;0104&rsqb;</number> Another example is a scheme in which the marking value is set to a higher priority value when the reference rate for the packet marking priority level i is less than or equal to the target rate for the packet marking priority level i, and the marking value is set to a lower priority value when the reference rate for the packet marking priority level i is greater than the target rate for the packet marking priority level i (in the case where the priority bit region of the specified level has one bit). </paragraph>
<paragraph id="P-0105" lvl="0"><number>&lsqb;0105&rsqb;</number> Note that, by the management such that &lsqb;reference rate for the packet marking priority level i&rsqb;&gE;&lsqb;reference rate for the packet marking priority level i&plus;1&rsqb;, it becomes possible to realize the packet marking priority control in which packets with the high packet marking priority level are hardly affected by packets with the low packet marking priority level. </paragraph>
<paragraph id="P-0106" lvl="0"><number>&lsqb;0106&rsqb;</number> Referring now to <cross-reference target="DRAWINGS">FIG. 2</cross-reference> to <cross-reference target="DRAWINGS">FIG. 17</cross-reference>, one embodiment of a node device and a packet transfer method according to the present invention will be described in detail. </paragraph>
<paragraph id="P-0107" lvl="0"><number>&lsqb;0107&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 2</cross-reference> shows an exemplary bit assignment for the priority bit region in this embodiment, which is directed to the case where the entire priority bit region has two bits while two hierarchical levels of an edge level (level 1) and a domain level (level 2) are defined and one bit of the priority bit region is assigned to each level. </paragraph>
<paragraph id="P-0108" lvl="0"><number>&lsqb;0108&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 2</cross-reference>, the bit <highlight><bold>1</bold></highlight> is the edge level priority bit and the bit <highlight><bold>2</bold></highlight> is the domain level priority bit. In this embodiment, each bit has a value &ldquo;In&rdquo; indicating the high priority or a value &ldquo;Out&rdquo; indicating the low priority. By combinations of values of the domain level priority bit and the edge level priority bit, four priority classes of &ldquo;0&rdquo;, &ldquo;1&rdquo;, &ldquo;2&rdquo; and &ldquo;3&rdquo; can be defined. </paragraph>
<paragraph id="P-0109" lvl="0"><number>&lsqb;0109&rsqb;</number> As for the numerical representations of &ldquo;In&rdquo; and &ldquo;Out&rdquo; values, the case of using &ldquo;In&rdquo;&equals;&ldquo;1&rdquo; and &ldquo;Out&rdquo;&equals;&ldquo;0&rdquo; and the case of using &ldquo;In&rdquo;&equals;&ldquo;0&rdquo; and &ldquo;Out&rdquo;&equals;&ldquo;1&rdquo; are available depending on types of packets, and the present invention is equally applicable to either case. Also, the number of levels can be more than two. In the case of using three levels, for example, it is possible to provide a neighboring router level priority bit for the purpose of carrying out the priority control among a plurality of neighboring routers that are connected to the same broadcast subnet, in addition to the two levels described above. </paragraph>
<paragraph id="P-0110" lvl="0"><number>&lsqb;0110&rsqb;</number> Packets belongs to one of the four priority classes given by combinations of values of the bit <highlight><bold>1</bold></highlight> and the bit <highlight><bold>2</bold></highlight>. The mapping between the priority classes and the packet transfer priority levels can be given by any of: (1) Priority level i&equals;Priority class i; (2) Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight>, Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>1</bold></highlight> or <highlight><bold>2</bold></highlight>, and Priority level <highlight><bold>2</bold></highlight>&equals;Priority class <highlight><bold>3</bold></highlight>; (3) Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight> or <highlight><bold>1</bold></highlight> and Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>2</bold></highlight> or <highlight><bold>3</bold></highlight> (the case of identifying the priority level by the domain level priority bit); (4) Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight> or <highlight><bold>2</bold></highlight> and Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>1</bold></highlight> or <highlight><bold>3</bold></highlight> (the case of identifying the priority level by the edge level priority bit); (5) Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight> or <highlight><bold>1</bold></highlight>, Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>2</bold></highlight>, and Priority level <highlight><bold>2</bold></highlight>&equals;Priority class <highlight><bold>1</bold></highlight> or <highlight><bold>2</bold></highlight> (the case of subdividing the priority level <highlight><bold>1</bold></highlight> of (3)); and (6) Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight> or <highlight><bold>2</bold></highlight>, Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>1</bold></highlight>, and Priority level <highlight><bold>2</bold></highlight>&equals;Priority class <highlight><bold>3</bold></highlight> (the case of subdividing the priority level <highlight><bold>1</bold></highlight> of (4)), for example. </paragraph>
<paragraph id="P-0111" lvl="0"><number>&lsqb;0111&rsqb;</number> Note that it is also possible for the transmitting side user to freely set values of the bit <highlight><bold>1</bold></highlight> and the bit <highlight><bold>2</bold></highlight>. </paragraph>
<paragraph id="P-0112" lvl="0"><number>&lsqb;0112&rsqb;</number> Next, <cross-reference target="DRAWINGS">FIG. 3</cross-reference> shows an exemplary configuration of a priority information attaching router in this embodiment. This router of <cross-reference target="DRAWINGS">FIG. 3</cross-reference> comprises a plurality of input/output interface units <highlight><bold>31</bold></highlight> having respective marking units <highlight><bold>32</bold></highlight> for carrying out the marking of the priority bit region in packets, and a switch unit <highlight><bold>33</bold></highlight> for carrying out packet exchange processing between different input/output interface units <highlight><bold>31</bold></highlight>. </paragraph>
<paragraph id="P-0113" lvl="0"><number>&lsqb;0113&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 3</cross-reference>, the marking unit <highlight><bold>32</bold></highlight> is provided within the input/output interface unit <highlight><bold>31</bold></highlight>, but it is also possible to provide the marking unit <highlight><bold>32</bold></highlight> within the switch unit <highlight><bold>33</bold></highlight>. Also, the marking unit <highlight><bold>32</bold></highlight> carries out the marking with respect to input packets coming in from the external or output packets going out to the external. </paragraph>
<paragraph id="P-0114" lvl="0"><number>&lsqb;0114&rsqb;</number> Also, the input/output interface unit <highlight><bold>31</bold></highlight> or the switch unit <highlight><bold>33</bold></highlight> may be provided with a buffer for storing packets, or with a priority control unit for carrying out the priority control based on the value of the priority bit region in packets. </paragraph>
<paragraph id="P-0115" lvl="0"><number>&lsqb;0115&rsqb;</number> Note that a router which only carries out the packet transfer priority control and does not carry out the marking will have a configuration in which the marking unit <highlight><bold>32</bold></highlight> is omitted and a priority control unit is provided within the input/output interface unit <highlight><bold>31</bold></highlight> or the switch unit <highlight><bold>33</bold></highlight> in the configuration of <cross-reference target="DRAWINGS">FIG. 3</cross-reference>. </paragraph>
<paragraph id="P-0116" lvl="0"><number>&lsqb;0116&rsqb;</number> Next, exemplary manners of marking at the marking unit <highlight><bold>32</bold></highlight> in the case of a transmitting side edge router will be described with references to <cross-reference target="DRAWINGS">FIG. 4</cross-reference> and <cross-reference target="DRAWINGS">FIG. 5</cross-reference>. The transmitting side edge router is E<highlight><bold>1</bold></highlight> and E<highlight><bold>2</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, for example, and the marking unit <highlight><bold>32</bold></highlight> here refers to the marking unit provided in the input/output interface unit with respect to each user of E<highlight><bold>1</bold></highlight> and E<highlight><bold>2</bold></highlight>. </paragraph>
<paragraph id="P-0117" lvl="0"><number>&lsqb;0117&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 4</cross-reference> and <cross-reference target="DRAWINGS">FIG. 5</cross-reference>, &ldquo;Priority bit&rdquo; indicates values of the priority bit region for each level before the marking (at a time of packet input to the marking unit <highlight><bold>32</bold></highlight>) and after the marking (at a time of packet output from the marking unit <highlight><bold>32</bold></highlight>). An entry with the priority bit after the marking indicated as &ldquo;In/Out&rdquo; denotes that it is marked as either &ldquo;In&rdquo; or &ldquo;Out&rdquo; depending on the marking algorithm. </paragraph>
<paragraph id="P-0118" lvl="0"><number>&lsqb;0118&rsqb;</number> &ldquo;Packet marking priority level (i)&rdquo; indicates the priority level at a time of marking which is defined by values of the priority bit region before the marking, and which can be defined independently from the packet transfer priority level. The higher packet marking priority level implies the likelihood of packets being marked as &ldquo;In&rdquo; at higher priority. </paragraph>
<paragraph id="P-0119" lvl="0"><number>&lsqb;0119&rsqb;</number> &ldquo;Reference rate (m&lsqb;i&rsqb;)&rdquo; indicates an output rate of packets that are marked as &ldquo;In&rdquo; with respect to packets belonging to each packet marking priority level, and this value will be utilized at a time of marking packets as &ldquo;In&rdquo; or &ldquo;Out&rdquo;. Note that the reference rate is set such that m&lsqb;i&rsqb;&gE;m&lsqb;i&prime;&rsqb; with respect to any two packet marking priority levels i and i&prime; where i&lt;i&prime;. </paragraph>
<paragraph id="P-0120" lvl="0"><number>&lsqb;0120&rsqb;</number> &ldquo;Target rate (r&lsqb;i&rsqb;)&rdquo; indicates the target rate for each packet marking priority level (a threshold for the reference rate at a time of marking), where packets will be marked as &ldquo;Out&rdquo; when the packet marking reference rate exceeds the packet marking target rate. </paragraph>
<paragraph id="P-0121" lvl="0"><number>&lsqb;0121&rsqb;</number> Both <cross-reference target="DRAWINGS">FIG. 4</cross-reference> and <cross-reference target="DRAWINGS">FIG. 5</cross-reference> show examples in which the transmitting side edge router sets the priority bit <highlight><bold>2</bold></highlight> as &ldquo;Out&rdquo;. </paragraph>
<paragraph id="P-0122" lvl="0"><number>&lsqb;0122&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 4</cross-reference>, the edge router rewrites the priority bit <highlight><bold>1</bold></highlight> of a packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; into &ldquo;In&rdquo; or &ldquo;out&rdquo; using a rate of output packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; from the user as the reference rate and ELR as the target rate. The priority bit <highlight><bold>1</bold></highlight> of a packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; will remain as &ldquo;Out&rdquo;. </paragraph>
<paragraph id="P-0123" lvl="0"><number>&lsqb;0123&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 5</cross-reference>, the edge router rewrites the priority bit <highlight><bold>1</bold></highlight> into &ldquo;In&rdquo; even for a packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; from the user when the output rate of packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is smaller than ELR. In this example, the packet marking priority level is determined by the value of the priority bit <highlight><bold>1</bold></highlight> of the input packet (the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is the higher packet marking priority level), and a rate of output packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;0 while a rate of output packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;1. The target rate is ELR for both the packet marking priority level&equals;0 and 1. </paragraph>
<paragraph id="P-0124" lvl="0"><number>&lsqb;0124&rsqb;</number> Next, exemplary manners of marking at the marking unit <highlight><bold>32</bold></highlight> in the case of a domain border router will be described with references to <cross-reference target="DRAWINGS">FIG. 6</cross-reference> and <cross-reference target="DRAWINGS">FIG. 12</cross-reference>. The domain border router is B<highlight><bold>2</bold></highlight>, B<highlight><bold>5</bold></highlight> and B<highlight><bold>6</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, for example, and the marking unit <highlight><bold>32</bold></highlight> here refers to the marking unit provided in the input/output interface unit of B<highlight><bold>2</bold></highlight>, B<highlight><bold>5</bold></highlight> and B<highlight><bold>6</bold></highlight> with respect to B<highlight><bold>1</bold></highlight>, B<highlight><bold>3</bold></highlight> and B<highlight><bold>4</bold></highlight>, respectively. Note that B<highlight><bold>1</bold></highlight>, B<highlight><bold>3</bold></highlight> and B<highlight><bold>4</bold></highlight> shown in <cross-reference target="DRAWINGS">FIG. 1</cross-reference> may function as this domain border router. </paragraph>
<paragraph id="P-0125" lvl="0"><number>&lsqb;0125&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 6</cross-reference> shows an exemplary case in which the priority bit <highlight><bold>2</bold></highlight> of an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is rewritten into &ldquo;In&rdquo; or &ldquo;Out&rdquo;, and the priority bit <highlight><bold>2</bold></highlight> of an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; is set as &ldquo;Out&rdquo;. In this example, the packet marking priority level is determined by the value of the priority bit <highlight><bold>1</bold></highlight> of the input packet (the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is the higher packet marking priority level), and a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for each packet marking priority level. The target rate for the packet marking priority level&equals;0 is 0, that is, the priority bit <highlight><bold>2</bold></highlight> is set as &ldquo;Out&rdquo; always. The target rate for the packet marking priority level&equals;1 is DLR. </paragraph>
<paragraph id="P-0126" lvl="0"><number>&lsqb;0126&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 7</cross-reference> shows an exemplary case In which the priority bit <highlight><bold>2</bold></highlight> of an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is rewritten into &ldquo;In&rdquo; or &ldquo;Out&rdquo;, and the priority bit <highlight><bold>2</bold></highlight> of an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; is set as &ldquo;In&rdquo;. In this example, the packet marking priority level is determined by the value of the priority bit <highlight><bold>1</bold></highlight> of the input packet (the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is the higher packet marking priority level), and a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for each packet marking priority level. The target rate for the packet marking priority level&equals;&infin; (infinity), that is, the priority bit <highlight><bold>2</bold></highlight> is set as &ldquo;In&rdquo; always. The target rate for the packet marking priority level&equals;1 is DLR. </paragraph>
<paragraph id="P-0127" lvl="0"><number>&lsqb;0127&rsqb;</number> Note that in <cross-reference target="DRAWINGS">FIG. 6</cross-reference> and <cross-reference target="DRAWINGS">FIG. 7</cross-reference>, the packet transfer priority level is determined as follows, for example. </paragraph>
<paragraph id="P-0128" lvl="0"><number>&lsqb;0128&rsqb;</number> A packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; has a higher packet transfer priority level than a packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; regardless of the value of the priority bit <highlight><bold>2</bold></highlight>. Also, among packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo;, a packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; has a higher packet transfer priority level than a packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;Out&rdquo;. All packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; have the same packet transfer priority level regardless of the value of the priority bit <highlight><bold>2</bold></highlight>. In other words, they correspond to the cases of setting Priority level <highlight><bold>0</bold></highlight>&equals;Priority class <highlight><bold>0</bold></highlight> (the case of <cross-reference target="DRAWINGS">FIG. 6</cross-reference>) or <highlight><bold>2</bold></highlight> (the case of <cross-reference target="DRAWINGS">FIG. 7</cross-reference>), Priority level <highlight><bold>1</bold></highlight>&equals;Priority class <highlight><bold>1</bold></highlight>, and Priority level <highlight><bold>2</bold></highlight>&equals;Priority class <highlight><bold>3</bold></highlight> in <cross-reference target="DRAWINGS">FIG. 2</cross-reference>. </paragraph>
<paragraph id="P-0129" lvl="0"><number>&lsqb;0129&rsqb;</number> Here, the cases of <cross-reference target="DRAWINGS">FIG. 6</cross-reference> and <cross-reference target="DRAWINGS">FIG. 7</cross-reference> differ from each other in that the priority bit <highlight><bold>2</bold></highlight> of a packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; is to be always set as &ldquo;Out&rdquo; (the case of <cross-reference target="DRAWINGS">FIG. 6</cross-reference>) or &ldquo;In&rdquo; (the case of <cross-reference target="DRAWINGS">FIG. 7</cross-reference>), but they share the common feature of attaching the priority bit <highlight><bold>2</bold></highlight> (while leaving the priority bit <highlight><bold>1</bold></highlight> unchanged) such that the packet transfer priority level within the domain becomes low for an input packet that is indicated as the low priority one, and attaching the priority bit <highlight><bold>2</bold></highlight> (while leaving the priority bit <highlight><bold>1</bold></highlight> unchanged) such that the packet transfer priority level becomes medium or high depending on the traffic condition for an input packet that is indicated as the high priority one. </paragraph>
<paragraph id="P-0130" lvl="0"><number>&lsqb;0130&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 8</cross-reference> shows an exemplary case in which an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is marked at higher priority over an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo;, at a time of carrying out the marking of the priority bit <highlight><bold>2</bold></highlight>. In this example, the packet marking priority level is determined by the value of the priority bit <highlight><bold>1</bold></highlight> of the input packet (the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is the higher packet marking priority level), and a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;0 while a rate of output packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;1. The target rate is DLR for both the packet marking priority level&equals;0 and 1. </paragraph>
<paragraph id="P-0131" lvl="0"><number>&lsqb;0131&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 9</cross-reference> shows an exemplary case in which an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is always marked as the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo;, and an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;Out&rdquo; is marked as the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; when the output rate of packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is smaller than DLR, at a time of carrying out the marking of the priority bit <highlight><bold>2</bold></highlight>. In this example, the packet marking priority level is determined by the value of the priority bit <highlight><bold>1</bold></highlight> of the input packet (the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is the higher packet marking priority level), and a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for each packet marking priority level. The target rate for the packet marking priority level&equals;0 is DLR, while the target rate for the packet marking priority level&equals;1 is &infin; (infinity), that is, the priority bit <highlight><bold>2</bold></highlight> is set as &ldquo;In&rdquo; always. </paragraph>
<paragraph id="P-0132" lvl="0"><number>&lsqb;0132&rsqb;</number> Note however that in this case it is preferable to limit the total amount of input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; to be less than or equal to DLR, by limiting subscriptions with the users for example, so that the sum of ELRs within the domain becomes less than or equal to DLR. </paragraph>
<paragraph id="P-0133" lvl="0"><number>&lsqb;0133&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 10</cross-reference> shows an exemplary case of carrying out the marking using not only the value of the priority bit <highlight><bold>1</bold></highlight> but also the value of the priority bit <highlight><bold>2</bold></highlight> of the input packet, at a time of carrying out the marking of the priority bit <highlight><bold>2</bold></highlight>. The packet marking priority level is set such that an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; becomes a higher priority one, and an input packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; becomes a higher priority one among those input packets which have the same value for the priority bit <highlight><bold>1</bold></highlight>. </paragraph>
<paragraph id="P-0134" lvl="0"><number>&lsqb;0134&rsqb;</number> In this case, a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;0 while a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; or the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;1. Also, a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;2 while a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>1</bold></highlight>&equals;the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;3. The target rate is DLR for each packet marking priority level. </paragraph>
<paragraph id="P-0135" lvl="0"><number>&lsqb;0135&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 11</cross-reference> shows another exemplary case of carrying out the marking using not only the value of the priority bit <highlight><bold>1</bold></highlight> but also the value of the priority bit <highlight><bold>2</bold></highlight> of the input packet, at a time of carrying out the marking of the priority bit <highlight><bold>2</bold></highlight>, similarly as in the case of <cross-reference target="DRAWINGS">FIG. 10</cross-reference>. This case of <cross-reference target="DRAWINGS">FIG. 11</cross-reference> however differs from the case of <cross-reference target="DRAWINGS">FIG. 10</cross-reference> in that the packet marking priority level is set such that an input packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; becomes a higher priority one, and an input packet with the priority bit <highlight><bold>1</bold></highlight>&equals;&ldquo;In&rdquo; becomes a higher priority one among those input packets which have the same value for the priority bit <highlight><bold>2</bold></highlight>. </paragraph>
<paragraph id="P-0136" lvl="0"><number>&lsqb;0136&rsqb;</number> In this case, the reference rates for the packet marking priority level&equals;0, 1 and 3 are the same as in the case of <cross-reference target="DRAWINGS">FIG. 10</cross-reference>, while a rate of output packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; with respect to input packets with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is used as the reference rate for the packet marking priority level&equals;2. The target rate is DLR for each packet marking priority level. </paragraph>
<paragraph id="P-0137" lvl="0"><number>&lsqb;0137&rsqb;</number> Note that <cross-reference target="DRAWINGS">FIG. 10</cross-reference> and <cross-reference target="DRAWINGS">FIG. 11</cross-reference> show exemplary cases where the packet marking priority level of an input packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is set higher than that of an input packet with the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;Out&rdquo;, but this relationship may be reversed depending on the operation policy of the network. </paragraph>
<paragraph id="P-0138" lvl="0"><number>&lsqb;0138&rsqb;</number> <cross-reference target="DRAWINGS">FIG. 12</cross-reference> shows an exemplary case of giving higher priority to inter-domain traffic over intra-domain traffic. Here, the priority bit <highlight><bold>2</bold></highlight>&equals;&ldquo;In&rdquo; is set for an input packet received from the other domain unconditionally (or if the destination of that input packet is within the own domain). In this way, it becomes possible for the output side domain to treat traffic that is flowing in from the other domain at higher priority over traffic that is closed within the domain. This scheme is effective in the application such as TCP which carry out such a flow control that a throughput of a session for which the transmission delay is large in the usual network becomes smaller than a throughput of a session for which the transmission delay is small in the usual network. </paragraph>
<paragraph id="P-0139" lvl="0"><number>&lsqb;0139&rsqb;</number> In the examples described up to now, the priority bit <highlight><bold>1</bold></highlight> is set as &ldquo;In&rdquo; or &ldquo;Out&rdquo; by the user and the edge router and the priority bit <highlight><bold>2</bold></highlight> is set as &ldquo;In&rdquo; or &ldquo;Out&rdquo; by the domain border router, but it is also possible to use a provision in which the priority bit <highlight><bold>1</bold></highlight> is set as &ldquo;In&rdquo; or &ldquo;Out&rdquo; by the user and the priority bit <highlight><bold>2</bold></highlight> is set as &ldquo;In&rdquo; or &ldquo;Out&rdquo; by the edge router or the domain border router. It is also possible to use a provision for providing the priority bit region with three bits in correspondence to the user level, the edge level and the domain level. </paragraph>
<paragraph id="P-0140" lvl="0"><number>&lsqb;0140&rsqb;</number> Next, the marking algorithm to be executed by the marking unit <highlight><bold>32</bold></highlight> in this embodiment will be described with reference to <cross-reference target="DRAWINGS">FIG. 13</cross-reference>. In <cross-reference target="DRAWINGS">FIG. 13</cross-reference>, &ldquo;j&rdquo; denotes a position of the priority bit corresponding to the priority level, &ldquo;m&lsqb;i&rsqb;&rdquo; denotes the packet marking reference rate for the packet marking priority level i (with the initial value&equals;0), and &ldquo;r&lsqb;i&rsqb;&rdquo; denotes the packet marking target rate for the packet marking priority level i. Also, &ldquo;t&lsqb;i&rsqb;&rdquo; denotes a final time at which the output of packets with the packet marking priority level higher or equal to i after marking the priority bit j&equals;&ldquo;In&rdquo; is completed (with the initial value&equals;0), &ldquo;C&rdquo; denotes a link capacity, and &ldquo;w&lsqb;i&rsqb;&rdquo; is a smoothing parameter for &ldquo;m&lsqb;i&rsqb;&rdquo;. </paragraph>
<paragraph id="P-0141" lvl="0"><number>&lsqb;0141&rsqb;</number> The marking unit <highlight><bold>32</bold></highlight> has either a state of carrying out the edge level marking or a state of carrying out the domain level marking. In the case of carrying out the edge level marking (where the own node functions as the edge router) upon having a packet entered into the marking unit <highlight><bold>32</bold></highlight> (step S<highlight><bold>1</bold></highlight> YES), the priority bit <highlight><bold>2</bold></highlight> is marked as &ldquo;Out&rdquo; (step S<highlight><bold>2</bold></highlight>) and j is set to 1 (step S<highlight><bold>3</bold></highlight>). When this is done, the inter-domain traffic with the priority bit <highlight><bold>2</bold></highlight> set as &ldquo;In&rdquo; according to <cross-reference target="DRAWINGS">FIG. 12</cross-reference> will be transferred at higher priority within the domain over packets with the priority bit <highlight><bold>2</bold></highlight> marked as &ldquo;Out&rdquo; which are still the intra-domain traffic at this point, for example. Note that the priority bit <highlight><bold>2</bold></highlight> may be marked as &ldquo;In&rdquo; at a time of carrying out the edge level marking, contrary to what is described above, depending on the operation policy of the domain. </paragraph>
<paragraph id="P-0142" lvl="0"><number>&lsqb;0142&rsqb;</number> On the other hand, in the case of carrying out the domain level marking (where the own node functions as the domain border router) (step S<highlight><bold>4</bold></highlight> YES), j is set to 2 (step S<highlight><bold>5</bold></highlight>). Then, the packet marking priority level is determined from the value of the priority bit region of the input packet and set equal to &ldquo;i&rdquo;, while the current time at a time of the packet input is set equal to &ldquo;now&rdquo; (step S<highlight><bold>6</bold></highlight>). </paragraph>
<paragraph id="P-0143" lvl="0"><number>&lsqb;0143&rsqb;</number> Next, the reference rate m after the marking is calculated by assuming that the priority bit j of the input packet is marked as &ldquo;In&rdquo; with respect to the packet marking priority level i (step S<highlight><bold>7</bold></highlight>). Then, if m&lE;the target rate r&lsqb;i&rsqb; (step S<highlight><bold>8</bold></highlight> YES), the priority bit j is marked as &ldquo;In&rdquo; (step S<highlight><bold>9</bold></highlight>), whereas otherwise (step S<highlight><bold>8</bold></highlight> NO) the priority bit j is marked as &ldquo;Out&rdquo; (step S<highlight><bold>15</bold></highlight>). </paragraph>
<paragraph id="P-0144" lvl="0"><number>&lsqb;0144&rsqb;</number> When the priority bit j is marked as &ldquo;In&rdquo;, the update of the reference rate m&lsqb;k&rsqb; and the update of the final marking time t&lsqb;k&rsqb; are carried out for the packet marking priority level k (i&gE;k&gE;0) (steps S<highlight><bold>10</bold></highlight> to S<highlight><bold>14</bold></highlight>). The reference rate m&lsqb;k&rsqb; is updated according to an exponential moving average of the smoothing parameter w&lsqb;k&rsqb;. Here however m&lsqb;k&rsqb; is to be updated only at a time of packet output so that (1&minus;w&lsqb;k&rsqb;) must be exponentiated by the elapsed time (now&minus;t&lsqb;k&rsqb;) since the previous packet output time. By updating the reference rate m&lsqb;k&rsqb; with respect to each packet marking priority level k which is less than or equal to i in this manner, it becomes possible to mark a packet with the high packet marking priority level as &ldquo;In&rdquo; at higher priority over a packet with the low packet marking priority level. </paragraph>
<paragraph id="P-0145" lvl="0"><number>&lsqb;0145&rsqb;</number> Next, an exemplary configuration of the marking unit <highlight><bold>32</bold></highlight> for realizing the marking algorithm of <cross-reference target="DRAWINGS">FIG. 13</cross-reference> will be described with reference to <cross-reference target="DRAWINGS">FIG. 14</cross-reference>. </paragraph>
<paragraph id="P-0146" lvl="0"><number>&lsqb;0146&rsqb;</number> The marking unit <highlight><bold>32</bold></highlight> of <cross-reference target="DRAWINGS">FIG. 14</cross-reference> comprises a priority field reading unit <highlight><bold>141</bold></highlight>, a priority field writing unit <highlight><bold>142</bold></highlight>, a rate for priority class calculation unit <highlight><bold>143</bold></highlight>, an output priority field value determining unit <highlight><bold>144</bold></highlight>, and a marking level holding unit <highlight><bold>145</bold></highlight>. </paragraph>
<paragraph id="P-0147" lvl="0"><number>&lsqb;0147&rsqb;</number> An input packet of the marking unit <highlight><bold>32</bold></highlight> is entered into the priority field reading unit <highlight><bold>141</bold></highlight>. </paragraph>
<paragraph id="P-0148" lvl="0"><number>&lsqb;0148&rsqb;</number> The priority field reading unit <highlight><bold>141</bold></highlight> copies the priority level recorded in the priority field in the packet header and outputs it to the output priority field value determining unit <highlight><bold>144</bold></highlight> and the rate for priority class calculation unit <highlight><bold>143</bold></highlight>, while giving the input packet to the priority field writing unit <highlight><bold>142</bold></highlight>. </paragraph>
<paragraph id="P-0149" lvl="0"><number>&lsqb;0149&rsqb;</number> The marking level holding unit <highlight><bold>145</bold></highlight> holds a marking level information indicating a level of the marking to be carried out at this node. Here, the marking level information specifies any one of &ldquo;edge level&rdquo; indicating that the edge level marking is to be carried out, &ldquo;domain level&rdquo; indicating that the domain level marking is to be carried out, and &ldquo;no level&rdquo; indicating that no marking is to be carried out. </paragraph>
<paragraph id="P-0150" lvl="0"><number>&lsqb;0150&rsqb;</number> The rate for priority class calculation unit <highlight><bold>143</bold></highlight> carries out the updating of the packet arrival rate with respect to each priority class for which the rate updating is necessary, from the priority information given from the priority field reading unit <highlight><bold>141</bold></highlight> and the marking level information given from the marking level holding unit <highlight><bold>145</bold></highlight>. </paragraph>
<paragraph id="P-0151" lvl="0"><number>&lsqb;0151&rsqb;</number> The output priority field value determining unit <highlight><bold>144</bold></highlight> determines the output priority field value, from the priority information given from the priority field reading unit <highlight><bold>141</bold></highlight>, the packet arrival rate for each priority class calculated by the rate for priority class calculation unit <highlight><bold>143</bold></highlight>, and the marking level information held by the marking level holding unit <highlight><bold>145</bold></highlight>. </paragraph>
<paragraph id="P-0152" lvl="0"><number>&lsqb;0152&rsqb;</number> The priority field writing unit <highlight><bold>142</bold></highlight> writes the priority field value determined by the output priority field value determining unit <highlight><bold>144</bold></highlight> into a header section of the packet given from the priority field reading unit <highlight><bold>141</bold></highlight>, and outputs this packet from the marking unit <highlight><bold>32</bold></highlight>. </paragraph>
<paragraph id="P-0153" lvl="0"><number>&lsqb;0153&rsqb;</number> Examples described up to now are directed to the case where ELR is a subscription rate between the user and the domain to which the user is connected while DLR is a subscription rate between two neighboring domains. Now, the case of using ELR specific to each destination and DLR specific to each neighboring domain border router will be described with reference to <cross-reference target="DRAWINGS">FIG. 15</cross-reference>. </paragraph>
<paragraph id="P-0154" lvl="0"><number>&lsqb;0154&rsqb;</number> In the example of <cross-reference target="DRAWINGS">FIG. 15</cross-reference>, the user U<highlight><bold>1</bold></highlight> in the domain A specifies ELR&equals;2 Mbps with respect to packets destined to the user U<highlight><bold>2</bold></highlight> in the same domain A. In addition, the user U<highlight><bold>2</bold></highlight> also specifies ELR&equals;2 Mbps with respect to packets destined to the user U<highlight><bold>1</bold></highlight>. This is effective when the users U<highlight><bold>1</bold></highlight> and U<highlight><bold>2</bold></highlight> belong to the same intra-company network and wish to provide the high QoS only with respect to traffic between the users U<highlight><bold>1</bold></highlight> and U<highlight><bold>2</bold></highlight>. Note that ELR&equals;0 Mbps will be set with respect to packets with destinations other than the specified destinations. Also, one user may specify a plurality of ELRs individually with respect to a plurality of destinations. </paragraph>
<paragraph id="P-0155" lvl="0"><number>&lsqb;0155&rsqb;</number> Also, the domain B carries out the marking using DLR of 5 Mbps overall with respect to incoming traffic from the domain A similarly as in <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, but in the example of <cross-reference target="DRAWINGS">FIG. 15</cross-reference>, among these 5 Mbps of DLR, the marking based on DLR of 2 Mbps is carried out with respect to traffic for which the next hop domain border router is B<highlight><bold>3</bold></highlight> while the marking based on DLR of 3 Mbps is carried out with respect to traffic for which the next hop domain border router is B<highlight><bold>4</bold></highlight>. Note that the next hop domain border router through which a packet passes can be searched out from the destination of the packet by accessing data structure managed by the interdomain routing protocol, for example. </paragraph>
<paragraph id="P-0156" lvl="0"><number>&lsqb;0156&rsqb;</number> In the case of <cross-reference target="DRAWINGS">FIG. 1</cross-reference>, when 5 Mbps of packets destined to the domain C from the domain A flow into the domain B, these packets will be treated as the high priority packets at the domain level within the domain B, but DLR between the domains B and C is 2 Mbps so that the marking for treating only 2 Mbps out of 5 Mbps as the high priority packets at the domain level within the domain C will be carried out at the domain border router B<highlight><bold>5</bold></highlight> or B<highlight><bold>3</bold></highlight>. </paragraph>
<paragraph id="P-0157" lvl="0"><number>&lsqb;0157&rsqb;</number> On the other hand, in <cross-reference target="DRAWINGS">FIG. 15</cross-reference>, the domain border router B<highlight><bold>2</bold></highlight> marks only 2 Mbps of traffic as the high priority ones with respect to packets for which the next hop domain border router is B<highlight><bold>3</bold></highlight>, because only 2 Mbps can be expected to be treated as the high priority packets at the domain level within the domain C. Consequently, the remaining bandwidth becomes available for use by the low priority packets at the domain level within the domain B. </paragraph>
<paragraph id="P-0158" lvl="0"><number>&lsqb;0158&rsqb;</number> As such, by specifying DLR (allocating communication resources) in finer units, it becomes possible to share the bandwidth more effectively among the high priority packets and the low priority packets. </paragraph>
<paragraph id="P-0159" lvl="0"><number>&lsqb;0159&rsqb;</number> Note that, in the case of specifying ELR or DLR by specifying correspondent while routers within the domain have ATM switching functions, it is possible to set up label switching paths (cut-through paths) of ATM or shortcut paths based on NHRP (Next Hop address Resolution Protocol) by specifying the bandwidth corresponding to ELR or DLR at a peak rate or an average rate as the traffic parameter at a time of ATM signaling among the edge routers or the domain border routers. </paragraph>
<paragraph id="P-0160" lvl="0"><number>&lsqb;0160&rsqb;</number> Also, each router can map one bit in the priority bit region to a CLP (Cell Loss Priority) bit of the ATM cell. In this case, it is also possible to use a UPC (Usage Parameter Control) unit in a UNI (User Network Interface) of ATM as the marking unit with respect to the priority bit that is mapped to the CLP bit. </paragraph>
<paragraph id="P-0161" lvl="0"><number>&lsqb;0161&rsqb;</number> Finally, <cross-reference target="DRAWINGS">FIG. 16</cross-reference> and <cross-reference target="DRAWINGS">FIG. 17</cross-reference> show exemplary cases of applying the priority bit region of this embodiment to packets of IP version 4 (IPv4) and IP version 6 (IPv6), respectively. </paragraph>
<paragraph id="P-0162" lvl="0"><number>&lsqb;0162&rsqb;</number> In <cross-reference target="DRAWINGS">FIG. 16</cross-reference> and <cross-reference target="DRAWINGS">FIG. 17</cross-reference>, the number inside brackets indicates the bit length of each field. In the IPv4 packet, at least two bits from three bits of Precedence field and Five bits of TOS field (portions enclosed by bold lines in <cross-reference target="DRAWINGS">FIG. 16</cross-reference>) can be used as the priority bit region. In the IPv6 packet, at least two bits from eight bits of Traffic Class field (a portion enclosed by bold lines in <cross-reference target="DRAWINGS">FIG. 17</cross-reference>) can be used as the priority bit region. </paragraph>
<paragraph id="P-0163" lvl="0"><number>&lsqb;0163&rsqb;</number> As described, according to the present invention, it becomes possible to attach the priority information hierarchically according to respective ranges of the network in which packets are to be transferred, so that it becomes possible to realize a flexible priority control in the packet transfer. </paragraph>
<paragraph id="P-0164" lvl="0"><number>&lsqb;0164&rsqb;</number> It is to be noted that, besides those already mentioned above, many modifications and variations of the above embodiments may be made without departing from the novel and advantageous features of the present invention. Accordingly, all such modifications and variations are intended to be included within the scope of the appended claims. </paragraph>
</section>
</detailed-description>
</subdoc-description>
<subdoc-claims>
<heading lvl="1">What is claimed is: </heading>
<claim id="CLM-00001">
<claim-text><highlight><bold>1</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each having a plurality of regions into which priority information can be written; and </claim-text>
<claim-text>a transmission unit for transmitting each packet received by the reception unit to a next hop node by writing the priority information according to criteria of said node device into one region into which said node device is allowed to write the priority information among the plurality of regions contained in each packet, while maintaining the priority information in other regions as received. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00002">
<claim-text><highlight><bold>2</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00001">claim 1</dependent-claim-reference>, wherein the transmission unit determines the priority information to be written into said one region by said node device according to a priority level specified by one or a combination of plural of the priority information written in the plurality of regions contained in each packet received by the reception unit. </claim-text>
</claim>
<claim id="CLM-00003">
<claim-text><highlight><bold>3</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00002">claim 2</dependent-claim-reference>, wherein the transmission unit determines the priority information to be written into said one region by said node device such that an amount of communication resources to be used by selected packets, which are to be transmitted by writing the priority information indicating a high priority into said one region, will approach an amount of communication resources allocated to a set of packets to which said selected packets belong. </claim-text>
</claim>
<claim id="CLM-00004">
<claim-text><highlight><bold>4</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>a transmission unit for transmitting each packet received by the reception unit by attaching a second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00005">
<claim-text><highlight><bold>5</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the transmission unit refers to the first priority information contained in each packet and attaches the second priority information indicating a high priority to those packets in which the first priority information indicates the high priority, at a higher priority over those packets in which the first priority information indicates a low priority. </claim-text>
</claim>
<claim id="CLM-00006">
<claim-text><highlight><bold>6</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00005">claim 5</dependent-claim-reference>, wherein the transmission unit attaches the second priority information indicating the high priority even to those packets in which the first priority information indicates the low priority, within a range in accordance with the allocated amount of communication resources. </claim-text>
</claim>
<claim id="CLM-00007">
<claim-text><highlight><bold>7</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00006">claim 6</dependent-claim-reference>, wherein when one packet with the first priority information indicating the high priority is received within a prescribed period of time after the second priority information indicating the high priority is attached to packets with the first priority information indicating the low priority, the transmission unit attaches the second priority information indicating the high priority to packets up to a prescribed range beyond the range in accordance with the allocated amount of communication resources, even when packets received by the reception unit exceed the range in accordance with the allocated amount of communication resources. </claim-text>
</claim>
<claim id="CLM-00008">
<claim-text><highlight><bold>8</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00007">claim 7</dependent-claim-reference>, wherein when another packet with the first priority information indicating the low priority is received within a prescribed period of time after the second priority information indicating the high priority is attached to packets up to the prescribed range beyond the range in according with the allocated amount of communication resources, the transmission unit attaches the second priority information indicating the low priority to packets until a part that exceeded the range in accordance with the allocated amount of communication resources is compensated even if said another packet is within the range in accordance with the allocated amount of communication resources. </claim-text>
</claim>
<claim id="CLM-00009">
<claim-text><highlight><bold>9</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the reception unit receives packets in which the first priority information is attached according to an amount of communication resources allocated to a flow to which each packet belongs, between the transmission node or the transmission network and the management network. </claim-text>
</claim>
<claim id="CLM-00010">
<claim-text><highlight><bold>10</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the transmission unit transmits each packet in a form of being encapsulated in a lower layer packet by writing at least an information corresponding to the second priority information into a packet header of the lower layer packet. </claim-text>
</claim>
<claim id="CLM-00011">
<claim-text><highlight><bold>11</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00004">claim 4</dependent-claim-reference>, wherein the transmission transmits each packet in a form of being encapsulated in an identical layer packet by setting each packet containing the first priority information as a payload and writing at least the second priority information in a packet header of the identical layer packet. </claim-text>
</claim>
<claim id="CLM-00012">
<claim-text><highlight><bold>12</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>a transmission unit for transmitting each packet received by the reception unit which contains the first priority information indicating a high priority by attaching a second priority information indicating a high priority, or transmitting each packet received by the reception unit which contains the first priority information indicating a low priority by attaching the second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00013">
<claim-text><highlight><bold>13</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>a transmission unit for transmitting each packet received by the reception unit which contains the first priority information indicating a low priority by attaching a second priority information indicating a low priority, or transmitting each packet received by the reception unit which contains the first priority information indicating a high priority by attaching the second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00014">
<claim-text><highlight><bold>14</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network and a second priority information which is attached at a previous hop node or a previous hop network; and </claim-text>
<claim-text>a transmission unit for transmitting each packet received by the reception unit which contains the first priority information indicating a high priority and the second priority information indicating a low priority, by rewriting the second priority information into that which indicates the high priority according to an allocated amount of communication resources that is allocated to a flow to which the received packet belongs, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00015">
<claim-text><highlight><bold>15</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00011">claim 14</dependent-claim-reference>, wherein the transmission unit rewrites the second priority information from that which indicates the low priority into that which indicates the high priority within a range in accordance with the allocated amount of communication resources, even in a packet in which the first priority information indicates the low priority. </claim-text>
</claim>
<claim id="CLM-00016">
<claim-text><highlight><bold>16</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00011">claim 14</dependent-claim-reference>, wherein the transmission unit writes the second priority information indicating the high priority, at a higher priority for those packets in which the second priority information indicates the high priority over those packets in which the second priority information indicates the low priority, among a plurality of packets in which the first priority information indicates an identical priority level, or regardless of what is indicated by the first priority information in packets. </claim-text>
</claim>
<claim id="CLM-00017">
<claim-text><highlight><bold>17</bold></highlight>. A node device, comprising: 
<claim-text>a judging unit for judging whether each packet to be transmitted is a first packet received from a previous hop network or a second packet which has nodes within a network to which said node device belongs as source and destination; and </claim-text>
<claim-text>a transmission unit for transmitting each packet that is judged as the first packet by the judging unit which contains a first priority information that was attached by a node other than said node device as priority information that cannot be rewritten by said node device and to which a second priority information indicating a high priority is attached as priority information that can be rewritten by said node device, or transmitting each packet that is judged as the second packet by the judging unit to which the second priority information indicating a low priority is attached, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00018">
<claim-text><highlight><bold>18</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00011">claim 17</dependent-claim-reference>, wherein the judging unit judges each packet which has a node within a network to which said node device belongs as destination among packets received from the previous hop network as the first packet. </claim-text>
</claim>
<claim id="CLM-00019">
<claim-text><highlight><bold>19</bold></highlight>. A node device, comprising: 
<claim-text>a reception unit for receiving packets each containing a first priority information that will not be rewritten after being attached at a transmission node, a transmission network, or a management network that manages the transmission node or the transmission network, and a second priority information that can be rewritten at a node on a transfer route of each packet; and </claim-text>
<claim-text>a processing unit for carrying out a transfer processing of each packet according to the second priority information contained in each packet as received. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00020">
<claim-text><highlight><bold>20</bold></highlight>. The node device of <dependent-claim-reference depends_on="CLM-00011">claim 19</dependent-claim-reference>, wherein the processing unit carrying out the transfer processing of each packet according to a priority level specified by the first priority information and the second priority information contained in each packet. </claim-text>
</claim>
<claim id="CLM-00021">
<claim-text><highlight><bold>21</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each having a plurality of regions into which priority information can be written; and </claim-text>
<claim-text>transmitting each packet received by the receiving step to a next hop node by writing the priority information according to criteria of said node into one region into which said node is allowed to write the priority information among the plurality of regions contained in each packet, while maintaining the priority information in other regions as received. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00022">
<claim-text><highlight><bold>22</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>transmitting each packet received by the receiving step by attaching a second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00023">
<claim-text><highlight><bold>23</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>transmitting each packet received by the receiving step which contains the first priority information indicating a high priority by attaching a second priority information indicating a high priority, or transmitting each packet received by the receiving step which contains the first priority information indicating a low priority by attaching the second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00024">
<claim-text><highlight><bold>24</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network; and </claim-text>
<claim-text>transmitting each packet received by the receiving step which contains the first priority information indicating a low priority by attaching a second priority information indicating a low priority, or transmitting each packet received by the receiving step which contains the first priority information indicating a high priority by attaching the second priority information according to an allocated amount of communication resources that is allocated to a flow to which each packet belongs and maintaining the first priority information as received, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00025">
<claim-text><highlight><bold>25</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each containing a first priority information which is attached at a transmission node, a transmission network, or a management network managing the transmission node or the transmission network and a second priority information which is attached at a previous hop node or a previous hop network; and </claim-text>
<claim-text>transmitting each packet received by the receiving step which contains the first priority information indicating a high priority and the second priority information indicating a low priority, by rewriting the second priority information into that which indicates the high priority according to an allocated amount of communication resources that is allocated to a flow to which the received packet belongs, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00026">
<claim-text><highlight><bold>26</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>judging whether each packet to be transmitted is a first packet received from a previous hop network or a second packet which has nodes within a network to which said node belongs as source and destination; and </claim-text>
<claim-text>transmitting each packet that is judged as the first packet by the judging step which contains a first priority information that was attached by a node other than said node as priority information that cannot be rewritten by said node and to which a second priority information indicating a high priority is attached as priority information that can be rewritten by said node, or transmitting each packet that is judged as the second packet by the judging step to which the second priority information indicating a low priority is attached, to a next hop node. </claim-text>
</claim-text>
</claim>
<claim id="CLM-00027">
<claim-text><highlight><bold>27</bold></highlight>. A packet transfer method at a node, comprising the steps of: 
<claim-text>receiving packets each containing a first priority information that will not be rewritten after being attached at a transmission node, a transmission network, or a management network that manages the transmission node or the transmission network, and a second priority information that can be rewritten at a node on a transfer route of each packet; and </claim-text>
<claim-text>carrying out a transfer processing of each packet according to the second priority information contained in each packet as received.</claim-text>
</claim-text>
</claim>
</subdoc-claims>
<subdoc-drawings id="DRAWINGS">
<heading lvl="0" align="CENTER">Drawings</heading>
<representative-figure>1</representative-figure>
<figure id="figure-D00000">
<image id="EMI-D00000" file="US20030002511A1-20030102-D00000.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00001">
<image id="EMI-D00001" file="US20030002511A1-20030102-D00001.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00002">
<image id="EMI-D00002" file="US20030002511A1-20030102-D00002.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00003">
<image id="EMI-D00003" file="US20030002511A1-20030102-D00003.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00004">
<image id="EMI-D00004" file="US20030002511A1-20030102-D00004.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00005">
<image id="EMI-D00005" file="US20030002511A1-20030102-D00005.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00006">
<image id="EMI-D00006" file="US20030002511A1-20030102-D00006.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00007">
<image id="EMI-D00007" file="US20030002511A1-20030102-D00007.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00008">
<image id="EMI-D00008" file="US20030002511A1-20030102-D00008.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00009">
<image id="EMI-D00009" file="US20030002511A1-20030102-D00009.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00010">
<image id="EMI-D00010" file="US20030002511A1-20030102-D00010.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00011">
<image id="EMI-D00011" file="US20030002511A1-20030102-D00011.TIF" imf="TIFF" ti="DR"/>
</figure>
<figure id="figure-D00012">
<image id="EMI-D00012" file="US20030002511A1-20030102-D00012.TIF" imf="TIFF" ti="DR"/>
</figure>
</subdoc-drawings>
</patent-application-publication>
